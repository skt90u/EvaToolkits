## 2016-03-04
	- 正皓
		修改報表 PASR0010
## 2016-03-01
	- 郁馨
		新增INVR0360-銷售品存貨變化表(圖表部分)
			1. 參考資料: \\10.3.25.19\share\Norman\20160301\安琪提供
			2. 圖表如果選Y，曲線圖須出現2張(一張縱軸是庫存數量INV_STOCK_MONTH_END的CURR_QTY、一張縱軸是庫存金額INV_STOCK_MONTH_END的CURR_AMT)，接著才出現圓餅圖
## 2016-02-25
	- 東鉅
		evasso 加入AD驗證機制
	- 泰尉 
		將邏輯修改成僅針對 checkAll 的 checkbox 進行 disable | enable (AUTD0080.js)

## 2016-02-19
	- 郁馨
	 1. 新增 INVR0360 -銷售品存貨變化表
	 
	 查詢條件
		- 年月(空白): YYYY/MM-YYYY/MM
		- 商品主類別: 參考下圖，但只要show G/P/W/Y
		- 商品次類別: 參考下圖
		- Kitty類商品(空白): □Y   □N
			過濾BAS_MATERIAL的料號/KITTY_FLAG
		- 會計科目(空白): XXXXXX~ XXXXXX (6位數)
			SELECT * FROM BAS_MATERIAL WHERE ACCOUNT_CODE BETWEEN '1201A*' AND '1201Z*';
		- 庫存數量為零(不顯示): □顯示   □不顯示
			SELECT * FROM BAS_MATERIAL A,INV_INVENTORY B WHERE A.CODE=B.CODE AND CURR_QTY<>0
		- 料號(空白): XXXXXXX~ XXXXXXX (無限制新增)
		- 圖表(N): □Y   □N 

https://websmp230.sap-ag.de/sap(bD16ZiZjPTAwMQ==)/bc/bsp/spn/patch_download/main_public.htm

```
SELECT 
	CODE,
	CURR_QTY,
	CURR_AMT 
FROM 
	INV_STOCK_MONTH_END
WHERE 
	PERIOD='201501'
	AND STORE_NO='AA'
	AND CODE='8100005'
```

郁馨需要提供的資料
	BASR140
參考EMAIL: RE: 新增INVR0360-銷售品存貨變化表(以這份為主)
參考報表: APNR0160

## 2016-02-15
	- 泰尉
	 1.
		* APND0062 新增，修改時更新 SHORTAGE 欄位 (APND0062.aspx.cs)
		* APND0070 新增，修改時(BLL_APND0070.cs)
	 2.
		* INVD0140 存檔時，檢查 INV_JUNK_MASTERS.DESCRIPTION -> 不可重複 (BLL_INVD0140)
	 3. SCR 製作報表(Excel | Word)如附件
	 	在 SCRM0011 功能頁中新增按鈕 【銷售資料轉檔】
		
		按鈕 【銷售資料轉檔】 顯示條件
		SCRM0010的查詢資料必須選擇
			- 裝載站別: 桃園
			- 裝載區域: PRE
			- 狀態: 現有版本
			- PS: 限定部門: I603

		報表查詢條件
			- 銷售日期起訖
			- 類別(下拉選單 = {ALL, G-禮物, ...}
				用以過濾實際要匯出的料號
				BAS_MATERIAL.CLASS
				BAS_MATERIAL.SUBCLASS
主類別 
All CLASS  IN G,P,W,Y

G-禮品
CLASS =G 排除 CLASS =G,SUBCLASS=1,7

P-化妝品
CLASS =P 排除 CLASS =P,SUBCLASS=1

Y-菸
CLASS =Y 排除 CLASS =Y,SUBCLASS=1

W-酒
CLASS =W 排除 CLASS =W,SUBCLASS=1

L-LOGO
CLASS =G &SUBCLASS=7

K-KITTY
CLASS =G &SUBCLASS=1, CLASS =W &SUBCLASS=1, CLASS =P &SUBCLASS=1, CLASS =Y &SUBCLASS=1,

			- 此頁面資訊(所有料號)

1 ~ 4 欄位參考邏輯
SELECT 
 A.VENDOR_NO,A.CODE,B.CLASS, 
 A.NAME_CHINESE, A.NAME_ENGLISH,
 A.COEFFICIENT ,C.PRICE  ,A.PREONLY_FLAG  
 FROM
 PRE_PREORDER_MATERIAL A  ,BAS_MATERIAL B, 
 (SELECT A.CODE,B.PRICE FROM 
  (SELECT CODE,MAX(SEQ) SEQ FROM CRW_SCR_COST_PRICE  GROUP BY CODE) A,
    CRW_SCR_COST_PRICE B WHERE A.CODE=B.CODE AND A.SEQ=B.SEQ) C
 WHERE  
  A.CODE=B.CODE(+)  AND  A.CODE=C.CODE (+)     
 AND A.CODE = :CODE

CRWR0090 查詢條件 
	1. 剛剛輸入的 銷售日期起訖
	2. 只有PRE ORDER
	3. 排序: 銷售金額

1. 中文名稱: NAME_CHINESE
2. 美金售價: PRICE
3. 台幣售價: 美金售價 * (CRWR0090.機上Rate) 
4. 圖片路徑: 
	* \\smasap03\IMAGE\PRE\PRE_Images
	* 檔名: {CODE} + {VENDOR_NO} .jpg
		e.g. 5001029FW020004.jpg
5. 月營收: 銷售金額=> 1/1~1/21號「銷售金額」除以21天*31天*(機上RATE)
6. 月數量: CRWR0090報表.月銷售量
7. 上架時間: select REQUEST_DATE from BAS_MATERIAL where code = :code
8. 庫存: CRWR0090報表.目前庫存量

[ORACLE 數值運算](http://mark-freefox.blogspot.tw/2011/08/oracle.html)

http://www.c-sharpcorner.com/UploadFile/0c1bb2/uploading-and-downloading-excel-files-from-database-using-as/		
	
http://geekswithblogs.net/KarthickRaju/archive/2014/06/18/download-excel-file-in-asp.net.aspx

C:\Users\Z215\Downloads\epplus-67a4ca04a276\epplus_67a4ca04a276

## 2016-02-04
	- 泰尉
	(1) 參考資料: \\C142474\Users\Norman\0204
	(2) INVD0140
存檔 INVD0141
	 INVD0143
select * from DBACCESS_ERROR

Insert Into INV_JUNK_MASTERS  (trans_no,DESCRIPTION,DEPARTMENT_NO,DEPARTMENT_SUB_NO,APPLY_DATE,APPLY_TYPE,JUNY_AMT,JUNY_QTY,status,crt_id,crt_date,crt_time,upd_id,upd_date,upd_time) values(:trans_no,:discard_no,:DEPARTMENT_NO,:DEPARTMENT_SUB_NO,:discard_date,:discard_type ,:discard_amt,:discard_qty,:status ,:user_id,:SystemDate,:SystemTime  ,:user_id,:SystemDate,:SystemTime) 
		

## 2016-02-01
	- 泰尉
	dbAccess.cs 擴充 LogError 功能

## 2016-01-30
	- 泰尉
	PURD0020 新增需求
		Cache Search Conditions
	VNDD0011 新增需求
		當部門為 I701，僅允許編輯以下欄位
		- 電話1	
		- 傳真號碼1	
		- EMAIL-1	
		- 電話2	
		- 傳真號碼2	
		- EMAIL-2	
		- 網站	
		- 廠商認証	
		- E_MAIL3


## 2016-01-29
	- 泰尉
	除錯 EVAAIRBW Default.aspx.cs
	- 佩琳
	除錯 B2CD0014


## 2016-01-28
	- 東鉅
	JOBS.PSDF020 改成經由 PSD_ORDER_SEQ 抓取 ORDER_NO 
	- 泰尉
	JOBS.INVF150 額外新增兩張報表

	- 佩琳
	- 修正載入的時候畫面空白的問題
\\c142464\SMAS.MainWebAP\SMAS.MainWebAP.B2C
B2CD0014.cs
B2CD0014.js 
B2CD0011.js
主要是這三隻
5400949>>商品料號


## 2016-01-27
	- 東鉅
	EvaSso 
	- 修正IE錯誤(jQuery)
	- 修正Login.aspx無法取得相關CSS與JS的錯誤(Web.config)

## 2016-01-26
	- 泰尉
	修正  Produce.cs
	- 依婕
	修正  SMAS.CRW 專案 AntiXSS 無法識別的問題 
	
## 2016-01-25
	- 東鉅
	修正  PSDF020 錯誤

## 2016-01-22
	- 東鉅
	EvaSso 
	- 支援 RWD
	- 畫面參考 https://almsaeedstudio.com
	- 支援 Single Sign On
	- 作為其他子系統的 Portal

	- 郁馨
	加入【我的最愛】沒有效果
```
SELECT D.PROG_NAME,
       PROG_PATH,
       CONCAT (CONCAT (DEPT, ' - '), D.PROG_NAME) DEPT,
       PROG_DESC
  FROM AUT_PROGRAM C,
       (  SELECT USER_ID, PROG_NAME
            FROM AUT_COMMON_USE
           WHERE USER_ID = :USER_ID
        ORDER BY SEQ) D,
       AUT_BY_USER E
 WHERE     C.STATUS = '1'
       AND C.PROG_NAME = D.PROG_NAME
       AND C.PROG_NAME = E.PROG_NAME
       AND D.USER_ID = E.USER_ID
```

## 2016-01-20
	- 東鉅
	EvaSso 
	- 支援 RWD
	- 畫面參考 https://almsaeedstudio.com
	- 支援 Single Sign On
	- 作為其他子系統的 Portal

## 2016-01-19
## 2016-01-18

	- 郁馨
		長榮(SMAS.MainWebAP)
			(1) BASR0120
			(2) BASR0130
		立榮(SMAS.MainWebAP)
			(1) BASR130
			(2) BASR140
		需求說明：
			(1)  將標題 【再製品】 改成 【在製品】
			(2)  將欄位 【再製品】 改成 【製成品】
			(3)  處理【品名】顯示超出的部份
		輸出內容(FOLDER)：
			\\10.3.25.19\share\Norman\20160118\郁馨
		輸出內容(GIT)：

## 2016-01-15
	- 郁馨
	  * 處理在測試環境無法執行 BulkCopy 的問題 (沒有安裝 ODP.NET)

	- 泰尉  
	  * 修改 LCSD0011 存檔邏輯，如果跳出
		天數，X天，低於 ...
        當按下確定按鈕後，需跳出 【是否知會主管?】
        並將使用者選擇(Y/N)紀錄在 INV_TRANS_MASTER.XXX
        
        在 AUTD0080 中的查詢結果，當 INV_TRANS_MASTER.XXX 為 Y 需要特別標記該筆資料(請參考 EMAIL - LCSD0013 檢核機制+電子表單顯示)

public string Submit_Next(string TRANS_NO, string REMARK, string AUT, string CARD_ID, string STATUS = "", string TABLENAME = "", bool ReturnSQL_STR = false, string DEPT = "", string NOTIFY_SUPERUSER = "N")

全部尋找 "insert into AUT_WORK_FLOW_LOG", 子資料夾, 尋找結果 1, 整個方案, "*.cs"
  C:\inetpub\wwwroot\SMAS.MainWebAP\SMAS.MainWebAP\Common\WorkFlow.cs(136):                        m_SQL = " Insert Into AUT_WORK_FLOW_LOG(  TRANS_NO, SEQ_NO, CARD_ID, DEPARTMENT_NO_S, DEPARTMENT_SUB_NO_S, EMPLOYEE_NO_S, DATE_S, TIME_S, DEPARTMENT_NO_A, DEPARTMENT_SUB_NO_A, POS_SEQ_START, POS_SEQ_END, AUTHORITY, PATH_ID, STATUS, MANAGER, REMARK )  ";
  C:\inetpub\wwwroot\SMAS.MainWebAP\SMAS.MainWebAP\Common\WorkFlow.cs(290):                            m_SQL = " Insert Into AUT_WORK_FLOW_LOG(  TRANS_NO, SEQ_NO, CARD_ID, DEPARTMENT_NO_S, DEPARTMENT_SUB_NO_S, EMPLOYEE_NO_S, DATE_S, TIME_S, DEPARTMENT_NO_A, DEPARTMENT_SUB_NO_A, POS_SEQ_START, POS_SEQ_END, AUTHORITY, PATH_ID, STATUS, MANAGER, REMARK )  ";
  相符的行: 2    相符的檔案: 1    搜尋的檔案總數: 3134

848331  登入後 執行 LCSD0011 送審，851085 登入 核決
我不能幫你做單，因為程式在你本機

	  * 修改 LCSD0013 存檔邏輯
	    參考 LCSD0011 存檔邏輯，

測試環境 tnsnames.ora		
C:\app\649426\product\11.2.0\client_1\Network\Admin

hfNotifySupervisor

## 2016-01-13  
	- 東鉅
	  * EvaSso RWD
	  * [參考網頁](http://www.w3schools.com/bootstrap/default.asp)
	  * [參考版型](https://almsaeedstudio.com/)
	- 泰尉  
	  * APND0062 當料庫庫存不足，更新 DETAIL 特定欄位
		```
		UPDATE INV_ORDER_DETAILS SET SHORTAGE='Y' WHERE OREDER_NO=:ORDER_NO AND CODE =:CODE
		```
	  * INVR0050 增加一欄位 允收期效
strSQL = @" SELECT A.STORE_NO,  A.CODE,  B.ENGLISH_SHORTNAME,  B.STORE_UNIT, NVL(A.CURR_QTY,0)CURR_QTY, NVL(C.QTY,0)QTY,  C.EXPIRE_DATE, D.CONFIRM_DATE, D.TRANS_NO, NVL (F.TRANS_QTY, 0) TRANS_QTY, B.EXP_DATE, B.EFFECT_DAYS
http://localhost/SMASWebAP/INV/INVR0050.ASPX?d=1452060896637
1100055 ~ 1100055

http://qasmasap01/SMASWebAP/INV/INVR0050.ASPX?d=1452668057156

## 2016-01-11
	- 郁馨
	  * SMAS (BASR0120, BASR0130) 將查詢條件由料號改成料號起訖
	  * 立榮 SMAS (BASR130, BASR140) 將查詢條件由料號改成料號起訖

## 2016-01-08
	- 泰尉
	  Login: 360861

```		* 
update PUR_REQUEST_DETAILS set status ='2' where REQUEST_NO='M160000026'; 
update PUR_REQUEST_master set status ='2' where REQUEST_NO='M160000026'; 
update aut_work_flow_log set STATUS ='W' where TRANS_NO='M160000026'; 
DELETE FROM aut_work_flow_log where SEQ_NO='30' and TRANS_NO='M160000026';   
```
	CheckResult:
		OK -> PUR_REQUEST_DETAILS.STATUS = 3 
		BAD -> PUR_REQUEST_DETAILS.STATUS = Z 

		PURD0011.aspx

## 2016-01-07
	- 東鉅
		* 處理 ORACLE 拋出的例外	
	- 泰尉
		* 在專案 SMAS_LCSAP 的 LCSMessage.cs 擴充例外發生時紀錄的資訊。
	- 郁馨
		* 轉檔 BASF060 (HouseKeeping)
		  dataBase id="SCS"

## 2016-01-06
	- 東鉅
		* 修正先前轉檔程式邏輯 (\\c97211\SHARE\Norman\160106)
		 - 一開始說在半夜轉移次
		 - 想再起飛時間前2小時，在更新一次
	- 泰尉
		* 轉檔【INVF150】 將 INVR0050 批次列印以 JOB 方式執行，並以郵件寄送，其產出報表將以附加檔案的方式寄送至指定對象
		  查詢參數[料庫]
			- MANG
			- MANO
		  寄送對象
			BAS_REFERENCE_DATA_DETAILS    CONFIG_TYPE=INVF140
	- 東鉅
		https://myb2b.evaair.com/smasb2b/VND/VNDW0010.aspx?action_type=ADD&GUID=b6132f5d-cb3a-446f-9d72-999b25fbdb2f

 
## 2016-01-04
	- 泰尉
		* INVD0021 處理某些資料在執行【新增空白欄位】動作的問題

## 2015-12-31
	- 泰尉
		* 使用 merge 寫法 修改 Procedure.cs #4215 
## 2015-12-30
	- 泰尉
		* 修正 請購轉訂購送貨地址 ( PURD0012.aspx.cs )

## 2015-12-29
	- 郁馨
		* 修正 INVD0031.aspx.cs 送審流程
		* 修正 INVD0221
	
現在   I703 WEB倉，走 G66 

INV_TRANS_MASTER

854180登入INVD0221
5201294
QP15004840

## 2015-12-28
	- 信榮
		CrystalReport 問題

## 2015-12-25
	- 郁馨
		修正 INVD0021.aspx 送審前的驗證邏輯
```		
SELECT ROWID,B.* FROM INV_EXPIRE_MATERIAL_STOCK B 
WHERE CODE='4800791' 
AND STORE_NO='MANO' 
ORDER BY EXPIRE_DATE DESC; 
--原始 
MANO    4800791    20160730    29040    0    0 
MANO    4800791    20160729    960    960    0

用 C93909 登入

INVD0021

H150010779
```
	
## 2015-12-23
	- 泰尉
	  LCSD0014 新增兩個按鈕 [上一頁], [下一頁]
	  http://smasap.evaair.com/SMASWebAP/LCS/LCSD0014.aspx
	  http://smasap.evaair.com/SMASWebAP/LCS/LCSD0010.aspx
	- 依潔
		處理 新航線資料無法顯示 的 BUG
		BUDD0031.aspx
		ReportLogic_CRW
## 2015-12-18
	- 郁馨
	查詢核決按鈕怎麼無法顯示

## 2015-12-17
	- 依捷
	1. 修正 核銷維護作業 CRWD0081 存檔邏輯 
		* 參考資料表: CRW_DEBIT_NOTE_DETAILS
		* 測試資料 (CRWD0080 -> 2015110058 -> 核銷) 
			2015110058
			2015110087
		* 重點欄位
			CRW_DEBIT_NOTE_DETAILS.CLEAR_MARK
			CRW_DEBIT_NOTE_DETAILS.CASH_FIRST_ACCEPT_DATE
		* 修正重點
			CLEAR_MARK=Y 代表USER 已經處理過，不能異動此筆任何資料
			故系統在存檔時，應判斷CLEAR_MARK=N 的資料才能修改
 		
		* ??? : if (txtUNREC_AMT.Text.Trim() == "0")
	- 東鉅
	1. VNDD0058 修改公式
		* VNDD0051 
			採購公告編號輸入 H150136，
			商品種類 選擇 免徵營業稅
			點選 陳核畫面預覽
			
		* VNDD0058 的 Margin計算公式應為 
			﹝建議售價(含稅)-供應單價(未稅) ﹞/ 建議售價(含稅)=?%
			顯示到小數點第一位數
	2. Fortify 掃描

http://localhost/SMASWebAP/CRW/CRWD0080.aspx
http://localhost/SMASWebAP/CRW/CRWD0080.aspx

http://localhost/SMASWebAP/VND/VNDD0051.aspx
http://localhost/SMASWebAP/VND/VNDD0058.aspx


Belinda Shao 邵郁馨 [下午 04:07]: 
10/7、10/8、10/15、10/23工時統分改掛案件-P3515M0073
蘇國棟 [下午 04:07]: 
OK
Belinda Shao 邵郁馨 [下午 04:08]: 
另10/23百分比記得設100
蘇國棟 [下午 04:08]: 
好


## 2015-12-15
	- 信榕
	1. APNF110 
		將超過一個月的資料搬移到指定資料夾
			來源：測試路徑：\\qasmasbt01\smas_eva\OUTPUT\APN\POS\backup


	
## 2015-12-11
	- 依婕
	1. 處理 TNS: 無法解析指定的連線 ID
	- 東鉅(暫時pending，因為尚未與USER確認企業邏輯)
	2. 權利金核銷作業 - 退貨行為錯誤，http://localhost/SMASWebAP/CAT/CATD0040.aspx?d=1449802594018
	- 泰尉
	3. 問卷系統 修改 QUED0021 增加欄位
```
SMASTEST.evaair.com
SCS
p35scs2015

<dataBase id="SCS" EventLog="true" EventLogPath="C:\com.ddsc.database">
   <dbType>ORACLE</dbType>
   <dbServer>SMASTEST.evaair.com</dbServer>
   <userID>G9GG0sM8nvEFr05oYmIhTZKKIol73T0lbcXDsRk2bY8=</userID>
   <userPW>t4KCb/l0nKhEaxX86NUhqEHvuSmzmbx0vuZtWyhuqH8=</userPW>
   <connectionTimeOut>100000</connectionTimeOut>
</dataBase>
```
	4. 問卷系統(修改 noncode 欄位 對應意義為 code_id)
	\\10.3.25.19\share\Norman\1211\泰尉\(TODO)需求02
	QUA_BCR_MASTER_BYCODE
	BAS_SUB_COMMON_TYPE

	- 郁馨
	5. FortifyIssue
		* B2C_ERROR
		* MainWebAP_ERROR
 
```
public static DataTable QuickQuery<T>(string sql, T args)
        {
            const string space = " ";
            sql = sql.Replace("\t", space)
                        .Replace("\r\n", space)
                        .Replace("\n", space)
                        .TrimEnd(new char[] { ';' });

            dbAccess dba = new dbAccess();

            var argsProperties = args.GetType().GetProperties();

            // (1) 根據組合SQL判斷實際要加入的參數

            List<string> sqlParams = new List<string>();
            var paramPattern = @":\w+";
            foreach (Match match in Regex.Matches(sql, paramPattern, RegexOptions.IgnoreCase))
            {
                foreach (Group group in match.Groups)
                {
                    string sqlParam = group.Value.Substring(1).ToUpper();

                    if (!argsProperties.Any(p => sqlParam == p.Name))
                        throw new Exception(string.Format("尚未設定 :{0} 對應參數", sqlParam));

                    if (!sqlParams.Contains(sqlParam))
                        sqlParams.Add(sqlParam);
                }
            }

            ArrayList arrParam = new ArrayList();
            foreach (var property in argsProperties)
            {
                if (sqlParams.Contains(property.Name))
                {
                    arrParam.Add(dba.GetOracleParam(":" + property.Name, Convert.ToString(property.GetValue(args))));
                }
            }

            // (4) 查詢資料
            DataSet ds = dba.runExecuteQuery("QuickQuery", sql, arrParam);

            return ds.Tables["Info"].Rows[0]["ReturnCode"].ToString() == "000"
                ? ds.Tables["QuickQuery"]
                : null;
        }
```

## 2015-12-10
	1. Foritfy - C:\Backup\20151210
	2. Fixed PURD0040 Bug

	http://localhost/SMASWebAP/PUR/PURD0040.aspx
	申請單日期 20151208 ~ 20151208
	click [修改]
	http://localhost/SMASWebAP/PUR/PURD0041.aspx
	click [簽收單]
	click [轉AP]
	
	\\qasmasbt01\smas_eva\OUTPUT\PUR\AFP0

## 2015-12-09
	- 郁馨
	1.	COPY BCRM0090，新增 BCRM0100 - 商務艙睡衣裝載版本維護作業 ，並作SIT文件
		將 APN_NIGHTPACKAGE_VERSION_QTY 改為 APN_NIGHTGOWN_VERSION_QTY
	2.	COPY APND0200，新增 APND0240 – 商務艙睡衣產領料單作業 ，並作SIT文件
	    將 APN_NIGHTPACKAGE_DATA 改為 APN_NIGHTGOWN_DATA
	3.	COPY BCRR0070，新增 BCRR0090 – 商務艙睡衣裝載表列印作業 ，並作SIT文件
		將 APN_NIGHTPACKAGE_DATA 改為 APN_NIGHTGOWN_DATA
	todo: strResults = m_Rpt.BCRR0090(P_SEQ, P_com, P_pgm, P_user,P_ldate, P_date,  P_date2);
	http://localhost/SMASWebAP/BCR/BCRR0090.aspx	
	
	APND0240(Fixed01)
	oTd0.style.width = DetailTitle1.rows(0).cells(0).style.width;
	改成
	oTd0.style.width = DetailTitle1.rows[0].cells[0].style.width;
	
	APND0240(Fixed02)
	e.Message
	改成
	e.message

	APND0240(Fixed03)
    <div class='scroll' id='boxscroll' style='height: 91%;'>
        <table id='DetailTable' width='98%' border='0' align='center' runat="server" cellpadding='5' cellspacing='0' class='table02'>
        </table>
    </div>
	改成                            
    <table id='DetailTable' width='98%' border='0' align='center' runat="server" cellpadding='5' cellspacing='0' class='table02'>
    </table>

	APND0240(Fixed04)
	document.ready 
	加上
	$('#btnDELETE3').hide();

	- 泰尉 
	CTMF050 在發送郵件的附加檔案中顯示的報表內容也呈現在郵件內容中


## 2015-12-08
	- 解決 Fortify Issue
	- BASR0010
		* VND_VENDOR.VENDOR_NO
		* 如果查詢條件選擇 停售品+各料庫，使用新報表(比舊報表多六個欄位) 
		* REMARK_TXT 欄位用單行
```
SELECT
    REMARK_TXT
FROM    
(
SELECT 
    -- REMARK_TXT
    * 
FROM 
    BAS_MATERIAL_REMARK_LOG 
WHERE 
    CODE = '0100016'
ORDER BY LOG_SEQ DESC    
-- GROUP BY CODE HAVING COUNT(1) > 1
)    
WHERE ROWNUM = 1    
    
```

```
SELECT 
    -- NVL(CURR_QTY, 0) AS CURR_QTY
    * 
FROM 
    INV_INVENTORY 
WHERE 
    CODE = '1600017' 
    -- AND STORE_NO = 'MANO'
    -- AND STORE_NO IN ('....')
    

```

	- APN有新的掃描檔，再請看一下
		
## 2015-12-07
	- 解決 Fortify Issue
		* CRWD0170.cs
		* CRWM0032.aspx.cs


## 2015-12-04
除錯

測試機
QAUNISMASAP01.UNIAIR.COM.TW
EVAAIR\E70964\19910102

SMAS
登入者  360861  \1~8

select dept_stn||ariv_stn as flt_phase  from CRW_KPI_INCENTIVE_COMMON_D     

select * from CRW_EXCHANGE_RATE
where exch_type='A'

## 2015-12-01
區分成新航線，非新航線，全部三類
http://smasap02.evaair.com/SMASWebAP/CRW/CRWR0270.aspx?d=1449019374301

伺服器: BGTT.EVAAIR.COM
帳號: FIN_SMAS
密碼: FINSMAS12

http://localhost/SMASWebAP/CRW/CRWR0270.aspx

測試
http://localhost/SMASWebAP/BUD/BUDD0033.aspx

"Data Source=BGTT; User Id=FIN_LINK; Password=SMAS_BGTT08;Max Pool Size=300"

"Data Source=BGTT.evaair.com; User Id=FIN_LINK; Password=SMAS_BGTT08;Max Pool Size=300"

01L^022015012936 -->已維護
01L^022014031507

\\C97211\share\tool

## 2015-11-30
1.
http://qasmasap01/SMASWebAP/Index.aspx
20150901~20150930
http://qasmasap01/SMASWebAP/PUR/PURR0120.aspx?d=1448864480602


BUDD0031
public static object ExportPurchaseAmount(string YEAR, string BUDGET_NO, string BUDGET_MONTH, string BUDGET_YEAR_MONTH)

CRW_KPI_INCENTIVE_COMMON
CRW_KPI_INCENTIVE_COMMON_D
BUDD0031-ExportPurchaseAmount
OU0101

SQL01
```
SELECT 
	DECODE (CLASS, 'C', CLASS || SUBCLASS, CLASS) CLASS, BUDGET_CODE
FROM 
	BAS_MATERIAL_CLASS
WHERE    
	(CLASS_LEVEL = '1' AND CLASS IN ('Y', 'G', 'W', 'P'))
    OR (CLASS_LEVEL = '2' AND CLASS IN ('C'))
```

SQL02  
```
DELETE FROM BUD_ESTIMATE_SCR_PRICE WHERE YEAR=:YEAR AND MONTH=:MONTH
```

SQL03  
```
SELECT A.*,
       (SELECT 
			NVL (SUM (PAX_CNT), 0)
		FROM 
			(SELECT 
				SUBSTR (FLT_NO, 1, 2) || LPAD (SUBSTR (FLT_NO, 3), 4, '0')
				FLT_NO,
                PERIOD,
                PAX_CNT
			FROM 
				MIS
		    WHERE 
				PERIOD = :PERIOD
			GROUP BY MIS.FLT_NO, PAX_CNT, PERIOD)
         WHERE FLT_NO = A.FLT_NO) PAX_CNT
  FROM (  
	SELECT 
		DECODE (BAS_MATERIAL.CONSIGNED, 'Y', 'C' || BAS_MATERIAL.CLASS, BAS_MATERIAL.CLASS) AS CLASS,
		SUBSTR (FLT_NO, 1, 2) || LPAD (SUBSTR (FLT_NO, 3), 4, '0') FLT_NO,
		FLT_PHASE,
		ROUND (SUM (SALE_QTY * PRICE_US), 4) REV_US,
		ROUND (SUM (SALE_QTY * PRICE_TW), 4) REV_TW
	FROM 
		BAS_MATERIAL,
		(SELECT 
			CLASS, 
			BUDGET_CODE
		FROM 
			BAS_MATERIAL_CLASS
		WHERE 
			CLASS_LEVEL = '1') MATERIAL_CLASS,
		(SELECT 
			PERIOD,
			CODE,
			DECODE (PAX_CNT, 0, 1, PAX_CNT) PAX_CNT,
			(SEC_FM || SEC_TO) AS FLT_PHASE,
			FLT_NO,
			SALE_QTY,
			COST_US,
			PRICE_US,
			COST_TW,
			PRICE_TW
		FROM 
			MIS
		WHERE PERIOD = :PERIOD) MIS
	WHERE     
		BAS_MATERIAL.CODE(+) = MIS.CODE
		AND BAS_MATERIAL.CLASS = MATERIAL_CLASS.CLASS(+)
        GROUP BY 
			SUBSTR (FLT_NO, 1, 2) || LPAD (SUBSTR (FLT_NO, 3), 4, '0'),
			FLT_PHASE,
			DECODE (BAS_MATERIAL.CONSIGNED, 'Y', 'C' || BAS_MATERIAL.CLASS, BAS_MATERIAL.CLASS)
        ORDER BY FLT_NO) A
```

SQL04  
```
CASE "W":
INSERT INTO BUD_ESTIMATE_SCR_PRICE

CASE "Y":
INSERT INTO BUD_ESTIMATE_SCR_PRICE

CASE "P":
INSERT INTO BUD_ESTIMATE_SCR_PRICE

CASE "G":
INSERT INTO BUD_ESTIMATE_SCR_PRICE

CASE "CW":
INSERT INTO BUD_ESTIMATE_SCR_PRICE

CASE "CY":
INSERT INTO BUD_ESTIMATE_SCR_PRICE

CASE "CP":
INSERT INTO BUD_ESTIMATE_SCR_PRICE

CASE "CG":
INSERT INTO BUD_ESTIMATE_SCR_PRICE  
```

SQL05  
```
SELECT 
	DISTINCT CONCAT (SUBSTR (FLT_NO, 1, 2), LPAD (SUBSTR (FLT_NO, 3, 4), 4, '0')) AS FLT_NO
FROM 
	BAS_MATERIAL MATERIAL,
	(SELECT 
		PERIOD,
		CODE,
		DECODE (PAX_CNT, 0, 1, PAX_CNT) PAX_CNT,
		(SEC_FM || SEC_TO) AS FLT_PHASE,
		FLT_NO,
		SALE_QTY,
		COST_US,
		PRICE_US,
		COST_TW,
		PRICE_TW
	FROM 
		MIS
   WHERE 
	PERIOD IN (sPERIOD_SQL)) MIS
WHERE     
	MATERIAL.CLASS IN ('C', 'P', 'Y', 'G', 'W')
	AND MATERIAL.CODE(+) = MIS.CODE
GROUP BY 
	FLT_NO,
	PERIOD,
	DECODE (MATERIAL.CONSIGNED, 'Y', 'C', MATERIAL.CLASS)
```

## 2015-11-26

1. 解決 Mp3DownloadHandler.ashx.cs FortifyIssure
2. 處理刪除功能不正常的問題
http://localhost/smaswebap/BCR/BCRD0020.aspx

<asp:Button ID="btnDELETE" runat="server" Text="刪除" class="BtnOn" PostBackUrl="~/BCR/BCRD0021.aspx" Visible="false" />

空值
public static Object Query_Data(string p_CLASS, string p_LOAD_NO, string p_AC_TYPE)

登入身分 C91347 
3. 立榮 BASR0140

```
CREATE OR REPLACE PROCEDURE UNISMAS.SP_BASR140_RPT(
  P_SEQ        IN VARCHAR2,
  P_USERNAME   IN VARCHAR2,
  P_DEPT       IN VARCHAR2,  
  P_CODE       IN VARCHAR2,
  P_CLASS      IN VARCHAR2,
  P_COMPANY    IN VARCHAR2,
  P_PROGRAM    IN VARCHAR2
) IS
    V_COUNT INTEGER := 0;
    C2      VARCHAR2(500) := '';
BEGIN

    IF P_CLASS = 'CODE' THEN
        
        C2 := '再製品';
        
        INSERT INTO BAS_RPT_TMP ( SEQ, C1, C2, C3, C4, C5, C6, C7)
        SELECT
            P_SEQ,
            P_CODE,
            C2,
            REC.CODE, -- C3 ~ C7
            REC.ENGLISH_SHORTNAME,
            REC.CHINESE_SHORTNAME,
            ROWNUM,
            (CASE WHEN REC.CLASS = 'CODE' THEN '再製品'
                  WHEN REC.CLASS = 'PARTS_CODE' THEN '生料'
                  ELSE '全部' END)
        FROM
        (
            SELECT
                A.CODE,
                B.ENGLISH_SHORTNAME,
                B.CHINESE_SHORTNAME,
                'CODE' AS CLASS
            FROM 
                UNI_UNIFORM_COMPONENT A,
                BAS_MATERIAL B
            WHERE 1 = 1 
                AND (A.CODE = P_CODE AND A.CODE = B.CODE(+))
            GROUP BY A.CODE, B.ENGLISH_SHORTNAME, B.CHINESE_SHORTNAME, CLASS
            ORDER BY A.CODE            
        ) REC;
        
    ELSIF P_CLASS = 'PARTS_CODE' THEN
        
        C2 := '生料';
        
        INSERT INTO BAS_RPT_TMP ( SEQ, C1, C2, C3, C4, C5, C6, C7)
        SELECT
            P_SEQ,
            P_CODE,
            C2,
            REC.CODE, -- C3 ~ C7
            REC.ENGLISH_SHORTNAME,
            REC.CHINESE_SHORTNAME,
            ROWNUM,
            (CASE WHEN REC.CLASS = 'CODE' THEN '再製品'
                  WHEN REC.CLASS = 'PARTS_CODE' THEN '生料'
                  ELSE '全部' END)
        FROM
        (
            SELECT
                A.CODE,
                B.ENGLISH_SHORTNAME,
                B.CHINESE_SHORTNAME,
                'PARTS_CODE' AS CLASS
            FROM 
                UNI_UNIFORM_COMPONENT A,
                BAS_MATERIAL B
            WHERE 1 = 1 
                AND (A.PARTS_CODE = P_CODE AND A.PARTS_CODE = B.CODE(+))
            GROUP BY A.PARTS_CODE, B.ENGLISH_SHORTNAME, B.CHINESE_SHORTNAME, CLASS
            ORDER BY A.PARTS_CODE            
        ) REC;
        
    ELSE
    
        C2 := '全部';
        
        INSERT INTO BAS_RPT_TMP ( SEQ, C1, C2, C3, C4, C5, C6, C7)
        SELECT
            P_SEQ,
            P_CODE,
            C2,
            REC.CODE, -- C3 ~ C7
            REC.ENGLISH_SHORTNAME,
            REC.CHINESE_SHORTNAME,
            ROWNUM,
            (CASE WHEN REC.CLASS = 'CODE' THEN '再製品'
                  WHEN REC.CLASS = 'PARTS_CODE' THEN '生料'
                  ELSE '全部' END)
        FROM
        (
            SELECT
                CODE,
                ENGLISH_SHORTNAME,
                CHINESE_SHORTNAME,
                CLASS
            FROM 
            ( 
                SELECT
                    A.CODE,
                    B.ENGLISH_SHORTNAME,
                    B.CHINESE_SHORTNAME,
                    'CODE' AS CLASS
                FROM 
                    UNI_UNIFORM_COMPONENT A,
                    BAS_MATERIAL B
                WHERE 1 = 1 
                    AND (A.CODE = P_CODE AND A.CODE = B.CODE(+))
                    GROUP BY A.CODE, B.ENGLISH_SHORTNAME, B.CHINESE_SHORTNAME, CLASS
                UNION 
                SELECT
                    A.PARTS_CODE AS CODE,
                    B.ENGLISH_SHORTNAME,
                    B.CHINESE_SHORTNAME,
                    'PARTS_CODE' AS CLASS
                FROM 
                    UNI_UNIFORM_COMPONENT A,
                    BAS_MATERIAL B
                WHERE 1 = 1 
                    AND (A.PARTS_CODE = P_CODE AND A.PARTS_CODE = B.CODE(+))
                    GROUP BY A.PARTS_CODE, B.ENGLISH_SHORTNAME, B.CHINESE_SHORTNAME, CLASS  
            ) 
            ORDER BY CODE        
        ) REC;
        
    END IF;    
    
    SELECT COUNT(1) INTO V_COUNT FROM BAS_RPT_TMP WHERE SEQ = P_SEQ;
   
    IF V_COUNT=0 THEN
        INSERT INTO BAS_RPT_TMP ( SEQ, C1, C2, C50)
        VALUES (P_SEQ,
                P_CODE,
                C2,
                '* 　選取範圍內無資料　*');
    END IF;    
END;
/

```
## 2015-11-25
1. 新增 BASR130 再製品材料成本規格表
http://localhost/SMAS/BAS/BASR130.ASPX

2. 新增 BASR140 生料及再製品明細清單表
http://localhost/SMAS/BAS/BASR140.ASPX

測試料號: 65SU000
登入身分: 180040

```
CREATE OR REPLACE PROCEDURE UNISMAS.SP_BASR130_RPT(
  P_SEQ        IN VARCHAR2,
  P_USERNAME      IN VARCHAR2,
  P_DEPT          IN VARCHAR2,  
  P_CODE          IN VARCHAR2,
  P_COMPANY      IN VARCHAR2,
  P_PROGRAM      IN VARCHAR2
) IS
    V_COUNT INTEGER := 0;
BEGIN
    
    INSERT INTO BAS_RPT_TMP ( SEQ, C1, C2, C3, C4, C5, C6, C7, C8, C9, C10, C11, C12)
    SELECT
        P_SEQ,
        P_CODE,
        ROWNUM,
        REC.CODE,
        REC.CODE_ENGLISH_SHORTNAME,
        REC.CODE_CHINESE_SHORTNAME,
        REC.PARTS_CODE, -- C6 ~ C10
        REC.PARTS_CODE_ENGLISH_SHORTNAME,
        REC.PARTS_CODE_CHINESE_SHORTNAME,
        TO_CHAR(REC.CURR_UNIT_PRICE),
        TO_CHAR(REC.PARTS_QTY),
        TO_CHAR(REC.UNIFORM_COST), -- C11 ~ C12
        REC.CRT_DATE
    FROM
    (
        SELECT 
            A.CODE,
            B.ENGLISH_SHORTNAME CODE_ENGLISH_SHORTNAME,
            B.CHINESE_SHORTNAME CODE_CHINESE_SHORTNAME,
            A.PARTS_CODE,
            C.ENGLISH_SHORTNAME PARTS_CODE_ENGLISH_SHORTNAME,
            C.CHINESE_SHORTNAME PARTS_CODE_CHINESE_SHORTNAME,
            C.CURR_UNIT_PRICE,
            A.PARTS_QTY,
            B.UNIFORM_COST,
            A.CRT_DATE
        FROM 
            UNI_UNIFORM_COMPONENT A,
            BAS_MATERIAL B,
            BAS_MATERIAL C
        WHERE 1 = 1
            AND A.CODE = P_CODE
            AND A.CODE = B.CODE(+) 
            AND A.PARTS_CODE = C.CODE(+)    
    ) REC;
    
    SELECT COUNT(1) INTO V_COUNT FROM BAS_RPT_TMP WHERE SEQ = P_SEQ;
   
    IF V_COUNT=0 THEN
        INSERT INTO BAS_RPT_TMP ( SEQ, C1, C50)
        VALUES (P_SEQ,
                P_CODE,
                '* 　選取範圍內無資料　*');
    END IF;    
END;
/




```

## 2015-11-24
1. 新增 BASR130 再製品材料成本規格表
2. 新增 BASR140 生料及再製品明細清單表

## 2015-11-23
請假

## 2015-11-20
1. 新增 BASR130 再製品材料成本規格表
2. 新增 BASR140 生料及再製品明細清單表
180040
1~8

請參考
BASR0120
BASR0130

SELECT * FROM AUT_PROGRAM
WHERE PROG_NAME='BASR120';

SELECT * FROM AUT_MENU_CONTROL
WHERE PROG_NAME='BASR120';

INSERT INTO AUT_MENU_CONTROL(MODID, PROG_NAME, CLASS_SEQ, SEQ, STATUS, CRT_ID, CRT_DATE, CRT_TIME, UPD_ID

SELECT MAX(SEQ) FROM AUT_MENU_CONTROL

UNISMAS / p35UNISMAST083

## 2015-11-19
解決 EVA_CONTROL 在 IE 顯示錯誤的問題

## 2015-11-18

將原本寫在PSD0070的邏輯寫到Produce裡面
msg = WORK_FLOW(TRANS_NO, REMARK, AUT, CARD_ID, SEQ_NO, PATH_ID, STATUS, ReturnSQL_STR);
  case "OC"://ADD BY EVELYN
                                            m_sp.SP_OC_TRANS_DEAL(TRANS_NO, DateTime.Now.ToString("yyyyMMdd"), AUT, STATUS, OnUser.ID, OnUser.Department + OnUser.Department_Sub);
                                            break;
                                        case "DE":
                                            m_sp.SP_DE_TRANS_DEAL(TRANS_NO, DateTime.Now.ToString("yyyyMMdd"), AUT, STATUS, OnUser.ID, OnUser.Department + OnUser.Department_Sub);
                                            break;


## 2015-11-17

PSDD0070
PSDD0071
修改表單流程，
移除*核決*功能
新增*送審*功能

## 2015-11-16

BASR0120 加上 再製品的CRT_DATE

## 2051-11-13

Job - PSDF020

1. 程式碼來源 \\C127123\inetpub\SmasTrans4.0

2. 資料庫 FROM: FIS
   資料庫 TO1:default
   資料庫 TO2:EAMS

3. ReadMasterData
```
 SELECT 
     'ORDER_NO'                                   AS ORDER_NO,
     TO_CHAR(SYSDATE, 'YYYYMMDD')                 AS ORDER_DATE,
     A.STN_ARRIVAL                                AS ARIV_STN,
     (A.CARRIER_CODE || LTRIM (A.FLIGHT_NO, '0')) AS DEPT_FLT_NO,
     A.AIRCRAFT_NO                                AS AIRCRAFT_NO,
     B.WSC_DEPARTURE_GATE                         AS DEPT_GATE,
     TO_CHAR (A.ETD_LOCAL, 'YYYYMMDDHH24MI')      AS FLIGHT_ETD_TIME,
     TO_CHAR (SYSDATE, 'YYYYMMDDHH24MI')          AS ORDER_NOTICE_TIME, 
     '0'                                          AS ATTACH_MARK,
     '1'                                          AS POLAR_REGION_EQUIP_MARK,
     '2'                                          AS STATUS,    
     'SYSTEM'                                     AS CRT_ID,
     TO_CHAR(SYSDATE, 'YYYYMMDD')                 AS CRT_DATE,
     TO_CHAR(SYSDATE, 'HH24MISS')                 AS CRT_TIME,
     'SYSTEM'                                     AS UPD_ID,
     TO_CHAR(SYSDATE, 'YYYYMMDD')                 AS UPD_DATE,
     TO_CHAR(SYSDATE, 'HH24MISS')                 AS UPD_TIME
 FROM 
     AAF0.VFS_FLIGHT_SCHEDULE A, 
     AAFW.WSC_SCHEDULE B, AAF0.SCHEDULE C 
 WHERE     
     A.STD_LOCAL BETWEEN TO_DATE ( :START_TIME , 'YYYYMMDDHH24MISS') AND TO_DATE ( :END_TIME , 'YYYYMMDDHH24MISS') 
     AND B.DPORT IN ('TPE', 'TSA') 
     AND A.FLIGHT_KEY = C.FLIGHT_KEY 
     AND A.FLIGHT_KEY=B.FLIGHT_KEY
     AND (
         (A.CARRIER_CODE || LTRIM (A.FLIGHT_NO, '0')) LIKE 'BR32%'
     OR
         (A.CARRIER_CODE || LTRIM (A.FLIGHT_NO, '0')) LIKE 'BR36%'
     ) 
```

4. ReadDetailData

```
 SELECT 'ORDER_NO' AS ORDER_NO, 
        '1'        AS SEQ, 
        'OT'       AS ORDER_CLASS, 
        '極地裝備' AS ORDER_ITEM, 
        '2'        AS QTY, 
        '套'       AS UNIT, 
        '其他'     AS REASON, 
        '請選擇'   AS EXPLANATION, 
        ''         AS REMARK, 
        'SYSTEM' AS CRT_ID, 
        TO_CHAR (SYSDATE, 'YYYYMMDD') AS CRT_DATE, 
        TO_CHAR (SYSDATE, 'HH24MISS') AS CRT_TIME, 
        'SYSTEM' AS UPD_ID, 
        TO_CHAR (SYSDATE, 'YYYYMMDD') AS UPD_DATE, 
        TO_CHAR (SYSDATE, 'HH24MISS') AS UPD_TIME, 
        'OT24'     AS CODE, 
        '1'        AS DELIVERY_FLAG, 
        '1'        AS SIGN_FLAG 
 FROM DUAL 
```

5. 原始參考SQL ('BR32', 'BR32B', 'BR36', 'BR36D')
```
SELECT * FROM (
 SELECT A.FLIGHT_KEY, 
        AIRCRAFT_TYPE, 
        A.SECTOR_SEQ, 
        (A.CARRIER_CODE || LTRIM (A.FLIGHT_NO, '0')) FLT_NO, 
        TO_CHAR (A.ETD, 'yyyy-mm-dd hh24:mi') ETD, 
        TO_CHAR (A.STD_LOCAL, 'yyyy-mm-dd hh24:mi') STD_LOCAL, 
        TO_CHAR (A.ETD_LOCAL, 'yyyy-mm-dd hh24:mi') FLIGHT_ETD_TIME, 
        CASE 
           WHEN ( (SYSDATE - A.ETD_LOCAL) * 24 * 60) >= 15 THEN 'Y' 
           ELSE 'N' 
        END 
           TIME_DIFF, 
        A.AIRCRAFT_NO, 
        A.STN_DEPARTURE DEP, 
        B.WSC_DEPARTURE_GATE GATE, 
        A.STN_ARRIVAL ARR, 
        TO_CHAR (A.STA_LOCAL, 'yyyy-mm-dd hh24:mi') STA_LOCAL, 
        TO_CHAR (A.ETA_LOCAL, 'yyyy-mm-dd hh24:mi') ETA_LOCAL, 
        TO_CHAR (A.ETA, 'yyyy-mm-dd hh24:mi') ETA, 
        A.ACTDATE, 
        A.FLIGHT_ROUTE_NO, 
        C.BLOCKOUT 
   FROM AAF0.VFS_FLIGHT_SCHEDULE A, AAFW.WSC_SCHEDULE B, AAF0.SCHEDULE C 
  WHERE     A.STD_LOCAL BETWEEN TO_DATE (:START_TIME, 'yyyy-mm-dd hh24:mi') 
                            AND TO_DATE (:END_TIME, 'yyyy-mm-dd hh24:mi') 
        AND B.DPORT IN ('TPE', 'TSA') 
        AND A.FLIGHT_KEY = C.FLIGHT_KEY 
        AND A.FLIGHT_KEY=B.FLIGHT_KEY 
) WHERE FLT_NO LIKE 'BR32%' --('BR32', 'BR32B', 'BR36', 'BR36D')		
```

## 2015-11-12
1. 將 SMAS 獨立成一個只包含
 - AUT
 - BAS
 - PAS
 - PSD
的 WebApplication

http://localhost/PSD.MainWebAP/PSD/PSDD0010.aspx
http://localhost/PSD.MainWebAP/PAS/PASD0010.aspx

2. 除錯 PASD0010

1. 送審
   登入身分：C91614 
http://localhost/SMASWebAP/PAS/PASD0010.aspx

272218 
2. 核決
   登入身分：272218 
   點選單據內容 => 核決

        public void showException(string message)
        {
            if ((!ClientScript.IsStartupScriptRegistered("errMessage")))
            {
                string m_Message = "錯誤訊息:" + message.Replace("\r\n", "").Replace("。", "");
                ClientScript.RegisterClientScriptBlock(this.GetType(), "Result", "<script language='javascript'> $(document).ready(function () { alert($('<div/>').html('" + HttpUtility.HtmlEncode(m_Message) + "').text()); }); </script>");
            }
        }
Q1: pas_MASTER.Rows.Count == 0, 對應處理方式
string status = pas_MASTER.Rows[0]["STATUS"].ToString().Trim();

Response.Write(ex.Message);

## 2015-11-11
解決 EVA_CONTROL 在讀取不到任何資料，應該顯示表頭以及查無資料字樣

## 2015-11-10
解決 EVA_CONTROL 在 正式環境讀取不到圖檔的問題

1. Create a WebSite
  PSD.MainWebAP 
2. Create a Virtual Path
  - AUT
  - 

## 2015-11-09
Report
BASR0120
BASR0130

## 2015-11-06
1. 新增報表 BASR0120 


查詢條件
  * 料號  0000000-9999999

```
            SELECT 
                A.CODE, -- 再製品料號
                B.ENGLISH_SHORTNAME CODE_ENGLISH_SHORTNAME, -- 再製品品名
                B.CHINESE_SHORTNAME CODE_CHINESE_SHORTNAME, -- 再製品中文 
                A.PARTS_CODE, -- 生料料號
                C.ENGLISH_SHORTNAME PARTS_CODE_ENGLISH_SHORTNAME, -- 生料品名
                C.CHINESE_SHORTNAME PARTS_CODE_CHINESE_SHORTNAME, -- 生料中文
                C.CURR_UNIT_PRICE, --單價
                A.PARTS_QTY, -- 數量
                B.UNIFORM_COST -- 材料成本      
            FROM 
                UNI_UNIFORM_COMPONENT A,
                BAS_MATERIAL B, --  再製品
                BAS_MATERIAL C --  生料
            WHERE A.CODE = '6200077'
                  AND A.CODE = B.CODE(+) 
                  AND A.PARTS_CODE = C.CODE(+)
```

2. 新增報表 BASR0130 生料及再製品明細清單表
查詢條件
  * 料號  0000000-9999999
  * 類型  全部 / 再製品 / 生料
```
            SELECT 
                A.CODE, -- 再製品料號
                B.ENGLISH_SHORTNAME CODE_ENGLISH_SHORTNAME, -- 再製品品名
                B.CHINESE_SHORTNAME CODE_CHINESE_SHORTNAME, -- 再製品中文       
            FROM 
                UNI_UNIFORM_COMPONENT A,
                BAS_MATERIAL B
            WHERE 1 = 1 
                AND (A.CODE = '6200077' AND A.CODE = B.CODE(+))
                AND (A.PARTS_CODE = '6200077' AND A.PARTS_CODE = B.CODE(+))
```

## 2015-11-05

(1) INVD0170R_1 報表加入一個欄位

(2) TODO - 有空將以下專案，獨立成另外的WebApplication
SMAS.MainWebAP.PSD
SMAS.MainWebAP.PAS
SMAS.MainWebAP.AUT

(3) 解決WebService無法編譯的問題

PURD00231

幫我DB測試資料庫改正式資料庫

登入:210600 / 12345678
PURD0040/相關訂購單
申請日期20151105  序號 5006

找到的解決方法(沒有一個可用)
http://greenbytes.de/tech/tc2231/#inlwithasciifilenamepdf
http://stackoverflow.com/questions/19255785/php-forces-pdf-file-download-even-though-im-using-content-disposition-inline
http://wiki-errors.com/do-it-yourself-solution-for-ieframe-dll-problems/
## 2015-11-04

SMAS_PSD_WS - Fortify 

Excel - 修正資料問題 (ExtemToRptTmp),
PSDD0070R  

中文 - 標楷體
英文 - TimesNewRoman

http://www.c-sharpcorner.com/UploadFile/mumbare.sachin/crystal-report-dynamic-text-format/

http://scn.sap.com/thread/3229750

http://www.experts-exchange.com/Database/Reporting/Q_23070262.html




## 2015-11-03


SELECT DISTINCT(PM.MPATROL_NO) PAS_NO, 
     PM.MPATROL_DATE PAS_DATE, 
     PM.FLT_NO, 
     DECODE (PM.STATUS, 
               0, '已取消', 
               1, '未送出', 
               2, '已送出', 
               9, '已完成') STATUS 
FROM PAS_MPATROL_RECORD_MASTER PM  
WHERE  
  SHEET_TYPE = :SHEET_TYPE
  AND PAS_DATE = :PAS_DATE


## 2015-11-02
協助修改Excel轉檔問題
 
## 2015-10-30
PASR0010.aspx 報表修改以下功能
1. 報表欄位(合格/缺失)-> PAS_MPATROL_RECORD_DETAILS.MPATROL_RESULT

2. 報表欄位(檢查人員)-> SELECT EMPLOYEE_NO||'-'||CHINESE_NAME  NAME FROM PSN_OPEN_DATA WHERE EMPLOYEE_NO = 'C91614'

3. 報表欄位(審核主管)-> SELECT EMPLOYEE_NO||'-'||CHINESE_NAME  NAME FROM PSN_OPEN_DATA WHERE EMPLOYEE_NO = 'C91614'


## 2015-10-29
SMAS

送審操作：PURD010 
  問題描述：送審成功後，回到畫面重新搜尋，查詢該筆資料，理應只有一筆，但是實際上卻有五筆
  送審者：746515 / 12345678

dsReturn = dba.runExecuteQuery(dtName, sqlCommands, maxrecord, position)

資料庫：UNISMAS
```
  SELECT DISTINCT
         A.REQUEST_NO,
         A.REQUEST_DATE,
         A.USER_ID,
         (A.REQUEST_DEPT || '-' || C.DESCRIPTION) DEPT,
         DECODE (A.STATUS,
                 '1', '1-未送審',
                 '9', '9-已審核',
                 '2-審核中')
            STATUS,
         DECODE (A.TRANSFER_FLAG,
                 '1', '1-已轉',
                 '2', '2-未轉',
                 '2-未轉')
            TRANSFER_FLAG
    FROM PUR_REQUEST_MASTER A,
         PUR_REQUEST_DETAILS B,
         DEPARTMENT C,
         BAS_MATERIAL D
   WHERE     A.REQUEST_NO = B.REQUEST_NO
         AND A.REQUEST_DEPT = C.DEPARTMENT_NO
         AND B.CODE = D.CODE
         AND A.STATUS <> '0'
         AND A.REQUEST_DATE = '20151029'
         AND A.USER_ID = '746515'
         AND A.REQUEST_DEPT = 'K100'
ORDER BY REQUEST_NO
```

駁回操作：PURD11
  問題描述：駁回成功後，查詢資料表 PUR_REQUEST_MASTER，理論上駁回完成，狀態應該為 1，但是實際上卻為 2
  駁回者：202139 / 12345678

Private Sub btnREJECT_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnREJECT.Click
updDATA("R")
TYPE = R

# CAFSWEB

有一個服務會自己停止

## 2015-10-27
PASR0010.aspx 報表修改以下功能
(DONE)1. 查詢條件
  + 單據號碼(PAS_MPATROL_RECORD_MASTER.MPATROL_NO)
  - 班機號碼(PAS_MPATROL_RECORD_MASTER.FLT_NO)

  巡倉檢核單 - 測試資料：
  單據號碼：PA1510190003
  單據號碼：PA1510300002
  日期：20151019

  有效期限物品抽檢單 - 測試資料：
  單據號碼：TC1509270001
  日期：20150927

2. 有效期限物品抽檢單
  * 報表的中文字形改為 標楷體
  * 報表的英文字形改為 Times New Roman 
  * 報表欄位 [抽檢人員] <-> [主管審核] 要對調，主管審核要放在右邊，PAS_MPATROL_RECORD_MASTER.SUBMIT_ID

4. 兩個子表要在同一頁
5. 報表內容 v/x -> 合格/不合格



參考資料：
http://localhost/SMASWebAP/PAS/PASR0010.aspx?d=1445908851035

單據號碼 PAS_MPATROL_RECORD_MASTER.MPATROL_NO
班機號碼 PAS_MPATROL_RECORD_MASTER.FLT_NO

審核主管 PAS_MPATROL_RECORD_MASTER.SUBMIT_ID

修改項目
  * PASR0010.aspx
  * 
## 2015-10-26

$(".SelectedRow")[5].innerText = "未送審"

測試帳號 : 858537

http://localhost/SMASWebAP/INV/INVD0031.aspx

針對部門為C100，領用料庫為VIP，其輸入料號必須為保稅品料號

```
SELECT * FROM BAS_MATERIAL WHERE BONDED = 'B' AND CODE = :CODE
```

----------
## 2015-10-23
http://localhost/SMASWebAP/CTM/CTMR0050.aspx

                        // 原本邏輯：排除 ORIGINAL_NO 為 D2, D7
                        // 後來邏輯：排除 ORIGINAL_NO 為 D2, 排除 ORIGINAL_NO 為 D7 且 TRANSNO 不為P開頭的



CTMR0050.aspx

查詢條件
呆滯天數: 610
料號: 8000616

//if ((t_QTY < t_CUR_INVENTORY) && (IN_OUT_DATE_INT <= From_INT))//

## 2015-10-22
將安裝客戶資料存入資料庫
\\10.3.25.19\share\Norman\1022\ExtemToRptTmp


## 2015-10-19
1. EAMS_CONTROL CENTER.aspx 等比例縮放TABLE
2. SMAS B2CD0142.js + 新增空白欄欄位序號沒有出來

function insertNewRow(table){
  
  // 取得最後一列的HTML，遞增裡面所有具備 id 或者 name 的元素
  var html = $(table).find('tr:last')[0].outerHTML;
  
  html = html.replace(/([name|id])="([A-Za-z]+)(\d+)"/g, function(){
    var matchItem   = arguments[0]; // name="chkSTATUS4"
    var attrName= arguments[1]; // name
    var valuePrefix = arguments[2]; // chkSTATUS
    var valueNumber = arguments[3]; // 4
    
    return attrName + '=' + '"' + valuePrefix + (+valueNumber+1) + '"';
  });
  
  $(html).appendTo(table);
  
  // 取得最後一列 的 seq 加一
  var $txtSEQ = $(table).find('tr:last').find('input[name*=txtSEQ]');
  $txtSEQ.attr('value', +($txtSEQ.attr('value') || 0) +1);
}

## 2015-10-16

將 PSDM0020 顯示平台欄位由 DropDown 修改成為 CheckBox
將 PSDM0021 顯示平台欄位由 DropDown 修改成為 CheckBox

顯示平台欄位 對應資料庫 PSD_NEWS_MASTER.NEWS_PLATFORM

http://localhost/SMASWebAP/PSD/PSDM0020.aspx?d=1444978050070

CHECKBOX 順序
- 物配 
- 餐勤 
- LED-物配 
- LED-通用 
- 物配巡倉

#####  修改檔案
 - PSDM0020.aspx
 - BLL_PSDM0020.cs
 - PSDM0020.js
 - PSDM0021.aspx
 - PSDM0021.aspx.cs 
 
##### Migration Database

UPDATE PSD_NEWS_MASTER SET NEWS_PLATFORM = '10000' WHERE NEWS_PLATFORM = 1;
UPDATE PSD_NEWS_MASTER SET NEWS_PLATFORM = '01000' WHERE NEWS_PLATFORM = 2;
UPDATE PSD_NEWS_MASTER SET NEWS_PLATFORM = '00100' WHERE NEWS_PLATFORM = 3;
UPDATE PSD_NEWS_MASTER SET NEWS_PLATFORM = '00010' WHERE NEWS_PLATFORM = 4;
UPDATE PSD_NEWS_MASTER SET NEWS_PLATFORM = '00001' WHERE NEWS_PLATFORM = 5;
UPDATE PSD_NEWS_MASTER SET NEWS_PLATFORM = '11111' WHERE NEWS_PLATFORM = 6;

## 2015-10-15
http://qasmasap01/SMASWebAP/LCS/LCSD0010.aspx?d=1444869610048
http://qasmasap01/SMASWebAP/LCS/LCSD0013.aspx
5401164

資料已送出，請稍後

ADD
INVD0190.aspx.cs

BLL_LCSD0030.cs - CheckSendPalletData - LCSD0031.js - SendMessageToServer()
BLL_LCSD0070.cs - CheckSendPalletData - LCSD0070.js - SendMessageToServer(flag)
BLL_LCSD0090.cs - SendMessage - LCSD0090.js - SendMsg()

LCSD0021.aspx.cs - btnSEND_Click
LCSD0022.aspx.cs - btnSEND_Click
LCSD0032.aspx.cs - btnSEND_Click
LCSD0100.aspx.cs - btnEXAMS_Click

DELETE
BLL_LCSD0080.cs



## 2015-10-14

修正 CTMD0010.js fortify issue

```
    public class SqliteHelper
    {
        private string connectionString;

        public SqliteHelper(string connectionString)
        {
            this.connectionString = connectionString;
        }

        public DataTable Query(string SQLiteString)
        {
            DataTable dt = new DataTable();
            SQLiteConnection conn = new SQLiteConnection(connectionString);
            SQLiteDataAdapter adapter = new SQLiteDataAdapter(SQLiteString, conn);
            DataSet ds = new DataSet();
            ds.Clear();
            adapter.Fill(ds);
            dt = ds.Tables[0];
            if (conn.State == ConnectionState.Open) conn.Close();
            return dt;
        }

        public string DataTableToJson(DataTable dt)
        {
            return JsonConvert.SerializeObject(dt, Formatting.Indented);
        }

        public static void SqliteToJson()
        {
            Dictionary<string, string> dict = new Dictionary<string, string> { 
                {"Gate", "SELECT * FROM GateAxis"},
                {"Point", "SELECT * FROM wpt Order By id"},
                {"AirPlaneShape", "SELECT * FROM AirPlaneShape"},
                {"AirPlaneAxis", "SELECT * FROM AirPlaneAxis"},
                {"Building", "SELECT * FROM Building"},

                {"SectorAxis", "SELECT * FROM SectorAxis"},
                {"Door", "SELECT id,door FROM Building"},
            };

            const string connectionString = @"Data Source=c:\user.db;";

            SqliteHelper helper = new SqliteHelper(connectionString);

            foreach (string key in dict.Keys)
            {
                string kind = key;
                string sql = dict[key];

                var dt = helper.Query(sql);
                string json = helper.DataTableToJson(dt);

                System.IO.File.AppendAllText(@"C:\airplane-location.txt", string.Format("{0} = ", kind));
                System.IO.File.AppendAllText(@"C:\airplane-location.txt", json);
                System.IO.File.AppendAllText(@"C:\airplane-location.txt", string.Format(";\r\n"));
            }
        }
    }
```
## 2015-10-13

## 2015-10-12

1. EAMS_CONTROL
  + 重寫 CENTER.aspx 更新邏輯，原本更新頁面方式是每十秒使用 Javascript:window.reload(),
    必須改成每十秒透過取得資料(在PSD_CENTRAL_WS.asmx.cs 的 CENTRAL_ORDER_DATA(string input_Json) )並重新繪製TABLE

  + 當點選某一列的時候，開啟dialog內部嵌入一個google map，並且每一秒撈取 PSD_LOCATION_WS(order_no) 資料，繪製 GOOGLE MAP

2. SMAS_PSD_WS (WebService)
  + 在 PSD_CENTRAL_WS.asmx.cs，新增 WebService(PSD_LOCATION_WS), 用以取經緯度資料 , 資料來源如下
    order_no = 201509080001 (測試資料)
    ```
    select * from PSD_ORDER_LOCATION where order_no = 點選資料列對應的 order_no
    ```


TODO:
  - 欠 GOOGLE API CODE
  - 欠 客戶圖層


未來要移除

START_DATE = DateTime.Now.AddYears(-10).ToString("yyyyMMddHHmm"); // 20151012 Norman, JUST FOR TEST
END_DATE = DateTime.Now.AddYears(+10).ToString("yyyyMMddHHmm"); // 20151012 Norman, JUST FOR TEST

http://localhost/SMAS_PSD_WS/PSD_CENTRAL_WS.asmx

#1038 (SMAS_PSD_WS)
 m_arrParam.Clear();
                    m_arrParam.Add(m_dba.GetOracleParam(":START_DATE", START_DATE));
                    m_arrParam.Add(m_dba.GetOracleParam(":END_DATE", END_DATE));
                    m_SQL = " SELECT ORDER_NO, ORDER_DATE, DEPT_FLT_NO, DEPT_GATE, ASSIGN_ID, STATUS, ";
                    m_SQL += " EGAS_CONFIRM_TIME, ASSIGN_TIME, EGAS_DELIVERY_TIME, CP_RECEIVE_TIME, DEPT_TIME FROM PSD_ORDER_MASTER ";
                    //m_SQL += " A.EGAS_CONFIRM_TIME, A.ASSIGN_TIME, A.EGAS_DELIVERY_TIME, A.CP_RECEIVE_TIME FROM PSD_ORDER_MASTER A JOIN PSN_OPEN_DATA B ON A.ASSIGN_ID=B.EMPLOYEE_NO";
                    m_SQL += " WHERE DEPT_TIME BETWEEN :START_DATE AND :END_DATE ORDER BY DEPT_TIME DESC ";

資料庫( EGASEAMS.EVAAIR.COM )，帳號 / 密碼 = EGASEAMS / p35egaseams2015p01 

---------------------------------------

## 2015-10-08
ReportLogic_CTM
public static string[] QuickInsertReport<T>(string tableName, IEnumerable<T> list)
public static DataTable QuickQuery<T>(string sql, T args)

http://localhost/SMASWebAP/CTM/CTMR0070.aspx



請新增一報表CTMR0070-D5報單序號一覽表，寫完要出SIT文件！謝謝！
搜尋條件
進出倉日期                 ~

報表明細欄位
進出倉序號    進出倉日期    報關號碼

語法
SELECT A.SHEET_NO,IN_OUT_DATE,A.APPLY_NO
FROM CTM_CUSTOMS_TRANS_MASTER A,CTM_CUSTOMS_TRANS_DETAILS B,BAS_MATERIAL C
WHERE A.STORE_NO=B.STORE_NO
AND A.SHEET_NO=B.SHEET_NO
AND B.CODE=C.CODE
AND A.APPLY_NO LIKE 'CA%'
AND REF_STORE='MANO'
AND C.MATERIAL_TYPE='S'
AND IN_OUT_DATE>='20150901' AND IN_OUT_DATE<='20150931'
ORDER BY A.SHEET_NO;

參考資料

INVD0170R_1.rpt

## 2015-10-07
協助處理長榮資訊網連線SMAS無法正確登入的問題

## 2015-10-06
修正以下錯誤
http://localhost/smaswebap/INV/INVD0130.aspx?d=1444119226461

結帳年月: 201508
日幣匯率金額欄位
放錯
放到美金欄位

## 2015-10-05
登入帳號：395408

REQ1:
http://localhost/SMASWebAP/VND/VNDD0050.aspx
查詢條件+
商品種類: +免徵營業稅(F)

REQ2:
http://localhost/SMASWebAP/VND/VNDD0050.aspx
當查詢條件的商品種類，選擇銷售用品，匯出的報表要加上 建議售價(含稅)
當查詢條件的商品種類，選擇免增營業稅，匯出的報表要加上 建議售價(含稅)

REQ3:
http://localhost/SMASWebAP/VND/VNDD0051.aspx
查詢條件+
商品種類: +免徵營業稅(F)
點選成和畫面預覽的邏輯與銷售用品相同，只有margin計算方式不一樣

## 2015-10-01
               
  SELECT 
    PURCHASE_NO AS PURCHASE_NO,
         (SELECT DISTINCT REQUEST_NO
            FROM PUR_PURCHASE_DETAILS
           WHERE PURCHASE_NO = PURCHASE_NO)
            AS REQUEST_NO,
            
         (SELECT VENDOR_NO
            FROM PUR_PURCHASE_MASTER
           WHERE PURCHASE_NO = PURCHASE_NO)
            AS VENDOR_NO,
         (SELECT VENDOR_NAME_ENGLISH
            FROM VND_VENDOR
           WHERE VENDOR_NO = (SELECT VENDOR_NO
                                FROM PUR_PURCHASE_MASTER
                               WHERE PURCHASE_NO = PURCHASE_NO))
            AS VENDOR_ENGLISHNAME
    FROM INV_TRANS_MASTER A,
     
   WHERE TRANS_NO = 'B150008378'



## 2015-09-30
1. 處理APN專案為IMPORT ANTIXSS的問題

## 2015-09-25
修正 INVR0140R 批次作業失敗問題
Check ReportService (WindowService) use lastest ReportLogic.dll
## 2015-09-24
登入帳號: 315518
申請單日期: 20150923
申請單序號: 5001 

http://localhost/SMASWebAP/PUR/PURD0040.aspx

http://qasmasbt01/SMASWebAP/export/315518/20150925/INVR0140R.rpt_1891508.pdf

INVR0140R.rpt

(1) 訂購單編號： 顯示
SELECT ORIGINAL_TRANS_NO FROM INV_TRANS_details A 
WHERE TRANS_NO='J150000033';
以逗號隔開

(2) 批次參數錯誤

(3) 列印回執聯
以表格顯示
SELECT ORIGINAL_TRANS_NO FROM INV_TRANS_details A 
WHERE TRANS_NO='J150000033';



ReportLogic_PUR.PURR0060

PURR0060.btnBATCH_Click(object sender, EventArgs e)

## 2015-09-23
1. BCRR0010.aspx  修改圖一這支功能，未來別課傳給我們會多加2個參數，分別帶到圖一的啟程日期與啟程航號
2. 360861 無法審核M150001658；但647850卻OK
3. PDAD130.asmx
  [WebMethod()]public XmlDocument funINSERT_APN_ORDER(string ORDER_DEPT, string STATUS, string CRT_ID, string CRT_DATE, string CRT_TIME, string REMARK, DataSet Data_List)
  [WebMethod()]public XmlDocument funINSERT_AREA_ORDER(string ORDER_DEPT, string STATUS, string CRT_ID, string CRT_DATE, string CRT_TIME, string REMARK, DataSet Data_List)

## 2015-09-22
job INVF150 修改sql查詢邏輯，輸入表單結果

## 2015-09-21
BASM0124.ASPX 
針對 INV_PUBLIC_GIFT_DEL_LOG 額外寫入CRT_ID

CTMD0040 SW040000 SW049999
-----------------------------------------
## 2015-09-18
AUTM0020.aspx
查詢條件區的流程代號從唯讀改成可編輯
AUTM0021.aspx
審核單位帶的內容不正確

## 2015-09-16
http://localhost/SMASWebAP/BCR/BCRM0080.aspx
BCRM0080 修改複製功能
裝載代號: 320BCX010908

--AND A.STND_LOAD_NO IN (SELECT STND_LOAD_NO FROM CRW_BCR_STANDARD_LOAD_DETAILS WHERE CODE = 'LALALA')

## 2015-09-15
INVR0240 無資料仍要出現表頭
AUTD0080 單位I502，且非主管人員的電子表單，全選核取框請反灰，使無法勾取

## 2015-09-14
KHHD0062
TXGD0062
修改檢查庫存量邏輯
- 如果主倉庫存量不足，則檢查RENG
  * CASE 0:  RENG 庫存足夠，通知倉儲科移倉
  * CASE 1:  RENG 庫存不足，通知物管科補貨

## 2015-09-11
1. 貴賓室現場流通量設定/OUTM0150 + OUTM0151
http://localhost/SMASWebAP/out/OUTM0150.aspx

## 2015-09-08
http://localhost/smaswebap/BCR/BCRD0050.aspx
(1) 在存檔之前檢核所有detailview的航勤盤點量，不可大於實際上機量，依次顯示所有錯誤，即使錯誤也讓使用者可以存檔。
(2) 增加航勤盤點量歸零按鈕

http://localhost/SMASWebAP/APN/APND0060.aspx
http://localhost/SMASWebAP/APN/APND0062.aspx
修改檢查庫存量邏輯
- 如果主倉庫存量不足，則檢查RENG
  * CASE 0:  RENG 庫存足夠，通知倉儲科移倉
  * CASE 1:  RENG 庫存不足，通知物管科補貨

                        // 檢查主倉(MANG, MANO)庫存量，如果主倉庫存不足，則檢查 RENG 庫存是否滿足叫貨量
                        //  * CASE 0:  RENG 庫存足夠，通知倉儲科移倉
                        //  * CASE 1:  RENG 庫存不足，通知物管科補貨

mailbody = getMailBody(ORDER_NO);

兩個地方

## 2015-09-07 (Mon)
1. 外部料庫檢核-INVF130
  * 規則：INV_INVENTORY的STORE_NO在RENG有數量，但這兩個月無單據進出 
  * MAIL找BAS_REFERENCE_DATA_DETAILS的RENG_H
    主旨：外部料庫2個月無異動之品項 
      料庫  目前庫存量 最近一次單據 確認日 來源料庫    目的料庫

SELECT * FROM INV_INVENTORY
WHERE STORE_NO='RENG' AND CURR_QTY <> 0

SELECT * 
FROM INV_TRANS_MASTER A,INV_TRANS_DETAILS B
WHERE A.TRANS_NO=B.TRANS_NO
AND B.CODE='1300006'
AND CONFIRM_DATE >兩個月前,例如7/7

尋找呆滯資料
列出這兩個月找步道單據的資料
(都找不到單據才列)

SELECT ROWID,B.* FROM BAS_REFERENCE_DATA_DETAILS B
WHERE CONFIG_TYPE='RENG_H';

store_no
料庫(INV_INVENTORY)  

curr_qty
目前庫存量(INV_INVENTORY) 

trans_no
最近一次單據 

confirm_date
確認日 

store_from
來源料庫    

store_to
目的料庫






INVD0020
STANDARD
REPORT -> STANDARD
CODE = 4000001 4999999
 
## 2015-09-04
// 20150904 Norman (JEST FOR TEST)
System.IO.File.AppendAllText(@"C:\1.sql", "runExecuteQuery");
System.IO.File.AppendAllText(@"C:\1.sql", dtname);
System.IO.File.AppendAllText(@"C:\1.sql", sqlCommand);
System.IO.File.AppendAllText(@"C:\1.sql", "\r\n");

## 2015-09-03
1. 解決報表 CRWR0030R-2 加總相差一塊錢的問題
   方式： ReportLogic_CRW.CRWR0030 ### 2177 + Math.Round
2. 
(1)修改的地方備註以下
P3514M0059-最新庫存表出表規則變更(UNDER REF QTY)

http://localhost/smaswebap/INV/INVR0020.aspx

(2)
修改 P_TXTSAFE_QTY == "5"
由原本的邏輯改為
INVENTORY的CURR_QTY+H_ONWAY_QTY>0即要LIST資料

AA表全部料庫
(3)SIT文件

當選擇
UNDER REF QTY
要檢查

                    if ((P_TXTSAFE_QTY == "4") || (P_TXTSAFE_QTY == "5"))
                        sb.Append(" AND (NVL(A.REF_QTY,0) <> 0)");

            
                        else if (P_TXTSAFE_QTY == "5")
                        {
                            if (tCURR_QTY_ORIS > tREF_QTY)
                            {
                                tresult = "1";
                            }
                        }
            
```

```
SELECT * FROM
(
/*  
SELECT NVL (CODE_LEN, 0) DAYS
  FROM BAS_COMMON_TYPE
 WHERE CODE_TYPE = 'SH'
*/
 
/* Formatted on 2015/9/3 下午 03:39:40 (QP5 v5.185.11230.41888) */

-- 201509
SELECT A.CODE,
       A.PO_ONWAY_QTY,
       A.PREN_QTY,
       A.H_ONWAY_QTY,
       A.CURR_QTY,
       A.SAFE_QTY,
       A.REF_QTY,
       A.DESC_ABBR,
       A.PACK_DETAIL,
       A.STORE_UNIT,
       A.LEAD_TIME,
       A.SAFE_PERIOD,
       A.MC5,
       A.COEF,
       A.SCR_SET,
       (NVL (B.CONS_QTY, 0) + NVL (C.SALE_QTY, 0)) CONS_QTY,
       '' SCR_SAFE_QTY,
       '' MATERIAL_TYPE,
       A.BOX_QTY,
       A.CURR_QTY_QRIS,
       A.RELAY_CODE,
       NVL (D.MOQ, 0) MOQ
FROM 
    (  
        SELECT /*+ FIRST_ROWS */
            A.CODE,
            SUM (NVL (A.PO_ONWAY_QTY, 0)) PO_ONWAY_QTY,
            SUM (NVL (A.PREN_QTY, 0)) PREN_QTY,
            0 H_ONWAY_QTY,
            SUM (NVL (A.CURR_QTY, 0)) CURR_QTY,
            MAX (NVL (B.SCR_SAFE_QTY, 0)) SAFE_QTY,
            MAX (NVL (B.SCR_SAFE_QTY, 0)) REF_QTY,
            MAX (NVL (B.ENGLISH_SHORTNAME, ' ')) DESC_ABBR,
            MAX (NVL (B.PACK_DETAIL, ' ')) PACK_DETAIL,
            MAX (NVL (B.STORE_UNIT, ' ')) STORE_UNIT,
            MAX (NVL (B.LEAD_TIME, 0)) LEAD_TIME,
            MAX (NVL (B.SAFE_PERIOD, 0)) SAFE_PERIOD,
            MAX (NVL (B.MONTH_END_MODE, ' ')) MC5,
            MAX (NVL (B.COEFFICIENT, 0)) COEF,
            MAX (NVL (D.BOTTOM, '0') * NVL (D.LEVEL1, '0')) BOX_QTY,
            MAX (NVL (B.SCR_SET, 0)) + MAX (NVL (B.SCR_SET_KHH, 0)) + MAX (NVL (B.SCR_SET_TXG, 0)) SCR_SET,
            SUM (NVL (A.CURR_QTY, 0)) - SUM (NVL (A.PREN_QTY, 0)) CURR_QTY_QRIS,
            MAX (NVL (B.RELAY_CODE, 0)) RELAY_CODE
        FROM 
            INV_INVENTORY A, 
            BAS_MATERIAL B, 
            LCS_WH_MATERIAL D
        WHERE     
            A.CODE = B.CODE
            AND A.CODE = D.CODE(+)
            AND A.STORE_NO <> 'TEMO'
            AND A.STORE_NO <> 'TEMG'
            AND A.STORE_NO <> 'STOR'
            AND A.STORE_NO <> 'AA'
            --AND (NVL (B.SCR_SAFE_QTY, 0) <> 0)  20150903 NORMAN
        GROUP BY A.CODE
    ) A,
    (  
        SELECT 
            A.CODE CODE1, 
            SUM (A.SALE_QTY_UPD) CONS_QTY
        FROM 
            CRW_FLIGHT_SALE A
        WHERE 
            A.DEPT_DATE BETWEEN :P_YM1 || '01' AND :P_YM2 || '31'
        GROUP BY A.CODE
    ) B,
   (  
        SELECT 
            PD.CODE, 
            NVL (SUM (PD.ORDER_QTY), 0) SALE_QTY
        FROM 
            PRE_ORDER_MASTER PM, 
            PRE_ORDER_DETAILS PD, 
            BAS_MATERIAL BM
        WHERE     
            PM.DEPT_DATE BETWEEN :P_YM1 || '01' AND :P_YM2 || '31'
            AND PD.CODE = BM.CODE(+)
            AND PM.ORDER_NO = PD.ORDER_NO(+)
            AND PM.STATUS >= '8'
            AND PM.RTN_FLAG = 'S'
        GROUP BY PD.CODE
    ) C,
    (  
        SELECT 
            CODE, 
            MAX (MINNUM_QTY) MOQ
        FROM 
            VND_SUPPLY
        GROUP BY CODE
    ) D
WHERE 
    A.CODE = B.CODE1(+) 
    AND A.CODE = C.CODE(+) 
    AND A.CODE = D.CODE(+)
    
 
)
WHERE
 CURR_QTY+H_ONWAY_QTY>0
 
```
## 2015-09-02 (WED)
http://qasmasap01/SMASWebAP/CTM/CTMD0010.aspx?d=1441157348782
1. 確認在 CTMD0040 進行刪除時，有將 INV_ACCOUNT_TRANSFER_LOG 中對應資料的 REPORT_STATUS 改成 N  
2. 將 CTMD0020 的查詢 SQL 給 LOG 出來

問題一的操作步驟
1. http://localhost/SMASWebAP/CTM/CTMD0010.aspx
2. 進出倉序號: SW040000 ~ SW049999
3. 選擇 刪除
4. 偵錯刪除動作，檢查 是否有將 INV_ACCOUNT_TRANSFER_LOG 中對應資料的 REPORT_STATUS 改成 N

問題二的操作步驟
1. http://localhost/SMASWebAP/CTM/CTMD0020.aspx
2. 進出倉日期: 20140101 ~ 20150902
3. 選擇 查詢未轉海關帳單據
4. 取出 CTMD0021.PageLoad 查詢SQL
```
/* Formatted on 2015/9/2 下午 12:01:51 (QP5 v5.185.11230.41888) */
SELECT TRANS_NO,
       DEPARTMENT_NO || DEPARTMENT_SUB_NO DEPARTMENT_NO,
       CONFIRM_DATE,
       TRANS_DATE,
       STORE_FROM,
       STORE_TO
  FROM INV_TRANS_MASTER TRANS_MAST
 WHERE     (CUSTOMS_MARK <> 'Y' OR CUSTOMS_MARK IS NULL)
       AND TRANS_DATE BETWEEN '20140101' AND '20150902'
       AND (   STORE_TO = 'MANO'
            OR STORE_TO = 'TEMO'
            OR STORE_TO = 'KHHO'
            OR STORE_TO = 'TEKO'
            OR STORE_FROM = 'MANO'
            OR STORE_FROM = 'TEMO'
            OR STORE_FROM = 'KHHO'
            OR STORE_FROM = 'TEKO')
       AND (   (    DEPARTMENT_NO || DEPARTMENT_SUB_NO IN
                       ('I202', 'Y101', 'Y105', 'I501', 'I502', 'K100')
                AND CARD_ID = 'H')
            OR (DEPARTMENT_NO || DEPARTMENT_SUB_NO = 'C100' AND CARD_ID = 'H')
            OR (CARD_ID = 'G' AND ISSUE_TYPE = 'C')
            OR (    DEPARTMENT_NO IN
                       ('I204',
                        'Y104',
                        'I206',
                        'Y102',
                        'Y101',
                        'Y105',
                        'I503',
                        'I501',
                        'I502',
                        'K100')
                AND (CARD_ID IN ('B', 'J', 'H', 'P', 'Q'))))
       AND (    SUBSTR (STORE_FROM, 1, 1) <> 'B'
            AND SUBSTR (STORE_FROM, 1, 1) <> 'N')
       AND (   STORE_TO IS NULL
            OR     NOT (STORE_TO = 'MANO' AND STORE_FROM = 'TEMO')
               AND NOT (STORE_TO = 'TEMO' AND STORE_FROM = 'MANO')
               AND NOT (STORE_TO = 'KHHO' AND STORE_FROM = 'TEKO')
               AND NOT (STORE_TO = 'TEKO' AND STORE_FROM = 'KHHO')
               AND NOT (STORE_TO = 'TEMO' AND STORE_FROM = 'TEKO')
               AND NOT (STORE_TO = 'TEKO' AND STORE_FROM = 'TEMO'))
       AND STATUS >= '2'
UNION ALL
SELECT DISTINCT B.TRANS_NO,
                DEPARTMENT_NO || DEPARTMENT_SUB_NO DEPARTMENT_NO,
                CONFIRM_DATE,
                TRANS_DATE,
                STORE_FROM,
                STORE_TO
  FROM INV_TRANS_MASTER B,
       (SELECT TRANS_NO, CUSTOMS_TYPE
          FROM CTM_CUSTOMS_TRANS_MASTER A) A
 WHERE     B.CUSTOMS_MARK = 'Y'
       AND B.TRANS_DATE BETWEEN '20140101' AND '20150902'
       AND B.CARD_ID = 'H'
       AND (STORE_FROM = 'MANO' OR STORE_FROM = 'KHHO' OR STORE_FROM = 'TGAD')
       AND (STORE_TO = 'MANO' OR STORE_TO = 'KHHO' OR STORE_TO = 'TGAD')
       AND A.TRANS_NO LIKE B.TRANS_NO || '%'
       AND A.TRANS_NO IN
              (SELECT TRANS_NO
                 FROM CTM_CUSTOMS_TRANS_MASTER A
                WHERE     CUSTOMS_TYPE = 'D7OUT'
                      AND TRANS_NO NOT IN (SELECT TRANS_NO
                                             FROM CTM_CUSTOMS_TRANS_MASTER A
                                            WHERE CUSTOMS_TYPE = 'D7IN'))
ORDER BY TRANS_NO, DEPARTMENT_NO
```

## 2015-09-01 (TUE)
報表CRWR0030_2 新增以下需求
1. 加總金額
2. 處理台幣與美金以外的所有幣別換算
  - 參考: CRW_EXCHANGE_RATE

操作步驟
1. http://localhost/SMASWebAP/CRW/CRWR0030.aspx
2. 航次別金額核對表-CRWR0030 空中銷售>報表

修改內容 ReportLogic_CRW.CRWR0030
N1

ReportLogic_CRW.CRWR0030 ### 2177 
是四捨五入到小數第四位


----------------------------------------

1.整理TCMS程式清單
2.工時統分
3.帳密留給我

帳號
Z215
密碼
!@#$QWERASDFZXCV

## 2015-07-31 (FRI)
## 2015-07-30 (THU)

- server: tcmsbat1
- B2ED010  (0729)
  新增查詢條件(TC_FORM_CD)，要放置在SITA CODE之前

- B2ER050
  修改查詢條件，  
  1. 部門改為預設帶空值 (空值代表查詢全部)
  2. 年月改為日期區間

http://www.tek-tips.com/viewthread.cfm?qid=1661164

- B2ER060
  修改查詢條件，  
  1. 部門改為預設帶空值 (空值代表查詢全部)
  2. 年月改為日期區間

- BASR010  
  修改查詢SQL，需要增加以下查詢邏輯
```
```

- 增加功能頁(PURR030)，叫做採購金額統計報表　　
　　參考PURR020，查詢邏輯如下，
```
``` 
  修改查詢SQL，需要增加以下查詢邏輯

## 2015-07-29 (WED)
- 處理 SMAS (qaunismasap01.uniair.com.tw) PURD011 修改完資料後，存檔發生 SEQ　undefined的問題(P3107M0963 搞的鬼)

## 2015-07-21 (TUE)
- 處理 TCMS 圖檔上傳 & SYNC 的問題
- 檔案清單
  * C:\Inetpub\wwwroot\TCMS\BASD012 (grant full access to IIS_USER)
  * B2EM012.ASPX.VB
  * B2EM011.JS
  * C:\Inetpub\wwwroot\TCMS_Service\TCMSBL.vb(1753)
  * C:\Inetpub\wwwroot\TCMS_Trans\TCMSBL.vb(1587): 

## 2015-07-20 (MON)
- 處理 TCMS 
 
## 2015-07-17 (FRI)
- 處理 TCMS B2EM011.js fortify 問題 (open dialog)

## 2015-07-16 (THU)
- TCSM SYSTEM PURD011, PURD013 問題
/*
  <system.web>
    <trace enabled="true" pageOutput="false" requestLimit="40" localOnly="false"/>
*/
    
--------------------
-- 查詢 PURD13
--------------------
SELECT * FROM PUR_REQUEST_MASTER WHERE RQST_NBR IN (SELECT 'M150000' || SERIAL_SEQ FROM INV_TRANSACTION_SEQUENCE WHERE TXN_TYP_CD='M' AND TXN_YR= '15');

SELECT * FROM PUR_REQUEST_DETAILS WHERE RQST_NBR IN (SELECT 'M150000' || SERIAL_SEQ FROM INV_TRANSACTION_SEQUENCE WHERE TXN_TYP_CD='M' AND TXN_YR= '15');


--------------------
-- 查詢 PURD11
--------------------
-- # 154

SELECT A.TC_FORM_CD,
       NVL (A.EST_DLVR_DT, ' ') EST_DLVR_DT,
       NVL (A.RQST_QTY, '0') RQST_QTY,
       '' STORE_NBR,
       A.VNDR_NBR,
       NVL (A.PUR_NBR, ' ') PUR_NBR,
       A.PROC_STUS_CD,
       A.RQST_COEF_RATE,
       A.UPD_EMP_ID,
       A.UPD_DT,
       A.UPD_TM,
       D.SUPP_MIN_QTY,
       '' LT_MARK,
       B.CLS_LVL_CD,
       B.TC_FORM_ENG_NM,
       B.LEAD_TM_DAYS_MSR,
       A.SUPP_UNIT_CD,
       B.VNDR_NBR VNDR_NBR1
  FROM PUR_REQUEST_DETAILS A,
       BAS_MATERIAL B,
       BAS_MATERIAL_CLASS C,
       VND_SUPPLY D
 WHERE     A.RQST_NBR = 'M150000123'
       AND A.TC_FORM_CD = B.TC_FORM_CD
       AND A.VNDR_NBR = D.VNDR_NBR
       AND B.TC_FORM_CD = D.TC_FORM_CD
       AND A.PROC_STUS_CD <> '0'
       AND A.PROC_STUS_CD <> 'Z'
       AND C.CLS_TYP_CD = '1' -- ISSUE
       AND B.CLS_LVL_CD = C.CLS_LVL_CD
       AND C.PROC_STUS_CD <> '0'

## 2015-07-15 (WED) 
- 新增報表 LCSR0030 - 料號使用棧板狀況一覽表
SELECT A.CODE,MAX(ENGLISH_SHORTNAME) ENGLISH_SHORTNAME,COUNT(PALLET_ID) PALLET_COUNT
FROM LCS_ITEM_WITH_PALLET A,BAS_MATERIAL B
WHERE A.CODE=B.CODE AND '1700021' <= A.CODE AND A.CODE <= '1700023' 
GROUP BY A.CODE

## 2015-07-14 (TUE) 
- 新增報表 LCSR0030 - 料號使用棧板狀況一覽表
SELECT A.CODE,MAX(ENGLISH_SHORTNAME) ENGLISH_SHORTNAME,COUNT(PALLET_ID) PALLET_COUNT
FROM LCS_ITEM_WITH_PALLET A,BAS_MATERIAL B
WHERE A.CODE=B.CODE AND '1700021' <= A.CODE AND A.CODE <= '1700023' 
GROUP BY A.CODE

## 2015-07-13 (MON)
以
E68180
登入報廢作業(
INVD0140
)報廢一般品

報廢編號：
航服品字第2015-0006號

報廢理由：
航服品字第E2015-0020號

(下面30個勾選理由都一樣)
以下為勾選的30個品項的料號  麻煩您協助處查詢了
謝謝！

0300302
0300504
0300512
0500044(X)
0800003(X)
0800054(X)
0800057(X)
0800065(X)
0800066(X)
0800067
0800068
0800069
0800070
0800071
0800084(X)
0800085(X)
0800086(X)
0800095(X)
0800107(X)
0900195(X)
0900304(X)
0900309(X)
1300703(X)
1300714(X)
1700065(X)
1700129(X)
1700130(X)
1700131(X)
1700140
1700141

## 2015-07-09 (THU)
- 處理SCS service 在正式環境無法運作的問題
- USER反應主檔管理的 中英文特色介紹，現在在key進去時發現，key完存檔成功後，再按修改進去看，剛剛key的資料又變空白。
幫我試一下你本機會這樣嗎？

## 2015-07-08 (WED)
- 修正PURR0020報表

 
## 2015-07-07 (TUE)
- 修正BASM0124 BUG
- 協助發布scs service到正式環境

## 2015-07-06 (MON)

檢查SQL查詢會發生錯誤的原因，檢查資料面有甚麼問題，並提出修正方案

  

    SELECT TRANS_NO,
           SHEET_NO,
           IN_OUT,
           A.CODE,
           TRANS_QTY,
           INV_QTY,
           A.ORIGINAL_DATE,
           ENGLISH_SHORTNAME,
           STORE_UNIT,
           UPPER (A.APPLY_NO) APPLY_NO,
           IN_OUT_DATE
      FROM (SELECT A.TRANS_NO,
                   A.SHEET_NO SHEET_NO,
                   IN_OUT,
                   B.CODE CODE,
                   B.TRANS_QTY,
                   (SELECT CURRENT_QTY
                      FROM CTM_CUSTOMS_BOND_STOCK
                     WHERE STORE_NO = 'MANO' AND CODE = B.CODE)
                      INV_QTY,
                   A.IN_OUT_DATE,
                   B.ORIGINAL_DATE,
                   B.ORIGINAL_NO APPLY_NO
              FROM CTM_CUSTOMS_TRANS_MASTER A, CTM_CUSTOMS_TRANS_DETAILS B
             WHERE A.STORE_NO = 'MANO' AND A.IN_OUT = 'I' AND A.STATUS <> '0'
                   AND TRUNC (SYSDATE) - TO_DATE (B.ORIGINAL_DATE, 'YYYYMMDD') >
                          TO_NUMBER ('720')
                   AND B.CODE >= '0'
                   AND B.CODE <= 'zzzzzzzzzzzzzz'
                   AND B.CODE IN
                          (  SELECT B.CODE
                               FROM CTM_CUSTOMS_TRANS_MASTER A,
                                    CTM_CUSTOMS_TRANS_DETAILS B
                              WHERE     A.STORE_NO = B.STORE_NO
                                    AND A.SHEET_NO = B.SHEET_NO
                                    AND B.ORIGINAL_DATE >= '20060101'
                                    AND A.STORE_NO = 'MANO'
                                    AND A.IN_OUT = 'I'
                                    AND A.STATUS <> '0'
                                    AND B.STATUS <> '0'
                                    AND B.CODE >= '0'
                                    AND B.CODE <= 'zzzzzzzzzzzzzz'
                                    AND TRUNC (SYSDATE)
                                        - TO_DATE (B.ORIGINAL_DATE, 'YYYYMMDD') >
                                           TO_NUMBER ('720')
                           GROUP BY B.CODE
                             HAVING TRUNC (SYSDATE)
                                    - TO_DATE (MAX (B.ORIGINAL_DATE), 'YYYYMMDD') >
                                       TO_NUMBER ('720'))
                   AND B.STATUS <> '0'
                   AND A.STORE_NO = B.STORE_NO
                   AND A.SHEET_NO = B.SHEET_NO
                   AND SUBSTR (A.APPLY_NO, 3, 1) = '/') A,
           CTM_CUSTOMS_BOND_STOCK B,
           BAS_MATERIAL C
     WHERE     B.STORE_NO = 'MANO'
           AND B.CURRENT_QTY > 0
           AND A.CODE = B.CODE
           AND A.CODE = C.CODE
           AND A.ORIGINAL_DATE >= '20060101'
  ORDER BY A.CODE, A.IN_OUT_DATE DESC


## 2015-07-03 (FRI)
  - 延續 2015-07-02 工作內容
  - INVD0130(轉換檔案格式錯誤)
   * http://localhost/SMASWebAP/inv/INVD0130.aspx
   * 操作 勾選2G 2C Transfer按轉檔
     修正方式
       D-000000000000520000000000000000000000
       C000000000000520000000000000000000000

 

## 2015-07-02 (THU)
  - BASM0120  
   * 新增按鈕 [清除未領用之公關單]，點選此按鈕將連結到 BASM0123 (清除未領用之公關單)
  - BASM0123
   * 查詢條件： 申請日期(須限制輸入日期必須為半年以前的日期)
   * 查詢結果欄位如下
    1. 核取框
    2. 申請單
    3. 申請部門
    4. 申請日
    5. 申請人(請到PSN_OPEN_DATA串)
    6. 申請電話
    7. 料號
    8. 數量
   * 查詢邏輯如下

      SELECT A.TRANS_NO,
         A.DEPARTMENT_NO,
         A.TRANS_DATE,
         A.APPLY_ID,
         A.APPLY_TEL,
         B.CODE,
         B.TRANS_QTY
        FROM INV_PUBLIC_GIFT_MASTER A, INV_PUBLIC_GIFT_DETAILS B
       WHERE A.TRANS_NO = B.TRANS_NO AND A.TRANS_DATE < '20150101'


   * 當按下刪除按鈕時，須執行以下邏輯
    1. 紀錄LOG (TableName: INV_PUBLIC_GIFT_DEL_LOG)
      - INV_PUBLIC_GIFT_DEL_LOG 目前尚未建立，需手動建立此資料表，並包含以下欄位
          1. TRANS_NO
          2. DEPARTMENT_NO
          3. TRANS_DATE
          4. APPLY_ID
          5. APPLY_TEL
          6. CODE
          7. TRANS_QTY
          8. INV_INVENTORY_BEFORE_PREN_QTY
          9. INV_INVENTORY_AFTER_PREN_QTY
      - 更新PREN_QTY，更新邏輯如下
        (依料號將GENL的預備出庫量PREN_QTY)-所選資料上面的數量(TRANS_QTY)
      - (依料號將GENL的預備出庫量PREN_QTY) 查詢邏輯如下

            SELECT PREN_QTY
              FROM INV_INVENTORY
             WHERE STORE_NO = 'GENL' AND CODE = ?     
    
    2. 刪除勾選的單據對應的 INV_PUBLIC_GIFT_DETAILS
    3. 刪除勾選的單據對應的 INV_PUBLIC_GIFT_MASTER

sInnerHtml += CreaterInnerHTML("hidden", g_fh.Public_Decode(g_fh.Public_Encode("txtGIFT_FLAG" + rows)), "1", g_fh.Public_Decode(g_fh.Public_Encode(GIFT_FLAG)), false, "", "", true, "", "", "GIFT_FLAG", "");

http://localhost/SMASWebAP/PUR/PURD0024.aspx

## 2015-07-01 (WED)

  - 修改專案的FORTIFY問題
  - 以下為修改程式清單
   * C:\inetpub\wwwroot\SMAS.MainWebAP\SMAS.MainWebAP\Query
   * ServiceMonitor

## 2015-06-30 (TUE)

  - AUTD0080.JS 回復成舊有的程式碼
  - AUTD0080.JS #395 本機連接 http://SMASAP/SMASWebAP/VND/VNDD0057.aspx
  - 修復在 IE 中，執行 BlockUI.js 的 GetTitle() 拋出錯誤的問題
  
## 2015-06-29 (MON)

  - (解決 Fortify 的問題) EAMS.MainWebAP
    C:\Users\Z215\Desktop\EAMS.MainWebAP
    C:\Backup\20150626\(解決 Fortify 的問題) EAMS.MainWebAP
  * EAMS.MainWebAP
    - CommonQuery.aspx.cs
  * EAMS.MainWebAP.AUT
  * EAMS.MainWebAP.BAS
  * EAMS.MainWebAP.PSD
  * SMAS.Cryptography
  * SMAS.CustomComponent
  * SMAS.CustomHandlers
  * SMAS.CustomSecurity
  * DDSC.CustomServerControl
  * DDSC.OracleADO
  * 
  * Logic
  * ReportService
  * 
## 2015-06-26 (FRI)
  - (解決 Fortify 的問題) SMAS_PDA_WS 
    將結果寄信到 STANHUANG@EVAAIR.COM (file://stanhuang@evaair.com/)

## 2015-06-25 (THU)
  - (TCSM) 延續 2015-06-22 的問題，偵錯在(OMD PIC)呈核完成後，為什麼單據沒有跑到系統管理者身上
  - (TCSM) 寄信給 B2ED0032 (製作運補計畫) 按下存檔，請加入寄信給申請者的動作，以下為信件內容範例
  * 以帳號 361027 登入，http://localhost:60273/TCMS/B2E/B2ED030.aspx
  * 查詢條件 運補日期= 20150116 ~ 20150116 ，狀態= 已轉分站運補計
  * 勾選三筆，按 轉運補計劃
  * 將進入B2ED032
  * 直接存檔，請加入寄信給申請者的動作，以下為信件內容範例
  *   主旨：申請單號-A15XXXXX，已由20150117，BR0036運補！
  *   內容：Dear Sir, 申請單號-A15XXXXX，已由20150117，BR0036運補，請記得簽收！
  - (TCSM) 修改檔案清單
  * B2ED011.aspx.vb
  * B2ED032.aspx.vb
  * Utility.vb 
  - 告知郁馨
  * (TCSM)  測試完成請刪除  
    strEmail = "belindashao@evaair.com" ' 這是測試用，未來請刪除

  * (TCSM) 目前發送EMAIL的來源預設為belindashao@evaair.com，若要修改，請查詢以下內容
    Const mailFrom As String = "belindashao@evaair.com"

  * (SMAS) SCRR0160
  * 來源預設為SCR_RPT_TMP_1，並非SCR_RPT_TMP，請在PRODUCTION環境建立相同TABLE

## 2015-06-24 (WED)
  - 處理B2CM0031.js (Fortify)

## 2015-06-23 (TUE)
  - 修正 ReportLogic_OUT.OUTR0050 計算報表錯誤
  - TCMS(AUTD070)，場站主管審核後，若申請資料遭OMD PIC或系統管理人修改，由系統傳送異動通知(email)給申請人
  * 測試 OMD PIC  ： B82420 登入，送審日期放20150101，隨便點一張單據內容
  * 測試 系統管理人： 361027 登入
  * OMD PIC  ：SELECT EMP_ID FROM AUT_MANAGER_DATA

  * EMAIL
         - SUBJECT: 審核人 - $目前使用者姓名$ 異動單據 $目前單據號碼$ 通知
         - BODY:
            * 申請單號
            * 申請品項
            * 品項~審核數量(前五欄)
         - DESTINATION: $審請人EMAIL$
  * 再提醒一下，申請人用我的id-854180取代，到AD SERVER找E-MAIL後寄給我就好
(1) ADClass.QueryADMail(strADPath, APPLY_EMP_ID)
(2) MyMail.Send is not working


場站主管審核後，若申請資料遭OMD PIC或系統管理人修改，由系統傳送異動通知給申請人 
## 2015-06-22 (MON)
  - 修正 BASD0021.aspx.cs 在存檔之前先檢驗欄位是否超過特定長度
  - 修正 BCRD0022.js 在存檔之前, 會自動新增一筆資料的問題, 導致新增前驗證"標準量加總=總數量"失敗 

## 2015-06-18 (THU)
  - 修正 BASD0021.aspx.cs 錯誤 (BAS_MATERIAL資料表無對應欄位 CHINESE_SPEC_DESC, ENGLISH_SPEC_DESC)
  - PURD0024.aspx 發送email內容錯誤
  * SELECT * FROM BAS_REFERENCE_DATA_DETAILS WHERE CONFIG_TYPE= 'EMAIL_PO'
  * BLL_PURD0020.cs (lineNo: 834)

[x]
鄭智方
長榮航空股份有限公司
服務品本部 物品採購部 物品採購課
33801桃園縣蘆竹鄉新南路一段376號8樓
Tel : +886-3-351-5939 Fax: +886-3-351-0017
E-mail : veronicacheng@evaair.com

Veronica Cheng
Procurement Sec.Procurement Dept., Cabin Service Div
EVA Airways Corp.
8th FL., 376, Hsin-Nan Rd., Sec. 1, Luchu, Taoyuan Hsien, 338, Taiwan
Tel : +886-3-351-5939 Fax: +886-3-351-0017
E-mail : veronicacheng@evaair.com

[O]
鄭智方
長榮航空股份有限公司
客艙服務本部 商品行銷部 商品採購課
33801桃園縣蘆竹鄉新南路一段376號二訓大樓9樓
Tel : +886-3-351-5939 Fax: +886-3-351-0017
E-mail : veronicacheng@evaair.com

英文版如下：

Veronica Cheng
Product Procurement Sec. Product Marketing Dept., Cabin Service Div
EVA Airways Corp.
9th FL. 2nd Training Building, 376, Hsin-Nan Rd., Sec. 1, Luchu, 
Taoyuan Hsien, 338, Taiwan
Tel : +886-3-351-5939 Fax: +886-3-351-0017
E-mail : veronicacheng@evaair.com

  - 撰寫報表 SCRR0160
  * 測試資料(190001 OR 200911)
  * 由於要顯示圖片, 因此另外開一個TABLE (SCR_RPT_TMP_1), 儲存報表資料
```
CREATE TABLE UATTEST.SCR_RPT_TMP_1
(
  SEQ       VARCHAR2(10 BYTE),
  C1        VARCHAR2(60 BYTE),
  C2        VARCHAR2(60 BYTE),
  C3        VARCHAR2(60 BYTE),
  C4        VARCHAR2(60 BYTE),
  C5        VARCHAR2(60 BYTE),
  C6        VARCHAR2(60 BYTE),
  C7        VARCHAR2(60 BYTE),
  C8        VARCHAR2(60 BYTE),
  C9        VARCHAR2(60 BYTE),
  C10       VARCHAR2(60 BYTE),
  C11       VARCHAR2(60 BYTE),
  C12       VARCHAR2(60 BYTE),
  C13       VARCHAR2(60 BYTE),
  C14       VARCHAR2(60 BYTE),
  C15       VARCHAR2(60 BYTE),
  C16       VARCHAR2(60 BYTE),
  C17       VARCHAR2(60 BYTE),
  C18       VARCHAR2(60 BYTE),
  C19       VARCHAR2(60 BYTE),
  C20       VARCHAR2(60 BYTE),
  C21       VARCHAR2(60 BYTE),
  C22       VARCHAR2(60 BYTE),
  C23       VARCHAR2(60 BYTE),
  C24       VARCHAR2(60 BYTE),
  C25       VARCHAR2(60 BYTE),
  C26       VARCHAR2(60 BYTE),
  C27       VARCHAR2(60 BYTE),
  C28       VARCHAR2(60 BYTE),
  C29       VARCHAR2(60 BYTE),
  C30       VARCHAR2(60 BYTE),
  C31       VARCHAR2(60 BYTE),
  C32       VARCHAR2(60 BYTE),
  C33       VARCHAR2(60 BYTE),
  C34       VARCHAR2(60 BYTE),
  C35       VARCHAR2(60 BYTE),
  C36       VARCHAR2(60 BYTE),
  C37       VARCHAR2(60 BYTE),
  C38       VARCHAR2(60 BYTE),
  C39       VARCHAR2(60 BYTE),
  C40       VARCHAR2(60 BYTE),
  C41       VARCHAR2(60 BYTE),
  C42       VARCHAR2(60 BYTE),
  C43       VARCHAR2(60 BYTE),
  C44       VARCHAR2(60 BYTE),
  C45       VARCHAR2(500 BYTE),
  C46       VARCHAR2(500 BYTE),
  C47       VARCHAR2(4000 BYTE),
  C48       VARCHAR2(200 BYTE),
  C49       VARCHAR2(300 BYTE),
  C50       VARCHAR2(200 BYTE),
  C51       BLOB,
  C52       BLOB,
  C53       BLOB,
  C54       BLOB,
  N1        NUMBER(10),
  N2        NUMBER(10),
  N3        NUMBER(10),
  N4        NUMBER(10),
  N5        NUMBER(10),
  N6        NUMBER(10),
  N7        NUMBER(10),
  N8        NUMBER(10),
  N9        NUMBER(10),
  N10       NUMBER(10),
  N11       NUMBER(10),
  N12       NUMBER(10),
  N13       NUMBER(10),
  N14       NUMBER(10),
  N15       NUMBER(10),
  N16       NUMBER(10),
  N17       NUMBER(10),
  N18       NUMBER(10),
  N19       NUMBER(10),
  N20       NUMBER(10),
  N21       NUMBER(10),
  N22       NUMBER(10),
  N23       NUMBER(10),
  N24       NUMBER(10),
  N25       NUMBER(10),
  N26       NUMBER(10),
  N27       NUMBER(10),
  N28       NUMBER(10),
  N29       NUMBER(10),
  N30       NUMBER(10),
  N31       NUMBER(10),
  N32       NUMBER(10),
  N33       NUMBER(10),
  N34       NUMBER(10),
  N35       NUMBER(10),
  N36       NUMBER(10),
  N37       NUMBER(10),
  N38       NUMBER(10),
  N39       NUMBER(10),
  N40       NUMBER(10),
  N41       NUMBER(15,5),
  N42       NUMBER(15,5),
  N43       NUMBER(15,5),
  N44       NUMBER(15,5),
  N45       NUMBER(15,5),
  N46       NUMBER(15,5),
  N47       NUMBER(15,5),
  N48       NUMBER(15,5),
  N49       NUMBER(15,5),
  N50       NUMBER(15,5),
  CRT_DATE  VARCHAR2(8 BYTE)                    DEFAULT TO_CHAR(SYSDATE,'YYYYMMDD'),
  CRT_TIME  VARCHAR2(6 BYTE)                    DEFAULT TO_CHAR(SYSDATE,'HH24MMSS')
)
```
## 2015-06-17 (WED)
  - 撰寫報表 SCRR0160X
  
## 2015-06-16 (TUE)
  - 修正 BASD0023.aspx
   
Only JPG file formate accepted .
http://www.codeproject.com/Questions/708851/How-to-store-images-and-displaying-images-in-cryst
http://forums.asp.net/t/1896748.aspx?Displaying+images+BLOB+Mysql+data+in+Crystal+Report+
http://forums.asp.net/t/1724447.aspx?Unable+to+show+image+on+Crystal+Report

 public string[] SCRR0160(string SEQ, string PERIOD, string CLASS, string PRINTDATE, string HOUR, string MIN)

## 2015-06-15 (MON)
  - 機型總數量維護作業針對失效版本進行複製，複製內容的有效期限須為9991231(BCRD0011.aspx)
  - TCMS系統( 361027 / 1234 )
  * TCMSBL.vb, <del>主檔中航班資訊，新增B7航班資訊</del>
  - 機上免稅品新品圖 (SCRR0160)
  * 功能: [預覽列印], [批次列印], [清除]
  * 查詢欄位(1/2):年月(必填欄位)
  * 查詢欄位(2/2):商品主類別(下拉選單, 預設為全部)  
    ```
    SELECT * FROM BAS_SUB_COMMON_TYPE WHERE CODE_TYPE='SC';
    ```
  * 查詢邏輯({料號, 中文品名, 英文品名, 圖} = {CODE, NAME_CHINESE, NAME_ENGLISH, IMAGE}) 
    ```
    SELECT * FROM PRE_PREORDER_MATERIAL WHERE CODE IN 
    (
    SELECT 
        DISTINCT CODE 
    FROM 
        BAS_MATERIAL 
    WHERE 
        REQUEST_DATE BETWEEN '19000101' AND '19000131'
        AND CLASS = 'W'
    )
    ```
  * 四筆資料一頁

## 2015-06-12 (FRI)
  - TCMS系統( 361027 / 1234 )
  * TCMSBL.vb, <del>主檔中航班資訊，新增B7航班資訊</del>

## 2015-06-11 (THU)
  - TCMS系統( 361027 / 1234 )
  * B2ED011, <del>系統管理人審核申請單時，先提示庫存量及單位，超出庫存量者無法審核，必須修改審核數量</del>

## 2015-06-10 (WED)
  - TCMS系統( 361027 / 1234 )
  * 主檔中航班資訊，新增B7航班資訊 
  * 系統管理人審核申請單時，先提示庫存量及單位，超出庫存量者無法審核，必須修改審核數量
  * B2E3B, <del>運補單產生時，資料依場站別印出</del>
  * INVD060, <del>查詢表單資料時，不需列出已下架版本，僅列出最新版本</del>

  <dataBase id="FIS">
    <DBType>Oracle</DBType>
    <DBServer>FIS.evaair.com</DBServer>
    <DBName>FIS.evaair.com</DBName>
    <ID>AAFS_SMAS</ID>
    <Password>SMAS_FIS0301</Password>
    <ConnectionTimeOut>1</ConnectionTimeOut>
  </dataBase>
  <dataBase id="TCMS">
    <DBType>Oracle</DBType>
    <DBServer>TCMSTEST.evaair.com</DBServer>
    <DBName>TCMS</DBName>
    <ID>TCMSTEST</ID>
    <Password>p35TCMST082</Password>
    <ConnectionTimeOut>1</ConnectionTimeOut>
  </dataBase>
  <dataBase id="TCMS">
    <DBType>Oracle</DBType>
    <DBServer>TCMS.evaair.com</DBServer>
    <DBName>TCMS</DBName>
    <ID>TCMS</ID>
    <Password>p35TCMS03</Password>
    <ConnectionTimeOut>1</ConnectionTimeOut>
  </dataBase>

## 2015-06-09 (TUE)
  - fortify (SMAS.MainWebAP.UNI)
  - 除錯(PSNF020\NIGHTRUN.cs)並未將物件參考設定為物件的執行個體

## 2015-06-08 (MON)
  - fortify (SMAS.MainWebAP.UNI)
  - 除錯(PSNF020\NIGHTRUN.cs)並未將物件參考設定為物件的執行個體
  - PURR020 (C:\Inetpub\wwwroot\TCMS\PUR\Report), <del>採購管理流程中，訂購單版本不正確，需修改成最新版序</del>

## 2015-06-05 (FRI)
  - fortify (SMAS.MainWebAP.UNI)
  - 查詢以下問題發生原因，AUTD0080在執行駁回申請時，更新 H_ONWAY_QTY 有問題
  - 模擬情境 
  * 以 399468 登入 --> INVD0020 --> 新增 --> MANO 到 KHHO --> 4800755 36個，送審,產生H150003579
  * 以 187560 登入 --> AUTD0080 --> 擬准
  * 以 E70465 登入 --> AUTD0080 --> 駁回
Procedure.cs
lineNo: 4312
```
SELECT 
  ROWID, B.* 
FROM 
  INV_EXPIRE_MATERIAL_STOCK B
WHERE 
  STORE_NO='KHHO'
  AND CODE='4800755'
  AND QTY<>0;
```

## 2015-06-04 (THU)
  - fortify

## 2015-06-03 (WED)
  - 設定本機資料夾( C:\inetpub\wwwroot\SMAS.MainWebAP\SMAS.MainWebAP.BAS\TEMP )
  * 建立資料夾 C:\inetpub\wwwroot\SMAS.MainWebAP\SMAS.MainWebAP.BAS\TEMP
  * 給予以下使用者此資料夾的所有權限
    (1) NETWORK SERVICE
   
 - 設定遠端資料夾( \\Smasap03.evaair.com\smas\Sound\BAS\Material\ )
  * 登入到伺服器 SMASAP03
  * 建立資料夾 C:\SMAS\Sound\BAS\Material (SELECT SERVER_PATH FROM BAS_DATA_INTERFACE WHERE INTERFACE_ID = 'BASD0020_S')
  * 給予以下使用者此資料夾的所有權限
    (1) 選擇一個DOMAIN USER(e.g. evaair/e10760)，此DOMAIN USER就是登入QASMASAP01的使用者
    (2) 將給予此使用者資料夾所有權縣 

 - 使用FortifyUtils.PathCombine會出問題
  //string filePath = FortifyUtils.PathCombine(dir, string.Format("{0}{1}", SERIAL_NO, Path.GetExtension(htmlInputFile.PostedFile.FileName)));
  //filePath = "\\" + filePath;
  
  string filePath = Path.Combine(dir, string.Format("{0}{1}", SERIAL_NO, Path.GetExtension(htmlInputFile.PostedFile.FileName)));
  return filePath;

http://blog.miniasp.com/post/2007/11/10/How-to-write-file-to-net-share-folder-using-ASPNET.aspx
http://www.outsystems.com/forums/discussion/5653/how-to-setting-up-applications-access-to-file-systems/
https://msdn.microsoft.com/en-us/library/cc515176%28v=cs.70%29.aspx


## 2015-06-02 (TUE)
  - 修正Fortify Issue
  * APN
  * AUT(尚未解決)
  * B2C(尚未解決)
  * BAS
  * BCR
  * BUD
  * CAT
  * CRW(尚未解決)
  * CTM
  * INV
  * LCS(尚未解決)
  * NSP
  * OUT
  * PSD


## 2015-06-02 (MON)
  - 修正在PURD0040在產製報表INVR0140R, PURR0060R的問題

SELECT 
    ORIGINAL_TRANS_NO,
    (SELECT DISTINCT REQUEST_NO FROM PUR_PURCHASE_DETAILS WHERE PURCHASE_NO=ORIGINAL_TRANS_NO),
    (SELECT VENDOR_NO FROM PUR_PURCHASE_MASTER WHERE PURCHASE_NO=ORIGINAL_TRANS_NO),
    (SELECT VENDOR_NAME_ENGLISH FROM VND_VENDOR WHERE VENDOR_NO = (SELECT VENDOR_NO FROM PUR_PURCHASE_MASTER WHERE PURCHASE_NO=ORIGINAL_TRANS_NO))
FROM
    INV_TRANS_DETAILS
WHERE    
    TRANS_NO='J150000033' 
ORDER BY  ORIGINAL_TRANS_NO  

## 2015-05-29 (FRI)
  - 修正在QASMASWBS04執行Jobs會失敗的問題
  - 建立JobRecorder

INVR0140報表前四項要各自獨立成一行
抓資料的方式還要再問泰尉

流程
PURD0040 -> 20150522 ~ 20150529
SELECT ONE ROW (申請單序號　5006)
PRESS '相關訂購單...'
PRESS '批次列印'

檢視報表
PURR0060R
INVR0140R

INVR0140_1

## 2015-05-28 (THU)
  - 修正在QASMASWBS04執行Jobs會失敗的問題
  * 確保相關資料庫連線參數有設定在 C:\dbconfig.xml
  * 確保相關資料庫連線參數有設定在 tnsname.ora
  * 建立資料夾 "C:\com.ddsc.database"，並給予目前使用者有足夠權限存取此資料夾
  
## 2015-05-27 (WED)
  - BASD0023加入下載功能
  - 轉檔(將 PSN_OPEN_DATA_NEW 從 WP32.evaair.com 寫入 SMASTEST.evaair.com)
  * 工作環境 : QASMASWBS04 (帳號密碼 : E70964/19910103)
  * 請在 QASMASWBS04 另開專案
  * SMASTEST.evaair.com (scs/p35scs2015)
  * WP32.evaair.com (SMAS_LINK/CPU)
  * dbCONFIG:
```
<dataBase id="WP32" EventLog="false" EventLogPath="C:\com.ddsc.database">
  <dbType>ORACLE</dbType> 
  <dbServer>WP32.evaair.com</dbServer> 
  <userID>HordAK8TsYM9lXFV6GIZ+a5qm4HJWnvFUPzKnBhgz/4=</userID> 
  <userPW>EOLTLkpFBsf0TpokzRHOEu0YR6zhTWvsnyqHsb54WtI=</userPW> 
  <connectionTimeOut>100000</connectionTimeOut> 
</dataBase>
```
 
## 2015-05-26 (TUE)
  - 處理 OUTR0030 預覽報表問題  
    請幫忙看看一樣的報表，都是跑AA 料庫，為何數字會不同?? 謝謝!  
  http://localhost/SMASWebAP/OUT/OUTR0030.aspx

 
轉檔來源
WP32.evaair.com  
SMAS_LINK/CPU  
轉檔目的
SMARTTEST.evaair.com

QueryCondition 1
料號 0100001 ~ 4999999 
年月 201404  ~ 201503

料號 1100379 
年月 201404 201503

E70964/19910102

QueryCondition 2
料號 1100379 
年月 201405 201504

## 2015-05-25 (MON)
  - (BASD0023) 解決 Fortify Issue
 
## 2015-05-22 (FRI)

  - 測試帳號:395408
  - TASK01: BASD0021加入兩個欄位(中文特色介紹，英文特色介紹)
  - TASK02: 新增上傳聲音檔(BASD0023)頁面
  * 聲音檔允許上傳檔案類型(WAV,WMV,MP3)
  * 可以線上播放

  CHINESE_SPEC_DESC    VARCHAR2(100 BYTE),
  ENGLISH_SPEC_DESC    VARCHAR2(100 BYTE)

(1)
  <data name="BTNSOUND" xml:space="preserve">
    <value>聲音資料</value>
  </data>  
  <data name="SOUNDPATH" xml:space="preserve">
    <value>聲音檔案路徑</value>
  </data>
  <data name="CHINESE_SPEC_DESC" xml:space="preserve">
    <value>中文特色介紹</value>
  </data>
  <data name="ENGLISH_SPEC_DESC" xml:space="preserve">
    <value>英文特色介紹</value>
  </data>  

(2) 建立資料夾並授予權限
C:\inetpub\wwwroot\SMAS.MainWebAP\SMAS.MainWebAP.BAS\TEMP

(3) 專案參考需增加 NuGet: Sasa

gNewData += txtREMARK.Text.Trim() + "?"; //備註

BAS_MATERIAL_SOUND_SEQUENCE, BAS_MATERIAL_IMAGE_SEQUENCE 一模一樣 拷貝即可
抓取最新版本

## 2015-05-21 (THU)
  - 宣導維護(PSDM0090, PSDM0091) 解決 Fortify Issue 
  - 屬性: 海關庫存差異檢核
  - 

## 2015-05-20 (WED)
  - 偵錯料號(8402225, 8402235, 8402216) 在
  - 時與預期結果不一致的問題  
  - 屬性: 海關庫存差異檢核
  - 

## 2015-05-19 (TUE)
  - 宣導維護(PSDM0090, PSDM0091)
  - 屬性: 海關庫存差異檢核轉檔

## 2015-05-18 (MON)
  - 宣導維護(PSDM0090, PSDM0091)
  - 屬性: 海關庫存差異檢核轉檔

## 2015-05-15 (THU)
  - 宣導維護(PSDM0090, PSDM0091)
  - 屬性: 海關庫存差異檢核轉檔
  
## 2015-05-14 (THU)
  - 宣導維護(PSDM0090, PSDM0091)
  - 屬性: 海關庫存差異檢核轉檔
  - TABLE: PSD_LED_PPT_ITEM
  - [解決
  - 失敗，拒絕存取路徑](http://name7946123.blogspot.tw/2013/07/blog-post_18.html)  
  - [使用PLUPLOAD進行多檔案上傳(前端)](http://www.plupload.com/docs/)  
  - [使用PLUPLOAD進行多檔案上傳(後端)](http://weblog.west-wind.com/posts/2013/Mar/12/Using-plUpload-to-upload-Files-with-ASPNET)
  - 專案參考需增加 NuGet: Westwind.Utilities, AntiXSS, Sasa
  - 上傳資料夾(TempUploads, Uploads)，針對IIS_IUSEr加入所有權限
  - [sasa source code](http://sourceforge.net/projects/)sasa/
 
## 2015-05-13 (WED)
  - CTMF020.CheckInconsistentStock
  * 工作屬性：海關帳
  * 新增 [庫存量 = 現有量 AND 庫存量 <> 海關庫存量]
  * 新增 [現有量 <> 海關庫存量]
  - CTMF020_TEMP.UpdateInconsistentStock
  * 工作屬性：海關帳
  * SET 海關庫存量 = 庫存量 IF 現有量 = 庫存量一樣 AND 庫存量 <> 海關庫存量

## 2015-05-12 (TUE)
  - 修正INVR0020最新庫存表卻跑不出
  * 頁面  
    http://localhost/SMASWebAP/INV/INVR0020.aspx
  * 查詢條件
    1. 料庫: 
    2. GENL
    2. 料號1: 6200960 ~ 6200970
  * 對應查詢邏輯    
    \\C136244\shared\20150512_INVR0020_GENL_6200960_6200970.SQL
  * 結論  
    無任何問題

  - 忘記哪一功能頁，但以下邏輯有問題
  -   
```
if (string.IsNullOrEmpty(Request["From"].ToString().Trim()) & string.IsNullOrEmpty(Request["To"].ToString().Trim()))  
else if (!string.IsNullOrEmpty(Request["From"].ToString().Trim()) & !string.IsNullOrEmpty(Request["To"].ToString().Trim()))  
```   



## 2015-05-11 (MON)

  - 修正INVR0020在預覽列印時，發生異常的問題
  * 頁面  
    http://localhost/SMASWebAP/INV/INVR0020.aspx
  * 查詢條件
    1. 料庫: MANO
    2. 料號1: 4000001 ~ 4999999  
  * 錯誤訊息(英文)  
    The given DataRow is not in the current DataRowCollection
  * 發生例外問題點  
    ReportLogic_INV.INVR0020,  ds_P1.Tables[1].Rows.Remove(row); // 清除原本的資料
  * 解決方法  
    if (!original_rows.Contains(dr)) // 原本只有 'original_rows.Add(dr);'，加上這一行避免重複加入 dr

  - 修正INVR0300，2015/03月的當月進貨金額，沒有資料。
  * 頁面  
    http://localhost/SMASWebAP/INV/INVR0300.aspx
  * 查詢條件  
    201503
  * 對應查詢邏輯    
    \\LOCALHOST\shared\INVR0300_201503.sql
  * 錯誤原因  
    INV_STOCK_AVG_AMT在201503月份沒有資料
  * 搜尋會塞入INV_STOCK_AVG_AMT資料表的JOB，手動執行對應動作(參數為201503)

## 2015-05-08 (FRI)

  - 新增PSDM0070, PSDM0071

## 2015-05-07 (THU)

  - 新增PSDM0080, PSDM0081
    
## 2015-05-06 (WED)

  - 修正PSDM0021星期欄位，對應儲存到資料庫的欄位格式
  - 航行管制部作業手冊
  * PSDM0070
  * PSDM0071
  * PSDM0080
  * PSDM0081
  
  * task_1 2015-05-05 (TUE) 
  * task_1 2015-04-30 (THU)
  * task_1 2015-04-29 (WED)
  * task_1 2015-04-21 (TUE)

  * task_2 2015-05-04 (MON)
  * task_2 2015-04-22 (WED)
  * task_2 2015-04-20 (MON)
  * task_2 2015-04-17 (FRI)

  * task_3 2015-04-15 (WED)
  * task_3 2015-04-14 (TUE)
  * task_3 2015-04-13 (MON)
  * task_3 2015-04-10 (FRI)

  * task_4 2015-04-28 (TUE)
  * task_4 2015-04-27 (MON)
  * task_4 2015-04-24 (FRI)
  * task_4 2015-04-23 (THU)
  
## 2015-05-05 (TUE)

  - 修正PSDM0021星期欄位，對應儲存到資料庫的欄位格式
  - 航行管制部作業手冊
  * PSDM0070
  * PSDM0071
  * PSDM0080
  * PSDM0081

  
## 2015-05-04 (MON)

  - 修正報表計算問題 
  - 
  
## 2015-04-30 (THU)

  - PURD0023新增以下欄位，並且修改對應UI

```
NEWS_WEEKDAYS  VARCHAR2(256 BYTE)             NOT NULL,  
NEWS_TIME1     VARCHAR2(8 BYTE)               NOT NULL,  
NEWS_TIME2     VARCHAR2(8 BYTE)               NOT NULL,                   
NEWS_TARGETS   VARCHAR2(256 BYTE)             NOT NULL,  
NEWS_IMGNAME   VARCHAR2(256 BYTE)             NOT NULL,  
NEWS_IMGPATH   VARCHAR2(256 BYTE)             NOT NULL,  
```
 
## 2015-04-29 (WED)

  - 偵錯B2CR0140報表問題, 尋找ReportLogic_B2C.cs中，函式B2CR0140查詢SQL問題
 
## 2015-04-28 (TUE)

  - 轉檔 PSNF010

## 2015-04-27 (MON)

  - 修正PURD0021.aspx，處理儲存按鈕後，訂單在途量的數目不正確的問題
 
## 2015-04-24 (FRI)

  - 修正PURD0021.aspx，處理在執行取消訂單後，訂單在途量的數目不正確的問題

## 2015-04-23 (THU)

  - 修正PURD0021.aspx，處理在執行取消訂單後，訂單在途量的數目不正確的問題
 
## 2015-04-22 (WED)

  - 修正OUTD0051.js，解決領用量的小數點問題(parseInt改成parseFloat)

## 2015-04-21 (TUE)

  - 修正WorkFlowRemark.aspx, 限制REMARK輸入不可大於200個字

## 2015-04-20 (MON)

  - 修正INVR0050.aspx查詢SQL邏輯(INVD0150.Query)
  
## 2015-04-17 (FRI)

  - 修正INVR0050.aspx查詢SQL邏輯(INVD0150.Query)

## 2015-04-16 (THU)

  - 請假看病

## 2015-04-15 (WED)

  - 修正INVR0050.aspx查詢SQL邏輯(INVD0150.Query)

## 2015-04-14 (TUE)

  - 處理轉檔(CTMF020.CheckStock)  
  EMAIL伺服器    
  const string SMTP = "10.3.25.150";  //測試完，要關掉

## 2015-04-13 (MON)

  - 修正fortity偵測到的XSS問題(B2CM0081.aspx.cs, B2CM0081.js)  
  前端：$.param  
  後端：Server.Encode

## 2015-04-10 (FRI)

  - 修正報表(BCRR0040R.rpt)，不能夠分頁的問題


https://evaflow.evaair.com/djps/