var SVPlayer=function(jPlayerSelector,options){var self=this;this.ui=$('#player_wrapper');this.player=$(jPlayerSelector);this.audio={};this.options=options;this._initPlayer();};SVPlayer.prototype={_initPlayer:function(){var self=this;this.player.jPlayer(this.options);$('#open_playlist_button').click(function(){self.toggleQueue();});$('#playerDetails').dblclick(function(){self.toggleQueue();});$('#player_seeking_buffer, #player_seeking_progress, #player_seeking_back').click(function(event){if(typeof event.offsetX==="undefined"||typeof event.offsetY==="undefined"){var targetOffset=$(event.target).offset();event.offsetX=event.pageX-targetOffset.left;event.offsetY=event.pageY-targetOffset.top;}
var percentage=event.offsetX/$('#player_seeking_back').width()*100;self.player.jPlayer('playHead',percentage);self.play()});$("#player_seeking_scrubber").draggable({containment:"parent",axis:"x",drag:function(){var totalWidth=$('#player_seeking_back').width();var currentPos=$(this).position().left;var percentage=currentPos/totalWidth*100;self.player.jPlayer('playHead',percentage);}});$('#volume_back, #volume_progress').click(function(event){if(typeof event.offsetX==="undefined"||typeof event.offsetY==="undefined"){var targetOffset=$(event.target).offset();event.offsetX=event.pageX-targetOffset.left;event.offsetY=event.pageY-targetOffset.top;}
var percentage=event.offsetX/$('#volume_back').width()*100;self.player.jPlayer('volume',percentage/100);$('#volume_progress').width(percentage+'%');var scrubber_left=parseInt($('#volume_back').width()*percentage/100)+'px';$('#volume_scrubber').css('left',scrubber_left);var volumeScale=20;var volumeLevel=Math.ceil(percentage/volumeScale);angular.element($('#player_wrapper')).scope().updateVolumeLevel(volumeLevel);});$("#volume_scrubber").draggable({containment:"parent",axis:"x",drag:function(){var currentPos=$(this).position().left;var percentage=currentPos/$('#volume_back').width()*100;self.player.jPlayer('volume',percentage/100);$('#volume_progress').width(percentage+'%');var volumeScale=20;var volumeLevel=Math.ceil(percentage/volumeScale);angular.element($('#player_wrapper')).scope().updateVolumeLevel(volumeLevel);}});this.player.bind($.jPlayer.event.ready,function(event){if(event.jPlayer.html.used&&event.jPlayer.html.audio.available){self.audio=$(this).data("jPlayer").htmlElement.audio;}});this.player.bind($.jPlayer.event.play,function(event){if((typeof self.audio.buffered==="object")&&(self.audio.buffered.length>0)){$('#player_duration').text($.jPlayer.convertTime(self.audio.duration));}});this.player.bind($.jPlayer.event.timeupdate,function(event){var percentage=event.jPlayer.status.currentPercentAbsolute;if(percentage==0){isAddPlayRecord=false;}else if(percentage>25&&!isAddPlayRecord){isAddPlayRecord=true;angular.element($('#player_wrapper')).scope().addPlayRecord(false);}
$('#player_elapsed').text($.jPlayer.convertTime(event.jPlayer.status.currentTime));$('#player_seeking_progress').width(percentage+'%');$('#player_seeking_scrubber').css('left',percentage+'%');});this.player.bind($.jPlayer.event.volumechange,function(event){});this.player.bind($.jPlayer.event.ended,function(event){angular.element($('#player_wrapper')).scope().addPlayRecord(true);angular.element($('#player_wrapper')).scope().next();});this.player.bind($.jPlayer.event.progress,function(event){var percent=0;if((typeof self.audio.buffered==="object")&&(self.audio.buffered.length>0)){if(self.audio.duration>0){$('#player_duration').text($.jPlayer.convertTime(self.audio.duration));var bufferTime=0;for(var i=0;i<self.audio.buffered.length;i++){bufferTime+=self.audio.buffered.end(i)-self.audio.buffered.start(i);}
percent=100*bufferTime/self.audio.duration;}}else{percent=0;}
$('#player_seeking_buffer').width(percent+'%');});},toggleQueue:function(){var _queue=$('#c_queue').toggle();var _scroll=$('#wrapper').scrollTop();if(_queue.css('display')=='block'){$('#open_playlist_button').addClass('close');$('#wrapper').css({'bottom':221});$('#back-top').css({'bottom':236});if(_scroll>0){$('#wrapper').scrollTop(_scroll+138);}
_gaq.push(['_trackEvent','Player','Open queue','arrow button']);}else{$('#open_playlist_button').removeClass('close');$('#wrapper').css({'bottom':40});$('#back-top').css({'bottom':55});$('#wrapper').scrollTop(_scroll-138);_gaq.push(['_trackEvent','Player','Close queue','arrow button']);}},play:function(){this.player.jPlayer('play');},pause:function(){this.player.jPlayer('pause');},stop:function(){this.player.jPlayer('stop');},mute:function(){this.player.jPlayer("mute");},unmute:function(){this.player.jPlayer("unmute");},setMedia:function(media){this.player.jPlayer('setMedia',{mp3:media});}}
var app=angular.module('app',['ngCookies']);app.run(function($http,$cookies){$http.defaults.headers.post['X-CSRFToken']=$cookies.csrftoken;});app.controller('PlayerController',['$scope','$http',function($scope,$http){$scope.playerTitle=gettext('player_title');$scope.radioModeTitle=gettext('radio_mode');$scope.songs=[];$scope.currentIndex=0;$scope.currentSong=undefined;$scope.queue_list_width=86*2;$scope.radioMode=false;$scope.loopMode=false;$scope.isMute=false;$scope.volumeLevel='lv3';$scope.playState='stop';var player=new SVPlayer('#jplayer',{swfPath:jplayer_swfPath,supplied:'mp3',volume:0.6,solution:'html,flash'});$scope.info=function(message){$.jGrowl(message);}
$scope.remove=function(song){var index=$scope.songs.indexOf(song);$scope.songs.splice(index,1);if(song==$scope.currentSong){if(index<$scope.songs.length){$scope.play();}else{$scope.stop();}}
if(index<$scope.currentIndex){$scope.currentIndex-=1;}
$scope.queue_list_width=86*($scope.songs.length+2);};$scope.add=function(song,isPlayNow){if(isPlayNow===undefined){isPlayNow=false;}
var step=$scope.songs.length;if($.isArray(song)){$scope.songs=$scope.songs.concat(song);}else{$scope.songs.push(song);}
if(isPlayNow){$scope.currentIndex=step;$scope.play();}else{$.jGrowl(gettext('Already add to play queue.'));}
$scope.queue_list_width=86*($scope.songs.length+2);}
$scope.toggleRadio=function(){$scope.radioMode=!$scope.radioMode;if($scope.loopMode){$scope.toggleLoop();}
if($scope.radioMode){$scope.getNextRadio();}}
$scope.updateVolumeLevel=function(volumeLevel){$scope.volumeLevel='lv'+volumeLevel;$scope.$apply();}
$scope.toggleLoop=function(){$scope.loopMode=!$scope.loopMode;if($scope.radioMode){$scope.toggleRadio();}}
$scope.getNextRadio=function(){var endpoint='/music/api/radio/0/';$http({method:'GET',url:endpoint}).success(function(data,status,headers,config){var isExistQueue=false;angular.forEach($scope.songs,function(song,i){if(data.id==song.id){isExistQueue=true;}});if(isExistQueue){$scope.getNextRadio();return;}
if($scope.playState=='stop'){$scope.add(data,true);}else{$scope.add(data);}}).error(function(data,status,headers,config){alert('oops');});};$scope.play=function(song){if(song==$scope.currentSong){if($scope.playState=='pause'){$scope.resume();return;}else if($scope.playState=='play'){$scope.pause();return;}}
if(song){$scope.currentIndex=$scope.songs.indexOf(song);}
if($scope.currentIndex==$scope.songs.length-1){if($scope.radioMode){$scope.getNextRadio();}}
song=$scope.songs[$scope.currentIndex];if(song){$.ajax({url:'/api/v1/public/song/'+song.id+'/',type:'POST',encoding:'UTF-8',cache:false,async:false,dataType:'json',success:function(data){$scope.currentSong=song;player.setMedia(data.file);player.play();}});$scope.playState='play';$.jGrowl('<img src="'+song.image+'" style="float: left; width: 45px; height: 45px; padding: 0px 10px 5px 0px;" />Now Playing<br /> "'+song.name+'"');_gaq.push(['_trackEvent','Song','Play',song.name]);}};$scope.addPlayRecord=function(is_full){if(!angular.isUndefined($scope.currentSong)){$http.post('/api/v1/song/'+$scope.currentSong.id+'/play/',{'is_full':is_full});}};$scope.like=function(song){var _like;if(song.is_like){_like='unlike';}else{_like='like';}
var url='/svapp/music.song/'+song.user.username+'/'+song.id+'/'+_like+'/';login_required(url,function(response){if(response.success){if(_like=='like'){$scope.currentSong.is_like=true;}else{$scope.currentSong.is_like=false;}}
$scope.$apply();});}
$scope.pause=function(){$scope.playState='pause';player.pause();}
$scope.resume=function(){$scope.playState='play';player.play();}
$scope.prev=function(){if($scope.currentIndex>0){$scope.currentIndex-=1;$scope.play();}};$scope.mute=function(){$scope.isMute=!$scope.isMute;if($scope.isMute){player.mute();}else{player.unmute();}}
$scope.next=function(){if($scope.currentIndex<$scope.songs.length-1){$scope.currentIndex+=1;$scope.play();}else{if($scope.loopMode){if($scope.currentIndex>=$scope.songs.length-1){$scope.currentIndex=0;$scope.play();}}else{$scope.stop();$scope.$apply();}}};$scope.start=function(){if($scope.playState=='play'){$scope.pause();}else if($scope.playState=='pause'){$scope.resume();}else{$scope.play();}};$scope.stop=function(){player.stop();$scope.currentIndex=0;$scope.playState='stop';}
$scope.clearQueue=function(){$scope.songs=[];$scope.stop();$scope.queue_list_width=86*2;}
$scope.$watch('playState',function(){if($scope.playState=='play'||$scope.playState=='pause'){$("#player_seeking_scrubber").draggable('enable');}else{$("#player_seeking_scrubber").draggable('disable');}});$scope.$watch('currentIndex',function(){$scope.currentSong=$scope.songs[$scope.currentIndex];});}]);(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var
push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root._=_;}
_.VERSION='1.7.0';var createCallback=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value);};case 2:return function(value,other){return func.call(context,value,other);};case 3:return function(value,index,collection){return func.call(context,value,index,collection);};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection);};}
return function(){return func.apply(context,arguments);};};_.iteratee=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return createCallback(value,context,argCount);if(_.isObject(value))return _.matches(value);return _.property(value);};_.each=_.forEach=function(obj,iteratee,context){if(obj==null)return obj;iteratee=createCallback(iteratee,context);var i,length=obj.length;if(length===+length){for(i=0;i<length;i++){iteratee(obj[i],i,obj);}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj);}}
return obj;};_.map=_.collect=function(obj,iteratee,context){if(obj==null)return[];iteratee=_.iteratee(iteratee,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,results=Array(length),currentKey;for(var index=0;index<length;index++){currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj);}
return results;};var reduceError='Reduce of empty array with no initial value';_.reduce=_.foldl=_.inject=function(obj,iteratee,memo,context){if(obj==null)obj=[];iteratee=createCallback(iteratee,context,4);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index=0,currentKey;if(arguments.length<3){if(!length)throw new TypeError(reduceError);memo=obj[keys?keys[index++]:index++];}
for(;index<length;index++){currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj);}
return memo;};_.reduceRight=_.foldr=function(obj,iteratee,memo,context){if(obj==null)obj=[];iteratee=createCallback(iteratee,context,4);var keys=obj.length!==+obj.length&&_.keys(obj),index=(keys||obj).length,currentKey;if(arguments.length<3){if(!index)throw new TypeError(reduceError);memo=obj[keys?keys[--index]:--index];}
while(index--){currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj);}
return memo;};_.find=_.detect=function(obj,predicate,context){var result;predicate=_.iteratee(predicate,context);_.some(obj,function(value,index,list){if(predicate(value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;predicate=_.iteratee(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value);});return results;};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(_.iteratee(predicate)),context);};_.every=_.all=function(obj,predicate,context){if(obj==null)return true;predicate=_.iteratee(predicate,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index,currentKey;for(index=0;index<length;index++){currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false;}
return true;};_.some=_.any=function(obj,predicate,context){if(obj==null)return false;predicate=_.iteratee(predicate,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index,currentKey;for(index=0;index<length;index++){currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true;}
return false;};_.contains=_.include=function(obj,target){if(obj==null)return false;if(obj.length!==+obj.length)obj=_.values(obj);return _.indexOf(obj,target)>=0;};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,_.property(key));};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs));};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs));};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value;}}}else{iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed;}});}
return result;};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value;}}}else{iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed;}});}
return result;};_.shuffle=function(obj){var set=obj&&obj.length===+obj.length?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index];}
return shuffled;};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)];}
return _.shuffle(obj).slice(0,Math.max(0,n));};_.sortBy=function(obj,iteratee,context){iteratee=_.iteratee(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1;}
return left.index-right.index;}),'value');};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key);});return result;};};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value];});_.indexBy=group(function(result,value,key){result[key]=value;});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1;});_.sortedIndex=function(array,obj,iteratee,context){iteratee=_.iteratee(iteratee,context,1);var value=iteratee(obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;if(iteratee(array[mid])<value)low=mid+1;else high=mid;}
return low;};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj);};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length;};_.partition=function(obj,predicate,context){predicate=_.iteratee(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value);});return[pass,fail];};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];if(n<0)return[];return slice.call(array,0,n);};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)));};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0));};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n);};_.compact=function(array){return _.filter(array,_.identity);};var flatten=function(input,shallow,strict,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input);}
for(var i=0,length=input.length;i<length;i++){var value=input[i];if(!_.isArray(value)&&!_.isArguments(value)){if(!strict)output.push(value);}else if(shallow){push.apply(output,value);}else{flatten(value,shallow,strict,output);}}
return output;};_.flatten=function(array,shallow){return flatten(array,shallow,false,[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(array==null)return[];if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false;}
if(iteratee!=null)iteratee=_.iteratee(iteratee,context);var result=[];var seen=[];for(var i=0,length=array.length;i<length;i++){var value=array[i];if(isSorted){if(!i||seen!==value)result.push(value);seen=value;}else if(iteratee){var computed=iteratee(value,i,array);if(_.indexOf(seen,computed)<0){seen.push(computed);result.push(value);}}else if(_.indexOf(result,value)<0){result.push(value);}}
return result;};_.union=function(){return _.uniq(flatten(arguments,true,true,[]));};_.intersection=function(array){if(array==null)return[];var result=[];var argsLength=arguments.length;for(var i=0,length=array.length;i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break;}
if(j===argsLength)result.push(item);}
return result;};_.difference=function(array){var rest=flatten(slice.call(arguments,1),true,true,[]);return _.filter(array,function(value){return!_.contains(rest,value);});};_.zip=function(array){if(array==null)return[];var length=_.max(arguments,'length').length;var results=Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,i);}
return results;};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i];}else{result[list[i][0]]=list[i][1];}}
return result;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=='number'){i=isSorted<0?Math.max(0,length+isSorted):isSorted;}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1;}}
for(;i<length;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var idx=array.length;if(typeof from=='number'){idx=from<0?idx+from+1:Math.min(idx,from+1);}
while(--idx>=0)if(array[idx]===item)return idx;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start;}
return range;};var Ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError('Bind must be called on a function');args=slice.call(arguments,2);bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));Ctor.prototype=func.prototype;var self=new Ctor;Ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(_.isObject(result))return result;return self;};return bound;};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++];}
while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args);};};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error('bindAll must be passed function names');for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj);}
return obj;};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=hasher?hasher.apply(this,arguments):key;if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address];};memoize.cache={};return memoize;};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null;};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);if(!timeout)context=args=null;}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining);}
return result;};};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>0){timeout=setTimeout(later,wait-last);}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null;}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null;}
return result;};};_.wrap=function(func,wrapper){return _.partial(wrapper,func);};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments);};};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result;};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments);}else{func=null;}
return memo;};};_.once=_.partial(_.before,2);_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys;};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]];}
return values;};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]];}
return pairs;};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i];}
return result;};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){if(!_.isObject(obj))return obj;var source,prop;for(var i=1,length=arguments.length;i<length;i++){source=arguments[i];for(prop in source){if(hasOwnProperty.call(source,prop)){obj[prop]=source[prop];}}}
return obj;};_.pick=function(obj,iteratee,context){var result={},key;if(obj==null)return result;if(_.isFunction(iteratee)){iteratee=createCallback(iteratee,context);for(key in obj){var value=obj[key];if(iteratee(value,key,obj))result[key]=value;}}else{var keys=concat.apply([],slice.call(arguments,1));obj=new Object(obj);for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(key in obj)result[key]=obj[key];}}
return result;};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee);}else{var keys=_.map(concat.apply([],slice.call(arguments,1)),String);iteratee=function(value,key){return!_.contains(keys,key);};}
return _.pick(obj,iteratee,context);};_.defaults=function(obj){if(!_.isObject(obj))return obj;for(var i=1,length=arguments.length;i<length;i++){var source=arguments[i];for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop];}}
return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case'[object RegExp]':case'[object String]':return''+a===''+b;case'[object Number]':if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case'[object Date]':case'[object Boolean]':return+a===+b;}
if(typeof a!='object'||typeof b!='object')return false;var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b;}
var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&'constructor'in a&&'constructor'in b&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)){return false;}
aStack.push(a);bStack.push(b);var size,result;if(className==='[object Array]'){size=a.length;result=size===b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break;}}}else{var keys=_.keys(a),key;size=keys.length;result=_.keys(b).length===size;if(result){while(size--){key=keys[size];if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break;}}}
aStack.pop();bStack.pop();return result;};_.isEqual=function(a,b){return eq(a,b,[],[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType===1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==='[object Array]';};_.isObject=function(obj){var type=typeof obj;return type==='function'||type==='object'&&!!obj;};_.each(['Arguments','Function','String','Number','Date','RegExp'],function(name){_['is'+name]=function(obj){return toString.call(obj)==='[object '+name+']';};});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,'callee');};}
if(typeof/./!=='function'){_.isFunction=function(obj){return typeof obj=='function'||false;};}
_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj));};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==='[object Boolean]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.constant=function(value){return function(){return value;};};_.noop=function(){};_.property=function(key){return function(obj){return obj[key];};};_.matches=function(attrs){var pairs=_.pairs(attrs),length=pairs.length;return function(obj){if(obj==null)return!length;obj=new Object(obj);for(var i=0;i<length;i++){var pair=pairs[i],key=pair[0];if(pair[1]!==obj[key]||!(key in obj))return false;}
return true;};};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=createCallback(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum;};_.random=function(min,max){if(max==null){max=min;min=0;}
return min+Math.floor(Math.random()*(max-min+1));};_.now=Date.now||function(){return new Date().getTime();};var escapeMap={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','`':'&#x60;'};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match];};var source='(?:'+_.keys(map).join('|')+')';var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,'g');return function(string){string=string==null?'':''+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string;};};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?object[property]():value;};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return'\\'+escapes[match];};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}else if(evaluate){source+="';\n"+evaluate+"\n__p+='";}
return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+
source+'return __p;\n';try{var render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}
var template=function(data){return render.call(this,data,_);};var argument=settings.variable||'obj';template.source='function('+argument+'){\n'+source+'}';return template;};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance;};var result=function(obj){return this._chain?_(obj).chain():obj;};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args));};});};_.mixin(_);_.each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==='shift'||name==='splice')&&obj.length===0)delete obj[0];return result.call(this,obj);};});_.each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments));};});_.prototype.value=function(){return this._wrapped;};if(typeof define==='function'&&define.amd){define('underscore',[],function(){return _;});}}.call(this));$(function(){$(document).ajaxStart(function(){loading_indicator.start();});$(document).ajaxStop(function(){loading_indicator.stop();});$('.lazy').lazyload();});var $masonry_container;function img_resize(container,callback){var isAppleDevice=navigator.userAgent.match(/(iPhone|iPod|iPad)/i);var isotope_timeout=isAppleDevice?100:0;var target;if(container=='#eventpage_works_list')
target='#eventpage_works_list .works_box';else if(container=='#home_works_list')
target='#home_works_list';else if(container=='#top_item_box_list')
target='#top_item_box_list'
else
target='#item_box_list';$masonry_container=$(target);$masonry_container.masonry({itemSelector:'.item_box',columnWidth:256,transitionDuration:0,isAnimated:false,gutter:10});$masonry_container.infinitescroll({navSelector:"#nextpage",nextSelector:"#nextpage a.next",itemSelector:".item_box",loadingText:'',loading:{msgText:'',img:'data:image/gif;base64,R0lGODlhAQABAHAAACH5BAUAAAAALAAAAAABAAEAAAICRAEAOw=='}},function(newElements,opts){var $newElems=$(newElements);$masonry_container.masonry('appended',$newElems);$('.lazy').lazyload();});}
function currentUserData(){'use strict';$.get('/accounts/api/current_user_data/',function(html){$('#nav_info_btn').after(html);});}
function init(){$(window).resize(function(){if($('#item_box_list').length>0){img_resize('#item_box_list');}
if($('#top_item_box_list').length>0)
img_resize('#top_item_box_list');if($('#eventpage_works_list').length>0)
img_resize('#eventpage_works_list');if($('#home_works_list').length>0)
img_resize('#home_works_list');});$('.adunit').dfp({dfpID:'6531201',enableSingleRequest:false,sizeMapping:{'banner':[{browser:[1200,400],ad_sizes:[812,132]},{browser:[0,0],ad_sizes:[660,107]}]},afterAllAdsLoaded:function(){start_iosslider();$('.carousel').carousel({interval:5000});}});currentUserData();}
function dynamic(){$(document).ajaxError(function(event,xhr,settings,exception){alert('<h4>系統錯誤，請稍後再試。</h4>'+'<p>'+settings.type+' "'+settings.url+'" : '+exception+'</p>');});$.ajaxSetup({beforeSend:function(xhr,settings){xhr.setRequestHeader("X-CSRFToken",$('input[name*="csrfmiddlewaretoken"]').val());}});$('body').delegate('#wrapper','checktrendingtop',function(){var $that=$('#wrapper');if($that.find('#trending_top').length){$that.css({'top':41});}else if($that.hasClass('eventpage_wrapper')){$that.css('top','');}else{$that.css({'top':0});}});$('#wrapper').trigger('checktrendingtop');$("#wrapper,#zoomScroll").livequery('scroll',function(){var wrapper_scrollHeight=$("#wrapper").scrollTop();var zoomScroll_scrollHeight=$("#zoomScroll").scrollTop();var SHOW_BACK_TOP_BTN_HEIGHT=1000;var isHavePopup=$('#zoomScroll').length>0;if(wrapper_scrollHeight>SHOW_BACK_TOP_BTN_HEIGHT&&!isHavePopup){$("#back-top").fadeIn();$("#back-top").css({'margin-right':0});}else if(zoomScroll_scrollHeight>SHOW_BACK_TOP_BTN_HEIGHT&&isHavePopup){$("#back-top").fadeIn();$("#back-top").css({'margin-right':20});}else{$("#back-top").fadeOut();}});$('#back-top a').live('click',function(){var popup=$('#zoomScroll');if(popup.length>0){popup.scrollTop(0);}else{$('#wrapper').scrollTop(0);}
return false;});$('#top a').live('click',function(){$('#wrapper').scrollTop(0);return false;});$('.title_menu a').live('click',function(){var scroll_to=$(this).attr('href');$('#wrapper').scrollTop($(scroll_to).offset().top);return false;});$('#trending_top').on('remove',function(){$('#wrapper').css({'top':49});});$('.lazy').livequery(function(){$(this).lazyload({failure_limit:10,container:$('#wrapper')});});$('.menu_box div a').livequery('click',function(){$(this).parent().siblings().removeClass('selected');$(this).parent().addClass('selected');});$('#index_wrapper').livequery(function(){if($('#index_wrapper').length>0){$('.lazy').lazyload({container:$('#index_wrapper')});}});$('#previous-load').livequery('click',function(){var anchor=$('div#nextpage a.next');var url=anchor.attr('href')
var that=$(this);$.get(url,function(data){$(data).find('.comment_box').insertAfter(that.parent()).hide().fadeIn();if($(data).find('#nextpage .next').length>0){anchor.attr('href',$(data).find('#nextpage .next').attr('href'));}else{that.fadeOut().remove();anchor.remove();}});return false;});$('#setting_content.messages').livequery(function(){$('#wrapper').scrollTop($('#wrapper')[0].scrollHeight);});$('.messages .comment_box').livequery('mouseenter',function(){$('.message-delete',this).show();});$('.messages .comment_box').livequery('mouseleave',function(){$('.message-delete',this).hide();});$('#top_item_box_list').livequery(function(){$('.lazy').lazyload({container:$('#wrapper')});img_resize("#top_item_box_list",function(){});});$('#item_box_list').livequery(function(){$('.lazy').lazyload({container:$('#wrapper')});if($('.works_list').length>0){$('.lazy').lazyload({container:$('.works_list')});}});$('#home_works_list').livequery(function(){var that=$(this);that.width($('#wrapper').width()-189);that.hide();$(window).resize(function(){that.width($('#wrapper').width()-189);});});$('#eventpage_works_list').livequery(function(){var that=$(this);$('.lazy').lazyload({container:that});that.width($('#wrapper').width()-$('#eventpage_data').width());$(window).resize(function(){var data_hide=$('#wrapper .eventpage_right').hasClass('data_hide');if(data_hide){that.width($('#wrapper').width());}else{that.width($('#wrapper').width()-$('#eventpage_data').width());}});img_resize('#eventpage_works_list');});$('#error_container.item_blocked').livequery(function(){var count=10;window.menu_flag=true;window.do_not_refresh=false;countdown=setInterval(function(){$('#block-countdown').html(count);if(count==0){window.clearInterval(countdown);var State=History.getState();if(State.hash==window.prv_url){window.location.href="/";}else{History.pushState(null,window.prv_title,State.hash);}}
count--;},1000);});$('.square').livequery('mouseenter',function(){if($(this).hasClass('square_s'))
return;$('.hide',this).show();});$('.square').livequery('mouseleave',function(){if($(this).hasClass('square_s'))
return;$('.hide',this).hide();});$('.eventpage_wrapper #event_works_menu .eventclose_tab').livequery('click',function(e){e.preventDefault();if($('i',this).hasClass('active')){$('.eventpage_wrapper #eventpage_data').show();$('.eventpage_wrapper .eventpage_right').removeClass('data_hide');$('i',this).removeClass('active')
$('#eventpage_works_list').width($('#wrapper').width()-$('#eventpage_data').width());}else{$('.eventpage_wrapper #eventpage_data').hide();$('.eventpage_wrapper .eventpage_right').addClass('data_hide');$('i',this).addClass('active')
$('#eventpage_works_list').width($('#wrapper').width());}
img_resize('#eventpage_works_list',function(){$('#eventpage_works_list').scrollTop(1);});return false;});$('.square_s .item_content .list, .photo, div.author_wrapper .cover, .works_menu_box, .item_box .list, .top_list .chart_play').livequery(function(){$(this).hover(function(){$('.hide',this).show();},function(){$('.hide',this).hide();});});$('.song_line').livequery('mouseenter',function(){$('.hide',this).show();});$('.song_line').livequery('mouseleave',function(){$('.hide',this).hide();});$('.song_line').livequery(function(){if($(this).hasClass('hide'))
$(this).hide();});$('a.menu_btn').livequery('click',function(){$(this).next('.menu_list_box').slideToggle();});$('.dynamic').livequery('click',function(){window.do_not_refresh=false;window.menu_flag=false;if($(this).parents('.dropdown').length>0){menu_flag=true;}else if($(this).parents().parents('.nav').length>0){menu_flag=true;}else if($(this).parents('li').parents('ul').parents('.menu_bar').length>0){menu_flag=true;}else{if($(this).parents('li').parents('.dropdown-menu').length>0){menu_flag=true;}
if($(this).parents('div .list_style').length>0){menu_flag=true;}
if($(this).parents('p').parents('div .add_comment_box').length>0){menu_flag=true;}
if($(this).parents('div .form-actions_right').length>0){menu_flag=true;}
if($(this).parents('h4').parents('div .item_content').length>0){menu_flag=true;}
if($(this).parents('div').parents('div .square').length>0){menu_flag=true;}
if($(this).parents('div').parents('div .form-song_add').length>0){menu_flag=true;}}
if(menu_flag){window.menu_flag=true;}
special_dynamic=false;if($(this).parents('h2').parents('div .info_box').length>0){special_dynamic=true;}
if($(this).parents('div .works_menu_wrapper').length>0){special_dynamic=true;}
if($(this).parents('.special_dynamic').length>0){special_dynamic=true;}
if($(this).parents('li').parents('.dropdown-menu').length>0){special_dynamic=true;}
if($(this).parents('div .btn_box').parents('.action_wrapper').length>0){special_dynamic=true;}
if(special_dynamic){var State=History.getState();window.prv_title=$('title').html();window.prv_url=State.hash;}
$('.navbar-inner .dropdown').find('.dropdown-menu').hide();resetStreetVoiceSearch();var href=$(this).attr('href');if(window.gUploading){confirm(gettext('Load another page?'),gettext('File is uploading, are you sure?'),gettext('Yes'),gettext('No'),function(ret){if(ret){window.gUploading=false;History.pushState(null,null,href);};});}else{History.pushState(null,null,href);}
$('body').css('overflow','auto');return false;});var _IE=(function(){if($.browser.msie){return $.browser.version;}else{return false;}}());$('.popup_work').livequery('click',function(e){$("#back-top").fadeOut();var State=History.getState();window.menu_flag=false;var href=$(this).attr('href');window.prv_title=$('title').html();if(_IE<9){window.prv_title=$('title').html().replace('#'+State.hash,'');}
window.prv_url=State.hash;if(window.gUploading){confirm(gettext('Load another page?'),gettext('File is uploading, are you sure?'),gettext('Yes'),gettext('No'),function(ret){if(ret){window.gUploading=false;History.pushState(null,null,href);};});}else{History.pushState(null,null,href);}
if(_IE>9){window.do_not_refresh=true;}
$("body").css("overflow","hidden");e.preventDefault();});$('.form-signup input[name*=password]').livequery('keyup',function(){var that=$(this);var parent=that.parent();var val=that.val();val=$.trim(val);if(val.length==0){if(parent.is('.warning, .success'))
parent.removeClass('warning').removeClass('success');if(parent.closest('.control-group').is('.warning, .success'))
parent.closest('.control-group').removeClass('warning').removeClass('success');parent.removeClass('error');parent.closest('.control-group').removeClass('error');that.next('span.help-inline').html(gettext('3-12 characters, case sensitive'));return;}
if(val.length<3||val.length>12){if(parent.is('.warning, .success'))
parent.removeClass('warning').removeClass('success');if(parent.closest('.control-group').is('.warning, .success'))
parent.closest('.control-group').removeClass('warning').removeClass('success');parent.addClass('error');parent.closest('.control-group').addClass('error');if(val.length==0)
that.next('span.help-inline').html('<i class="s_icon-error"></i>'+gettext('Please enter password'));else
that.next('span.help-inline').html('<i class="s_icon-error"></i>'+gettext('Incorrect Password'));}else{if(parent.is('.warning, .error'))
parent.removeClass('warning').removeClass('error');if(parent.closest('.control-group').is('.warning, .error'))
parent.closest('.control-group').removeClass('warning').removeClass('error');parent.addClass('success');parent.closest('.control-group').addClass('success');that.next('span.help-inline').html('<i class="s_icon-success"></i>');}
password_check();});$('.form-signup input[name*=passconf]').livequery('change',function(){password_check();});$('.form-signup input').livequery('change',function(){var that=$(this);var val=that.val();val=$.trim(val);that.val(val);var input_name=that.attr('name');if((input_name==='username')||(input_name==='email')||(input_name==='nickname')){if(val.length===0){that.closest('.control-group').removeClass('success');that.closest('.control-group').removeClass('error');that.closest('.control-group').removeClass('warning');if(input_name=='username')
that.next('span.help-inline').html(gettext('3-16 characters, the first character must be in English'));if(input_name=='email')
that.next('span.help-inline').html(gettext('Suggest you use your ISP provided email or payment email address.'));if(input_name=='nickname')
that.next('span.help-inline').html(gettext('please input the nickname'));return false;}
that.closest('.control-group').removeClass('success');that.closest('.control-group').removeClass('error');if(input_name=='nickname'){that.closest('.control-group').addClass('success');that.next('span.help-inline').html('<i class="s_icon-success"></i>');return;}
$.post('/accounts/signup_check/',that.serialize(),function(response){if(response.success){that.closest('.control-group').addClass('success');that.next('span.help-inline').html('<i class="s_icon-success"></i>'+response.message);}else{that.closest('.control-group').addClass('error');that.next('span.help-inline').html('<i class="s_icon-error"></i>'+response.message);}});}else{return false;}});$('.form-signup.fb input').livequery(function(){var that=$(this);var val=that.val();val=$.trim(val);that.val(val);var input_name=that.attr('name');if((input_name==='username')||(input_name==='nickname')){if(val.length===0){that.closest('.control-group').removeClass('success');that.closest('.control-group').removeClass('error');that.closest('.control-group').removeClass('warning');if(input_name=='username')
that.next('span.help-inline').html(gettext('3-16 characters, the first character must be in English'));if(input_name=='nickname')
that.next('span.help-inline').html(gettext('please input the nickname'));return false;}
that.closest('.control-group').removeClass('success');that.closest('.control-group').removeClass('error');$.post('/accounts/signup_check/',that.serialize(),function(response){if(response.success){that.closest('.control-group').addClass('success');that.next('span.help-inline').html('<i class="s_icon-success"></i>'+response.message);}else{that.closest('.control-group').addClass('error');that.next('span.help-inline').html('<i class="s_icon-error"></i>'+response.message);}});}else{return false;}});$('.form-signup').livequery('submit',function(){var stat=true;$('input',this).each(function(){var that=$(this);if(that.val()==''){that.parent().addClass('error');stat=false;that.next('span.help-inline').html('<i class="s_icon-error"></i>'+that.attr('placeholder')+' '+gettext('is required'));}});if(stat){$(':submit').attr('disabled',true);$(':submit').val(gettext('Processing ...'));$.post($(this).attr('action'),$(this).serialize(),function(response){if(response.success){top.location.href=response.redirect;}else{$(':submit').attr('disabled',false);$(':submit').val(gettext('submit'));var errors=response.errors;for(var field in errors){if(errors[field].length>0){alert(errors[field][0]);if(field=='captcha'){$.getJSON('/captcha/refresh/?'+randomChar(10),{},function(json){$('.captcha').attr("src",json.image_url);$('#id_captcha_0').val(json.key);});}
break;};};}}).fail(function(){$(':submit').attr('disabled',false);$(':submit').val(gettext('submit'));});}
return false;});$('.boxjoinmember').livequery('click',function(e){e.preventDefault();var url=$(this).attr('href');var that=$(this).parents('#Login');that.modal('toggle');History.pushState(null,null,url);});$('.form-message').livequery('submit',function(){that=$(this).parents('#Message');$.post($(this).attr('action'),$(this).serialize(),function(response){if(response.success){that.modal('toggle');History.pushState(null,null,response.redirect);}});return false;});$('.form-message-inline').livequery('submit',function(){var url=$(this).attr('action');var data=$(this).serialize();data=data+'&inline=true';$.post(url,data,function(response){if(response.success){$('.form-message-inline').get(0).reset();$(response.html).hide().insertBefore('.add_comment_box').fadeIn('1000');}});return false;});$('.message-delete').livequery('click',function(){var that=$(this);var url=that.attr('href');confirm(gettext('Confirm'),gettext('Are you sure you want to delete this message?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.get(url,function(response){if(response.success){that.parent().fadeOut(function(){$(this).remove();});}});}});return false;});$('.logout').livequery('click',function(){var href=$(this).attr('href');$.ajax({url:href,cache:false,success:function(resp){if(resp.success){top.location.href="http://"+location.host;}}});return false;});$('.modal').on('hidden',function(){$('.modal-backdrop').remove();$(this).remove();});$('#ModalDiv .modal').on('hide',function(){$('.modal-backdrop').remove();$(this).remove();});$('#ModalDiv .modal').on('hidden',function(){$('.modal-backdrop').remove();$(this).remove();});$('a.modal_box').livequery('click',function(){var that=this;if($(that).data('loading')===true){return false;}
$(that).data('loading',true);$('#ModalDiv').load($(this).attr('href')+' div.modal',function(){$('#ModalDiv .modal').modal('show');$('#ModalDiv .modal').on('hidden',function(){$(this).remove();});$('.modal-body').infinitescroll({loading:{finishedMsg:'',msgText:'',img:'/asset/images/ajax-loader.gif'},behavior:'local',binder:$('.modal-body'),navSelector:'.page_nav',nextSelector:'.page_nav .next',itemSelector:'.who_box',localMode:true,errorCallback:function(){$('#infscr-loading').animate({opacity:.8},2000).fadeOut('normal');}});$(that).data('loading',false);$('.banner_box .adunit').dfp({dfpID:"6531201",enableSingleRequest:false});});return false;});$('#trending_top .title_text').livequery('mouseenter',function(){if($('#top_menu').hasClass('show'))
return;$('#top_menu').show();return false;});$('#trending_top').livequery('mouseleave',function(){if($('#top_menu').hasClass('show'))
return;$('#top_menu').hide();return false;});$('.dropdown-toggle').livequery('click',function(){$('.add_playlist a').show();$('.add_playlist input').val('').hide();});$('.dropdown.open').livequery(function(){var that=$(this)
$(this).parents('.item_box').siblings().css({'z-index':2});$(this).parents('.item_box').css({'z-index':3});});$('.navbar-inner .dropdown').livequery(function(){$(this).hover(function(){$(this).find('.dropdown-menu').fadeIn(100);},function(){$(this).find('.dropdown-menu').fadeOut(50);});});$('.search_box').click(function(){$(this).find('.search_input').fadeIn(100);});$(document.body).on('click',function(event){var target=$(event.target);if(!target.children().hasClass('m_icon-search')&&!target.hasClass('m_icon-search')&&!target.hasClass('search_box')&&!target.hasClass('search_input')&&!target.hasClass('navbar-search')&&!target.hasClass('search-query')){$('.search_input').hide();}});$('.playlist-menu a').livequery('click',function(){var that=$(this)
var url=that.attr('href');if(url.search('add')==-1){_gaq.push(['_trackEvent','Playlist','Remove from playlist','card']);re_url=url.replace('remove','add');}
else{_gaq.push(['_trackEvent','Playlist','Add to playlist','card']);re_url=url.replace('add','remove');}
$.post(url,function(response){if(response.success){if(re_url.search('add')==-1){$('i',that).removeClass().addClass('s_icon-sub');$('.playlist-menu').parent().next('.num').text(function(index,text){$(this).text(parseInt(text)+1);});}else{$('i',that).removeClass().addClass('s_icon-none');$('.playlist-menu').parent().next('.num').text(function(index,text){$(this).text(parseInt(text)-1);});}
that.attr('href',re_url);}});return false;});$('.follow').livequery('click',function(e){e.preventDefault();var that=$(this);$(this).attr('disabled',true);var url=that.attr('href');var is_follow=(url.search('unfollow')==-1);var new_url=is_follow?url.replace('follow','unfollow'):url.replace('unfollow','follow');login_required(url,function(response){that.attr('disabled',false);if(!response.success){alert(response.message);return;}
that.attr('href',new_url);$('i',that).toggleClass('selected');if(that.hasClass('btn')){$('span',that).text(is_follow?gettext('subscribed'):gettext('subscribe'));}
var followers_count=$('.followers_count[data-user='+response.username+']')
if(response.followers_count){followers_count.text(response.followers_count);}
var self_following_count=$('.self-following.following_count');self_following_count.text(self_following_count.text()-(is_follow?-1:1));if(!is_follow){var item_box_list=$('#item_box_list');if(item_box_list.hasClass('self-following')){var item_box=followers_count.closest('.item_box');item_box.remove();item_box_list.isotope('remove',item_box);}}});return false;});$('.follow.btn').livequery('mouseenter',function(){var that=$(this);if($('i',that).hasClass('selected')){$('span',that).text(gettext('unsubscribe'));}});$('.follow.btn').livequery('mouseleave',function(){var that=$(this);if($('i',that).hasClass('selected')){$('span',that).text(gettext('subscribed'));}});$('.add_song').livequery('click',function(e){e.preventDefault();var data_type=$(this).attr('data-type');var data=$(this).attr('data');if(data_type=='uncategorized'){url='/api/v1/public/user/'+data+'/songs/?album_id=0';}else if(data_type=='playlist'){url='/api/v1/public/playlist/'+data+'/';}else if(data_type=='song'){url='/api/v1/public/song/'+data+'/';}else if(data_type=='album'){url='/api/v1/public/album/'+data+'/';}else{url='/music/api/'+data_type+'/'+data+'/';}
if(data_type=='song'){type='POST';}else{type='GET';}
$.ajax({url:url,type:type,encoding:'UTF-8',cache:false,async:false,dataType:'json',success:function(response){if(data_type=='song'){angular.element($('#player_wrapper')).scope().add(response);}else if(data_type=='uncategorized'){angular.element($('#player_wrapper')).scope().add(response.results);}else if(data_type=='playlist'){songs=_.shuffle(response.songs);angular.element($('#player_wrapper')).scope().add(songs);}else{angular.element($('#player_wrapper')).scope().add(response.songs);}
angular.element($('#player_wrapper')).scope().$apply();}});});$('.play').livequery('click',function(e){e.preventDefault();var data_type=$(this).attr('data-type');var data=$(this).attr('data');var url;if(!(data_type===undefined)&&!(data===undefined)){if(data_type=='uncategorized'){url='/api/v1/public/user/'+data+'/songs/?album_id=0';}else if(data_type=='playlist'){url='/api/v1/public/playlist/'+data+'/';}else if(data_type=='24hr'){url='/api/v1/public/charts/realtime/';}else if(data_type=='album'){url='/api/v1/public/album/'+data+'/';}else if(data_type=='song'){url='/api/v1/public/song/'+data+'/';}else{url='/music/api/'+data_type+'/'+data+'/';}
if(data_type=='song'){type='POST';}else{type='GET';}
$.ajax({url:url,type:type,encoding:'UTF-8',cache:false,async:false,dataType:'json',success:function(response){if(data_type=='song'){angular.element($('#player_wrapper')).scope().add(response,true);}else if(data_type=='uncategorized'){angular.element($('#player_wrapper')).scope().add(response.results,true);}else if(data_type=='24hr'){angular.element($('#player_wrapper')).scope().add(response.results,true);}else if(data_type=='playlist'){songs=_.shuffle(response.songs);angular.element($('#player_wrapper')).scope().add(songs,true);}else{angular.element($('#player_wrapper')).scope().add(response.songs,true);}
angular.element($('#player_wrapper')).scope().$apply();}});}});$('#top_menu_list.browse li a').livequery('click',function(){$(this).parent().siblings().removeClass('selected');$(this).parent().addClass('selected');$('#top_menu_type.browse').hide();if($(this).parent().attr('data-type')=='latest'){$('#top_menu_list_s.browse').hide();$('#top_menu_type.browse').fadeIn();}
else
$('#top_menu_list_s.browse').fadeIn();$('#top_menu_list_s.browse li').removeClass('selected');return false;});$('#top_menu_list_s.browse li a').livequery('click',function(){$(this).parent().siblings().removeClass('selected');$(this).parent().addClass('selected');$('#top_menu_type').fadeIn();return false;});$('#top_menu_type.browse a.browse').livequery('click',function(){var url='/music/browse/'
url+=$('#top_menu_list li.selected').attr('data-type')+'/';url+=$(this).attr('href')+'/';if($('#top_menu_list_s li').hasClass('selected'))
url+=$('#top_menu_list_s li.selected').attr('data-type')+'/';History.pushState(null,null,url);return false;});$('#top_menu_list.charts li a.charts').livequery('click',function(){$(this).parent().siblings().removeClass('selected');$(this).parent().addClass('selected');$('#top_menu_type.charts').fadeIn();$('#top_menu_type.charts li').removeClass('selected');return false;});$('#top_menu_type.charts a.charts').livequery('click',function(){var url='/music/charts/'
url+=$(this).attr('href')+'/';url+=$('#top_menu_list.charts li.selected').attr('data-type')+'/';History.pushState(null,null,url);return false;});$('#play_collection').livequery('click',function(e){e.preventDefault();var song_ids=[];$('.music_item','#item_box_list').each(function(i,music_item){var song_id=$('a.play',music_item).attr('data');song_ids.push(song_id);});$('.music_list_item','.chartpage_left').each(function(index,music_list_item){$('.list_box a.play',music_list_item).each(function(index_j,play){var list_song_id=$(play).attr('data');song_ids.push(list_song_id);});});var data={'song_ids':song_ids};$.ajax({url:'/api/v1/songs/play_all/?offset=0&limit='+song_ids.length,type:'POST',async:true,encoding:'UTF-8',data:JSON.stringify(data),dataType:'json',success:function(response){angular.element($('#player_wrapper')).scope().add(response.results,true);angular.element($('#player_wrapper')).scope().$apply();}});});$('.play-video').livequery('click',function(e){e.preventDefault();var url=$(this).attr('href');$('#ModalDiv').load(url+' div.modal',function(){$('#ModalDiv .modal').modal('show');$('#VideoModal').on('hidden',function(){$(this).remove();});});});$('#VideoModal').on('hidden',function(){$(this).remove();});$('#service-form-button').livequery('click',function(){$(this).hide();$('.question_type').slideToggle();$('form#service').slideToggle();});$('#service-form-cancel-button').livequery('click',function(){$('.question_type').slideToggle();$('form#service').slideToggle(function(){$('#service-form-button').show();});});$('form#service').livequery('submit',function(){$(':submit').attr('disabled',true);$(':submit').val(gettext('Processing ...'));var url=$(this).attr('action');var that=$(this);if($('.control-group.error').children().length>0){$('.control-group.error').children().remove();}
$.ajax({url:url,type:'POST',encoding:'UTF-8',cache:false,dataType:'json',data:that.serialize(),success:function(response){if(response.success){$.jGrowl(response.message,{'life':800,'speed':'fast'});that[0].reset();$('.question_type').slideToggle();$('form#service').slideToggle();$('#service-form-button').show();}
else{var errors=response.errors;for(field in errors){if(errors[field].length>0){$('#id_'+field).parent().find('.control-group.error').append('<span class="help-inline"><i class="s_icon-error"></i>'+errors[field][0]+'</span>');}}}},complete:function(status){$(':submit').val(gettext('submit'));$(':submit').attr('disabled',false);}});return false;});$('#show_more_tags').livequery('click',function(){if($(this).parents('.tag_boxes').find('.tag_box.hide').length>0){$(this).parents('.tag_boxes').find('.tag_box.hide').removeClass('hide');$(this).hide();}
return false});$('#top_title.event_page li a.event_channel').livequery('click',function(e){e.preventDefault();var filter=$('#event_page_dropdown_filter').attr('data-type');var channel=$(this).attr('data-type');var url=$(this).attr('href');if(filter!=''){url+=filter+'/';};if(channel!=''){url+=channel+'/';};$('#top_title.event_page #event_page_dropdown_channel').contents(':eq(2)').replaceWith($(this).text());$('#top_title.event_page #event_page_dropdown_channel').attr('data-type',$(this).attr('data-type'));History.pushState(null,null,url);});$('#top_title.event_page li a.event_filter').livequery('click',function(e){e.preventDefault();var channel=$('#event_page_dropdown_channel').attr('data-type');var filter=$(this).attr('data-type');var url=$(this).attr('href');if(filter!=''){url+=filter+'/';};if(channel!=''){url+=channel+'/';};$('#top_title.event_page #event_page_dropdown_filter').contents(':eq(2)').replaceWith($(this).text());$('#top_title.event_page #event_page_dropdown_filter').attr('data-type',$(this).attr('data-type'));History.pushState(null,null,url);});$('.info_box.add_message_btn').livequery('click',function(e){e.preventDefault();var that=$(this);var isotopeContainer=that.parents('#item_box_list')
if(isotopeContainer.length<1){isotopeContainer=$('#eventpage_works_list > .works_box');}
var commentBox=that.parents('.item_box').find('.add_message');var isVisible=!commentBox.toggleClass('hide').hasClass('hide');if(isVisible){$('.add_message').not(commentBox).addClass('hide');}
isotopeContainer.isotope('reLayout');var commentInput=commentBox.find('form input[name=comment]');if(isVisible){commentInput.focus();_gaq.push(['_trackEvent','Comment','Show comment input','card']);}else{commentInput.blur();_gaq.push(['_trackEvent','Comment','Hide comment input','card']);}});$('#wrapper').on('submit','#id_marketing_form',function(){$('input:submit').attr("disabled",true);$(':submit').val(gettext('Processing ...'));var url=$('#id_marketing_form').attr('action');var data=$('#id_marketing_form').serialize();$.ajax({type:"POST",url:url,dataType:'json',data:data,success:function(response){if(response){if(response.success){History.pushState(null,null,'/service/');}
$.jGrowl(response.message,{'life':800,'speed':'slow'});$(':submit').val(gettext('submit'));$('input:submit').attr("disabled",false);}}});return false;});$('#who-likes .select-works-cancel').livequery('click',function(e){e.preventDefault();$('#who-likes').modal('hide').remove();return false;});$('[rel="tooltip"]').livequery(function(){$(this).tooltip();});}
function getting(url,element,callback){$.get(url,function(response,textstatus,xhr){if(xhr.status==200||xhr.status==302)
reload_element(element);});if(typeof callback=='function'){callback();}}
function login_required(url,callbacks){if(typeof callbacks=='function'){callbacks['success']=callbacks;}else if(typeof callbacks=='undefined'){callbacks={};}
$.get(url,function(response){if(response.login===undefined){if(typeof(callbacks['success'])=='function'){callbacks['success'].call(this,response);}}else{$('#ModalDiv').load('/accounts/login/ div.modal',function(){$('#Login').modal('show');});}
if(typeof(callbacks['complete'])=='function'){callbacks['complete'].call(this);}});return false;}
window.confirm=function(title,content,button1,button2,callback){var ret;var template='<div class="modal hide warning" id="confirmModal">'
template+='<div class="modal-header"><a class="close" data-dismiss="modal">&times;</a><h3>'+title+'</h3></div>'
template+='<div class="modal-body"><p>'+content+'</p></div>'
template+='<div class="modal-footer"><input type="button" name="true" value="'+button1+'" class="btn btn-primary" />'
if(button2)
template+='<input type="button" name="false" value="'+button2+'" class="btn" />'
template+='</div></div>'
$(template).appendTo('body');$('#confirmModal').modal('show');$('#confirmModal input[name$="true"]').click(function(){ret=true;if(typeof callback=='function'){callback.call(this,ret);}
$('#confirmModal').modal('hide').remove();});$('#confirmModal input[name$="false"]').click(function(){ret=false;if(typeof callback=='function'){callback.call(this,ret);}
$('#confirmModal').modal('hide').remove();});$('#confirmModal').on('hidden',function(){$(this).remove();});}
window.alert=function(content,callback){var template='<div class="modal hide" id="alertModal">'
template+='<div class="modal-header"><a class="close" data-dismiss="modal">&times;</a><h3>'+gettext('Alert')+'</h3></div>'
template+='<div class="modal-body"><p>'+content+'</p></div>'
template+='<div class="modal-footer"><input type="button" name="ok" value="'+gettext('Ok')+'" class="btn btn-primary" />'
template+='</div></div>'
$(template).appendTo('body');$('#alertModal').modal('show');$('#alertModal input[name$="ok"]').click(function(){$('#alertModal').modal('hide').remove();});$('#alertModal').on('hidden',function(){$(this).remove();if(typeof callback=='function'){callback();}});}
function reload_element(element,url,single){url=url?url:location.href;url=url.replace('#','');$.ajax({url:url,cache:false,success:function(data){if(single){var par=$(element).parent();$(element).remove();par.append($(data).find(element));}else{$(element).each(function(counter){var that=$(this);var par=that.parent();that.fadeOut('fast',function(){if(that.siblings().length>0){var next=that.next();var prev=that.prev();that.remove();if(!next&&!prev){par.append($($(data).find(par).children())).hide().fadeIn();}else{if(next.length>0)
$($(data).find(element)[counter]).insertBefore(next).hide().fadeIn();else
$($(data).find(element)[counter]).insertAfter(prev).hide().fadeIn();}}else{if(that.attr('id')===undefined){var prefix='.';var ele=that.attr('class').replace(/ /g,'.');}else{var prefix='#';var ele=that.attr('id');}
if(that.hasClass('single')){var count=that.closest('.item_box').index();that.remove();par.append($(data).find('.item_box:eq('+count+') '+prefix+ele));}else{that.remove();par.append($(data).find(element)[counter]).hide().fadeIn('fast');}}});counter+1;});}}});return false;}
function password_check(){var thepassword=$('.form-signup input[name*=password]');var that=$('.form-signup input[name*=passconf]');if(that.val()==''){if(that.parent().hasClass('success'))
that.parent().removeClass('success');if(that.parent().closest('.control-group').hasClass('success'))
that.parent().closest('.control-group').removeClass('success');that.parent().removeClass('error');that.parent().closest('.control-group').removeClass('error');that.next('span.help-inline').html(gettext('please input password again'));return;}
if(that.val()){if(thepassword.val()!=that.val()){if(that.parent().hasClass('success'))
that.parent().removeClass('success');if(that.parent().closest('.control-group').hasClass('success'))
that.parent().closest('.control-group').removeClass('success');that.parent().addClass('error');that.parent().closest('.control-group').addClass('error');that.next('span.help-inline').html('<i class="s_icon-error"></i>'+gettext('Password does not match'));}else{if(that.parent().hasClass('error'))
that.parent().removeClass('error');if(that.parent().closest('.control-group').hasClass('error'))
that.parent().closest('.control-group').removeClass('error');that.parent().addClass('success');that.parent().closest('.control-group').addClass('success');that.next('span.help-inline').html('<i class="s_icon-success"></i>'+gettext('Password Okay'));}}}
function ClearTimer(){window.timer=true;}
$.fn.scale=function(_dimension){var obj=$(this);obj.each(function(){var ratio=$(this).width()/$(this).height()
$(this).width(_dimension);$(this).height(_dimension/ratio);});}
function menu_active(state_hash){$('.list-one').removeClass('active');$('.list-two').removeClass('active');$('.list-three').removeClass('active');var re=/^[\/]?music\//g;if(re.test(state_hash)){$('.list-one').addClass('active')}
var re=/^[\/]?creative\//g;if(re.test(state_hash)){$('.list-two').addClass('active');}
var re=/^[\/]?opportunities\//g;if(re.test(state_hash)){$('.list-three').addClass('active');}}
$(function(){$('#Login').live('hide',function(e){$('.login_banner').remove();});});$(function(){'use strict';$('.form-login_fb').livequery('submit',function(){var that=$(this);$.post($(this).attr('action'),that.serialize(),function(response){if(response.success){History.pushState(null,null,response.redirect);reload_element('.login-related');}else{if(that.find('.control-group.error').children().length==0){var template='<span class="help-inline"><i class="s_icon-error"></i> '+gettext('Account')+'/'+gettext('Password invalid')+'</span>'
that.find('.control-group.error').append(template);that.find('.control-group.error').show();}}});return false;});$('.form-login input:text').livequery('keypress',function(e){if(e.which==13){return false;}});$('.form-login').livequery('keypress',function(e){if(e.which==13){$(this).submit();return false;}});$('#submit_button').livequery('click',function(){$('.form-login').submit();return false;});function fb_login(){var next=$('.form-login').attr('next');var redirect_uri='http://'+location.host+'/accounts/facebook/server_side_verify/';if(navigator.userAgent.match('CriOS')){redirect_url='https://www.facebook.com/dialog/oauth?client_id=160149997878&redirect_uri='+redirect_uri;window.location=redirect_url;return;}
FB.login(function(response){if(response.authResponse){var access_token=response.authResponse.accessToken;FB.api('/me',function(response){if(!response||response.error){alert('Facebook API 錯誤，請重新嘗試或手動登入');}
else{response.access_token=access_token;$.post('/accounts/facebook/verify/',response,function(data){$('#Login').modal('toggle');if(data.success){if(next===undefined){top.location.reload();}
else{if(next==='None'){top.location.reload();}
else{top.location.href=next;}}}
else{History.pushState(null,null,'/accounts/facebook/connect/');}});}});}},{scope:'public_profile,email,publish_actions'});}
$('#facebook_button').livequery('click',function(){fb_login();return false;});function sinaweibo_login(){var next=$('.form-login').attr('next');var redirect_uri='http://'+location.host+'/accounts/sinaweibo/server_side_verify/';if(navigator.userAgent.match('CriOS')){redirect_url='https://api.weibo.com/oauth2/authorize?client_id=1624480831&redirect_uri='+redirect_uri;window.location=redirect_url;return;}
WB2.anyWhere(function(W){if(WB2.checkLogin()){sinaweibo_getuid(W,next);}else{WB2.login(function(){sinaweibo_getuid(W,next);});}});}
function sinaweibo_getuid(W,next){W.parseCMD("/account/get_uid.json",function(oResult,bStatus){if(bStatus){sinaweibo_getdata(W,oResult.uid,next);}},{},{method:'GET'});}
function sinaweibo_getdata(W,uid,next){W.parseCMD("/users/show.json",function(oResult,bStatus){$.post('/accounts/sinaweibo/verify/',oResult,function(data){$('#Login').modal('toggle');if(data.success){if(next===undefined){top.location.reload();}else{if(next==="None"){top.location.reload();}else{top.location.href=next;}}}else{History.pushState(null,null,'/accounts/sinaweibo/connect/');}});},{uid:uid},{method:'GET'});}
$('#sinaweibo_button').livequery('click',function(){sinaweibo_login();return false;});});$(function(){$('#event_opt_button').livequery('click',function(e){if($(this).parent().next().find(':checkbox').is(':checked')){var url=$(this).attr('rel');$('#ModalDiv').load(url+' div.modal',function(){$('#ModalDiv .modal').modal('show');$('#UserWorks').on('hidden',function(){$(this).remove();});});}else{var disabled=$(this).hasClass('disabled');if(!disabled){alert(gettext('Please agree before entering an event'));}}});$('#my_works .opt-event').livequery('click',function(){var that=$(this);var url=that.attr('rel');confirm(gettext('Exit the event'),gettext('Are you sure you want to exit the event?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({type:'POST',url:url,data:'',dataType:'json',cache:false,success:function(response){if(response.success){$(that).parents('.event_joined_work').remove();$('#eventpage_works_list').load(location.href+' #eventpage_works_list > *',function(){img_resize('#eventpage_works_list');});}},complete:function(){if($('#my_works .event_joined_work').length<=0){$('#my_works .well').hide();}}});};});});$('#UserWorks .select-works-cancel').livequery('click',function(e){e.preventDefault();$('#UserWorks').modal('hide').remove();return false;});$('#UserWorks input.opt-event').livequery('click',function(e){e.preventDefault();var that=$(this);if(that.hasClass('btn-primary')){that.removeClass('btn-primary').removeClass('selected');that.attr('value',gettext('Join'));}else{var url=that.attr('rel');$.ajax({url:url,type:'POST',dataType:'json',success:function(response){if(response.success){that.addClass('btn-primary selected');that.attr('value',gettext('Cancel'));}else{$.jGrowl(response.message,{'life':800,'speed':'fast'});}},})}});$('#UserWorks a.opt-event').livequery('click',function(e){e.preventDefault();var that=$(this).parent();if(that.hasClass('selected')){that.removeClass('selected');}else{var url=$(this).attr('rel');$.ajax({url:url,type:'POST',dataType:'json',success:function(response){if(response.success){that.addClass('selected');}else{$.jGrowl(response.message,{'life':800,'speed':'fast'});}},})}
return false;});$('#UserWorks a.select_set').livequery('click',function(e){e.preventDefault();var url=$(this).attr('href');$.ajax({type:'GET',url:url,dataType:'html',cache:false,success:function(data){var modal_header=$(data).find('.modal-header').addClass('tempshow');var modal_body=$(data).find('.modal-body').addClass('tempshow');var modal_footer=$(data).find('.modal-footer').addClass('tempshow');$('#UserWorks .modal-header, #UserWorks .modal-body, #UserWorks .modal-footer').addClass('temphide');$('div.temphide').hide();$('#UserWorks').append(modal_header);$('#UserWorks').append(modal_body);$('#UserWorks').append(modal_footer);}});return false;});$('#UserWorks a.select_set').livequery('click',function(e){e.preventDefault();var url=$(this).attr('href');$.ajax({type:'GET',url:url,dataType:'html',cache:false,success:function(data){var modal_header=$(data).find('.modal-header').addClass('tempshow');var modal_body=$(data).find('.modal-body').addClass('tempshow');var modal_footer=$(data).find('.modal-footer').addClass('tempshow');$('#UserWorks .modal-header, #UserWorks .modal-body, #UserWorks .modal-footer').addClass('temphide');$('div.temphide').hide();$('#UserWorks').append(modal_header);$('#UserWorks').append(modal_body);$('#UserWorks').append(modal_footer);}});return false;});$('#UserWorks a.selet-works-sets-prevstep').livequery('click',function(e){e.preventDefault();$('#UserWorks div.tempshow').remove();$('#UserWorks div.temphide').show().removeClass('temphide');});$('#UserWorks a.select-works-confirm').livequery('click',function(e){e.preventDefault();var url=$(this).attr('href');var work_ids=[];$.each($('#UserWorks .selected'),function(i,work){var work_id=$(this).attr('data-value').split('ev_')[1];work_ids.push(work_id);});$.ajax({url:url,type:'POST',dataType:'json',data:{work_ids:work_ids},success:function(response){if(response.success){getting(location.href,'#my_works .well');getting(location.href,'#eventpage_works_list');img_resize('#eventpage_works_list');$('#UserWorks').modal('hide').remove();}else{$('#UserWorks').modal('hide').remove();alert(response.message);}},})
return false;});$('.vote').livequery('click',function(){var that=$(this);var url=that.attr('href');login_required(url,function(response){if(response.success){that.addClass('btn-info');that.text(gettext('Voted'));var $info_wrapper=that.parent();var $vote_count=$('.vote_count',$info_wrapper);var pre_vote_count=parseInt($vote_count.html());$vote_count.html(pre_vote_count+1);}
else{alert(response.message);}});return false;});});;(function(factory){if(typeof module==='function'){module.exports=factory(this.jQuery||require('jquery'));}else{this.NProgress=factory(this.jQuery);}})(function($){var NProgress={};NProgress.version='0.1.2';var Settings=NProgress.settings={minimum:0.08,easing:'ease',positionUsing:'',speed:200,trickle:true,trickleRate:0.02,trickleSpeed:800,showSpinner:true,template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};NProgress.configure=function(options){$.extend(Settings,options);return this;};NProgress.status=null;NProgress.set=function(n){var started=NProgress.isStarted();n=clamp(n,Settings.minimum,1);NProgress.status=(n===1?null:n);var $progress=NProgress.render(!started),$bar=$progress.find('[role="bar"]'),speed=Settings.speed,ease=Settings.easing;$progress[0].offsetWidth;$progress.queue(function(next){if(Settings.positionUsing==='')Settings.positionUsing=NProgress.getPositioningCSS();$bar.css(barPositionCSS(n,speed,ease));if(n===1){$progress.css({transition:'none',opacity:1});$progress[0].offsetWidth;setTimeout(function(){$progress.css({transition:'all '+speed+'ms linear',opacity:0});setTimeout(function(){NProgress.remove();next();},speed);},speed);}else{setTimeout(next,speed);}});return this;};NProgress.isStarted=function(){return typeof NProgress.status==='number';};NProgress.start=function(){if(!NProgress.status)NProgress.set(0);var work=function(){setTimeout(function(){if(!NProgress.status)return;NProgress.trickle();work();},Settings.trickleSpeed);};if(Settings.trickle)work();return this;};NProgress.done=function(force){if(!force&&!NProgress.status)return this;return NProgress.inc(0.3+0.5*Math.random()).set(1);};NProgress.inc=function(amount){var n=NProgress.status;if(!n){return NProgress.start();}else{if(typeof amount!=='number'){amount=(1-n)*clamp(Math.random()*n,0.1,0.95);}
n=clamp(n+amount,0,0.994);return NProgress.set(n);}};NProgress.trickle=function(){return NProgress.inc(Math.random()*Settings.trickleRate);};NProgress.render=function(fromStart){if(NProgress.isRendered())return $("#nprogress");$('html').addClass('nprogress-busy');var $el=$("<div id='nprogress'>").html(Settings.template);var perc=fromStart?'-100':toBarPerc(NProgress.status||0);$el.find('[role="bar"]').css({transition:'all 0 linear',transform:'translate3d('+perc+'%,0,0)'});if(!Settings.showSpinner)
$el.find('[role="spinner"]').remove();$el.appendTo(document.body);return $el;};NProgress.remove=function(){$('html').removeClass('nprogress-busy');$('#nprogress').remove();};NProgress.isRendered=function(){return($("#nprogress").length>0);};NProgress.getPositioningCSS=function(){var bodyStyle=document.body.style;var vendorPrefix=('WebkitTransform'in bodyStyle)?'Webkit':('MozTransform'in bodyStyle)?'Moz':('msTransform'in bodyStyle)?'ms':('OTransform'in bodyStyle)?'O':'';if(vendorPrefix+'Perspective'in bodyStyle){return'translate3d';}else if(vendorPrefix+'Transform'in bodyStyle){return'translate';}else{return'margin';}};function clamp(n,min,max){if(n<min)return min;if(n>max)return max;return n;}
function toBarPerc(n){return(-1+n)*100;}
function barPositionCSS(n,speed,ease){var barCSS;if(Settings.positionUsing==='translate3d'){barCSS={transform:'translate3d('+toBarPerc(n)+'%,0,0)'};}else if(Settings.positionUsing==='translate'){barCSS={transform:'translate('+toBarPerc(n)+'%,0)'};}else{barCSS={'margin-left':toBarPerc(n)+'%'};}
barCSS.transition='all '+speed+'ms '+ease;return barCSS;}
return NProgress;});function loadingIndicator(container){var loading_flag=false;this.start=function(){if(loading_flag==false){NProgress.start();NProgress.set(0.5);loading_flag=true;}}
this.stop=function(){NProgress.done();loading_flag=false;}}
jQuery.extend({highlight:function(node,re,nodeName,className){if(node.nodeType===3){var match=node.data.match(re);if(match){var highlight=document.createElement(nodeName||'span');highlight.className=className||'highlight';var wordNode=node.splitText(match.index);wordNode.splitText(match[0].length);var wordClone=wordNode.cloneNode(true);highlight.appendChild(wordClone);wordNode.parentNode.replaceChild(highlight,wordNode);return 1;}}else if((node.nodeType===1&&node.childNodes)&&!/(script|style)/i.test(node.tagName)&&!(node.tagName===nodeName.toUpperCase()&&node.className===className)){for(var i=0;i<node.childNodes.length;i++){i+=jQuery.highlight(node.childNodes[i],re,nodeName,className);}}
return 0;}});jQuery.fn.unhighlight=function(options){var settings={className:'highlight',element:'span'};jQuery.extend(settings,options);return this.find(settings.element+"."+settings.className).each(function(){var parent=this.parentNode;parent.replaceChild(this.firstChild,this);parent.normalize();}).end();};jQuery.fn.highlight=function(words,options){var settings={className:'highlight',element:'span',caseSensitive:false,wordsOnly:false};jQuery.extend(settings,options);if(words.constructor===String){words=[words];}
words=jQuery.grep(words,function(word,i){return word!='';});words=jQuery.map(words,function(word,i){return word.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");});if(words.length==0){return this;};var flag=settings.caseSensitive?"":"i";var pattern="("+words.join("|")+")";if(settings.wordsOnly){pattern="\\b"+pattern+"\\b";}
var re=new RegExp(pattern,flag);return this.each(function(){jQuery.highlight(this,re,settings.element,settings.className);});};!function($){"use strict"
var toggle='[data-toggle="dropdown"]',Dropdown=function(element){var $el=$(element).on('click.dropdown.data-api',this.toggle)
$('html').on('click.dropdown.data-api',function(){$el.parent().removeClass('open')})}
Dropdown.prototype={constructor:Dropdown,toggle:function(e){var $this=$(this),selector=$this.attr('data-target'),$parent,isActive
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
$parent=$(selector)
$parent.length||($parent=$this.parent())
isActive=$parent.hasClass('open')
clearMenus()
!isActive&&$parent.toggleClass('open')
return false}}
function clearMenus(){$(toggle).parent().removeClass('open')}
$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data('dropdown')
if(!data)$this.data('dropdown',(data=new Dropdown(this)))
if(typeof option=='string')data[option].call($this)})}
$.fn.dropdown.Constructor=Dropdown
$(function(){$('html').on('click.dropdown.data-api',clearMenus)
$('body').on('click.dropdown.data-api',toggle,Dropdown.prototype.toggle)})}(window.jQuery)
+function($){"use strict";var Carousel=function(element,options){this.$element=$(element)
this.$indicators=this.$element.find('.carousel-indicators')
this.options=options
this.paused=this.sliding=this.interval=this.$active=this.$items=null
this.options.pause=='hover'&&this.$element.on('mouseenter',$.proxy(this.pause,this)).on('mouseleave',$.proxy(this.cycle,this))}
Carousel.DEFAULTS={interval:5000,pause:'hover',wrap:true}
Carousel.prototype.cycle=function(e){e||(this.paused=false)
this.interval&&clearInterval(this.interval)
this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval))
return this}
Carousel.prototype.getActiveIndex=function(){this.$active=this.$element.find('.item.active')
this.$items=this.$active.parent().children()
return this.$items.index(this.$active)}
Carousel.prototype.to=function(pos){var that=this
var activeIndex=this.getActiveIndex()
if(pos>(this.$items.length-1)||pos<0)return
if(this.sliding)return this.$element.one('slid',function(){that.to(pos)})
if(activeIndex==pos)return this.pause().cycle()
return this.slide(pos>activeIndex?'next':'prev',$(this.$items[pos]))}
Carousel.prototype.pause=function(e){e||(this.paused=true)
if(this.$element.find('.next, .prev').length&&$.support.transition.end){this.$element.trigger($.support.transition.end)
this.cycle(true)}
this.interval=clearInterval(this.interval)
return this}
Carousel.prototype.next=function(){if(this.sliding)return
return this.slide('next')}
Carousel.prototype.prev=function(){if(this.sliding)return
return this.slide('prev')}
Carousel.prototype.slide=function(type,next){var $active=this.$element.find('.item.active')
var $next=next||$active[type]()
var isCycling=this.interval
var direction=type=='next'?'left':'right'
var fallback=type=='next'?'first':'last'
var that=this
if(!$next.length){if(!this.options.wrap)return
$next=this.$element.find('.item')[fallback]()}
this.sliding=true
isCycling&&this.pause()
var e=$.Event('slide.bs.carousel',{relatedTarget:$next[0],direction:direction})
if($next.hasClass('active'))return
if(this.$indicators.length){this.$indicators.find('.active').removeClass('active')
this.$element.one('slid',function(){var $nextIndicator=$(that.$indicators.children()[that.getActiveIndex()])
$nextIndicator&&$nextIndicator.addClass('active')})}
if($.support.transition&&this.$element.hasClass('slide')){this.$element.trigger(e)
if(e.isDefaultPrevented())return
$next.addClass(type)
$next[0].offsetWidth
$active.addClass(direction)
$next.addClass(direction)
$active.one($.support.transition.end,function(){$next.removeClass([type,direction].join(' ')).addClass('active')
$active.removeClass(['active',direction].join(' '))
that.sliding=false
setTimeout(function(){that.$element.trigger('slid')},0)}).emulateTransitionEnd(600)}else{this.$element.trigger(e)
if(e.isDefaultPrevented())return
$active.removeClass('active')
$next.addClass('active')
this.sliding=false
this.$element.trigger('slid')}
isCycling&&this.cycle()
return this}
var old=$.fn.carousel
$.fn.carousel=function(option){return this.each(function(){var $this=$(this)
var data=$this.data('bs.carousel')
var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=='object'&&option)
var action=typeof option=='string'?option:options.slide
if(!data)$this.data('bs.carousel',(data=new Carousel(this,options)))
if(typeof option=='number')data.to(option)
else if(action)data[action]()
else if(options.interval)data.pause().cycle()})}
$.fn.carousel.Constructor=Carousel
$.fn.carousel.noConflict=function(){$.fn.carousel=old
return this}
$(document).on('click.bs.carousel.data-api','[data-slide], [data-slide-to]',function(e){var $this=$(this),href
var $target=$($this.attr('data-target')||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''))
var options=$.extend({},$target.data(),$this.data())
var slideIndex=$this.attr('data-slide-to')
if(slideIndex)options.interval=false
$target.carousel(options)
if(slideIndex=$this.attr('data-slide-to')){$target.data('bs.carousel').to(slideIndex)}
e.preventDefault()})
$(window).on('load',function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this)
$carousel.carousel($carousel.data())})})}(window.jQuery);!function($){"use strict"
var Collapse=function(element,options){this.$element=$(element)
this.options=$.extend({},$.fn.collapse.defaults,options)
if(this.options["parent"]){this.$parent=$(this.options["parent"])}
this.options.toggle&&this.toggle()}
Collapse.prototype={constructor:Collapse,dimension:function(){var hasWidth=this.$element.hasClass('width')
return hasWidth?'width':'height'},show:function(){var dimension=this.dimension(),scroll=$.camelCase(['scroll',dimension].join('-')),actives=this.$parent&&this.$parent.find('.in'),hasData
if(actives&&actives.length){hasData=actives.data('collapse')
actives.collapse('hide')
hasData||actives.data('collapse',null)}
this.$element[dimension](0)
this.transition('addClass','show','shown')
this.$element[dimension](this.$element[0][scroll])},hide:function(){var dimension=this.dimension()
this.reset(this.$element[dimension]())
this.transition('removeClass','hide','hidden')
this.$element[dimension](0)},reset:function(size){var dimension=this.dimension()
this.$element.removeClass('collapse')
[dimension](size||'auto')
[0].offsetWidth
this.$element.addClass('collapse')},transition:function(method,startEvent,completeEvent){var that=this,complete=function(){if(startEvent=='show')that.reset()
that.$element.trigger(completeEvent)}
this.$element.trigger(startEvent)
[method]('in')
$.support.transition&&this.$element.hasClass('collapse')?this.$element.one($.support.transition.end,complete):complete()},toggle:function(){this[this.$element.hasClass('in')?'hide':'show']()}}
$.fn.collapse=function(option){return this.each(function(){var $this=$(this),data=$this.data('collapse'),options=typeof option=='object'&&option
if(!data)$this.data('collapse',(data=new Collapse(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.collapse.defaults={toggle:true}
$.fn.collapse.Constructor=Collapse
$(function(){$('body').on('click.collapse.data-api','[data-toggle=collapse]',function(e){var $this=$(this),href,target=$this.attr('data-target')||e.preventDefault()||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,''),option=$(target).data('collapse')?'toggle':$this.data()
$(target).collapse(option)})})}(window.jQuery)
!function($){"use strict"
var Tooltip=function(element,options){this.init('tooltip',element,options)}
Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut
this.type=type
this.$element=$(element)
this.options=this.getOptions(options)
this.enabled=true
if(this.options.trigger!='manual'){eventIn=this.options.trigger=='hover'?'mouseenter':'focus'
eventOut=this.options.trigger=='hover'?'mouseleave':'blur'
this.$element.on(eventIn,this.options.selector,$.proxy(this.enter,this))
this.$element.on(eventOut,this.options.selector,$.proxy(this.leave,this))}
this.options.selector?(this._options=$.extend({},this.options,{trigger:'manual',selector:''})):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,options,this.$element.data())
if(options.delay&&typeof options.delay=='number'){options.delay={show:options.delay,hide:options.delay}}
return options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type)
if(!self.options.delay||!self.options.delay.show){self.show()}else{self.hoverState='in'
setTimeout(function(){if(self.hoverState=='in'){self.show()}},self.options.delay.show)}},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type)
if(!self.options.delay||!self.options.delay.hide){self.hide()}else{self.hoverState='out'
setTimeout(function(){if(self.hoverState=='out'){self.hide()}},self.options.delay.hide)}},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp
if(this.hasContent()&&this.enabled){$tip=this.tip()
this.setContent()
if(this.options.animation){$tip.addClass('fade')}
placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement
inside=/in/.test(placement)
$tip.remove().css({top:0,left:0,display:'block'}).appendTo(inside?this.$element:document.body)
pos=this.getPosition(inside)
actualWidth=$tip[0].offsetWidth
actualHeight=$tip[0].offsetHeight
switch(inside?placement.split(' ')[1]:placement){case'bottom':tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}
break
case'top':tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}
break
case'left':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}
break
case'right':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}
break
case'radio-top':tp={top:pos.top-actualHeight,left:pos.left-25}
break}
$tip.css(tp).addClass(placement).addClass('in')}},setContent:function(){var $tip=this.tip()
$tip.find('.tooltip-inner').html(this.getTitle())
$tip.removeClass('fade in top bottom left right')},hide:function(){var that=this,$tip=this.tip()
$tip.removeClass('in')
function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500)
$tip.one($.support.transition.end,function(){clearTimeout(timeout)
$tip.remove()})}
$.support.transition&&this.$tip.hasClass('fade')?removeWithAnimation():$tip.remove()},fixTitle:function(){var $e=this.$element
if($e.attr('title')||typeof($e.attr('data-original-title'))!='string'){$e.attr('data-original-title',$e.attr('title')||'').removeAttr('title')}},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},(inside?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var title,$e=this.$element,o=this.options
title=$e.attr('data-original-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title)
title=title.toString().replace(/(^\s*|\s*$)/,"")
return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide()
this.$element=null
this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass('in')?'hide':'show']()}}
$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data('tooltip'),options=typeof option=='object'&&option
if(!data)$this.data('tooltip',(data=new Tooltip(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.tooltip.Constructor=Tooltip
$.fn.tooltip.defaults={animation:true,delay:0,selector:false,placement:'top',trigger:'hover',title:'',template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery);+function($){"use strict";function transitionEnd(){var el=document.createElement('bootstrap')
var transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd otransitionend','transition':'transitionend'}
for(var name in transEndEventNames){if(el.style[name]!==undefined){return{end:transEndEventNames[name]}}}}
$.fn.emulateTransitionEnd=function(duration){var called=false,$el=this
$(this).one($.support.transition.end,function(){called=true})
var callback=function(){if(!called)$($el).trigger($.support.transition.end)}
setTimeout(callback,duration)
return this}
$(function(){$.support.transition=transitionEnd()})}(window.jQuery);!function($){"use strict"
var Tab=function(element){this.element=$(element)}
Tab.prototype={constructor:Tab,show:function(){var $this=this.element,$ul=$this.closest('ul:not(.dropdown-menu)'),selector=$this.attr('data-target'),previous,$target
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
if($this.parent('li').hasClass('active'))return
previous=$ul.find('.active a').last()[0]
$this.trigger({type:'show',relatedTarget:previous})
$target=$(selector)
this.activate($this.parent('li'),$ul)
this.activate($target,$target.parent(),function(){$this.trigger({type:'shown',relatedTarget:previous})})},activate:function(element,container,callback){var $active=container.find('> .active'),transition=callback&&$.support.transition&&$active.hasClass('fade')
function next(){$active.removeClass('active').find('> .dropdown-menu > .active').removeClass('active')
element.addClass('active')
if(transition){element[0].offsetWidth
element.addClass('in')}else{element.removeClass('fade')}
if(element.parent('.dropdown-menu')){element.closest('li.dropdown').addClass('active')}
callback&&callback()}
transition?$active.one($.support.transition.end,next):next()
$active.removeClass('in')}}
$.fn.tab=function(option){return this.each(function(){var $this=$(this),data=$this.data('tab')
if(!data)$this.data('tab',(data=new Tab(this)))
if(typeof option=='string')data[option]()})}
$.fn.tab.Constructor=Tab
$(function(){$('body').on('click.tab.data-api','[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault()
$(this).tab('show')})})}(window.jQuery);!function($){"use strict"
var Modal=function(content,options){this.options=options
this.$element=$(content).delegate('[data-dismiss="modal"]','click.dismiss.modal',$.proxy(this.hide,this))}
Modal.prototype={constructor:Modal,toggle:function(){return this[!this.isShown?'show':'hide']()},show:function(){var that=this
if(this.isShown)return
$('body').addClass('modal-open')
this.isShown=true
this.$element.trigger('show')
escape.call(this)
backdrop.call(this,function(){var transition=$.support.transition&&that.$element.hasClass('fade')
!that.$element.parent().length&&that.$element.appendTo(document.body)
that.$element.show()
if(transition){that.$element[0].offsetWidth}
that.$element.addClass('in')
transition?that.$element.one($.support.transition.end,function(){that.$element.trigger('shown')}):that.$element.trigger('shown')})},hide:function(e){var element_id=this.$element.attr('id')
if(element_id=='playlistModal'){$.ajax({type:"POST",url:'/playlist/manage/save_queue1/',dataType:'json',success:function(response){if(response){$('#playlistModal').modal('hide').remove();$('.modal-backdrop').remove();if(response.success&&!response.redirect){var ret_data=response.data;var modal=$(ret_data).siblings('div.modal')
$('#ModalDiv').html(modal);$('#ModalDiv .modal').modal('show');$('#ModalDiv .modal').on('hidden',function(){$(this).remove();});}else if(response.success&&response.redirect){alert(response);}}}});}
e&&e.preventDefault()
if(!this.isShown)return
var that=this
this.isShown=false
$('body').removeClass('modal-open')
escape.call(this)
this.$element.trigger('hide').removeClass('in')
$.support.transition&&this.$element.hasClass('fade')?hideWithTransition.call(this):hideModal.call(this)}}
function hideWithTransition(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end)
hideModal.call(that)},500)
this.$element.one($.support.transition.end,function(){clearTimeout(timeout)
hideModal.call(that)})}
function hideModal(that){this.$element.hide().trigger('hidden')
backdrop.call(this)}
function backdrop(callback){var that=this,animate=this.$element.hasClass('fade')?'fade':''
if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate
this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body)
if(this.options.backdrop!='static'){this.$backdrop.click($.proxy(this.hide,this))}
if(doAnimate)this.$backdrop[0].offsetWidth
this.$backdrop.addClass('in')
doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass('in')
$.support.transition&&this.$element.hasClass('fade')?this.$backdrop.one($.support.transition.end,$.proxy(removeBackdrop,this)):removeBackdrop.call(this)}else if(callback){callback()}}
function removeBackdrop(){this.$backdrop.remove()
this.$backdrop=null}
function escape(){var that=this
if(this.isShown&&this.options.keyboard){$(document).on('keyup.dismiss.modal',function(e){e.which==27&&that.hide()})}else if(!this.isShown){$(document).off('keyup.dismiss.modal')}}
$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data('modal'),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=='object'&&option)
if(!data)$this.data('modal',(data=new Modal(this,options)))
if(typeof option=='string')data[option]()
else if(options.show)data.show()})}
$.fn.modal.defaults={backdrop:true,keyboard:true,show:true}
$.fn.modal.Constructor=Modal
$(function(){$('body').on('click.modal.data-api','[data-toggle="modal"]',function(e){var $this=$(this),href,$target=$($this.attr('data-target')||(href=$this.attr('href'))&&href.replace(/.*(?=#[^\s]+$)/,'')),option=$target.data('modal')?'toggle':$.extend({},$target.data(),$this.data())
e.preventDefault()
$target.modal(option)})})}(window.jQuery);(function($,window){var $window=$(window);$.fn.lazyload=function(options){var elements=this;var $container;var settings={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:window,data_attribute:"original",skip_invisible:true,appear:null,load:null};function update(){var counter=0;elements.each(function(){var $this=$(this);if(settings.skip_invisible&&!$this.is(":visible")){return;}
if($.abovethetop(this,settings)||$.leftofbegin(this,settings)){}else if(!$.belowthefold(this,settings)&&!$.rightoffold(this,settings)){$this.trigger("appear");counter=0;}else{if(++counter>settings.failure_limit){return false;}}});}
if(options){if(undefined!==options.failurelimit){options.failure_limit=options.failurelimit;delete options.failurelimit;}
if(undefined!==options.effectspeed){options.effect_speed=options.effectspeed;delete options.effectspeed;}
$.extend(settings,options);}
$container=(settings.container===undefined||settings.container===window)?$window:$(settings.container);if(0===settings.event.indexOf("scroll")){$container.bind(settings.event,function(event){return update();});}
this.each(function(){var self=this;var $self=$(self);self.loaded=false;$self.one("appear",function(){if(!this.loaded){if(settings.appear){var elements_left=elements.length;settings.appear.call(self,elements_left,settings);}
$("<img />").bind("load",function(){$self.hide().attr("src",$self.data(settings.data_attribute))
[settings.effect](settings.effect_speed);self.loaded=true;var temp=$.grep(elements,function(element){return!element.loaded;});elements=$(temp);if(settings.load){var elements_left=elements.length;settings.load.call(self,elements_left,settings);}}).attr("src",$self.data(settings.data_attribute));}});if(0!==settings.event.indexOf("scroll")){$self.bind(settings.event,function(event){if(!self.loaded){$self.trigger("appear");}});}});$window.bind("resize",function(event){update();});$(document).ready(function(){update();});return this;};$.belowthefold=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=$window.height()+$window.scrollTop();}else{fold=$(settings.container).offset().top+$(settings.container).height();}
return fold<=$(element).offset().top-settings.threshold;};$.rightoffold=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=$window.width()+$window.scrollLeft();}else{fold=$(settings.container).offset().left+$(settings.container).width();}
return fold<=$(element).offset().left-settings.threshold;};$.abovethetop=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=$window.scrollTop();}else{fold=$(settings.container).offset().top;}
return fold>=$(element).offset().top+settings.threshold+$(element).height();};$.leftofbegin=function(element,settings){var fold;if(settings.container===undefined||settings.container===window){fold=$window.scrollLeft();}else{fold=$(settings.container).offset().left;}
return fold>=$(element).offset().left+settings.threshold+$(element).width();};$.inviewport=function(element,settings){return!$.rightoffold(element,settings)&&!$.leftofbegin(element,settings)&&!$.belowthefold(element,settings)&&!$.abovethetop(element,settings);};$.extend($.expr[':'],{"below-the-fold":function(a){return $.belowthefold(a,{threshold:0});},"above-the-top":function(a){return!$.belowthefold(a,{threshold:0});},"right-of-screen":function(a){return $.rightoffold(a,{threshold:0});},"left-of-screen":function(a){return!$.rightoffold(a,{threshold:0});},"in-viewport":function(a){return $.inviewport(a,{threshold:0});},"above-the-fold":function(a){return!$.belowthefold(a,{threshold:0});},"right-of-fold":function(a){return $.rightoffold(a,{threshold:0});},"left-of-fold":function(a){return!$.rightoffold(a,{threshold:0});}});})(jQuery,window);(function($){$.extend($.fn,{livequery:function(type,fn,fn2){var self=this,q;if($.isFunction(type))
fn2=fn,fn=type,type=undefined;$.each($.livequery.queries,function(i,query){if(self.selector==query.selector&&self.context==query.context&&type==query.type&&(!fn||fn.$lqguid==query.fn.$lqguid)&&(!fn2||fn2.$lqguid==query.fn2.$lqguid))
return(q=query)&&false;});q=q||new $.livequery(this.selector,this.context,type,fn,fn2);q.stopped=false;q.run();return this;},expire:function(type,fn,fn2){var self=this;if($.isFunction(type))
fn2=fn,fn=type,type=undefined;$.each($.livequery.queries,function(i,query){if(self.selector==query.selector&&self.context==query.context&&(!type||type==query.type)&&(!fn||fn.$lqguid==query.fn.$lqguid)&&(!fn2||fn2.$lqguid==query.fn2.$lqguid)&&!this.stopped)
$.livequery.stop(query.id);});return this;}});$.livequery=function(selector,context,type,fn,fn2){this.selector=selector;this.context=context;this.type=type;this.fn=fn;this.fn2=fn2;this.elements=[];this.stopped=false;this.id=$.livequery.queries.push(this)-1;fn.$lqguid=fn.$lqguid||$.livequery.guid++;if(fn2)fn2.$lqguid=fn2.$lqguid||$.livequery.guid++;return this;};$.livequery.prototype={stop:function(){var query=this;if(this.type)
this.elements.unbind(this.type,this.fn);else if(this.fn2)
this.elements.each(function(i,el){query.fn2.apply(el);});this.elements=[];this.stopped=true;},run:function(){if(this.stopped)return;var query=this;var oEls=this.elements,els=$(this.selector,this.context),nEls=els.not(oEls);this.elements=els;if(this.type){nEls.bind(this.type,this.fn);if(oEls.length>0)
$.each(oEls,function(i,el){if($.inArray(el,els)<0)
$.event.remove(el,query.type,query.fn);});}
else{nEls.each(function(){query.fn.apply(this);});if(this.fn2&&oEls.length>0)
$.each(oEls,function(i,el){if($.inArray(el,els)<0)
query.fn2.apply(el);});}}};$.extend($.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if($.livequery.running&&$.livequery.queue.length){var length=$.livequery.queue.length;while(length--)
$.livequery.queries[$.livequery.queue.shift()].run();}},pause:function(){$.livequery.running=false;},play:function(){$.livequery.running=true;$.livequery.run();},registerPlugin:function(){$.each(arguments,function(i,n){if(!$.fn[n])return;var old=$.fn[n];$.fn[n]=function(){var r=old.apply(this,arguments);$.livequery.run();return r;}});},run:function(id){if(id!=undefined){if($.inArray(id,$.livequery.queue)<0)
$.livequery.queue.push(id);}
else
$.each($.livequery.queries,function(id){if($.inArray(id,$.livequery.queue)<0)
$.livequery.queue.push(id);});if($.livequery.timeout)clearTimeout($.livequery.timeout);$.livequery.timeout=setTimeout($.livequery.checkQueue,20);},stop:function(id){if(id!=undefined)
$.livequery.queries[id].stop();else
$.each($.livequery.queries,function(id){$.livequery.queries[id].stop();});}});$.livequery.registerPlugin('append','prepend','after','before','wrap','attr','removeAttr','addClass','removeClass','toggleClass','empty','remove','html');$(function(){$.livequery.play();});})(jQuery);window.JSON||(window.JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var JSON=window.JSON,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a,b){"use strict";var c=a.History=a.History||{},d=a.jQuery;if(typeof c.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");c.Adapter={bind:function(a,b,c){d(a).bind(b,c)},trigger:function(a,b,c){d(a).trigger(b,c)},extractEventData:function(a,c,d){var e=c&&c.originalEvent&&c.originalEvent[a]||d&&d[a]||b;return e},onDomLoad:function(a){d(a)}},typeof c.init!="undefined"&&c.init()}(window),function(a,b){"use strict";var c=a.document,d=a.setTimeout||d,e=a.clearTimeout||e,f=a.setInterval||f,g=a.History=a.History||{};if(typeof g.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");g.initHtml4=function(){if(typeof g.initHtml4.initialized!="undefined")return!1;g.initHtml4.initialized=!0,g.enabled=!0,g.savedHashes=[],g.isLastHash=function(a){var b=g.getHashByIndex(),c;return c=a===b,c},g.saveHash=function(a){return g.isLastHash(a)?!1:(g.savedHashes.push(a),!0)},g.getHashByIndex=function(a){var b=null;return typeof a=="undefined"?b=g.savedHashes[g.savedHashes.length-1]:a<0?b=g.savedHashes[g.savedHashes.length+a]:b=g.savedHashes[a],b},g.discardedHashes={},g.discardedStates={},g.discardState=function(a,b,c){var d=g.getHashByState(a),e;return e={discardedState:a,backState:c,forwardState:b},g.discardedStates[d]=e,!0},g.discardHash=function(a,b,c){var d={discardedHash:a,backState:c,forwardState:b};return g.discardedHashes[a]=d,!0},g.discardedState=function(a){var b=g.getHashByState(a),c;return c=g.discardedStates[b]||!1,c},g.discardedHash=function(a){var b=g.discardedHashes[a]||!1;return b},g.recycleState=function(a){var b=g.getHashByState(a);return g.discardedState(a)&&delete g.discardedStates[b],!0},g.emulated.hashChange&&(g.hashChangeInit=function(){g.checkerFunction=null;var b="",d,e,h,i;return g.isInternetExplorer()?(d="historyjs-iframe",e=c.createElement("iframe"),e.setAttribute("id",d),e.style.display="none",c.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.close(),h="",i=!1,g.checkerFunction=function(){if(i)return!1;i=!0;var c=g.getHash()||"",d=g.unescapeHash(e.contentWindow.document.location.hash)||"";return c!==b?(b=c,d!==c&&(h=d=c,e.contentWindow.document.open(),e.contentWindow.document.close(),e.contentWindow.document.location.hash=g.escapeHash(c)),g.Adapter.trigger(a,"hashchange")):d!==h&&(h=d,g.setHash(d,!1)),i=!1,!0}):g.checkerFunction=function(){var c=g.getHash();return c!==b&&(b=c,g.Adapter.trigger(a,"hashchange")),!0},g.intervalList.push(f(g.checkerFunction,g.options.hashChangeInterval)),!0},g.Adapter.onDomLoad(g.hashChangeInit)),g.emulated.pushState&&(g.onHashChange=function(b){var d=b&&b.newURL||c.location.href,e=g.getHashByUrl(d),f=null,h=null,i=null,j;return g.isLastHash(e)?(g.busy(!1),!1):(g.doubleCheckComplete(),g.saveHash(e),e&&g.isTraditionalAnchor(e)?(g.Adapter.trigger(a,"anchorchange"),g.busy(!1),!1):(f=g.extractState(g.getFullUrl(e||c.location.href,!1),!0),g.isLastSavedState(f)?(g.busy(!1),!1):(h=g.getHashByState(f),j=g.discardedState(f),j?(g.getHashByIndex(-2)===g.getHashByState(j.forwardState)?g.back(!1):g.forward(!1),!1):(g.pushState(f.data,f.title,f.url,!1),!0))))},g.Adapter.bind(a,"hashchange",g.onHashChange),g.pushState=function(b,d,e,f){if(g.getHashByUrl(e))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(f!==!1&&g.busy())return g.pushQueue({scope:g,callback:g.pushState,args:arguments,queue:f}),!1;g.busy(!0);var h=g.createStateObject(b,d,e),i=g.getHashByState(h),j=g.getState(!1),k=g.getHashByState(j),l=g.getHash();return g.storeState(h),g.expectedStateId=h.id,g.recycleState(h),g.setTitle(h),i===k?(g.busy(!1),!1):i!==l&&i!==g.getShortUrl(c.location.href)?(g.setHash(i,!1),!1):(g.saveState(h),g.Adapter.trigger(a,"statechange"),g.busy(!1),!0)},g.replaceState=function(a,b,c,d){if(g.getHashByUrl(c))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(d!==!1&&g.busy())return g.pushQueue({scope:g,callback:g.replaceState,args:arguments,queue:d}),!1;g.busy(!0);var e=g.createStateObject(a,b,c),f=g.getState(!1),h=g.getStateByIndex(-2);return g.discardState(f,e,h),g.pushState(e.data,e.title,e.url,!1),!0}),g.emulated.pushState&&g.getHash()&&!g.emulated.hashChange&&g.Adapter.onDomLoad(function(){g.Adapter.trigger(a,"hashchange")})},typeof g.init!="undefined"&&g.init()}(window),function(a,b){"use strict";var c=a.console||b,d=a.document,e=a.navigator,f=a.sessionStorage||!1,g=a.setTimeout,h=a.clearTimeout,i=a.setInterval,j=a.clearInterval,k=a.JSON,l=a.alert,m=a.History=a.History||{},n=a.history;k.stringify=k.stringify||k.encode,k.parse=k.parse||k.decode;if(typeof m.init!="undefined")throw new Error("History.js Core has already been loaded...");m.init=function(){return typeof m.Adapter=="undefined"?!1:(typeof m.initCore!="undefined"&&m.initCore(),typeof m.initHtml4!="undefined"&&m.initHtml4(),!0)},m.initCore=function(){if(typeof m.initCore.initialized!="undefined")return!1;m.initCore.initialized=!0,m.options=m.options||{},m.options.hashChangeInterval=m.options.hashChangeInterval||100,m.options.safariPollInterval=m.options.safariPollInterval||500,m.options.doubleCheckInterval=m.options.doubleCheckInterval||500,m.options.storeInterval=m.options.storeInterval||1e3,m.options.busyDelay=m.options.busyDelay||250,m.options.debug=m.options.debug||!1,m.options.initialTitle=m.options.initialTitle||d.title,m.intervalList=[],m.clearAllIntervals=function(){var a,b=m.intervalList;if(typeof b!="undefined"&&b!==null){for(a=0;a<b.length;a++)j(b[a]);m.intervalList=null}},m.debug=function(){(m.options.debug||!1)&&m.log.apply(m,arguments)},m.log=function(){var a=typeof c!="undefined"&&typeof c.log!="undefined"&&typeof c.log.apply!="undefined",b=d.getElementById("log"),e,f,g,h,i;a?(h=Array.prototype.slice.call(arguments),e=h.shift(),typeof c.debug!="undefined"?c.debug.apply(c,[e,h]):c.log.apply(c,[e,h])):e="\n"+arguments[0]+"\n";for(f=1,g=arguments.length;f<g;++f){i=arguments[f];if(typeof i=="object"&&typeof k!="undefined")try{i=k.stringify(i)}catch(j){}e+="\n"+i+"\n"}return b?(b.value+=e+"\n-----\n",b.scrollTop=b.scrollHeight-b.clientHeight):a||l(e),!0},m.getInternetExplorerMajorVersion=function(){var a=m.getInternetExplorerMajorVersion.cached=typeof m.getInternetExplorerMajorVersion.cached!="undefined"?m.getInternetExplorerMajorVersion.cached:function(){var a=3,b=d.createElement("div"),c=b.getElementsByTagName("i");while((b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c[0]);return a>4?a:!1}();return a},m.isInternetExplorer=function(){var a=m.isInternetExplorer.cached=typeof m.isInternetExplorer.cached!="undefined"?m.isInternetExplorer.cached:Boolean(m.getInternetExplorerMajorVersion());return a},m.emulated={pushState:!Boolean(a.history&&a.history.pushState&&a.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(e.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(e.userAgent)),hashChange:Boolean(!("onhashchange"in a||"onhashchange"in d)||m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<8)},m.enabled=!m.emulated.pushState,m.bugs={setHash:Boolean(!m.emulated.pushState&&e.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),safariPoll:Boolean(!m.emulated.pushState&&e.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(e.userAgent)),ieDoubleCheck:Boolean(m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(m.isInternetExplorer()&&m.getInternetExplorerMajorVersion()<7)},m.isEmptyObject=function(a){for(var b in a)return!1;return!0},m.cloneObject=function(a){var b,c;return a?(b=k.stringify(a),c=k.parse(b)):c={},c},m.getRootUrl=function(){var a=d.location.protocol+"//"+(d.location.hostname||d.location.host);if(d.location.port||!1)a+=":"+d.location.port;return a+="/",a},m.getBaseHref=function(){var a=d.getElementsByTagName("base"),b=null,c="";return a.length===1&&(b=a[0],c=b.href.replace(/[^\/]+$/,"")),c=c.replace(/\/+$/,""),c&&(c+="/"),c},m.getBaseUrl=function(){var a=m.getBaseHref()||m.getBasePageUrl()||m.getRootUrl();return a},m.getPageUrl=function(){var a=m.getState(!1,!1),b=(a||{}).url||d.location.href,c;return c=b.replace(/\/+$/,"").replace(/[^\/]+$/,function(a,b,c){return/\./.test(a)?a:a+"/"}),c},m.getBasePageUrl=function(){var a=d.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(a,b,c){return/[^\/]$/.test(a)?"":a}).replace(/\/+$/,"")+"/";return a},m.getFullUrl=function(a,b){var c=a,d=a.substring(0,1);return b=typeof b=="undefined"?!0:b,/[a-z]+\:\/\//.test(a)||(d==="/"?c=m.getRootUrl()+a.replace(/^\/+/,""):d==="#"?c=m.getPageUrl().replace(/#.*/,"")+a:d==="?"?c=m.getPageUrl().replace(/[\?#].*/,"")+a:b?c=m.getBaseUrl()+a.replace(/^(\.\/)+/,""):c=m.getBasePageUrl()+a.replace(/^(\.\/)+/,"")),c.replace(/\#$/,"")},m.getShortUrl=function(a){var b=a,c=m.getBaseUrl(),d=m.getRootUrl();return m.emulated.pushState&&(b=b.replace(c,"")),b=b.replace(d,"/"),m.isTraditionalAnchor(b)&&(b="./"+b),b=b.replace(/^(\.\/)+/g,"./").replace(/\#$/,""),b},m.store={},m.idToState=m.idToState||{},m.stateToId=m.stateToId||{},m.urlToId=m.urlToId||{},m.storedStates=m.storedStates||[],m.savedStates=m.savedStates||[],m.normalizeStore=function(){m.store.idToState=m.store.idToState||{},m.store.urlToId=m.store.urlToId||{},m.store.stateToId=m.store.stateToId||{}},m.getState=function(a,b){typeof a=="undefined"&&(a=!0),typeof b=="undefined"&&(b=!0);var c=m.getLastSavedState();return!c&&b&&(c=m.createStateObject()),a&&(c=m.cloneObject(c),c.url=c.cleanUrl||c.url),c},m.getIdByState=function(a){var b=m.extractId(a.url),c;if(!b){c=m.getStateString(a);if(typeof m.stateToId[c]!="undefined")b=m.stateToId[c];else if(typeof m.store.stateToId[c]!="undefined")b=m.store.stateToId[c];else{for(;;){b=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof m.idToState[b]=="undefined"&&typeof m.store.idToState[b]=="undefined")break}m.stateToId[c]=b,m.idToState[b]=a}}return b},m.normalizeState=function(a){var b,c;if(!a||typeof a!="object")a={};if(typeof a.normalized!="undefined")return a;if(!a.data||typeof a.data!="object")a.data={};b={},b.normalized=!0,b.title=a.title||"",b.url=m.getFullUrl(m.unescapeString(a.url||d.location.href)),b.hash=m.getShortUrl(b.url),b.data=m.cloneObject(a.data),b.id=m.getIdByState(b),b.cleanUrl=b.url.replace(/\??\&_suid.*/,""),b.url=b.cleanUrl,c=!m.isEmptyObject(b.data);if(b.title||c)b.hash=m.getShortUrl(b.url).replace(/\??\&_suid.*/,""),/\?/.test(b.hash)||(b.hash+="?"),b.hash+="&_suid="+b.id;return b.hashedUrl=m.getFullUrl(b.hash),(m.emulated.pushState||m.bugs.safariPoll)&&m.hasUrlDuplicate(b)&&(b.url=b.hashedUrl),b},m.createStateObject=function(a,b,c){var d={data:a,title:b,url:c};return d=m.normalizeState(d),d},m.getStateById=function(a){a=String(a);var c=m.idToState[a]||m.store.idToState[a]||b;return c},m.getStateString=function(a){var b,c,d;return b=m.normalizeState(a),c={data:b.data,title:a.title,url:a.url},d=k.stringify(c),d},m.getStateId=function(a){var b,c;return b=m.normalizeState(a),c=b.id,c},m.getHashByState=function(a){var b,c;return b=m.normalizeState(a),c=b.hash,c},m.extractId=function(a){var b,c,d;return c=/(.*)\&_suid=([0-9]+)$/.exec(a),d=c?c[1]||a:a,b=c?String(c[2]||""):"",b||!1},m.isTraditionalAnchor=function(a){var b=!/[\/\?\.]/.test(a);return b},m.extractState=function(a,b){var c=null,d,e;return b=b||!1,d=m.extractId(a),d&&(c=m.getStateById(d)),c||(e=m.getFullUrl(a),d=m.getIdByUrl(e)||!1,d&&(c=m.getStateById(d)),!c&&b&&!m.isTraditionalAnchor(a)&&(c=m.createStateObject(null,null,e))),c},m.getIdByUrl=function(a){var c=m.urlToId[a]||m.store.urlToId[a]||b;return c},m.getLastSavedState=function(){return m.savedStates[m.savedStates.length-1]||b},m.getLastStoredState=function(){return m.storedStates[m.storedStates.length-1]||b},m.hasUrlDuplicate=function(a){var b=!1,c;return c=m.extractState(a.url),b=c&&c.id!==a.id,b},m.storeState=function(a){return m.urlToId[a.url]=a.id,m.storedStates.push(m.cloneObject(a)),a},m.isLastSavedState=function(a){var b=!1,c,d,e;return m.savedStates.length&&(c=a.id,d=m.getLastSavedState(),e=d.id,b=c===e),b},m.saveState=function(a){return m.isLastSavedState(a)?!1:(m.savedStates.push(m.cloneObject(a)),!0)},m.getStateByIndex=function(a){var b=null;return typeof a=="undefined"?b=m.savedStates[m.savedStates.length-1]:a<0?b=m.savedStates[m.savedStates.length+a]:b=m.savedStates[a],b},m.getHash=function(){var a=m.unescapeHash(d.location.hash);return a},m.unescapeString=function(b){var c=b,d;for(;;){d=a.unescape(c);if(d===c)break;c=d}return c},m.unescapeHash=function(a){var b=m.normalizeHash(a);return b=m.unescapeString(b),b},m.normalizeHash=function(a){var b=a.replace(/[^#]*#/,"").replace(/#.*/,"");return b},m.setHash=function(a,b){var c,e,f;return b!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.setHash,args:arguments,queue:b}),!1):(c=m.escapeHash(a),m.busy(!0),e=m.extractState(a,!0),e&&!m.emulated.pushState?m.pushState(e.data,e.title,e.url,!1):d.location.hash!==c&&(m.bugs.setHash?(f=m.getPageUrl(),m.pushState(null,null,f+"#"+c,!1)):d.location.hash=c),m)},m.escapeHash=function(b){var c=m.normalizeHash(b);return c=a.escape(c),m.bugs.hashEscape||(c=c.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),c},m.getHashByUrl=function(a){var b=String(a).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return b=m.unescapeHash(b),b},m.setTitle=function(a){var b=a.title,c;b||(c=m.getStateByIndex(0),c&&c.url===a.url&&(b=c.title||m.options.initialTitle));try{d.getElementsByTagName("title")[0].innerHTML=b.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(e){}return d.title=b,m},m.queues=[],m.busy=function(a){typeof a!="undefined"?m.busy.flag=a:typeof m.busy.flag=="undefined"&&(m.busy.flag=!1);if(!m.busy.flag){h(m.busy.timeout);var b=function(){var a,c,d;if(m.busy.flag)return;for(a=m.queues.length-1;a>=0;--a){c=m.queues[a];if(c.length===0)continue;d=c.shift(),m.fireQueueItem(d),m.busy.timeout=g(b,m.options.busyDelay)}};m.busy.timeout=g(b,m.options.busyDelay)}return m.busy.flag},m.busy.flag=!1,m.fireQueueItem=function(a){return a.callback.apply(a.scope||m,a.args||[])},m.pushQueue=function(a){return m.queues[a.queue||0]=m.queues[a.queue||0]||[],m.queues[a.queue||0].push(a),m},m.queue=function(a,b){return typeof a=="function"&&(a={callback:a}),typeof b!="undefined"&&(a.queue=b),m.busy()?m.pushQueue(a):m.fireQueueItem(a),m},m.clearQueue=function(){return m.busy.flag=!1,m.queues=[],m},m.stateChanged=!1,m.doubleChecker=!1,m.doubleCheckComplete=function(){return m.stateChanged=!0,m.doubleCheckClear(),m},m.doubleCheckClear=function(){return m.doubleChecker&&(h(m.doubleChecker),m.doubleChecker=!1),m},m.doubleCheck=function(a){return m.stateChanged=!1,m.doubleCheckClear(),m.bugs.ieDoubleCheck&&(m.doubleChecker=g(function(){return m.doubleCheckClear(),m.stateChanged||a(),!0},m.options.doubleCheckInterval)),m},m.safariStatePoll=function(){var b=m.extractState(d.location.href),c;if(!m.isLastSavedState(b))c=b;else return;return c||(c=m.createStateObject()),m.Adapter.trigger(a,"popstate"),m},m.back=function(a){return a!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.back,args:arguments,queue:a}),!1):(m.busy(!0),m.doubleCheck(function(){m.back(!1)}),n.go(-1),!0)},m.forward=function(a){return a!==!1&&m.busy()?(m.pushQueue({scope:m,callback:m.forward,args:arguments,queue:a}),!1):(m.busy(!0),m.doubleCheck(function(){m.forward(!1)}),n.go(1),!0)},m.go=function(a,b){var c;if(a>0)for(c=1;c<=a;++c)m.forward(b);else{if(!(a<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(c=-1;c>=a;--c)m.back(b)}return m};if(m.emulated.pushState){var o=function(){};m.pushState=m.pushState||o,m.replaceState=m.replaceState||o}else m.onPopState=function(b,c){var e=!1,f=!1,g,h;return m.doubleCheckComplete(),g=m.getHash(),g?(h=m.extractState(g||d.location.href,!0),h?m.replaceState(h.data,h.title,h.url,!1):(m.Adapter.trigger(a,"anchorchange"),m.busy(!1)),m.expectedStateId=!1,!1):(e=m.Adapter.extractEventData("state",b,c)||!1,e?f=m.getStateById(e):m.expectedStateId?f=m.getStateById(m.expectedStateId):f=m.extractState(d.location.href),f||(f=m.createStateObject(null,null,d.location.href)),m.expectedStateId=!1,m.isLastSavedState(f)?(m.busy(!1),!1):(m.storeState(f),m.saveState(f),m.setTitle(f),m.Adapter.trigger(a,"statechange"),m.busy(!1),!0))},m.Adapter.bind(a,"popstate",m.onPopState),m.pushState=function(b,c,d,e){if(m.getHashByUrl(d)&&m.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&m.busy())return m.pushQueue({scope:m,callback:m.pushState,args:arguments,queue:e}),!1;m.busy(!0);var f=m.createStateObject(b,c,d);return m.isLastSavedState(f)?m.busy(!1):(m.storeState(f),m.expectedStateId=f.id,n.pushState(f.id,f.title,f.url),m.Adapter.trigger(a,"popstate")),!0},m.replaceState=function(b,c,d,e){if(m.getHashByUrl(d)&&m.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(e!==!1&&m.busy())return m.pushQueue({scope:m,callback:m.replaceState,args:arguments,queue:e}),!1;m.busy(!0);var f=m.createStateObject(b,c,d);return m.isLastSavedState(f)?m.busy(!1):(m.storeState(f),m.expectedStateId=f.id,n.replaceState(f.id,f.title,f.url),m.Adapter.trigger(a,"popstate")),!0};if(f){try{m.store=k.parse(f.getItem("History.store"))||{}}catch(p){m.store={}}m.normalizeStore()}else m.store={},m.normalizeStore();m.Adapter.bind(a,"beforeunload",m.clearAllIntervals),m.Adapter.bind(a,"unload",m.clearAllIntervals),m.saveState(m.storeState(m.extractState(d.location.href,!0))),f&&(m.onUnload=function(){var a,b;try{a=k.parse(f.getItem("History.store"))||{}}catch(c){a={}}a.idToState=a.idToState||{},a.urlToId=a.urlToId||{},a.stateToId=a.stateToId||{};for(b in m.idToState){if(!m.idToState.hasOwnProperty(b))continue;a.idToState[b]=m.idToState[b]}for(b in m.urlToId){if(!m.urlToId.hasOwnProperty(b))continue;a.urlToId[b]=m.urlToId[b]}for(b in m.stateToId){if(!m.stateToId.hasOwnProperty(b))continue;a.stateToId[b]=m.stateToId[b]}m.store=a,m.normalizeStore(),f.setItem("History.store",k.stringify(a))},m.intervalList.push(i(m.onUnload,m.options.storeInterval)),m.Adapter.bind(a,"beforeunload",m.onUnload),m.Adapter.bind(a,"unload",m.onUnload));if(!m.emulated.pushState){m.bugs.safariPoll&&m.intervalList.push(i(m.safariStatePoll,m.options.safariPollInterval));if(e.vendor==="Apple Computer, Inc."||(e.appCodeName||"")==="Mozilla")m.Adapter.bind(a,"hashchange",function(){m.Adapter.trigger(a,"popstate")}),m.getHash()&&m.Adapter.onDomLoad(function(){m.Adapter.trigger(a,"hashchange")})}},m.init()}(window)
function slideChange(args){}
function slideComplete(args){return false;}
function sliderLoaded(args){slideChange(args);}
function start_iosslider(){$('#iosslider-banner .item').removeClass('hide');$('.iosSlider').iosSlider({desktopClickDrag:false,snapToChildren:true,infiniteSlider:true,snapSlideCenter:false,navPrevSelector:'.sliderContainer .slideSelectors .prev',navNextSelector:'.sliderContainer .slideSelectors .next',onSlideComplete:slideComplete,onSliderLoaded:sliderLoaded,onSlideChange:slideChange,autoSlide:true,scrollbar:false,scrollbarMargin:'0',scrollbarBorderRadius:'0',keyboardControls:false});}
﻿function comment(){$('#id_comment_form').livequery('submit',function(e){var comment=$('#id_comment',this).val();if(!$.trim(comment)){return false;}
if(comment.length>=500){alert(gettext('Comments can only enter 500 characters!'));return false;}
var url=$(this).attr('action');var data=$(this).serializeArray();$.ajax({url:url,data:data,type:'POST',dataType:'json',success:function(response){if(response.success){$('#id_comment_form').get(0).reset();}
$(response.html).hide().insertAfter('.add_comment_box').fadeIn('1000');},});_gaq.push(['_trackEvent','Comment','Submit comment']);return false;});$('form.work_simple_comment_form').livequery('submit',function(e){var url=$(this).attr('action');var data=$(this).serializeArray();var that=$(this);var b=$(this).parents('.item_box');var anchor=$('.add_message_btn',b);var status_icon=$('i',anchor);var message_count_text=status_icon[0].nextSibling;if(message_count_text){var message_count=parseInt(message_count_text.textContent);message_count+=1;message_count_text.textContent=message_count;}
that.parent().append('<span class="help-inline">'+gettext('Message done!')+'</span>');that.remove();$.ajax({url:url,data:data,type:'POST',dataType:'json',success:function(response){},});return false;});$('form.work_simple_comment_form input[name=comment]').livequery('keypress',function(e){if(e.which==13){var val=$.trim($(this).val());if(val===''){return false;}
$(this).parents('form').submit();}});$('a.comment-delete').livequery('click',function(){var comment=$(this);var content;confirm(gettext('Warning'),gettext('Are you sure you want to delete this message?'),gettext('Delete'),gettext('Cancel'),function(ret){if(ret){if($('#nextpage').children().length>0){var more_comments=$('#load_more_comments');var next_url=more_comments.attr('href');$.get(next_url,function(data){content=$(data).find('#comments .comment_box');});}
var form=comment.parent().find('form.comment-delete');var url=$(form).attr('action');var data=$(form).serialize();$.ajax({url:url,data:data,type:'POST',dataType:'json',success:function(response){if(response.success){comment.closest('.comment_box').fadeOut('1000',function(){$(this).remove();$(content[0]).insertBefore('.more').hide().fadeIn();if(content.length==1)
more_comments.parents('.more').remove();});}}});}});});$('#load_more_comments').livequery('click',function(){var that=$(this);var url=that.attr('href');$.get(url,function(data){that.parents('.more').remove();var content=$(data).find('#comments >*');content.appendTo('#comments').hide().fadeIn();});return false;});return false;}
$(function(){window.gUploading=false;$(window).bind('beforeunload',function(){if(window.gUploading){return gettext('files are uploading ...');}});var deb={log:function(msg){if(window.console){console.log(msg);}else{alert(msg);};},};var song_uploader_manage={uploader_add_song:function(up,files){var count=files.length;var template=$('#song_add_template').html();$.each(files,function(i,file){var edit_str=template;edit_str=edit_str.replace(/::file_id::/g,file.id);edit_str=edit_str.replace(/::song_file_name::/g,file.name);$(edit_str).insertBefore('#song_upload_texts');$('#song_'+file.id+' .more a').click(function(){if($('#song_'+file.id+' .more b').hasClass('caret')){$('#song_'+file.id+' #editarea').slideDown('slow',function(){$('#song_'+file.id+' .more a').html(gettext('Less')+'<b class="un_caret"></b>');});}else{$('#song_'+file.id+' #editarea').slideUp('slow',function(){$('#song_'+file.id+' .more a').html(gettext('More')+'<b class="caret"></b>');});};return false;});$('#song_'+file.id+' a.close').bind('click',function(e){e.preventDefault();var that=$(this);confirm(gettext('Cancel upload'),gettext('Are you sure to cancel this file?'),gettext('Yes'),gettext('No'),function(ret){if(!((file.status==plupload.UPLOADING)||(file.status==plupload.DONE))){if(ret){up.removeFile(file);$('#song_'+file.id+' span.close, #song_'+file.id+' .progress').fadeOut();$('#song_'+file.id+' #status').html(gettext('Canceled'));that.addClass('hide');};};});});if(!--count){up.refresh();up.start();}})}};window.song_uploader={};$('#picksongfiles').livequery(function(){if(window.song_upload_loaded){window.song_uploader.unbind('FilesAdded');}else{window.song_upload_loaded=true;}
window.song_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$('#song_upload_url').val(),browse_button:'picksongfiles',container:'inside_box',max_file_size:'100mb',chunk_size:'1mb',autostart:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,drop_element:'wrapper',multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"audio file",extensions:"mp3"}],});window.song_uploader.init();window.song_uploader.bind('FilesAdded',function(up,files){if(window.song_upload_flag){window.gUploading=true;if(!$('#confirm').attr('checked')){confirm(gettext('Confirm rights'),gettext('Please confirm that you or your band own the rights and agreed with the license of StreetVoice. Confirm correct, check the checkbox?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$('#confirm').attr('checked','checked');$('#confirm').attr('disabled',true);song_uploader_manage.uploader_add_song(up,files);}else{up.splice();up.refresh();};});}else{$('#confirm').attr('disabled',true);song_uploader_manage.uploader_add_song(up,files);};}});window.song_uploader.bind('Error',function(up,err){if(window.song_upload_flag){var message=gettext('File upload error, Please choose file to upload again.');alert(message);window.gUploading=false;up.refresh();}});window.song_uploader.bind('BeforeUpload',function(up,file){var url=$('#song_create_info').val();$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'song_name='+encodeURIComponent(file.name),dataType:'json',cache:false,success:function(resp){if(resp.success){file.song_id=resp.song_id;file.delete_new_song_url=resp.delete_new_song_url;$('#song_cover_area_'+resp.song_id).livequery(function(){song_id=resp.song_id;var single_song_cover_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$('#upload_song_cover_url_'+song_id).val(),browse_button:'single_song_cover_pickfile_'+song_id,container:'song_cover_area_'+song_id,max_file_size:'10mb',chunk_size:'1mb',autostart:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});single_song_cover_uploader.init();single_song_cover_uploader.bind('FilesAdded',function(up,files){window.gUploading=true;$('#single_song_cover_pickfile_'+song_id).attr('disabled','disabled');$('#single_song_edit_form #frm_save').attr('disabled','disabled');$('#single_song_edit_form #frm_save').val(gettext('Updating ...'));up.start();});single_song_cover_uploader.bind('Error',function(up,err){var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.splice();up.refresh();window.gUploading=false;});single_song_cover_uploader.bind('UploadFile',function(up,file){window.gUploading=true;});single_song_cover_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){if(resp.cover_url){$('#song_cover_img_'+song_id).attr("src",resp.cover_url);}}
$('#single_song_cover_pickfile_'+song_id).removeAttr('disabled');$('#single_song_edit_form #frm_save').val(gettext('Save'));$('#single_song_edit_form #frm_save').removeAttr('disabled');window.gUploading=false;});});$('#song_'+file.id+' #upload_play_'+file.id).attr('data',file.song_id);$('#song_'+file.id+' #editarea').append(resp.data);$('#song_'+file.id+' #editarea').toggle('slow');$('#song_'+file.id+' form').submit(function(){doSong.save('song_'+file.id);return false;});up.settings.multipart_params={song_id:file.song_id};up.trigger('UploadFile',file);}},error:function(ob,textStatus){alert(gettext('beforeupload error'));}});return false;up.settings.multipart_params={'song_id':file.song_id};up.trigger('UploadFile',file);});window.song_uploader.bind('UploadFile',function(up,file){$('#song_'+file.id+' .close').hide();if($('#song_'+file.id+' .more').hasClass('hide')){$('#song_'+file.id+' .more').removeClass('hide');}
window.gUploading=true;});window.song_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.song_uploader.bind('UploadProgress',function(up,file){$('#song_'+file.id+' #status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#song_'+file.id+' .progress .bar').css('width',file.percent+'%');if(file.percent>=99){$('#song_'+file.id+' #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');};});window.song_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#song_'+file.id+' #status').html(gettext('File uploaded'));$('#song_'+file.id+' a.close, #song_'+file.id+' .progress').hide();}else{var delete_new_song_url=file.delete_new_song_url;if(delete_new_song_url){$.ajax({url:delete_new_song_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){},error:function(ob,textStatus){}});}
$('#song_'+file.id+' #status').addClass('error');$('#song_'+file.id+' #status').html(resp.message);$('#song_'+file.id+' a.close, #song_'+file.id+' .progress').hide();$('#song_'+file.id+' #editarea').remove();$('#song_'+file.id+' .more').remove();}});});$('input.input-noenter').livequery('keypress',function(e){var that=$(this);if(e.which==13)
return false;});var doSong={save:function(area_id){var $form=$('#'+area_id+' form');if($('#'+area_id+' #id_style').val()==''){$('#'+area_id+' #id_public_2').attr('checked',true);};if($.trim($('#'+area_id+' #id_name').val())==''){alert(gettext('song name cannot empty'));return false;};if($('#'+area_id+' #id_genre').val()=='0'){alert(gettext('Please select a style'));return false;};var name=$form.find('#id_name').val();var synopsis=$form.find('#id_synopsis').val();var lyrics=$form.find('#id_lyrics').val();var musicalbum=$form.find('#id_musicalbum').val();var genre=$form.find('#id_genre').val();var license=$form.find('#id_license').val();var status=$form.find('#id_public').val();var $tag_textarea=$('#'+area_id+' .song_tag_textarea');var textext=$tag_textarea.textext()[0];var tags=textext.tags()._formData;var form_url=$form.attr('action');var form_data={'name':name,'synopsis':synopsis,'lyrics':lyrics,'musicalbum':musicalbum,'genre':genre,'tags':tags,'public':status,'license':license};$('#'+area_id+' form #frm_save').attr('disabled','disabled');$('#'+area_id+' form #frm_save').val(gettext('Updating ...'));$('.boboerror').remove();$.ajax({url:form_url,type:'POST',data:form_data,dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Save done'),{'life':800,'speed':'fast'});$('#'+area_id+' form #frm_save').val(gettext('Saved'));$('#album_edit_song_list #song_'+resp.song_id+' .album_sort_song_name').text(resp.song_name);$('#album_edit_song_list #song_'+resp.song_id+' td.g_text').text(resp.status_message);setTimeout(function(){$('#'+area_id+' form #frm_save').val(gettext('Save'));$('#'+area_id+' form #frm_save').removeAttr('disabled');},1200);}else{$('#'+area_id+' form #frm_save').val(gettext('Save'));$('#'+area_id+' form #frm_save').removeAttr('disabled');var errors=resp.errors;for(var field in errors){if(errors[field].length>0){alert(errors[field][1]);$('#'+area_id+' #id_'+field).focus();break;};};};},});return false;},isuploading:false,};window.album_image_uploader={};$('#albumcreate_album_cover_item').livequery(function(){if(window.album_image_upload_loaded){window.album_image_uploader.unbind('FilesAdded');}else{window.album_image_upload_loaded=true;}
window.album_image_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',browse_button:'albumcreate_album_cover_item',container:'inside_box',max_file_size:'10mb',multi_selection:false,multiple_queues:false,unique_names:true,flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});window.album_image_uploader.bind('FilesAdded',function(up,files){$('#btn_create_album').attr('disabled',true);var album_name=$('#frm_cralbum #id_album_name').val();var description=$('#frm_cralbum #id_description').val();if(album_name==''){for(var i in files){album_name=files[i].name;}
album_name=album_name.split('.')[0]}
window.album_image_uploader.settings.url=$('#frm_cralbum').attr('action'),window.album_image_uploader.settings.multipart_params={'csrfmiddlewaretoken':$('input[name="csrfmiddlewaretoken"]').val(),'album_name':album_name,'description':description,'buy_link':'',};up.refresh();setTimeout(function(){up.start();},100);});window.album_image_uploader.bind('UploadFile',function(up,file){window.gUploading=true;up.refresh();});window.album_image_uploader.bind('Error',function(up,err){if(window.album_image_upload_flag){window.gUploading=false;var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.refresh();}});window.album_image_uploader.bind('UploadProgress',function(up,file){});window.album_image_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.album_image_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#frm_cralbum #album_id').val(resp.album_id);$('#frm_cralbum #next').val(resp.next);$('#frm_cralbum #is_box').val(resp.is_box);album_name=$('#frm_cralbum #id_album_name').val();if(album_name==''){$('#frm_cralbum #id_album_name').val(resp.album_name);}
if(resp.album_cover){$('#cover_img').attr("src",resp.album_cover);}
$('#btn_create_album').attr('disabled',false);}else{var errors=resp.errors;for(field in errors){if(errors[field].length>0){if(field=='cover'){$('#frm_cralbum #selectfile').show();};alert(errors[field]);$('#frm_cralbum #id_'+field).focus();break;};};};});window.album_image_uploader.init();});$('#btn_create_album').livequery('click',function(){if($.trim($('#frm_cralbum #next').val())==''){alert(gettext('please add a cover image.'));return false;};if($.trim($('#frm_cralbum #id_album_name').val())==''){alert(gettext('album name cannot be empty.'));return false;};$.ajax({url:$('#frm_cralbum #next').val(),type:'POST',encoding:'UTF-8',data:$('#frm_cralbum').serialize(),dataType:'json',cache:false,success:function(resp){if(resp.success){var href=$('#frm_cralbum #next').val();var is_box=$('#frm_cralbum #is_box').val();if(is_box=='true'){$('#id_musicalbum').prepend('<option value='+resp.album_id+' selected="selected">'+resp.album_name+'</option>');$('#id_album').val(resp.album_id);$('#myModal').modal('hide');}else{alert(resp.messages);History.pushState(null,null,href);}}else{var errors=resp.errors;for(var field in errors){if(errors[field].length>0){if(field=='cover'){$('#frm_cralbum #selectfile').show();};alert(errors[field][1]);$('#frm_edalbum #id_'+field).focus();break;};};};},});return false;});window.album_image_edit_uploader={};$('#albumedit_album_cover_item').livequery(function(){if(window.album_image_upload_loaded){window.album_image_uploader.unbind('FilesAdded');}else{window.album_image_edit_uploader=true;}
window.album_image_edit_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',browse_button:'edit_album_cover_btn',container:'inside_box',max_file_size:'10mb',multi_selection:false,multiple_queues:false,unique_names:true,flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});window.album_image_edit_uploader.bind('FilesAdded',function(up,files){$('#btn_edit_album').attr('disabled',true);window.album_image_edit_uploader.settings.url=$('#frm_edalbum').attr('action'),window.album_image_edit_uploader.settings.multipart_params={'csrfmiddlewaretoken':$('input[name="csrfmiddlewaretoken"]').val(),'album_name':$('#frm_edalbum #old_album_name').val(),'description':$('#frm_edalbum #old_description').val(),'buy_link':'',};up.refresh();setTimeout(function(){up.start();},100);});window.album_image_edit_uploader.bind('UploadFile',function(up,file){window.gUploading=true;up.refresh();});window.album_image_edit_uploader.bind('Error',function(up,err){if(window.album_image_upload_flag){window.gUploading=false;var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.refresh();}});window.album_image_edit_uploader.bind('UploadProgress',function(up,file){});window.album_image_edit_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.album_image_edit_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){if(resp.album_cover){$('#cover_img').attr("src",resp.album_cover);}
$('#btn_edit_album').attr('disabled',false);}else{var errors=resp.errors;for(var field in errors){if(errors[field].length>0){if(field=='cover'){$('#frm_edalbum #selectfile').show();};alert(errors[field][1]);$('#frm_edalbum #id_'+field).focus();break;};};};});window.album_image_edit_uploader.init();});$('#btn_edit_album').livequery('click',function(){if($.trim($('#frm_edalbum #id_album_name').val())==''){alert(gettext('album name cannot be empty.'));return false;};$.ajax({url:$('#frm_edalbum').attr('action'),type:'POST',encoding:'UTF-8',data:$('#frm_edalbum').serialize(),dataType:'json',cache:false,success:function(resp){if(resp.success){alert(resp.messages);}else{var errors=resp.errors;for(var field in errors){if(errors[field].length>0){if(field=='cover'){$('#frm_cralbum #selectfile').show();};alert(errors[field][1]);$('#frm_edalbum #id_'+field).focus();break;};};};},});return false;});var tr_sort_fixHelper=function(e,ui){ui.children().each(function(){$(this).width($(this).width());});return ui;};$('#tbl_album_song_list #album_edit_song_list').livequery(function(){$(this).sortable({axis:'y',helper:tr_sort_fixHelper,handle:'.album_sort_song_name',scroll:true,cursor:'move'}).disableSelection();$(this).sortable({stop:function(e,ui){$('#album_sort_msg').text('update sorting').show();var sort_data=$(this).sortable('serialize');var url=$('#frm_edalbum').attr('action');if(sort_data.length==0){top.location.reload();return false;};type='album_song_ordering';$.getJSON(url,{'sort_data':sort_data,'type':type},function(resp){if(resp&&resp.success){$('#album_sort_msg').text(resp.message).show();};});},change:function(e,ui){$('#album_sort_msg').text('change').hide().text('');},});});$('#album_edit_song_list .s_icon-error').livequery('click',function(){var song_id=$(this).parents('tr.album_songs').attr('id');var url=$('#frm_edalbum').attr('action');type='remove_song_from_album';$.getJSON(url,{'song_id':song_id,'type':type},function(resp){if(resp&&resp.success){$('#album_sort_msg').text(resp.message).show();$('#album_edit_song_list #editsongarea_'+song_id.split('_')[1]).fadeOut('slow').remove();$('#album_edit_song_list #song_'+song_id.split('_')[1]).fadeOut('slow').remove();reload_element('#allalready');};});return false;});$('#get_already').livequery('click',function(){if(!$('#already').is(':visible')){reload_element('#allalready');};});$('#allalready .s_icon-add').livequery('click',function(){var song_id=$(this).parent().parent().parent().attr('id');var url=$('#frm_edalbum').attr('action');type='add_song_to_album';$.getJSON(url,{'song_id':song_id,'type':type},function(resp){if(resp&&resp.success){$('#album_sort_msg').text(resp.message).show();var addsong='<tr id="'+song_id+'" class="album_songs"></tr>'
$('#album_edit_song_list').append(addsong);reload_element('#album_edit_song_list #'+song_id);$('#allalready #'+song_id).fadeOut('slow').remove();};});return false;});window.album_uploader={};$('#the_album_new_song').livequery(function(){if(window.album_upload_loaded){window.album_uploader.unbind('FilesAdded');}else{window.album_upload_loaded=true;}
window.album_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$('#frm_album_new_song_upload').attr('action'),browse_button:'albumsongpickfiles',container:'the_album_new_song',max_file_size:'100mb',chunk_size:'1mb',autostart:false,drop_element:'wrapper',multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"audio file",extensions:"mp3"}],preinit:{Init:function(up,info){},},});window.album_uploader.init();window.album_uploader.bind('FilesAdded',function(up,files){if(window.album_upload_flag){if(!$('#confirm').attr('checked')){confirm(gettext('Confirm rights'),gettext('Please confirm that you or your band own the rights and agreed with the license of StreetVoice. Confirm correct, check the checkbox?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$('#confirm').attr('checked','checked');$('#confirm').attr('disabled',true);window.gUploading=true;uploader_maange.uploader_album_addsong(up,files);}else{up.splice();up.refresh();};});}else{$('#confirm').attr('disabled',true);window.gUploading=true;uploader_maange.uploader_album_addsong(up,files);};}});window.album_uploader.bind('Error',function(up,err){if(window.album_upload_flag){var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.refresh();window.gUploading=false;}});window.album_uploader.bind('BeforeUpload',function(up,file){var theform=$('#wrapper').find($('#frm_album_new_song_add_create_info'));$.ajax({url:$(theform).attr('action'),type:'POST',encoding:'UTF-8',data:'song_name='+encodeURIComponent(file.name),dataType:'json',cache:false,success:function(resp){if(resp.success){file.song_id=resp.song_id;file.delete_song_url=resp.delete_song_url;up.settings.multipart_params={song_id:file.song_id};$('#upload_'+file.id+' #editarea').append(resp.data);$('#upload_'+file.id+' #editarea').toggle('slow');$('#upload_'+file.id+' form').submit(function(){doSong.save('upload_'+file.id);return false;});var url=window.location.pathname;var song_info_url='';song_info_url=url.replace(/info/g,"song/"+resp.song_id+"/info")
var addsong='<tr id="song_'+resp.song_id+'" class="album_songs"><td id="song_play_'+file.id+'"><a data="'+resp.song_id+'" class="play btn btn-mini btn-circle icon_only" data-type="song" href="#" data="'+resp.song_id+'""><i class="xs_icon-play"></i></a></td><td class="album_sort_song_name">'+resp.song_name+'</td><td></td><td><div class="action_btn"><div class="btn-group icon_only"><a class="btn btn-mini" href="'+song_info_url+'"><i class="s_icon-edit"></i></a><a class="btn btn-mini"><i class="s_icon-error"></i></a></div></div></td></tr>'
var delete_song_url=file.delete_song_url;$('#upload_'+file.id+' #delete_song_in_upload_song').bind('click',function(){confirm(gettext('delete song'),gettext('Are you sure you want to delete this song?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:delete_song_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){$('#upload_'+file.id).remove();$('#song_'+file.song_id).remove();}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete song error'));}});}});});$('#album_edit_song_list').append(addsong);up.trigger('UploadFile',file);}else{}},error:function(ob,textStatus){alert(gettext('beforeupload error'));}});return false;});window.album_uploader.bind('UploadFile',function(up,file){$('#upload_'+file.id+' .close').hide();$('#upload_'+file.id+' .more').show();$('#upload_'+file.id+' .progress').show();window.gUploading=true;});window.album_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.album_uploader.bind('UploadProgress',function(up,file){$('#upload_'+file.id+' #status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#upload_'+file.id+' .progress .bar').css('width',file.percent+'%');if(file.percent>=100){$('#upload_'+file.id+' #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');}});window.album_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#upload_'+file.id+' #status').html(gettext('File uploaded'));$('#upload_'+file.id+' #delete_song_in_upload_song').show();$('#upload_'+file.id+' .close, #upload_'+file.id+' .progress').fadeOut();$('#song_play_'+file.id+' a').show('slow');}else{var delete_song_url=file.delete_song_url;$.ajax({url:delete_song_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){},error:function(ob,textStatus){}});$('#song_'+file.song_id).remove();$('#upload_'+file.id+' #status').html(resp.message);$('#upload_'+file.id+' .close, #upload_'+file.id+' .progress').fadeOut();$('#upload_'+file.id+' #editarea').remove();$('#upload_'+file.id+' .more').remove();}});});var album_songs_uploader=new Array();$('#album_edit_song_list .s_icon-edit').livequery('click',function(){var parent_tr_id=$(this).parents('tr.album_songs').attr('id');var sortarea='#tbl_album_song_list #album_edit_song_list';var info_url=$(this).parent('a').attr('href');var song_id=parent_tr_id.split('_')[1];if($('#editsongarea_'+song_id).length==0){$.ajax({url:info_url,type:'POST',encoding:'UTF-8',data:'s=s',dataType:'json',cache:false,success:function(resp){if(resp.success){$(sortarea).sortable({disabled:true}).enableSelection();var edit_area_str='<tr id="editsongarea_'+song_id+'" class="editsongarea">'+'<td colspan="4" class="song_edit_td">'+'<div class="well form-song_edit form-inline">'+'<a class="close">&times;</a>'+resp.data+'<div class="more"><a href="#">'+gettext('Less')+'<b class="un_caret"></b></a></div>'+'</div>'+'</td></tr>';$(edit_area_str).insertAfter('#'+parent_tr_id);album_songs_uploader[song_id]=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$('#frm_album_song_edit_upload').attr('action'),browse_button:'pickfile_'+song_id,container:'uploader_container_'+song_id,max_file_size:'100mb',chunk_size:'1mb',autostart:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:false,multipart_params:{'song_id':parseInt(song_id),'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"audio file",extensions:"mp3"}],});album_songs_uploader[song_id].init();album_songs_uploader[song_id].bind('FilesAdded',function(up,files){$('#pickfile_'+song_id).attr('disabled','disabled');var th_url=$('#frm_album_song_edit_check_info').attr('action');$.ajax({url:th_url,type:'POST',encoding:'UTF-8',data:'song_id='+song_id,dataType:'json',cache:false,success:function(resp){if(resp.success){$.each(files,function(i,file){$('#editsongarea_'+song_id+' .song_edit_td h3').text(file.name);$('#editsongarea_'+song_id+' span#status').html('('+plupload.formatSize(file.size)+')'+gettext('Waiting ...'))});up.settings.multipart_params={song_id:parseInt(song_id)};up.refresh();up.start();window.gUploading=true;}else{up.splice();up.refresh();$('#pickfile_'+song_id).removeAttr('disabled');alert(resp.message);}},error:function(ob,textStatus){alert(gettext('beforeupload error'));}});});album_songs_uploader[song_id].bind('BeforeUpload',function(up,file){var th_url=$('#frm_album_song_edit_check_info').attr('action');$.ajax({url:th_url,type:'POST',encoding:'UTF-8',data:'song_id='+song_id,dataType:'json',cache:false,success:function(resp){if(resp.success){up.settings.multipart_params={song_id:parseInt(song_id)};up.trigger('UploadFile',file);}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('beforeupload error'));}});return false;});album_songs_uploader[song_id].bind('Error',function(up,err){var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.splice();window.gUploading=false;$('#editsongarea_'+song_id+' .progress .bar').css('width','0%');$('#editsongarea_'+song_id+' .song_edit_td h3').text('');$('#editsongarea_'+song_id+' span#status').html('')
$('#pickfile_'+song_id).removeAttr('disabled');up.refresh();});album_songs_uploader[song_id].bind('UploadFile',function(up,file){$('#editsongarea_'+song_id+' .close').hide();$('#editsongarea_'+song_id+' .progress').show();window.gUploading=true;});album_songs_uploader[song_id].bind('UploadComplete',function(up,files){$('#editsongarea_'+song_id+' .close').show();$('#editsongarea_'+song_id+' .progress').fadeOut();window.gUploading=false;});album_songs_uploader[song_id].bind('UploadProgress',function(up,file){$('#editsongarea_'+song_id+' span#status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#editsongarea_'+song_id+' .progress .bar').css('width',file.percent+'%');if(file.percent>=100){$('#editsongarea_'+song_id+' #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');}});album_songs_uploader[song_id].bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#editsongarea_'+song_id+' #status').html(gettext('File uploaded'));$('#editsongarea_'+song_id+' .close').show();$('#editsongarea_'+song_id+' .progress').fadeOut();}else{alert(resp.message);up.splice();window.gUploading=false;$('#editsongarea_'+song_id+' .progress .bar').css('width','0%');$('#editsongarea_'+song_id+' .song_edit_td h3').text('');$('#editsongarea_'+song_id+' span#status').html('')
$('#pickfile_'+song_id).removeAttr('disabled');up.refresh();}});$('#editsongarea_'+song_id+' #albumsongedit_'+song_id).submit(function(){doSong.save('editsongarea_'+song_id);return false;});}else{alert(gettext('get song data error'));}},error:function(ob,textStatus){alert(gettext('get song data error'));}});$('#editsongarea_'+song_id+' .more').livequery('click',function(){if($('#editsongarea_'+song_id+' .more b').hasClass('caret')){$('#editsongarea_'+song_id+' #editarea').slideDown('slow',function(){$('#editsongarea_'+song_id+' .more a').html(gettext('Less')+'<b class="un_caret"></b>');});}else{$('#editsongarea_'+song_id+' #editarea').slideUp('slow',function(){$('#editsongarea_'+song_id+' .more a').html(gettext('More')+'<b class="caret"></b>');});};return false;});$('#editsongarea_'+song_id+' .close').livequery('click',function(){$('#editsongarea_'+song_id).fadeOut().remove();if($('#tbl_album_song_list .editsongarea').length>0){$(sortarea).sortable({disabled:true}).enableSelection();}else{$(sortarea).sortable({disabled:false}).disableSelection();}});}else{$('#editsongarea_'+song_id+' #id_name').focus();return false;};return false;});$('#single_song_edit_form').livequery(function(){$('#single_song_edit_area #single_song_edit_form').submit(function(e){e.preventDefault();doSong.save('single_song_edit_area');return false;});var song_id=$('#single_song_edit_form #song_id').val();var single_song_cover_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$("#upload_song_cover_url").val(),browse_button:'single_song_cover_pickfile',container:'song_cover_area',max_file_size:'10mb',chunk_size:'1mb',autostart:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});single_song_cover_uploader.init();single_song_cover_uploader.bind('FilesAdded',function(up,files){window.gUploading=true;$('#single_song_cover_pickfile').attr('disabled','disabled');$('#single_song_edit_form #frm_save').attr('disabled','disabled');$('#single_song_edit_form #frm_save').val(gettext('Updating ...'));up.start();});single_song_cover_uploader.bind('Error',function(up,err){var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.splice();up.refresh();window.gUploading=false;});single_song_cover_uploader.bind('UploadFile',function(up,file){window.gUploading=true;});single_song_cover_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){if(resp.cover_url){$('#song_cover_img').attr("src",resp.cover_url);}}
$('#single_song_cover_pickfile').removeAttr('disabled');$('#single_song_edit_form #frm_save').val(gettext('Save'));$('#single_song_edit_form #frm_save').removeAttr('disabled');window.gUploading=false;});var single_song_edit_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$('#frm_song_edit_upload').attr('action'),browse_button:'single_song_edit_pickfile',container:'single_song_uploader_container',max_file_size:'100mb',chunk_size:'1mb',autostart:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:false,multipart_params:{'song_id':parseInt(song_id),'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"audio file",extensions:"mp3"}],});single_song_edit_uploader.init();single_song_edit_uploader.bind('FilesAdded',function(up,files){$('#single_song_edit_pickfile').attr('disabled','disabled');var th_url=$('#frm_song_edit_check_info').attr('action');$.ajax({url:th_url,type:'POST',encoding:'UTF-8',data:'song_id='+song_id,dataType:'json',cache:false,success:function(resp){if(resp.success){$.each(files,function(i,file){$('#single_song_edit_area h3').text(file.name);$('#single_song_edit_area span#status').html('('+plupload.formatSize(file.size)+')'+gettext('Waiting ...'))
$('#single_song_edit_area div#song_name_area').show();});up.settings.multipart_params={song_id:parseInt(song_id)};up.refresh();up.start();window.gUploading=true;}else{$('#single_song_edit_pickfile').removeAttr('disabled');up.splice();up.refresh();alert(resp.message);}},error:function(ob,textStatus){$('#single_song_edit_pickfile').removeAttr('disabled');up.splice();up.refresh();alert(gettext('beforeupload error'));}});});single_song_edit_uploader.bind('BeforeUpload',function(up,file){});single_song_edit_uploader.bind('Error',function(up,err){var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.splice();$('#single_song_edit_area .progress .bar').css('width','0%');$('#single_song_edit_area div#progressbar_area').fadeOut();$('#single_song_edit_area h3').text('');$('#single_song_edit_area span#status').html('')
$('#single_song_edit_pickfile').removeAttr('disabled');$('#single_song_edit_area div#song_name_area').hide();up.refresh();window.gUploading=false;});single_song_edit_uploader.bind('UploadFile',function(up,file){$('#single_song_edit_area div#progressbar_area').show();$('#single_song_edit_area span#status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');window.gUploading=true;});single_song_edit_uploader.bind('UploadProgress',function(up,file){$('#single_song_edit_area #status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#single_song_edit_area .progress .bar').css('width',file.percent+'%');if(file.percent>=100){$('#single_song_edit_area #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');}});single_song_edit_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#single_song_edit_area #status').html(gettext('File uploaded'));$('#single_song_edit_area div#progressbar_area').fadeOut();$('#single_song_edit_area .close').show();}else{alert(resp.message);up.splice();up.refresh();$('#single_song_edit_area .progress .bar').css('width','0%');$('#single_song_edit_area div#progressbar_area').fadeOut();$('#single_song_edit_area h3').text('');$('#single_song_edit_area span#status').html('')
$('#single_song_edit_pickfile').removeAttr('disabled');$('#single_song_edit_area div#song_name_area').hide();}
window.gUploading=false;});});var uploader_maange={uploader_add_song:function(up,files){$.each(files,function(i,file){var edit_str=''+'<div class="well form-song_edit form-inline" id="upload_'+file.id+'">'+'<span class="close">&times;</span>'+'<div class="control-group"><h3><a id="upload_play_'+file.id+'" class="noplay" data-type="song" data="" href="#"><i class="xs_icon-play"></i></a>'+file.name+'</h3>('+plupload.formatSize(file.size)+') <span id="status" class="status-inline">'+gettext('Waiting ...')+'</span>'+'</div>'+'<div class="progress"><div class="bar"></div></div>'+'<div id="editarea" class="row" style="display:none"></div>'+'<div class="more"><a href="#">'+gettext('Less')+'<b class="un_caret"></b></a></div>'+'</div>';$(edit_str).insertBefore('#song_upload_texts')
$('#upload_'+file.id+' .more a').click(function(){if($('#upload_'+file.id+' .more b').hasClass('caret')){$('#upload_'+file.id+' #editarea').slideDown('slow',function(){$('#upload_'+file.id+' .more a').html(gettext('Less')+'<b class="un_caret"></b>');});}else{$('#upload_'+file.id+' #editarea').slideUp('slow',function(){$('#upload_'+file.id+' .more a').html(gettext('More')+'<b class="caret"></b>');});};return false;});$('#upload_'+file.id+' .more').hide();$('#upload_'+file.id+' span.close').bind('click',function(e){e.preventDefault();confirm(gettext('Cancel upload'),gettext('Are you sure to cancel this file?'),gettext('Yes'),gettext('No'),function(ret){if(!((file.status==plupload.UPLOADING)||(file.status==plupload.DONE))){if(ret){up.removeFile(file);$('#upload_'+file.id+' span.close, #upload_'+file.id+' .progress').fadeOut();$('#upload_'+file.id+' #status').html(gettext('Canceled'));};};});});});up.refresh();up.start();},uploader_album_addsong:function(up,files){$.each(files,function(i,file){var edit_str=''+'<div class="well form-song_edit form-inline" id="upload_'+file.id+'">'+'<span class="close">&times;</span>'+'<div class="control-group"><h3>'+file.name+'</h3>('+plupload.formatSize(file.size)+') <span id="status" class="status-inline">'+gettext('Waiting ...')+'</span>'+'</div>'+'<div class="progress hide"><div class="bar"></div></div>'+'<div id="editarea" class="row" style="display:none"></div>'+'<div class="more"><a href="#">'+gettext('Less')+'<b class="un_caret"></b></a></div>'+'</div>';$(edit_str).insertBefore('#song_upload_texts');$('#upload_'+file.id+' span.close').click(function(e){e.preventDefault();confirm(gettext('Cancel upload'),gettext('Are you sure to cancel this file?'),gettext('Yes'),gettext('No'),function(ret){if(!((file.status==plupload.UPLOADING)||(file.status==plupload.DONE))){if(ret){up.removeFile(file);$('#upload_'+file.id+' span.close, #upload_'+file.id+' .progress').fadeOut();$('#upload_'+file.id+' #status').html(gettext('Canceled'));};};});});$('#upload_'+file.id+' .more a').click(function(){if($('#upload_'+file.id+' .more b').hasClass('caret')){$('#upload_'+file.id+' #editarea').slideDown('slow',function(){$('#upload_'+file.id+' .more a').html(gettext('Less')+'<b class="un_caret"></b>');});}else{$('#upload_'+file.id+' #editarea').slideUp('slow',function(){$('#upload_'+file.id+' .more a').html(gettext('More')+'<b class="caret"></b>');});};return false;});$('#upload_'+file.id+' .more').hide();});up.refresh();up.start();}};$('#btn_deletesong').livequery('click',function(){var the_url=$('#frm_song_delete').attr('action');confirm(gettext('delete song'),gettext('Are you sure you want to delete this song?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:the_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){History.pushState(null,null,resp.next);}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete song error'));}});}});});$('.delete_a_song').livequery('click',function(){var rel=$(this).attr('rel');var song_id=rel.split(',')[0];var the_url=rel.split(',')[1];confirm(gettext('delete song'),gettext('Are you sure you want to delete this song?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:the_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){$('#song_'+song_id).remove();$('#editsongarea_'+song_id).remove();}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete song error'));}});}});});$('#btn_delete_album').livequery('click',function(){var the_url=$(this).attr('rel');confirm(gettext('delete album'),gettext('Are you sure you want to delete this album?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:the_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){History.pushState(null,null,resp.next);}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete song error'));}});}});});$('#indievox-purchase').livequery('click',function(){var indievox_url=$('#indievox_link').val();location.href=indievox_url;});$('.song_tag_textarea').livequery(function(){var that=this;var that_id=$(this).attr('id');$('#'+that_id).textext({enabled:true,plugins:'tags ajax autocomplete',ajax:{url:$('#song_manage_tag_user_pool_url').val(),dataType:'json',loading:{delay:0,message:gettext('Loading...')},cacheResults:false},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter',188:'comma!'},html:{tag:'<div class="text-tag"><div class="tag_box"><span class="text-label"/><a class="text-remove" style="cursor:pointer;">×</a></div></div>',hidden:'<input type="hidden" name="tags" id="id_tags" />'}});var textext=$(that).textext()[0];var has_dropdown=false;$(that).bind('showDropdown',function(e){has_dropdown=true;});$(that).bind('hideDropdown',function(e){has_dropdown=false;});$(that).bind('enterKeyUp',function(e){e.preventDefault();if(!has_dropdown){var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');}});$(that).bind('commaKeyPress',function(e){e.preventDefault();var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');});var form=$(that).parents('form.form-song-edit:first');var mytags=form.find('#mytags').children();$.each(mytags,function(){$('#'+that_id).textext()[0].tags().addTags([$(this).val()]);});});$('.form-song-edit .tag_recommend .tag_box').livequery('click',function(e){var target_area_id='id_tag_textarea_'+$(this).attr('data');e.preventDefault();var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});});$(function(){var deb={log:function(msg){if(window.console){console.log(msg);}},};var dna_uploader_manage={uploader_add_dna:function(up,files){var count=files.length;var template=$('#dna_add_template').html();$.each(files,function(i,file){var edit_str=template;edit_str=edit_str.replace(/::file_id::/g,file.id);edit_str=edit_str.replace(/::dna_file_name::/g,file.name);$(edit_str).insertBefore('#dna_upload_texts');$('#dna_'+file.id+' .more a').click(function(){if($('#dna_'+file.id+' .more b').hasClass('caret')){$('#dna_'+file.id+' #editarea').slideDown('slow',function(){$('#dna_'+file.id+' .more a').html(gettext('Less')+'<b class="un_caret"></b>');});}else{$('#dna_'+file.id+' #editarea').slideUp('slow',function(){$('#dna_'+file.id+' .more a').html(gettext('More')+'<b class="caret"></b>');});};return false;});$('#dna_'+file.id+' a.close').bind('click',function(e){e.preventDefault();var that=$(this);confirm(gettext('Cancel upload'),gettext('Are you sure to cancel this file?'),gettext('Yes'),gettext('No'),function(ret){if(!((file.status==plupload.UPLOADING)||(file.status==plupload.DONE))){if(ret){up.removeFile(file);$('#dna_'+file.id+' span.close, #dna_'+file.id+' .progress').fadeOut();$('#dna_'+file.id+' #status').html(gettext('Canceled'));that.addClass('hide');};};});});if(!--count){up.refresh();up.start();}})}};var dna_datas={};window.dna_uploader={};$('#pickdnafiles').livequery(function(){if(window.dna_upload_loaded){window.dna_uploader.unbind('FilesAdded');}else{window.dna_upload_loaded=true;}
window.dna_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$('#dna_upload_url').val(),browse_button:'pickdnafiles',container:'inside_box',max_file_size:'10mb',chunk_size:'1mb',autostart:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,drop_element:'wrapper',multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});window.dna_uploader.init();window.dna_uploader.bind('FilesAdded',function(up,files){if(window.dna_upload_flag){window.gUploading=true;dna_uploader_manage.uploader_add_dna(up,files);}});window.dna_uploader.bind('Error',function(up,err){if(window.dna_upload_flag){window.gUploading=false;var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.refresh();}});window.dna_uploader.bind('BeforeUpload',function(up,file){var url=$('#dna_create_info').val();var batch_id=$('#design_batch_id').val();dna_datas['dna_name']=file.name;dna_datas['batch_id']=batch_id;$.ajax({url:url,type:'POST',encoding:'UTF-8',data:dna_datas,dataType:'json',cache:false,success:function(resp){if(resp.success){file.dna_id=resp.dna_id;file.dna_delete_url=resp.dna_delete_url;$('#dna_'+file.id+' #editarea').append(resp.data);$('#dna_'+file.id+' #editarea').toggle('slow');$('#dna_'+file.id+' form').submit(function(){doDNA.save('dna_'+file.id);return false;});up.settings.multipart_params={dna_id:file.dna_id};up.trigger('UploadFile',file);if(!$('#batch_designs_count_show').is(":visible")){$('#batch_designs_count_show').removeClass('hide');}
if(!$('#btn_design_batch').is(":visible")){$('#btn_design_batch').removeClass('hide');}}},error:function(ob,textStatus){alert(gettext('beforeupload error'));}});return false;up.settings.multipart_params={'dna_id':file.dna_id};up.trigger('UploadFile',file);});window.dna_uploader.bind('UploadFile',function(up,file){$('#dna_'+file.id+' .close').hide();if($('#dna_'+file.id+' .more').hasClass('hide')){$('#dna_'+file.id+' .more').removeClass('hide');}
window.gUploading=true;});window.dna_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.dna_uploader.bind('UploadProgress',function(up,file){$('#dna_'+file.id+' #status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#dna_'+file.id+' .progress .bar').css('width',file.percent+'%');if(file.percent>=99){$('#dna_'+file.id+' #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');}});window.dna_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#dna_'+file.id+' #status').html(gettext('File uploaded'));$('#dna_'+file.id+' a.close, #dna_'+file.id+' .progress').hide();$('#dna_'+file.id+' #dna_img').attr('src',resp.dna_image_url);$('#batch_designs_count').text($('#batch_designs_count').text()*1+1);}else{if(file.dna_delete_url){var dna_delete_url=file.dna_delete_url;$.ajax({url:dna_delete_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){},error:function(ob,textStatus){}});}
$('#dna_'+file.id+' #status').html(resp.message);$('#dna_'+file.id+' a.close, #dna_'+file.id+' .progress').hide();$('#dna_'+file.id+' #editarea').remove();$('#dna_'+file.id+' .more').remove();}});});$('ul.dna_category li.add_category a').livequery('click',function(e){e.preventDefault();$(this).next('input').val('').show().focus();$(this).hide();return false;});$('ul.dna_category li.add_category input').livequery('blur',function(e){$(this).val('').hide();$(this).prev('a').show();});$('.form-dna_edit ul.dna_category li.add_category input').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var name=$(this).val();var design_id=$(this).attr('data');var that=$(this).closest('.dropdown ul.dna_category.dropdown-menu');var that_form=$(this).closest('form');var category_id=$('#id_category',that_form).val();$.ajax({url:$('#dna_create_category_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name,'design_id':design_id},dataType:'json',cache:false,success:function(resp){if(resp.success){if(category_id=='1'){$('.category_value',that_form).html($('.category_value',that_form).html()+', '+resp.category_name);}else{$('.category_value',that_form).html(resp.category_name);}
$('#id_category',that_form).val('1');var selected_str=$('#dna_add_category_selected_template').html();selected_str=selected_str.replace(/::category_id::/g,resp.category_id);selected_str=selected_str.replace(/::category_name::/g,resp.category_name);selected_str=selected_str.replace(/::design_id::/g,design_id);var unselected_str=$('#dna_add_category_unselected_template').html();var template='';$('.dropdown ul.dna_category.dropdown-menu').each(function(){var this_data=$(this).attr('data');if(this_data===design_id){template=selected_str;}else{unselected_str=unselected_str.replace(/::category_id::/g,resp.category_id);unselected_str=unselected_str.replace(/::category_name::/g,resp.category_name);unselected_str=unselected_str.replace(/::design_id::/g,$(this).attr('data'));template=unselected_str;}
$('li:last',this).before(template);});}},error:function(ob,textStatus){},});$(this).val('');$(this).hide();$(this).prev('a').show();that.scrollTop(0);}});$('.form-dna_edit .dna_category a.category_item').livequery('click',function(e){e.preventDefault();var that=$(this);var url=that.attr('href');if(url.search('add')==-1){re_url=url.replace('remove','add');}else{re_url=url.replace('add','remove');}
$.ajax({url:url,type:'POST',encoding:'UTF-8',dataType:'json',cache:false,success:function(resp){if(resp.success){if(re_url.search('add')==-1){$('i',that).removeClass().addClass('s_icon-sub');}else{$('i',that).removeClass().addClass('s_icon-none');}
that.attr('href',re_url);var that_form=that.parents().closest('form');that_form.find('.category_value').html('');that_form.find('.dna_category').find('i[class="s_icon-sub"]').each(function(){if(that_form.find('.category_value').html()==''){that_form.find('.category_value').html($(this).parent().text());}else{that_form.find('.category_value').html(that_form.find('.category_value').html()+', '+$(this).parent().text());}});if(that_form.find('.category_value').html()==''){that_form.find('.category_value').html(gettext('Please select design subject'));that_form.find('#id_category').val('');}else{that_form.find('#id_category').val('1');}}else{alert(resp.message);}},error:function(ob,textStatus){},});return false;});$('.dna_tag_textarea').livequery(function(){var that=this;var that_id=$(this).attr('id');$('#'+that_id).textext({enabled:true,plugins:'tags ajax autocomplete',ajax:{url:$('#dna_manage_tag_user_pool_url').val(),dataType:'json',loading:{delay:0,message:gettext('Loading...')},cacheResults:false},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter',188:'comma!'},html:{tag:'<div class="text-tag"><div class="tag_box"><span class="text-label"/><a class="text-remove" style="cursor:pointer;">×</a></div></div>',hidden:'<input type="hidden" name="tags[]" id="id_tags" />'}});var textext=$(that).textext()[0];var has_dropdown=false;$(that).bind('showDropdown',function(e){has_dropdown=true;});$(that).bind('hideDropdown',function(e){has_dropdown=false;});$(that).bind('enterKeyUp',function(e){e.preventDefault();if(!has_dropdown){var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');}});$(that).bind('commaKeyPress',function(e){e.preventDefault();var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');});var form=$(that).parents('form.form-dna_edit:first');var mytags=form.find('#mytags').children();$.each(mytags,function(){$('#'+that_id).textext()[0].tags().addTags([$(this).val()]);});});$('.form-dna_edit .tag_recommend .tag_box').livequery('click',function(e){var target_area_id='id_tag_textarea_'+$(this).attr('data');e.preventDefault();var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});$('form.form-dna_edit input.dna-info-save').livequery('click',function(e){$('.boboerror').remove();var that=$(this);var form=$(this).parents('form.form-dna_edit:first');var name=form.find('#id_name').val();var synopsis=form.find('#id_synopsis').val();var tags=eval(form.find('#id_tags').val());var status=form.find('#id_status').val();var creative_commons=form.find('#id_creative_commons').val();var datas={'name':name,'synopsis':synopsis,'tags':tags,'status':status,'creative_commons':creative_commons};var url=form.attr('action');form.find('#id_name').val($.trim(form.find('#id_name').val()));if(form.find('#id_name').val()==''){alert(gettext('title can not be empty.'));return false;}
that.attr('disabled','disabled');that.val(gettext('Updating ...'));$.ajax({url:url,type:'POST',encoding:'UTF-8',data:datas,dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Save done'),{'life':800,'speed':'fast'});that.val(gettext('Saved'));}else{var errors=resp.errors;if(errors){var app_str='';for(var field in errors){if(errors[field].length>0){app_str='<span class="help-inline alert-error boboerror"><i class="s_icon-error"></i>'+errors[field][0]+'</span>';$('.form-dna_edit #id_'+field).parent().find('.help-inline').remove();$('.form-dna_edit #id_'+field).parent().append(app_str);};};};}},error:function(ob,textStatus){$.jGrowl(gettext('update data error'),{'life':800,'speed':'fast'});},complete:function(){setTimeout(function(){that.val(gettext('Save'));that.removeAttr('disabled');},1200);}});return false;});$('form.form-dna_edit input.btn-delete').livequery('click',function(e){e.preventDefault();var url=$(this).attr('data');confirm(gettext('delete dna'),gettext('Are you sure you want to delete this design work?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){History.pushState(null,null,resp.next);}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete design error'));}});}});});$('#btn_batch_designs').livequery('click',function(){var that=$(this);var form=$('#form-dna_batch');var categories=$('#id_categories',form).val();var tags=eval($('#id_tags',form).val());var status=$('#id_status',form).val();var creative_commons=$('#id_creative_commons',form).val();var batch_id=$('#batch_id',form).val();var datas={'tags':tags,'status':status,'creative_commons':creative_commons,'categories':categories,'batch_id':batch_id};var url=form.attr('action');that.attr('disabled','disabled');$.ajax({url:url,type:'POST',data:datas,encoding:'UTF-8',dataType:'json',cache:false,success:function(resp){if(resp.success){dna_datas['categories']=categories;dna_datas['tags']=tags;dna_datas['status']=status;dna_datas['cc']=creative_commons;$('form.form-dna_edit span.category_value').html($('#form-dna_batch span.category_value').html());$('form.form-dna_edit a.category_item').find('i[class="s_icon-sub"]').each(function(){$(this).removeClass().addClass('s_icon-none');$(this).parent().attr('href',$(this).parent().attr('href').replace('remove','add'));});if(categories){var new_categories=new Array();var new_categories_id=categories.split(',');for(i=0;i<=new_categories_id.length-1;i++){new_categories[i]='category-'+new_categories_id[i];}
$('form.form-dna_edit a.category_item i').not('.s_icon-sub').each(function(){if($.inArray($(this).parent().attr('id'),new_categories)!=-1){$(this).removeClass().addClass('s_icon-sub');$(this).parent().attr('href',$(this).parent().attr('href').replace('add','remove'));}});}
if(tags){$('form.form-dna_edit .text-tags').html('');$('form.form-dna_edit #id_tags').val('');for(i=0;i<=tags.length-1;i++){$('form.form-dna_edit .dna_tag_textarea').each(function(){$(this).textext()[0].tags().addTags([tags[i]]);});}}
$('form.form-dna_edit #id_status').val(status);$('form.form-dna_edit #id_creative_commons').val(creative_commons);$('form.form-dna_edit #id_category').val('1');alert(resp.message);$('#myModal').modal('hide');}else{alert(resp.message);that.removeAttr('disabled');}},error:function(ob,textStatus){alert(gettext('error'));}});return false;});$('#form-dna_batch .dna_category a.category_item').livequery('click',function(e){e.preventDefault();var that_form=$(this).closest('form');$('#id_categories',that_form).val('');$('.category_value',that_form).html('');if($('i',this).is('.s_icon-sub')){$('i',this).removeClass('s_icon-sub').addClass('s_icon-none');}else{$('i',this).removeClass('s_icon-none').addClass('s_icon-sub');}
$('a.category_item i.s_icon-sub',that_form).each(function(){if($('.category_value',that_form).html()==''){$('.category_value',that_form).html($(this).parent().text());}else{$('.category_value',that_form).html($('.category_value',that_form).html()+', '+$(this).parent().text());}
if($('#id_categories',that_form).val()==''){$('#id_categories',that_form).val($(this).parent().attr('id').replace('category-',''));}else{$('#id_categories',that_form).val($('#id_categories',that_form).val()+','+$(this).parent().attr('id').replace('category-',''));}});if($('.category_value',that_form).html()==''){$('.category_value',that_form).html(gettext('Please select design subject'));}
return false;});$('#form-dna_batch .tag_recommend .tag_box').livequery('click',function(e){e.preventDefault();var target_area_id='id_tag_textarea_'+$(this).attr('data');var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});$('#form-dna_batch ul.dna_category li.add_category input').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var name=$(this).val();var batch_id=$(this).attr('data');var that=$(this).closest('.dropdown ul.dna_category.dropdown-menu');var that_form=$(this).closest('form');var categories_id=$('#id_categories',that_form).val();$.ajax({url:$('#dna_create_category_batch_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name},dataType:'json',cache:false,success:function(resp){if(resp.success){if(categories_id==''){$('#id_categories',that_form).val(resp.category_id);$('.category_value',that_form).html(resp.category_name);}else{$('#id_categories',that_form).val($('#id_categories',that_form).val()+','+resp.category_id);$('.category_value',that_form).html($('.category_value',that_form).html()+', '+resp.category_name);}
var selected_str=$('#dna_add_category_selected_template').html();selected_str=selected_str.replace(/::category_id::/g,resp.category_id);selected_str=selected_str.replace(/::category_name::/g,resp.category_name);selected_str=selected_str.replace(/::design_id::/g,batch_id);$('.dna_category',that_form).prepend(selected_str);$('form.form-dna_edit').each(function(){var unselected_str=$('#dna_add_category_unselected_template').html();var this_design=$('a.category_item',this).attr('data');unselected_str=unselected_str.replace(/::category_id::/g,resp.category_id);unselected_str=unselected_str.replace(/::category_name::/g,resp.category_name);unselected_str=unselected_str.replace(/::design_id::/g,this_design);$('.dna_category',this).prepend(unselected_str);});}else{alert(resp.message);}},error:function(ob,textStatus){},});$(this).val('');$(this).hide();$(this).prev('a').show();that.scrollTop(0);}});});$(function(){var photo_uploader_manage={uploader_add_photo:function(up,files){var count=files.length;var template=$('#photo_add_template').html();$.each(files,function(i,file){var edit_str=template;edit_str=edit_str.replace(/::file_id::/g,file.id);edit_str=edit_str.replace(/::photo_file_name::/g,file.name);$(edit_str).insertBefore('#photo_upload_texts');$('#photo_'+file.id+' .more a').click(function(){if($('#photo_'+file.id+' .more b').hasClass('caret')){$('#photo_'+file.id+' #editarea').slideDown('slow',function(){$('#photo_'+file.id+' .more a').html(gettext('Less')+'<b class="un_caret"></b>');});}else{$('#photo_'+file.id+' #editarea').slideUp('slow',function(){$('#photo_'+file.id+' .more a').html(gettext('More')+'<b class="caret"></b>');});};return false;});$('#photo_'+file.id+' a.close').bind('click',function(e){e.preventDefault();var that=$(this);confirm(gettext('Cancel upload'),gettext('Are you sure to cancel this file?'),gettext('Yes'),gettext('No'),function(ret){if(!((file.status==plupload.UPLOADING)||(file.status==plupload.DONE))){if(ret){up.removeFile(file);$('#photo_'+file.id+' span.close, #photo_'+file.id+' .progress').fadeOut();$('#photo_'+file.id+' #status').html(gettext('Canceled'));that.addClass('hide');};};});});if(!--count){up.refresh();up.start();}})}};var doPhoto={save:function(area_id){var $form=$('#'+area_id+' form');if($.trim($('#'+area_id+' #id_name').val())==''){alert(gettext('photo name cannot empty'));return false;};$('#'+area_id+' form #frm_save').attr('disabled','disabled');$('#'+area_id+' form #frm_save').val(gettext('Updating ...'));$('#'+area_id+' form .boboerror').remove();var name=$form.find('#id_name').val();var description=$form.find('#id_description').val();var area=$form.find('#id_area').val();var permission=$form.find('#id_permission').val();var creative_commons=$form.find('#id_creative_commons').val();var $tag_textarea=$('#'+area_id+' .photo_tag_textarea');var textext=$tag_textarea.textext()[0];var tags=textext.tags()._formData;var form_url=$form.attr('action');var form_data={'name':name,'description':description,'tags':tags,'area':area,'permission':permission,'creative_commons':creative_commons};$.ajax({url:form_url,type:'POST',encoding:'UTF-8',data:form_data,dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Save done'),{'life':800,'speed':'fast'});$('#'+area_id+' form #frm_save').val(gettext('Saved'));$('#album_edit_photo_list #photo_'+resp.photo_id+' .album_sort_photo_name').text(resp.photo_name);setTimeout(function(){$('#'+area_id+' form #frm_save').val(gettext('Save'));$('#'+area_id+' form #frm_save').removeAttr('disabled');},1200);}else{$('#'+area_id+' form #frm_save').val(gettext('Save'));$('#'+area_id+' form #frm_save').removeAttr('disabled');var errors=resp.errors;if(errors){alert(errors);var app_str='';for(var field in errors){if(errors[field].length>0){app_str='<span class="help-inline alert-error boboerror"><i class="s_icon-error"></i>'+errors[field][0]+'</span>';$('#'+area_id+' form #id_'+field).parent().find('.help-inline').remove();$('#'+area_id+' form #id_'+field).parent().append(app_str);};};};};},});return false;},isuploading:false,};var photos_datas={};window.photo_uploader={};$('#pickphotofiles').livequery(function(){if(window.photo_upload_loaded){window.photo_uploader.unbind('FilesAdded');}else{window.photo_upload_loaded=true;}
window.photo_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:$('#photo_upload_url').val(),browse_button:'pickphotofiles',container:'inside_box',max_file_size:'10mb',chunk_size:'1mb',autostart:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,drop_element:'wrapper',multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});window.photo_uploader.init();window.photo_uploader.bind('FilesAdded',function(up,files){if(window.photo_upload_flag){window.gUploading=true;photo_uploader_manage.uploader_add_photo(up,files);}});window.photo_uploader.bind('Error',function(up,err){if(window.photo_upload_flag){var message=gettext('File upload error, Please choose file to upload again.');alert(message);window.gUploading=false;up.refresh();}});window.photo_uploader.bind('BeforeUpload',function(up,file){var url=$('#photo_create_info').val();var batch_id=$('#photo_batch_id').val();photos_datas['photo_name']=file.name
photos_datas['batch_id']=batch_id
$.ajax({url:url,type:'POST',encoding:'UTF-8',data:photos_datas,dataType:'json',cache:false,success:function(resp){if(resp.success){file.photo_id=resp.photo_id;file.photo_delete_url=resp.delete_photo_url;up.settings.multipart_params={photo_id:file.photo_id};$('#photo_'+file.id+' #editarea').append(resp.data);$('#photo_'+file.id+' #editarea').toggle('slow');$('#photo_'+file.id+' form #frm_save').livequery('click',function(){doPhoto.save('photo_'+file.id);});up.trigger('UploadFile',file);if(!$('#batch_photos_count_show').is(":visible")){$('#batch_photos_count_show').removeClass('hide');}
if(!$('#btn_photo_batch').is(':visible')){$('#btn_photo_batch').removeClass('hide');}}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('beforeupload error'));}});return false;up.settings.multipart_params={'photo_id':file.photo_id};up.trigger('UploadFile',file);});window.photo_uploader.bind('UploadFile',function(up,file){$('#photo_'+file.id+' .close').hide();if($('#photo_'+file.id+' .more').hasClass('hide')){$('#photo_'+file.id+' .more').removeClass('hide');}
window.gUploading=true;});window.photo_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.photo_uploader.bind('UploadProgress',function(up,file){$('#photo_'+file.id+' #status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#photo_'+file.id+' .progress .bar').css('width',file.percent+'%');if(file.percent>=99){$('#photo_'+file.id+' #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');};});window.photo_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#photo_'+file.id+' #status').html(gettext('Upload is complete'));$('#photo_'+file.id+' a.close, #photo_'+file.id+' .progress').hide();$('#photo_'+file.id+' #photo_img').attr('src',resp.photo_image_url);$('#batch_photos_count').text($('#batch_photos_count').text()*1+1);}else{var photo_delete_url=file.photo_delete_url;$.ajax({url:photo_delete_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){},error:function(ob,textStatus){}});var message=gettext('File upload error, Please choose file to upload again.');$('#photo_'+file.id+' #status').html(message);$('#photo_'+file.id+' a.close, #photo_'+file.id+' .progress').hide();$('#photo_'+file.id+' #editarea').remove();$('#photo_'+file.id+' .more').remove();}});})
$('ul.photo_album li.add_album a').livequery('click',function(e){e.preventDefault();$(this).next('input').val('').show().focus();$(this).hide();return false;});$('ul.photo_album li.add_album input').livequery('blur',function(){$(this).val('').hide();$(this).prev('a').show();});$('.form-photo_edit ul.photo_album li.add_album input').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var that_form=$(this).closest('form');var this_form_index=$('form.form-photo_edit').index(that_form);var name=$(this).val();var photo_id=$('#photo_id',that_form).val();var photoalbum_id=$('#id_newalbum',that_form).val();var that=$(this).closest('.dropdown ul.photo_album.dropdown-menu');$.ajax({url:$('#photo_create_album_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name,'photo_id':photo_id},dataType:'json',cache:false,success:function(resp){if(resp.success){$('#id_newalbum',that_form).val('1');if(photoalbum_id=='1'){$('.album_value',that_form).html($('.album_value',that_form).html()+', '+resp.album_name);}else{$('.album_value',that_form).html(resp.album_name);}
var selected_str=$('#photo_add_album_selected_template').html();selected_str=selected_str.replace(/::album_id::/g,resp.album_id);selected_str=selected_str.replace(/::album_name::/g,resp.album_name);selected_str=selected_str.replace(/::photo_id::/g,photo_id);$('.photo_album',that_form).prepend(selected_str);$('form.form-photo_edit').not(':eq('+this_form_index+')').each(function(){var noselected_str='';noselected_str=$('#photo_add_album_noselected_template').html();noselected_str=noselected_str.replace(/::album_id::/g,resp.album_id);noselected_str=noselected_str.replace(/::album_name::/g,resp.album_name);noselected_str=noselected_str.replace(/::photo_id::/g,$(this).find('#photo_id').val());$(this).find('.photo_album').prepend(noselected_str);});}},error:function(ob,textStatus){},});$(this).val('');$(this).hide();$(this).prev('a').show();that.scrollTop(0);}});$('.dropdown-toggle').livequery('click',function(){$('.add_album a').show();$('.add_album input').val('').hide();});$('.form-photo_edit .photo_album a.album_item').livequery('click',function(e){e.preventDefault();var that=$(this);var url=that.attr('href');if(url.search('add')==-1)
re_url=url.replace('remove','add');else
re_url=url.replace('add','remove');$.get(url,function(response){if(response.success){if(re_url.search('add')==-1){$('i',that).removeClass().addClass('s_icon-sub');}else{$('i',that).removeClass().addClass('s_icon-none');}
that.attr('href',re_url);var that_form=that.closest('form');that_form.find('.album_value').html('');that_form.closest('form').find('.photo_album').find('i[class="s_icon-sub"]').each(function(){if(that_form.find('.album_value').html()==''){that_form.find('.album_value').html($(this).parent().text());}else{that_form.find('.album_value').html(that_form.find('.album_value').html()+', '+$(this).parent().text());}});if(that_form.find('.album_value').html()==''){that_form.find('.album_value').html(gettext('Please choose the album'));that_form.find('#id_newalbum').val('');}else{that_form.find('#id_newalbum').val('1');}}});return false;});$('#frm_save','#photo-edit_form').livequery('click',function(e){e.preventDefault();var that=$(this);that.attr('disabled','disabled');that.val(gettext('Updating ...'));doPhoto.save('single_photo_edit_area');});$('.form-photo_edit .btn-delete').livequery('click',function(e){e.preventDefault();var url=$(this).attr('data');confirm(gettext('Delete photo'),gettext('Are you sure to delete the photo?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){History.pushState(null,null,resp.next);}
else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('Delete photo error'));}});}})});$('.menu_list_box').hide();$('a.menu_btn').live('click',function(){$($(this).next('.menu_list_box')).slideToggle();});$('.item').hover(function(){$('.hide',this).toggle();});$('.form-photo_album_edit .btn-primary').livequery('click',function(e){e.preventDefault();var name=$('#id_name').val();var description=$('#id_description').val();if(name==''){alert(gettext('name can not be null'));return false;}
if(description==''){alert(gettext('description can not be null'));return false;}
var url=$('.form-photo_album_edit').attr('action');$.ajax({url:url,type:'POST',encoding:'UTF-8',data:$('.form-photo_album_edit').serialize(),dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Save done'),{'life':800,'speed':'fast'});}else{$.jGrowl(resp.message,{'life':800,'speed':'fast'});}},error:function(ob,textStatus){alert(gettext('error'));}});});$('.album-permission').livequery('click',function(e){e.preventDefault();var url=$(this).attr('data');$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){$.jGrowl(resp.message,{'life':800,'speed':'fast'});},error:function(ob,textStatus){alert(gettext('error'));}});});$('.album-delete').livequery('click',function(e){e.preventDefault();var url=$(this).attr('data');confirm(gettext('Delete album'),gettext('Are you sure to delete this album?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.status){History.pushState(null,null,resp.next);}
else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete album error'));}});}})});$('.album-choose').livequery('click',function(e){e.preventDefault();});$('.set-album-cover').livequery('click',function(e){var url=$(this).attr('data');$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){$.jGrowl(resp.message,{'life':800,'speed':'fast'})},error:function(ob,textStatus){alert(gettext('error'));}});});$('.form-photo_edit_s .photo-delete').livequery('click',function(e){e.preventDefault();var that=$(this);var url=$(this).attr('data');confirm(gettext('Delete photo'),gettext('Are you sure to delete the photo?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(resp.message,{'life':800,'speed':'fast'})
that.parents('.form-photo_edit_s').remove();}
else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete photo error'));}});}});});$('#album_choose').livequery('click',function(e){e.preventDefault();var that=$(this);var url=$('.form-photo_album_choose').attr('action');var form_datas=$('.form-photo_album_choose').serialize();$.ajax({url:url,type:'POST',data:form_datas,encoding:'UTF-8',dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(resp.message,{'life':800,'speed':'fast'});$('#photo-album'+resp.photo_id).remove();$('#myModal').modal('hide');}else{$.jGrowl(resp.message,{'life':800,'speed':'fast'});$('#myModal').modal('hide');}},error:function(ob,textStatus){alert(gettext('error'));$('#myModal').modal('hide');}});});$('#photo_set_tags').livequery('click',function(e){e.preventDefault();var new_tags=$('.tag_controls .tag_box .tag_name').text();var input_tag=jQuery.trim($('#tag_text').val());if(input_tag.indexOf(' ')!=-1){input_tag=input_tag.replace(/""/g,'"');}
$('#id_tags').val(new_tags+input_tag);var url=$('.form-photo_set_tags').attr('action');var tags=$('#id_tags').val();$.ajax({url:url,type:'POST',data:'tags='+tags,encoding:'UTF-8',dataType:'json',cache:false,success:function(resp){$.jGrowl(resp.message,{'life':800,'speed':'fast'});$('#myModal').modal('hide');},error:function(ob,textStatus){alert(gettext('error'));$('#myModal').modal('hide');}});});$('.form-photo_edit .tag_recommend .tag_box').livequery('click',function(e){e.preventDefault();var that_form=$(this).closest('form');var old_tags=that_form.find('#id_tags').val();old_tags=jQuery.trim(old_tags);var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
that_form.find('#id_tags').val(old_tags+' '+new_tag);that_form.find('.tag_controls').prepend('<span class="tag_box"><span class="tag_name">'+new_tag+' </span><a class="close_btn" href="#">×</a></span>');return false;});$('.form-photo_edit .tag_controls .close_btn').livequery('click',function(){$(this).parent().remove();var that=$(this).closest('form');var new_tags=that.find('.tag_controls .tag_box .tag_name').text();that.find('#id_tags').val(new_tags);return false;});$('#form-photos_batch a.album_item').livequery('click',function(e){e.preventDefault();var that_form=$(this).closest('form');$('#id_albums',that_form).val('');$('.album_value',that_form).html('');if($('i',this).is('.s_icon-sub')){$('i',this).removeClass('s_icon-sub').addClass('s_icon-none');}else{$('i',this).removeClass('s_icon-none').addClass('s_icon-sub');}
$('a.album_item',that_form).find('i[class="s_icon-sub"]').each(function(){if($('.album_value',that_form).html()==''){$('.album_value',that_form).html($(this).parent().text());}else{$('.album_value',that_form).html($('.album_value',that_form).html()+', '+$(this).parent().text());}
if($('#id_albums',that_form).val()==''){$('#id_albums',that_form).val($(this).parent().attr('id').replace('album-',''));}else{$('#id_albums',that_form).val($('#id_albums',that_form).val()+','+$(this).parent().attr('id').replace('album-',''));}});if($('.album_value',that_form).html()==''){$('.album_value',that_form).html(gettext('Please choose the album'));}
return false;});$('#btn_batch_photos').livequery('click',function(){var that=$(this);var form=$('#form-photos_batch');var url=form.attr('action');var albums=$('#id_albums',form).val();var tags=eval($('#id_tags',form).val());var area=$('#id_area',form).val();var permission=$('#id_permission',form).val();var creative_commons=$('#id_creative_commons',form).val();var batch_id=$('#batch_id',form).val();var datas={'id_albums':albums,'tags':tags,'area':area,'permission':permission,'creative_commons':creative_commons,'batch_id':batch_id};that.attr('disabled','disabled');that.val(gettext('Updating ...'));$.ajax({url:url,type:'POST',data:datas,encoding:'UTF-8',dataType:'json',cache:false,success:function(resp){if(resp.success){photos_datas['albums_id']=albums;photos_datas['tags']=tags;photos_datas['area']=area;photos_datas['status']=permission;photos_datas['cc']=creative_commons;$('form.form-photo_edit span.album_value').html($('#form-photos_batch span.album_value').html());$('form.form-photo_edit a.album_item').find('i[class="s_icon-sub"]').each(function(){$(this).removeClass().addClass('s_icon-none');$(this).parent().attr('href',$(this).parent().attr('href').replace('remove','add'));});if(albums){var new_albums=new Array();var new_albums_id=albums.split(',');for(i=0;i<=new_albums_id.length-1;i++){new_albums[i]='album-'+new_albums_id[i];}
$('form.form-photo_edit a.album_item i').not('.s_icon-sub').each(function(){if($.inArray($(this).parent().attr('id'),new_albums)!=-1){$(this).removeClass().addClass('s_icon-sub');$(this).parent().attr('href',$(this).parent().attr('href').replace('add','remove'));}});}
if(tags){$('form.form-photo_edit .text-tags').html('');$('form.form-photo_edit #id_tags').val('');for(i=0;i<=tags.length-1;i++){$('form.form-photo_edit .photo_tag_textarea').each(function(){$(this).textext()[0].tags().addTags([tags[i]]);});}}
$('form.form-photo_edit #id_area').val(area);$('form.form-photo_edit #id_permission').val(permission);$('form.form-photo_edit #id_creative_commons').val(creative_commons);$('form.form-photo_edit #id_newalbum').val('1');alert(resp.message);$('#myModal').modal('hide');}else{alert(resp.message);that.removeAttr('disabled');}},error:function(ob,textStatus){alert(gettext('error'));}});return false;});$('#form-photos_batch .tag_recommend .tag_box').livequery('click',function(e){e.preventDefault();var target_area_id='id_tag_textarea_'+$(this).attr('data');var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});$('#form-photos_batch .tag_controls .close_btn').livequery('click',function(){$(this).parent().remove();var that=$(this).closest('form');var new_tags=that.find('.tag_controls .tag_box .tag_name').text();that.find('#id_tags').val(new_tags);return false;});$('#form-photos_batch ul.photo_album li.add_album input').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var that_form=$(this).closest('form');var name=$(this).val();var batch_id=$('#batch_id',that_form).val();var id_albums=$('#id_albums',that_form).val();var that=$(this).closest('.dropdown ul.photo_album.dropdown-menu');$.ajax({url:$('#batch_create_album_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name},dataType:'json',cache:false,success:function(resp){if(resp.success){if(id_albums==''){$('#id_albums',that_form).val(resp.album_id);$('.album_value',that_form).html(resp.album_name);}else{$('#id_albums',that_form).val($('#id_albums',that_form).val()+','+resp.album_id);$('.album_value',that_form).html($('.album_value',that_form).html()+', '+resp.album_name);}
var selected_str=$('#batch_add_album_selected_template').html();selected_str=selected_str.replace(/::album_id::/g,resp.album_id);selected_str=selected_str.replace(/::album_name::/g,resp.album_name);selected_str=selected_str.replace(/::batch_id::/g,batch_id);$('.photo_album',that_form).prepend(selected_str);$('form.form-photo_edit').each(function(){var photo_unselected_str=$('#batch_add_album_unselected_template').html();var this_photo=$('a.album_item',this).attr('data');photo_unselected_str=photo_unselected_str.replace(/::album_id::/g,resp.album_id);photo_unselected_str=photo_unselected_str.replace(/::album_name::/g,resp.album_name);photo_unselected_str=photo_unselected_str.replace(/::batch_id::/g,this_photo);$('.photo_album',this).prepend(photo_unselected_str);});}else{alert(resp.message);}},error:function(ob,textStatus){},});$(this).val('');$(this).hide();$(this).prev('a').show();that.scrollTop(0);}});$('.photo_tag_textarea').livequery(function(){var that=this;var that_id=$(this).attr('id');$('#'+that_id).textext({enabled:true,plugins:'tags ajax autocomplete',ajax:{url:$('#photo_manage_tag_user_pool_url').val(),dataType:'json',loading:{delay:0,message:gettext('Loading...')},cacheResults:false},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter',188:'comma!'},html:{tag:'<div class="text-tag"><div class="tag_box"><span class="text-label"/><a class="text-remove" style="cursor:pointer;">×</a></div></div>',hidden:'<input type="hidden" name="tags" id="id_tags" />'}});var textext=$(that).textext()[0];var has_dropdown=false;$(that).bind('showDropdown',function(e){has_dropdown=true;});$(that).bind('hideDropdown',function(e){has_dropdown=false;});$(that).bind('enterKeyUp',function(e){e.preventDefault();if(!has_dropdown){var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');}});$(that).bind('commaKeyPress',function(e){e.preventDefault();var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');});var form=$(that).parents('form.form-photo_edit:first');var mytags=form.find('#mytags').children();$.each(mytags,function(){$('#'+that_id).textext()[0].tags().addTags([$(this).val()]);});});$('.form-photo_edit .tag_recommend .tag_box').livequery('click',function(e){var target_area_id='id_tag_textarea_'+$(this).attr('data');e.preventDefault();var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});});$(function(){var video_uploader_manage={uploader_add_video:function(up,files){var count=files.length;var template=$('#video_add_template').html();$.each(files,function(i,file){var edit_str=template;edit_str=edit_str.replace(/::file_id::/g,file.id);edit_str=edit_str.replace(/::video_file_name::/g,file.name);$(edit_str).insertBefore('#video_upload_texts');$('#video_'+file.id+' .more a').click(function(){if($('#video_'+file.id+' .more b').hasClass('caret')){$('#video_'+file.id+' #editarea').slideDown('slow',function(){$('#video_'+file.id+' .more a').html(gettext('Less')+'<b class="un_caret"></b>');});}else{$('#video_'+file.id+' #editarea').slideUp('slow',function(){$('#video_'+file.id+' .more a').html(gettext('More')+'<b class="caret"></b>');});};return false;});$('#video_'+file.id+' a.close').bind('click',function(e){e.preventDefault();var that=$(this);confirm(gettext('Cancel upload'),gettext('Are you sure to cancel this file?'),gettext('Yes'),gettext('No'),function(ret){if(!((file.status==plupload.UPLOADING)||(file.status==plupload.DONE))){if(ret){up.removeFile(file);$('#video_'+file.id+' span.close, #video_'+file.id+' .progress').fadeOut();$('#video_'+file.id+' #status').html(gettext('Canceled'));that.addClass('hide');};};});});if(!--count){up.refresh();up.start();}})}};var doVideo={save:function(area_id){if($.trim($('#'+area_id+' #id_name').val())==''){alert(gettext('video name cannot empty'));return false;};$('#'+area_id+' form #frm_save').attr('disabled','disabled');$('#'+area_id+' form #frm_save').val(gettext('Updating ...'));$('#'+area_id+' form .boboerror').remove();var $form=$('form','#'+area_id+'');var form_data=$form.serializeObject();var $tag_textarea=$('.video_tag_textarea',$form);var textext=$tag_textarea.textext()[0];var tags=textext.tags()._formData;form_data.tags=tags;var form_url=$form.attr('action');$.ajax({url:form_url,type:'POST',encoding:'UTF-8',data:form_data,dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Save done'),{'life':800,'speed':'fast'});$('#'+area_id+' form #frm_save').val(gettext('Saved'));$('#album_edit_video_list #video_'+resp.video_id+' .album_sort_video_name').text(resp.video_name);setTimeout(function(){$('#'+area_id+' form #frm_save').val(gettext('Save'));$('#'+area_id+' form #frm_save').removeAttr('disabled');},1200);}else{$('#'+area_id+' form #frm_save').val(gettext('Save'));$('#'+area_id+' form #frm_save').removeAttr('disabled');var errors=resp.errors;if(errors){var app_str='';for(var field in errors){if(errors[field].length>0){app_str='<span class="help-inline alert-error boboerror"><i class="s_icon-error"></i>'+errors[field][0]+'</span>';$('#'+area_id+' form #id_'+field).parent().find('.help-inline').remove();$('#'+area_id+' form #id_'+field).parent().append(app_str);};};};};},});return false;},isuploading:false,};var PLUPLOAD_MULTIPART_PARAMS_S3={'acl':'public-read','Content-Type':'audio/wav','AWSAccessKeyId':'AKIAJNPPNTPWBPTF2XPA','success_action_status':'201'};window.video_uploader={};$('#pickvideofiles').livequery(function(){if(window.video_upload_loaded){window.video_uploader.unbind('FilesAdded');}
else{window.video_upload_loaded=true;}
var s3_upload_endpoint=$('#s3_upload_endpoint').val();window.video_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:s3_upload_endpoint,container:'inside_box',browse_button:'pickvideofiles',drop_element:'wrapper',autostart:false,multipart:true,multi_selection:true,max_file_size:'1024mb',flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',filters:[{title:'video file',extensions:'avi,dv,mov,qt,mpeg,mp4,vob,asf,wmv,flv,rm,rmvb'}],});window.video_uploader.init();window.video_uploader.bind('FilesAdded',function(up,files){if(window.video_upload_flag){if(!$('#confirm').attr('checked')){confirm(gettext('Confirm rights'),gettext('Please confirm that you or your band own the rights and agreed with the license of StreetVoice. Confirm correct, check the checkbox?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$('#confirm').attr('checked','checked');$('#confirm').attr('disabled',true);video_uploader_manage.uploader_add_video(up,files);}else{up.splice();up.refresh();};});}
else{$('#confirm').attr('disabled',true);video_uploader_manage.uploader_add_video(up,files);};}});window.video_uploader.bind('BeforeUpload',function(up,file){var file_extension=file.name.split('.').pop();var s3_key='video_source/'+file.id+'.'+file_extension;var s3_upload_policy=$('#s3_upload_policy').val();var s3_upload_signature=$('#s3_upload_signature').val();var params=$.extend({'policy':s3_upload_policy,'signature':s3_upload_signature},PLUPLOAD_MULTIPART_PARAMS_S3);params.key=s3_key;params.Filename=s3_key;up.settings.multipart_params=params;var url=$('#video_create_info').val();$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'video_name='+encodeURIComponent(file.name),dataType:'json',cache:false,success:function(resp){if(resp.success){file.video_id=resp.video_id;file.video_delete_url=resp.delete_new_video_url;$('#video_'+file.id+' #editarea').append(resp.data);$('#video_'+file.id+' #editarea').toggle('slow');$('#video_'+file.id+' form #frm_save').livequery('click',function(){doVideo.save('video_'+file.id);});up.trigger('UploadFile',file);}
else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('beforeupload error'));}});return false;});window.video_uploader.bind('UploadFile',function(up,file){$('#video_'+file.id+' .close').hide();if($('#video_'+file.id+' .more').hasClass('hide')){$('#video_'+file.id+' .more').removeClass('hide');}
window.gUploading=true;});window.video_uploader.bind('UploadProgress',function(up,file){$('#video_'+file.id+' #status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#video_'+file.id+' .progress .bar').css('width',file.percent+'%');if(file.percent>=100){$('#video_'+file.id+' #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');};});window.video_uploader.bind('FileUploaded',function(up,file,response){var xml_doc=$.parseXML(response.response);var file_path=$(xml_doc).find('Key').text();var video_id=file.video_id;var $video_form=$('#video_'+video_id);var url=$('#video_update_file_path_url',$video_form).val();var post_data={'file_path':file_path,'file_size':file.size,'s3_response':response.response};$.ajax({url:url,type:'POST',encoding:'UTF-8',data:post_data,dataType:'json',cache:false,success:function(resp){},error:function(ob,textStatus){}});if(response.status===201){$('#video_'+file.id+' #status').html(gettext('Upload is complete, enter the system file conversion program'));$('#video_'+file.id+' .close, #video_'+file.id+' .progress').hide();}
else{var delete_video_url=file.video_delete_url;$.ajax({url:delete_video_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){},error:function(ob,textStatus){}});$('#video_'+file.id+' #status').html(resp.message);$('#video_'+file.id+' a.close, #video_'+file.id+' .progress').hide();$('#video_'+file.id+' #editarea').remove();$('#video_'+file.id+' .more').remove();}});window.video_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.video_uploader.bind('Error',function(up,err){if(window.video_upload_flag){var message=gettext('File upload error, Please choose file to upload again.');alert(message);window.gUploading=false;up.refresh();}});});$('ul.video_category li.add_category a').livequery('click',function(e){e.preventDefault();$(this).next('input').val('').show().focus();$(this).hide();return false;});$('ul.video_category li.add_category input').livequery('blur',function(){$(this).val('').hide();$(this).prev('a').show();});$('ul.video_category li.add_category input').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var name=$(this).val();var that_form=$(this).closest('form');var this_form_index=$('form[class="form-video_edit"]').index(that_form);var video_id=$('#video_id',that_form).val();var that=$(this).closest('.dropdown ul.video_category.dropdown-menu');var category_id=$('#id_category',that_form).val();$.ajax({url:$('#video_create_category_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name,'video_id':video_id},dataType:'json',cache:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},success:function(resp){if(resp.success){$('#id_category',that_form).val('1');if(category_id=='1'){$('.category_value',that_form).html($('.category_value',that_form).html()+', '+resp.category_name);}else{$('.category_value',that_form).html(resp.category_name);}
var selected_str=$('#video_add_category_selected_template').html();selected_str=selected_str.replace(/::category_id::/g,resp.category_id);selected_str=selected_str.replace(/::category_name::/g,resp.category_name);selected_str=selected_str.replace(/::video_id::/g,video_id);$('.video_category',that_form).prepend(selected_str);$('form[class="form-video_edit"]').not(':eq('+this_form_index+')').each(function(){var noselected_str='';noselected_str=$('#video_add_category_noselected_template').html();noselected_str=noselected_str.replace(/::category_id::/g,resp.category_id);noselected_str=noselected_str.replace(/::category_name::/g,resp.category_name);noselected_str=noselected_str.replace(/::video_id::/g,$(this).find('#video_id').val());$(this).find('.video_category').prepend(noselected_str);});}},error:function(ob,textStatus){alert('error');},});$(this).val('');$(this).hide();$(this).prev('a').show();that.scrollTop(0);}});$('.dropdown-toggle').livequery('click',function(){$('.add_category a').show();$('.add_category input').val('').hide();});$('.video_category a.category_item').livequery('click',function(e){e.preventDefault();var that=$(this);var url=that.attr('href');if(url.search('add')==-1)
re_url=url.replace('remove','add');else
re_url=url.replace('add','remove');$.get(url,function(response){if(response.success){if(re_url.search('add')==-1){$('i',that).removeClass().addClass('s_icon-sub');}else{$('i',that).removeClass().addClass('s_icon-none');}
that.attr('href',re_url);var that_form=that.closest('form');that_form.find('.category_value').html('');that_form.closest('form').find('.video_category').find('i[class="s_icon-sub"]').each(function(){if(that_form.find('.category_value').html()==''){that_form.find('.category_value').html($(this).parent().text());}else{that_form.find('.category_value').html(that_form.find('.category_value').html()+', '+$(this).parent().text());}});if(that_form.find('.category_value').html()==''){that_form.find('.category_value').html(gettext('Please choose the video category'));that_form.find('#id_category').val('');}else{that_form.find('#id_category').val('1');}}});return false;});$('.form-video_edit .tag_recommend .tag_box').livequery('click',function(e){e.preventDefault();var that=$(this).closest('form');var old_tags=that.find('#id_tags').val();old_tags=jQuery.trim(old_tags);var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
that.find('#id_tags').val(old_tags+' '+new_tag);that.find('.tag_controls').prepend('<span class="tag_box"><span class="tag_name">'+new_tag+' </span><a class="close_btn" href="#">×</a></span>');return false;});$('.form-video_edit .tag_controls .close_btn').livequery('click',function(){$(this).parent().remove();var that=$(this).closest('form');var new_tags=that.find('.tag_controls .tag_box .tag_name').text();that.find('#id_tags').val(new_tags);return false;});$('.video_cover').livequery('click',function(){$('.cover_select').removeClass('selected');var thumb_id=$(this).attr('data');$('#thumbs').val(thumb_id);$(this).parent().addClass('selected');});$('.form-video_edit .btn-delete').livequery('click',function(e){e.preventDefault();var delete_url=$(this).attr('data');confirm(gettext('Delete video'),gettext('Are you sure to delete the video?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:delete_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){History.pushState(null,null,resp.next);}else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('Delete video error'));}});}});});$('#frm_edit_save').livequery('click',function(e){e.preventDefault();$('.boboerror').remove();var that=$(this);var new_tags=$('.tag_controls .tag_box .tag_name').text();var input_tag=jQuery.trim($('#tag_text').val());if(input_tag.indexOf(' ')!=-1){input_tag=input_tag.replace(/""/g,'"');}
$('#id_tags').val(input_tag+' '+new_tags);if($('#id_name').val()==''){alert(gettext('video name cannot empty'));return false;}
var $form=$('#single_video_edit_form');var form_data=$form.serializeObject();var $tag_textarea=$('.video_tag_textarea',$form);var textext=$tag_textarea.textext()[0];var tags=textext.tags()._formData;form_data.tags=tags;var form_url=$form.attr('action');$.ajax({url:form_url,type:'POST',encoding:'UTF-8',data:form_data,dataType:'json',cache:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:true,multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},success:function(resp){if(resp.success){$.jGrowl(gettext('Save done'),{'life':800,'speed':'fast'});that.val(gettext('Saved'));}else{var errors=resp.errors;if(errors){var app_str='';for(var field in errors){if(errors[field].length>0){app_str='<span class="help-inline alert-error boboerror"><i class="s_icon-error"></i>'+errors[field][0]+'</span>';$('.form-video_edit #id_'+field).parent().find('.help-inline').remove();$('.form-video_edit #id_'+field).parent().append(app_str);};};};}},error:function(ob,textStatus){$.jGrowl(gettext('update data error'),{'life':800,'speed':'fast'});},complete:function(){setTimeout(function(){that.val(gettext('Save'));that.removeAttr('disabled');},1200);}});});var s3_upload_endpoint=$('#s3_upload_endpoint').val();$('#single_video_edit_form').livequery(function(){var video_id=$('#single_video_edit_form #video_id').val();var single_video_edit_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',url:s3_upload_endpoint,browse_button:'single_video_edit_pickfile',container:'single_video_uploader_container',max_file_size:'1024mb',autostart:false,multi_selection:false,flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',filters:[{title:"video file",extensions:"avi,mov,dv,mpeg,mpg,mp4,asf,wmv,flv,rmvb,mod,m4v,vob,mkv"}],});single_video_edit_uploader.init();single_video_edit_uploader.bind('FilesAdded',function(up,files){$('#single_video_edit_pickfile').attr('disabled','disabled');var th_url=$('#video_edit_check_info').val();$.ajax({url:th_url,type:'POST',encoding:'UTF-8',data:'video_id='+video_id,dataType:'json',cache:false,multipart:true,unique_names:true,multiple_queues:false,multi_selection:false,multipart_params:{'csrfmiddlewaretoken':$('#id_csrfmiddlewaretoken').val()},headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},success:function(resp){if(resp.success){$.each(files,function(i,file){$('#single_video_edit_area h3').text(file.name);$('#single_video_edit_area span#status').html(gettext('Waiting ...'))
$('#single_video_edit_area div#video_name_area').show();});up.settings.multipart_params={video_id:parseInt(video_id)};up.refresh();up.start();window.gUploading=true;}else{$('#single_video_edit_pickfile').removeAttr('disabled');up.splice();up.refresh();alert(resp.message);}},error:function(ob,textStatus){$('#single_video_edit_pickfile').removeAttr('disabled');up.splice();up.refresh();alert(gettext('beforeupload error'));}});});single_video_edit_uploader.bind('BeforeUpload',function(up,file){var file_extension=file.name.split('.').pop();var s3_key='video_source/'+file.id+'.'+file_extension;var s3_upload_policy=$('#s3_upload_policy').val();var s3_upload_signature=$('#s3_upload_signature').val();var params=$.extend({'policy':s3_upload_policy,'signature':s3_upload_signature},PLUPLOAD_MULTIPART_PARAMS_S3);params.key=s3_key;params.Filename=s3_key;up.settings.multipart_params=params;});single_video_edit_uploader.bind('Error',function(up,err){var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.splice();$('#single_video_edit_area .progress .bar').css('width','0%');$('#single_video_edit_area div#progressbar_area').fadeOut();$('#single_video_edit_area h3').text('');$('#single_video_edit_area span#status').html('')
$('#single_video_edit_pickfile').removeAttr('disabled');$('#single_video_edit_area div#video_name_area').hide();up.refresh();window.gUploading=false;});single_video_edit_uploader.bind('UploadFile',function(up,file){$('#single_video_edit_area div#progressbar_area').show();window.gUploading=true;});single_video_edit_uploader.bind('UploadProgress',function(up,file){$('#single_video_edit_area span#status').html(gettext('Uploading ... ')+'<b>'+file.percent+'%</b>');$('#single_video_edit_area .progress .bar').css('width',file.percent+'%');if(file.percent>=100){$('#single_video_edit_area #status').html(gettext('Saving ... ')+'<b>'+file.percent+'%</b>');}});single_video_edit_uploader.bind('FileUploaded',function(up,file,response){var xml_doc=$.parseXML(response.response);var file_path=$(xml_doc).find('Key').text();var video_id=file.video_id;var $video_form=$('#video_'+video_id);var url=$('#video_update_file_path_url',$video_form).val();var post_data={'file_path':file_path,'file_size':file.size};$.ajax({url:url,type:'POST',encoding:'UTF-8',data:post_data,dataType:'json',cache:false,success:function(resp){},error:function(ob,textStatus){}});if(response.status===201){$('#single_video_edit_area #status').html(gettext('Upload is complete, enter the system file conversion program'));$('#single_video_edit_area div#progressbar_area').fadeOut();$('#single_video_edit_area .close').show();}
else{alert(resp.message);up.splice();up.refresh();$('#single_video_edit_area .progress .bar').css('width','0%');$('#single_video_edit_area div#progressbar_area').fadeOut();$('#single_video_edit_area h3').text('');$('#single_video_edit_area span#status').html('')
$('#single_video_edit_pickfile').removeAttr('disabled');$('#single_video_edit_area div#video_name_area').hide();}
window.gUploading=false;});});$('.user_video_category .edit_box a').livequery('click',function(){$(this).parent().next().find('input').show().focus();$('#video_category_name').hide();return false;});$('.user_video_category input[type="text"]').livequery('blur',function(){$(this).hide();$('#video_category_name').show();return false;});$('.user_video_category input[type="text"]').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var name=$(this).val();var video_category_id=$('#video_category_id').val();$.ajax({url:$('#video_edit_category_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name,'video_category_id':video_category_id},dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Update success'),{'life':800,'speed':'fast'});$('#video_category_name').text(resp.category_name);$('#video_category_name').show();$(this).val(resp.category_name);}},error:function(ob,textStatus){}});$(this).hide();$('#video_Category_name').show();}});$('.video_tag_textarea').livequery(function(){var that=this;var that_id=$(this).attr('id');$('#'+that_id).textext({enabled:true,plugins:'tags ajax autocomplete',ajax:{url:$('#video_manage_tag_user_pool_url').val(),dataType:'json',loading:{delay:0,message:gettext('Loading...')},cacheResults:false},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter',188:'comma!'},html:{tag:'<div class="text-tag"><div class="tag_box"><span class="text-label"/><a class="text-remove" style="cursor:pointer;">×</a></div></div>',hidden:'<input type="hidden" name="tags[]" id="id_tags" />'}});var textext=$(that).textext()[0];var has_dropdown=false;$(that).bind('showDropdown',function(e){has_dropdown=true;});$(that).bind('hideDropdown',function(e){has_dropdown=false;});$(that).bind('enterKeyUp',function(e){e.preventDefault();if(!has_dropdown){var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');}});$(that).bind('commaKeyPress',function(e){e.preventDefault();var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');});var form=$(that).parents('form.form-video_edit:first');var mytags=form.find('#mytags').children();$.each(mytags,function(){$('#'+that_id).textext()[0].tags().addTags([$(this).val()]);});});$('.form-video_edit .tag_recommend .tag_box').livequery('click',function(e){var target_area_id='id_tag_textarea_'+$(this).attr('data');e.preventDefault();var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});})
var autoSave='';$(function(){$('.content_wrapper.content_line.full_box p').find('a').each(function(){if(typeof($(this).attr('target'))=='undefined'){$(this).attr('target','_blank');}});$('.form-writing_add .category_select').livequery('click',function(){$('#id_newcategory').val('');$('.category_value').html('');if($(this).find('i').is('.category_select .s_icon-sub')){$(this).find('i').removeClass('s_icon-sub').addClass('s_icon-none');}else{$(this).find('i').removeClass('s_icon-none').addClass('s_icon-sub');}
$('.category_select').find('i[class="s_icon-sub"]').each(function(){if($('.category_value').html()==''){$('.category_value').html($(this).parent().text());}else{$('.category_value').html($('.category_value').html()+', '+$(this).parent().text());}
if($('#id_newcategory').val()==''){$('#id_newcategory').val($(this).attr('data'));}else{$('#id_newcategory').val($('#id_newcategory').val()+','+$(this).attr('data'));}});if($('.category_value').html()==''){$('.category_value').html(gettext('Please select the article category'));}})
$('#publish_select').livequery('change',function(){$('.publish_time').toggle();})
$('.captcha').livequery('click',function(){$.getJSON('/captcha/refresh/?'+randomChar(10),{},function(json){$('.captcha').attr("src",json.image_url);$('#id_captcha_0').val(json.key);});return false;});$('#article_post').livequery(function(){var ed=CKEDITOR.replace('id_content');var LEFT_CAL=Calendar.setup({cont:"calendar_container_ooxx",weekNumbers:false,selectionType:Calendar.SEL_SINGLE,dateFormat:'%Y-%m-%d %H:%M:%S',showTime:24,setLanguage:'cn',onSelect:function(){var date=this.selection.get();date=Calendar.intToDate(date);date=Calendar.printDate(date,"%Y-%m-%d");var h=this.getHours();var m=this.getMinutes();if(h<10)h="0"+h;if(m<10)m="0"+m;datetime=date+' '+h+':'+m+':00'
$("#id_publish_at").val(datetime);$('#calendar_container_ooxx').toggle();}})});$('#article_publish').livequery('click',function(){var ed=CKEDITOR.instances.id_content;ed.updateElement();if($('#id_name').val()==''){alert(gettext('Please input the article name'));return false;}
if(ed.getData()==''){alert(gettext('Please input the article content'));return false;}
var that=$(this);if($('#article_id').val()){_url='/article/manage/edit/'+$("#article_id").val()+'/';}else{_url='/article/manage/post/';}
var $form=$('#article_post');var form_data=$form.serializeObject();var $tag_textarea=$('.article_tag_textarea',$form);var textext=$tag_textarea.textext()[0];var tags=textext.tags()._formData;form_data.tags=tags;var form_url=$form.attr('action');that.attr("disabled",true);that.val(gettext('Updating ...'));$.ajax({url:_url,type:'POST',encoding:'UTF-8',data:form_data,dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Save done'),{'life':800,'speed':'fast'});History.pushState(null,null,resp.next);}else{that.attr("disabled",false);var errors=resp.errors;for(var field in errors){if(errors[field].length>0){alert(errors[field][1]);if(errors[field][0]=='captcha'){$.getJSON('/captcha/refresh/?'+randomChar(10),{},function(json){$('.captcha').attr("src",json.image_url);$('#id_captcha_0').val(json.key);});$('#captcha').show();}
break;};};}},error:function(ob,textStatus){$.jGrowl(gettext('update data error'),{'life':800,'speed':'fast'});},complete:function(){setTimeout(function(){that.val(gettext('Save'));that.removeAttr('disabled');},1200);}});});$('#article_preview').livequery('click',function(){var ed=CKEDITOR.instances.id_content;ed.updateElement();if($('#id_name').val()==''){alert(gettext('Please input the article name'));return false;}
if(ed.getData()==''){alert(gettext('Please input the article content'));return false;}
var $form=$('#article_post');var form_data=$form.serializeObject();$.ajax({url:'/article/manage/preview/',type:"POST",dataType:"html",async:false,cache:false,data:form_data,success:function(data){var win=window.open();win.document.write(data);},error:function(){e.preventDefault();}});});$('.add_category a').livequery('click',function(){$(this).next('input').show().focus();$(this).hide();return false;});$('.add_category input').livequery('blur',function(){$(this).val('').hide();$(this).prev('a').show();});$('.form-writing_add .article_category .add_category input').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var name=$(this).val();var that=$(this).closest('.dropdown ul.article_category.dropdown-menu');var url=$('#article_create_category_url').val();$.post(url,{'name':name},function(response){if(response.success){var category_id=response.category;var $newcategory=$('#id_newcategory');var old_newcategory_val=$newcategory.val();var $category_value=$('.category_value');var old_category_value=$('.category_value').html();if(old_newcategory_val.length>0){$newcategory.val(old_newcategory_val+','+category_id);$category_value.html(old_category_value+', '+response.category_name);}
else{$newcategory.val(response.category);$category_value.html(response.category_name);}
var template="<li><a href='javascript:;' class='category_select' data="+response.category+"><i class='s_icon-sub'></i>"+response.category_name+"</a></li>";$('.article_category').prepend(template);}});$(this).val('');$(this).hide();$(this).prev('a').show();that.scrollTop(0);}});$('.form-writing_edit .article_category .add_category input').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var name=$(this).val();var article_id=$('#article_id').val();var that=$(this).closest('.dropdown ul.article_category.dropdown-menu');$.ajax({url:$('#article_create_category_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name,'article_id':article_id},dataType:'json',cache:false,success:function(resp){if(resp.success){if($('#has_category').val()=='1'){$('.category_value').html($('.category_value').html()+', '+resp.category_name);}else{$('.category_value').html(resp.category_name);$('#has_category').val('1');}
var selected_str=$('#article_add_category_selected_template').html();selected_str=selected_str.replace(/::category_id::/g,resp.category);selected_str=selected_str.replace(/::category_name::/g,resp.category_name);selected_str=selected_str.replace(/::article_id::/g,article_id);$('.article_category').prepend(selected_str);}},error:function(ob,textStatus){},});$(this).val('');$(this).hide();$(this).prev('a').show();that.scrollTop(0);}});$('.form-writing_edit .article_category a').livequery('click',function(){var that=$(this);var url=that.attr('href');if(url.search('add')==-1)
re_url=url.replace('remove','add');else
re_url=url.replace('add','remove');$.get(url,function(response){if(response.success){if(re_url.search('add')==-1){$('i',that).removeClass().addClass('s_icon-sub');}else{$('i',that).removeClass().addClass('s_icon-none');}
that.attr('href',re_url);$('.category_value').html('');$('.article_category li').find('i[class="s_icon-sub"]').each(function(){if($('.category_value').html()==''){$('.category_value').html($(this).parent().text());}else{$('.category_value').html($('.category_value').html()+', '+$(this).parent().text());}});if($('.category_value').html()==''){$('.category_value').html(gettext('Please select the article category'));$('#has_category').val('');}else{$('#has_category').val('1');}}});return false;});$('.dropdown-toggle').livequery('click',function(){$('.add_category a').show();$('.add_category input').val('').hide();});$('.form-writing_edit .btn-delete').livequery('click',function(e){e.preventDefault();var url=$(this).attr('data');confirm(gettext('Delete Article'),gettext('Are you sure you want to delete this article?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('delete done'),{'life':800,'speed':'fast'});History.pushState(null,null,resp.next);}
else{alert(resp.message);}},error:function(ob,textStatus){alert(gettext('delete article error'));}});}})})
$('#insert_to_article').livequery('click',function(){var img=$('#id_imagepool_url').val();var location=$('input[name=location]:checked').val();if(location!='none')
{var imgsrc='<div style=\'text-align:'+location+'\'><img src='+img+' /></div>';}
else{var imgsrc='<div><img src='+img+' /></div>';}
if(img){var ed=CKEDITOR.instances.id_content;ed.insertHtml(imgsrc);}
$('#ModalDiv .modal').modal('hide');});$('#btn_imagepool_upload').livequery('click',function(){if($('#frm_upload_imagepool #id_imagepool_pic').val()==''){alert(gettext('please add a image.'));return false;};var that=$(this);that.attr('disabled',true);var create_imagepool_url=$('#frm_upload_imagepool').attr('action');var datas=$('#frm_upload_imagepool').serialize();$('#frm_imagepool_area').upload(create_imagepool_url,datas,function(resp){if(resp.success){$('#id_imagepool_url').val('http://'+resp.imagepool_url);$('#box_pic').attr('src',resp.imagepool_src);$('#box_pic').attr('data','http://'+resp.imagepool_url);$('#imageset').show();that.removeAttr('disabled');}else{$('#frm_imagepool_area .error').html(resp.message);that.removeAttr('disabled');}},'json');return false;});$('.imagepool_image').livequery('click',function(){var id=$(this).attr('id');var image_src=$(this).attr('src');var image_data=$(this).attr('data');$('.imagepool_box').removeClass('selected');$(this).closest('.imagepool_box').addClass('selected');$('#box_pic').attr('src',image_src);$('#box_pic').attr('data',image_data);$('#id_imagepool_url').val(image_data);$('#imageset').show();});$('#get_uploadbox').livequery('click',function(){if(!$('#uploadbox').is(':visible')){$('#photobox').hide();};});$('#get_photobox').livequery('click',function(){if(!$('#photobox').is(':visible')){$('#photobox').show();$('#uploadbox').removeClass('in active');reload_element('#allimagepools',$('#frm_upload_imagepool').attr('action'));};});$('.pagination .imagepool_page a').livequery('click',function(){var that=$(this);$.ajax({url:that.attr('href'),type:'GET',encoding:'UTF-8',dataType:'json',cache:false,success:function(resp){$('#allimagepools .select_box').html(resp.imagepool_data);$('.pagination').html(resp.page_data);},})
return false;});$('div.article_category .edit_box a').livequery('click',function(){$(this).parent().next().find('input').show().focus();$('#category_name').hide();return false;});$('div.article_category input[type="text"]').livequery('blur',function(){$('#category_name').show();$(this).hide();return false;});$('div.article_category input[type="text"]').livequery('keypress',function(e){if(e.which==13){e.preventDefault();var name=$(this).val();var category_id=$('#category_id').val();$.ajax({url:$('#article_edit_category_url').val(),type:'POST',encoding:'UTF-8',data:{'name':name,'category_id':category_id},dataType:'json',cache:false,success:function(resp){if(resp.success){$.jGrowl(gettext('Update success'),{'life':800,'speed':'fast'});$('#category_name').text(resp.category_name);$(this).val(resp.category_name);}},error:function(ob,textStatus){},});$(this).hide();$(this).prev('span').show();}});$('.article_tag_textarea').livequery(function(){var that=this;var that_id=$(this).attr('id');$('#'+that_id).textext({enabled:true,plugins:'tags ajax autocomplete',ajax:{url:$('#article_manage_tag_user_pool_url').val(),dataType:'json',loading:{delay:0,message:gettext('Loading...')},cacheResults:false},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter',188:'comma!'},html:{tag:'<div class="text-tag"><div class="tag_box"><span class="text-label"/><a class="text-remove" style="cursor:pointer;">×</a></div></div>',hidden:'<input type="hidden" name="tags[]" id="id_tags" />'}});var textext=$(that).textext()[0];var has_dropdown=false;$(that).bind('showDropdown',function(e){has_dropdown=true;});$(that).bind('hideDropdown',function(e){has_dropdown=false;});$(that).bind('enterKeyUp',function(e){e.preventDefault();if(!has_dropdown){var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');}});$(that).bind('commaKeyPress',function(e){e.preventDefault();var new_tag=$.trim($(that).val());textext.tags().addTags([new_tag]);$(that).val('');});var form=$(that).parents('form.form-writing_edit:first');var mytags=form.find('#mytags').children();$.each(mytags,function(){$('#'+that_id).textext()[0].tags().addTags([$(this).val()]);});});$('.form-writing_add .tag_recommend .tag_box').livequery('click',function(e){var target_area_id=$(this).attr('data');e.preventDefault();var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});$('.form-writing_edit .tag_recommend .tag_box').livequery('click',function(e){var target_area_id=$(this).attr('data');e.preventDefault();var new_tag=jQuery.trim($(this).text());if(new_tag.indexOf(' ')!=-1){new_tag=new_tag.replace(/""/g,'"');}
$('#'+target_area_id).textext()[0].tags().addTags([new_tag]);});});function randomChar(l){var x="0123456789qwertyuioplkjhgfdsazxcvbnm";var tmp="";for(var i=0;i<l;i++){tmp+=x.charAt(Math.ceil(Math.random()*100000000)%x.length);}
return tmp;}
function setboxpic(picsrc){if(picsrc){$('#imageset').show();$('#box_pic').attr('src',picsrc);}
else{$('#box_pic').attr('src',media_url+'images/writing/p150-1.jpg');}}
(function($){var rotateLeft=function(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
var addUnsigned=function(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4)return(lResult^0x80000000^lX8^lY8);if(lX4|lY4){if(lResult&0x40000000)return(lResult^0xC0000000^lX8^lY8);else return(lResult^0x40000000^lX8^lY8);}else{return(lResult^lX8^lY8);}}
var F=function(x,y,z){return(x&y)|((~x)&z);}
var G=function(x,y,z){return(x&z)|(y&(~z));}
var H=function(x,y,z){return(x^y^z);}
var I=function(x,y,z){return(y^(x|(~z)));}
var FF=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var GG=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var HH=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var II=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b);};var convertToWordArray=function(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWordsTempOne=lMessageLength+8;var lNumberOfWordsTempTwo=(lNumberOfWordsTempOne-(lNumberOfWordsTempOne%64))/64;var lNumberOfWords=(lNumberOfWordsTempTwo+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;};var wordToHex=function(lValue){var WordToHexValue="",WordToHexValueTemp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValueTemp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValueTemp.substr(WordToHexValueTemp.length-2,2);}
return WordToHexValue;};var uTF8Encode=function(string){string=string.replace(/\x0d\x0a/g,"\x0a");var output="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){output+=String.fromCharCode(c);}else if((c>127)&&(c<2048)){output+=String.fromCharCode((c>>6)|192);output+=String.fromCharCode((c&63)|128);}else{output+=String.fromCharCode((c>>12)|224);output+=String.fromCharCode(((c>>6)&63)|128);output+=String.fromCharCode((c&63)|128);}}
return output;};$.extend({encode:function(string){var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=uTF8Encode(string);x=convertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD);}
var tempValue=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return tempValue.toLowerCase();}});})(jQuery);$(function(){$('#btn_edit_profile').livequery('click',function(){$('.boboerror').remove();var frm_url=$('#frm_edituserprofile').attr('action');var datas=$('#frm_edituserprofile').serialize();var that=$(this);window.do_not_refresh=true;that.attr('disabled',true);$('#frm_edituserprofile_area').upload(frm_url,datas,function(resp){if(resp.success){reload_element('#setting_content');if(resp.updateimage){reload_element('.member_box img');reload_element('.member_box span');reload_element('.uploader-avatar');};reload_element('.author_bg .login-related',$('.menu_bar li:first a').attr('href'));reload_element('#setting_menu');alert(resp.messages,function(){if(resp.need_reload){document.location.reload();}});that.removeAttr('disabled');}else{var errors=resp.errors;var messages=resp.messages;if(errors){var app_str='';for(var field in errors){if(errors[field].length>0){app_str='<span class="help-inline alert-error boboerror"><i class="s_icon-error"></i>'+errors[field][0]+'</span>';$('#frm_edituserprofile #id_'+field).parent().find('.help-inline').remove();$('#frm_edituserprofile #id_'+field).parent().append(app_str);if(field=='birthday'){$('#frm_edituserprofile #id_birthday_year').parent().find('.help-inline').remove();$('#frm_edituserprofile #id_birthday_year').parent().append(app_str);};};};};if(messages){alert(messages);};that.removeAttr('disabled');};},'json');return false;});$('#btn_delete_account').livequery('click',function(){var frm_url=$('#frm_delete_account_ok').attr('action');$.ajax({url:frm_url,type:'POST',encoding:'UTF-8',data:'',dataType:'json',cache:false,success:function(resp){if(resp.success){var href=resp.next;window.location=href;}else{}},error:function(ob,textStatus){alert(textStatus);}});return false;});$('.member_delete').livequery('click',function(){var frm_id=$(this).parent().parent().parent().parent().parent().attr('id');var url=$('#'+frm_id).attr('action');var member_id=frm_id.split('_')[2];$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'acttype=delete&member_id='+member_id,dataType:'json',cache:false,success:function(resp){if(resp.success){$('#'+frm_id).fadeOut().remove();};},error:function(ob,textStatus){alert(textStatus);}});return false;});$('.member_update').livequery('click',function(){var frm_id=$(this).parent().parent().parent().parent().parent().attr('id');var url=$('#'+frm_id).attr('action');var member_id=frm_id.split('_')[2];var datas=$('#'+frm_id).serialize();$('#'+frm_id+'_area').upload(url,datas,function(resp){if(resp.success){reload_element('#'+frm_id);alert(resp.messages);}else{var messages=resp.messages;if(messages){alert(messages);};};},'json');return false;});$('#profile_member_add').livequery('click',function(){var url=$('#frm_member_add').attr('action');var datas=$('#frm_member_add').serialize();$('#frm_member_add_area').upload(url,datas,function(resp){if(resp.success){reload_element('#member_list_area');alert(resp.messages);}else{var messages=resp.messages;if(messages){alert(messages);};};},'json');return false;});bb_log={update_ok:'',};$('#notification_btn_ok').livequery('click',function(){var theButton=this;var url=$('#epaper_setting').attr('action');var datas=$('#epaper_setting').serialize();theButton.disabled=true;$.ajax({url:url,type:'POST',encoding:'UTF-8',data:'frm_type=epaper&'+datas,dataType:'json',cache:false,success:function(resp){if(resp.success){alert(resp.message);};},error:function(ob,textStatus){alert(textStatus);},complete:function(jqXHR,textStatus){theButton.disabled=false;}});return false;});$('#notification_btn_cancel').livequery('click',function(){$('#epaper_setting').each(function(){this.reset();});return false;});$('#reactivate_frm').livequery('submit',function(e){var url=$('#reactivate_url').val();var datas=$(this).serialize();$.ajax({url:url,type:'POST',encoding:'UTF-8',data:datas,dataType:'json',cache:false,success:function(resp){if(resp.success){History.pushState(null,null,resp.next);}else{var errors=resp.errors;var app_str='';if(errors){for(var field in errors){if(errors[field].length>0){alert('Email'+errors[field][0]);};};};};},error:function(ob,textStatus){alert(textStatus);}});e.preventDefault();return false;});$('#btn_profile_cstomization').live('click',function(event){event.preventDefault();var url=$("#form_profile_cstomization").attr('action');var data=$("#form_profile_cstomization").serialize();$('#form_profile_cstomization_area').upload(url,data,function(response){if(response.success){alert(response.messages);reload_element('.author_bg',$('.menu_bar li:first a').attr('href'));$('#form_profile_cstomization').load(document.location+' #form_profile_cstomization > *',function(response,status,xhr){$('#zoomScroll').scrollTop(0);});}else{var errors=response.errors;if(errors){var app_str='';for(var field in errors){if(errors[field].length>0){app_str='<span class="help-inline alert-error boboerror"><i class="s_icon-error"></i>'+errors[field][0]+'</span>';$('#form_profile_cstomization #id_'+field).parent().find('.help-inline').remove();$('#form_profile_cstomization #id_'+field).parent().append(app_str);};};};}},'json');return false;});$('#frm_change_email').livequery('submit',function(){$('#btn_change_email_submit').attr("disabled",true);$('#frm_change_email .help-inline').remove();var url=$(this).attr('action');var datas=$(this).serialize();$.ajax({url:url,type:'POST',encoding:'UTF-8',data:datas,dataType:'json',cache:false,success:function(resp){if(resp.success){alert(resp.messages);}else{var errors=resp.errors;var app_str='';if(errors){for(var field in errors){if(errors[field].length>0){app_str='<span class="alert-error help-inline"><i class="s_icon-error"></i> '+errors[field][0]+'</span>';$('#frm_change_email #id_'+field).parent().append(app_str);};};};};$('#btn_change_email_submit').attr("disabled",false);},error:function(ob,textStatus){alert(textStatus);$('#btn_change_email_submit').attr("disabled",false);}});return false;});$('#frm_change_password').livequery('submit',function(){$('#frm_change_password .help-inline').remove();var url=$(this).attr('action');var datas=$(this).serialize();$.ajax({url:url,type:'POST',encoding:'UTF-8',data:datas,dataType:'json',cache:false,success:function(resp){if(resp.success){alert(resp.messages);$('#frm_change_password')[0].reset();}else{var errors=resp.errors;var app_str='';if(errors){for(var field in errors){if(errors[field].length>0){app_str='<span class="alert-error help-inline"><i class="s_icon-error"></i> '+errors[field][0]+'</span>';$('#frm_change_password #id_'+field).parent().append(app_str);}}}}},error:function(ob,textStatus){alert(textStatus);}});return false;});$('.more_lang').livequery('click',function(){var thenext=window.location.href;var thelang=$(this).attr('value');$('id_next').val(thenext);$('#id_language').val(thelang);$('#thelangform').submit();});$('input[name=built_in_background]').live('click',function(e){$(this).parents('.item.span1').addClass('selected').siblings().removeClass('selected');});$('.profile_image_action').live('click',function(event){var a=this;var targetSelector=$(this).data('target');confirm(gettext('Remove?'),$(a).data('confirm-message')||gettext('Are you sure to remove?'),gettext('Yes'),gettext('No'),function(confirmed){if(confirmed){$.ajax({url:a.href,type:'POST',encoding:'UTF-8',dataType:'json',cache:false,success:function(response){if(response.success){if(response.next){History.pushState(null,null,response.next);}else if(targetSelector&&response.newImageUrl){var targetElement=$('img#'+targetSelector);targetElement.attr('src',response.newImageUrl);$(a).parent('li').remove();}}else{alert(response.message);}},error:function(jqXHR,textStatus){alert(textStatus);}});}});return false;});});$(function(){window.playlist_create_image_uploader={};$('#playlistcreate_album_cover_item').livequery(function(){window.playlist_create_image_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',browse_button:'create_album_cover_btn',container:'playlistModal',max_file_size:'10mb',multi_selection:false,multiple_queues:false,unique_names:true,flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});window.playlist_create_image_uploader.bind('FilesAdded',function(up,files){var fileCount=up.files.length,i=0,ids=$.map(up.files,function(item){return item.id;});for(i=0;i<fileCount;i++){window.playlist_create_image_uploader.removeFile(window.playlist_create_image_uploader.getFile(ids[i]));}});window.playlist_create_image_uploader.bind('UploadFile',function(up,file){window.gUploading=true;up.refresh();});window.playlist_create_image_uploader.bind('Error',function(up,err){window.gUploading=false;var message=gettext('File upload error, Please choose file to upload again.');alert(message);up.refresh();});window.playlist_create_image_uploader.bind('UploadProgress',function(up,file){});window.playlist_create_image_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.playlist_create_image_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){$('#playlistModal').modal('hide').remove();$('.modal-backdrop').remove();$.jGrowl(resp.messages);}else{var errors=resp.errors;for(var field in errors){if(errors[field].length>0){if(field=='cover'){$('#frm_craPlaylist #selectfile').show();};alert(errors[field][0]);$('#frm_craPlaylist #id_'+field).focus();break;};};};});window.playlist_create_image_uploader.init();});$('#btn_create_playlist').livequery('click',function(){if(window.playlist_create_image_uploader.files.length==1){if($.trim($('#frm_craPlaylist #id_playlist_name').val())==''){alert(gettext('album name cannot be empty.'));return false;};window.playlist_create_image_uploader.settings.url=$('#frm_craPlaylist').attr('action'),window.playlist_create_image_uploader.settings.multipart_params={'csrfmiddlewaretoken':$('input[name="csrfmiddlewaretoken"]').val(),'playlist_name':$('#frm_craPlaylist #id_playlist_name').val(),'description':$('#frm_craPlaylist #id_description').val(),'is_public':$('#frm_craPlaylist #id_isPublic').val(),};window.playlist_create_image_uploader.start();return false;}else{$.ajax({url:$('#frm_craPlaylist').attr('action'),type:'POST',encoding:'UTF-8',data:$('#frm_craPlaylist').serialize(),dataType:'json',cache:false,success:function(resp){if(resp.success){$('#btn_cancel_create_playlist').click();$('#current_playlist').prepend('<option value='+resp.playlist_id+' selected="selected">'+resp.playlist_name+'</option>');}else{var errors=resp.errors;for(var field in errors){if(errors[field].length>0){if(field=='cover'){$('#frm_craPlaylist #selectfile').show();};alert(errors[field][0]);$('#frm_craPlaylist #id_'+field).focus();break;};};};},});}});$('#add_playlist .btn-primary').livequery('click',function(e){e.preventDefault();var playlist_id=$('#current_playlist').attr('data');if(playlist_id===''){alert($('#current_playlist').attr('data-info'));}else{var data=$('#save_queue1').serialize();items=angular.element($('#player_wrapper')).scope().songs;var items_length=items.length;if(items_length){var ids=[];$.each(items,function(index,obj){ids.push(obj.id);});var data={'ids[]':ids,'playlist_id':$('#playlist_id').val(),}}
$.ajax({type:"POST",url:$('form#save_queue1').attr('action'),dataType:'json',data:data,success:function(response){if(response){if(response.success){$('#add_playlist').modal('hide').remove();alert(response.message);}else{alert(response.message);}}}});}
return false;});$('.savequeue_add_playlist input').livequery('keypress',function(e){name=$(this).val();var that=$(this).closest('.dropdown ul.dropdown-menu.save_queue');if(e.which==13){$.post('/playlist/manage/save_queue_create/',{'name':name},function(response){if(response.success){$('#current_playlist').attr('data',response.playlist_id);$('#playlist_id').val(response.playlist_id);$('#current_playlist').contents(':eq(0)').replaceWith(response.playlist_name);template='<li><a href="#" class="change_playlist_id" data="'+response.playlist_id+'"><i class="s_icon-none"></i>'+response.playlist_name+'</a></li>';if(that.children().length>1){$('li:eq(0)',this).after(template);}else{that.prepend(template);}}});$(this).val('');$(this).hide();$(this).prev('a').show();that.toggle();that.scrollTop(0);}});$('#save_queue1 .change_playlist_id').livequery('click',function(e){var $that=$(this);$('#current_playlist').attr('data',$that.attr('data'));$('#playlist_id').val($that.attr('data'));$('#current_playlist').contents(':eq(0)').replaceWith($that.text());});$('#add_playlist .select-works-cancel').livequery('click',function(e){e.preventDefault();$('#add_playlist').modal('hide').remove();return false;});$('#playlist_songs').livequery(function(){$(this).sortable();$(this).disableSelection();});$('.s_icon-move').livequery('click',function(){$(this).parentsUntil('tbody').remove();return false;});window.playlist_edit_image_uploader={};$('#editplaylist_cover_item').livequery(function(){window.playlist_edit_image_uploader=new plupload.Uploader({runtimes:'html5,flash,silverlight,html4',browse_button:'edit_playlist_cover_btn',url:$('#frm_editPlaylist').attr('action'),autostart:false,container:'inside_box',max_file_size:'10mb',multi_selection:false,multiple_queues:false,unique_names:true,flash_swf_url:'/asset/js/plupload/js/plupload.flash.swf',silverlight_xap_url:'/asset/js/plupload/js/plupload.silverlight.xap',multipart_params:{'csrfmiddlewaretoken':$('input:hidden[name=csrfmiddlewaretoken]').val(),'only_cover':'1'},headers:{'X-Requested-With':'XMLHttpRequest','X-CSRFToken':$('#id_csrfmiddlewaretoken').val()},filters:[{title:"image file",extensions:"jpg,jpeg,png,jpe"}],});window.playlist_edit_image_uploader.bind('FilesAdded',function(up,files){var fileCount=up.files.length,i=0,ids=$.map(up.files,function(item){return item.id;});for(i=0;i<fileCount;i++){window.playlist_edit_image_uploader.removeFile(window.playlist_edit_image_uploader.getFile(ids[i]));}
$('#playlist-save-form').attr('disabled',true);setTimeout(function(){up.start();},100);});window.playlist_edit_image_uploader.bind('UploadFile',function(up,file){window.gUploading=true;up.refresh();});window.playlist_edit_image_uploader.bind('Error',function(up,err){window.gUploading=false;var message=gettext('File upload error, Please choose file to upload again.');alert(message);$('#playlist-save-form').attr('disabled',false);up.refresh();});window.playlist_edit_image_uploader.bind('UploadProgress',function(up,file){});window.playlist_edit_image_uploader.bind('UploadComplete',function(up,files){window.gUploading=false;});window.playlist_edit_image_uploader.bind('FileUploaded',function(up,file,response){var resp=JSON.parse(response.response);if(resp.success){if(resp.isUpdateCover){reload_element('#playlistedit_reload_area');}}else{alert(resp.message);}});$('#playlist-save-form').attr('disabled',false);window.playlist_edit_image_uploader.init();});$('#playlist-save-form').livequery('click',function(){var sort_data=$('#playlist_songs').sortable('serialize');var playlist_name=$('#id_playlist_name').val();var description=$('#id_desc').val();var pub=$('#id_public').val();var cover=$('#id_cover').val();var cfrstoken=$('input:hidden[name=csrfmiddlewaretoken]').val();if($.trim($('#frm_editPlaylist #id_playlist_name').val())==''){alert(gettext('album name cannot be empty.'));return false;};if(window.playlist_edit_image_uploader.files.length==1){window.playlist_edit_image_uploader.settings.url=$('#frm_editPlaylist').attr('action'),window.playlist_edit_image_uploader.settings.multipart_params={'public':pub,'sort_data':sort_data,'playlist_name':playlist_name,'description':description,'csrfmiddlewaretoken':cfrstoken};window.playlist_edit_image_uploader.start();return false;}else{$.ajax({url:$('#frm_editPlaylist').attr('action'),type:'POST',encoding:'UTF-8',data:{'public':pub,'sort_data':sort_data,'playlist_name':playlist_name,'description':description,'csrfmiddlewaretoken':cfrstoken},dataType:'json',cache:false,success:function(resp){if(resp.success){alert(resp.message);if(resp.isUpdateCover){reload_element('#playlistedit_reload_area');}}else{alert(resp.message);}},});}
return false;});$('#playlist-delete').livequery('click',function(){var id=$(this).attr('data-type');var url="/playlist/manage/"+id+"/delete/";confirm(gettext('Warning'),gettext('Are you sure you want to delete this playlist?'),gettext('Yes'),gettext('No'),function(ret){if(ret){$.get(url,function(response){if(response.success){$('.menu_list[data="'+id+'"]').remove();History.pushState(null,null,response.redirect);}});}});});$('.playlist-like .like').livequery('click',function(){$(this).closest('.item_box').fadeOut(function(){$('#item_box_list').isotope('remove',$(this));});});$('#btn_add_playlist_list').livequery('click',function(e){e.preventDefault();if($.trim($('#frm_craPlaylist #id_playlist_name').val())==''){alert(gettext('playlist name cannot be empty.'));return false;};var name=$('#frm_craPlaylist #id_playlist_name').val();var datas=$('#frm_craPlaylist').serialize();var craPlaylist_url=$('#frm_craPlaylist').attr('action');var data_id=$('#id_data_id').val();var data_type=$('#id_data_type').val();if(window.playlist_create_image_uploader.files.length==1){window.playlist_create_image_uploader.settings.url=craPlaylist_url;window.playlist_create_image_uploader.settings.multipart_params={'is_public':$('#id_isPublic').val(),'playlist_name':$('#id_playlist_name').val(),'description':$('#id_description').val(),'csrfmiddlewaretoken':$('input[name="csrfmiddlewaretoken"]').val(),'dataType':$('#id_data_type').val(),'data_id':$('#id_data_id').val()};window.playlist_create_image_uploader.start();return false;}else{$('#frm_cralbum_area').upload(craPlaylist_url,datas,function(response){if(response.success){$('#playlistModal').modal('hide').remove();$('.modal-backdrop').remove();$.jGrowl(response.messages);}else{$.jGrowl(response.messages);}},'json');}
return false;});$('#btn_cancel_close_modal').livequery('click',function(e){$('#playlistModal').modal('hide').remove();$('.modal-backdrop').remove();});$('#btn_cancel_create_playlist').livequery('click',function(e){items=angular.element($('#player_wrapper')).scope().songs;var items_length=items.length;if(items_length){var ids=[];$.each(items,function(index,obj){ids.push(obj.id);});var data={'ids[]':ids}
$.ajax({type:"POST",url:'/playlist/manage/save_queue1/',dataType:'json',data:data,success:function(response){if(response){$('#playlistModal').modal('hide').remove();$('.modal-backdrop').remove();if(response.success&&!response.redirect){var ret_data=response.data;var modal=$(ret_data).siblings('div.modal')
$('#ModalDiv').html(modal);$('#ModalDiv .modal').modal('show');$('#ModalDiv .modal').on('hidden',function(){$(this).remove();});}else if(response.success&&response.redirect){alert(response);}}}});}});$('#create_playlist_cover_btn').livequery('click',function(){$('#playlistSelectFile #id_cover').click();return false;});$('body').on('click','.get_user_playlists_link',function(){var data_id=$(this).attr('data_id');var data_type=$(this).attr('data_type');var request_url=$(this).attr('request_url');var $playlist_menu=$(this).siblings(".playlist-menu");_gaq.push(['_trackEvent','Playlist','Show playlist dropdown','card']);$.ajax({url:request_url,type:'GET',encoding:'UTF-8',dataType:'json',cache:false,success:function(resp){if(typeof resp.login!="undefined"&&!resp.login){$('#ModalDiv').load('/accounts/login/ div.modal',function(){$('#Login').modal('show');});}
else if(resp.success){var user_playlists=resp.results;$playlist_menu.empty();$playlist_menu.append('<li class="text">'+gettext('Select a playlist')+'</li>');if(data_type=="musicsong"){for(var i=0;i<user_playlists.length;i++){var user_playlist=user_playlists[i];if(user_playlist.is_exist){var template='<li><a id="playlist-'+user_playlist.id+'" href="/playlist/manage/remove/'+user_playlist.id+'/'+data_id+'/">'
template+='<i class="s_icon-sub"></i>'+user_playlist.name+'</a>'}else{var template='<li><a id="playlist-'+user_playlist.id+'" href="/playlist/manage/add/'+user_playlist.id+'/'+data_id+'/">'
template+='<i class="s_icon-none"></i>'+user_playlist.name+'</a>'}
$playlist_menu.append(template);}}else if(data_type=='playlist'||data_type=='musicalbum'||data_type=='unmusicalbum'){if(data_type=='playlist'){url_type='/playlist/';}else if(data_type=='musicalbum'){url_type='/album/';}else if(data_type=='unmusicalbum'){url_type='/unalbum/';}
for(var i=0;i<user_playlists.length;i++){var user_playlist=user_playlists[i];if(user_playlist.is_exist){var template='<li><a id="playlist-'+user_playlist.id+'" href="/playlist/manage/remove/'+user_playlist.id+url_type+data_id+'/">'
template+='<i class="s_icon-sub"></i>'+user_playlist.name+'</a>'}else{var template='<li><a id="playlist-'+user_playlist.id+'" href="/playlist/manage/add/'+user_playlist.id+url_type+data_id+'/">'
template+='<i class="s_icon-none"></i>'+user_playlist.name+'</a>'}
$playlist_menu.append(template);}}
var template='<li><a class="modal_box" href="/playlist/manage/playlist/box_create/True/'+data_type+'/'+data_id+'/"><i class="s_icon-add"></i>'+gettext('Add a playlist')+'</a></li>';$playlist_menu.append(template);}}});})})
$(function(){'use strict';$('.like').livequery('click',function(){var anchor=$(this);var url=$(this).data('href');var stat=url.search('unlike');var like_count_text=$("#like_num").text();var like_count=parseInt(like_count_text);if(stat==-1){var re_url=url.replace('like','unlike');var new_like_count=like_count+1;}
else{var re_url=url.replace('unlike','like');var new_like_count=like_count-1;}
$("#like_num").text(new_like_count);$('i',anchor).toggleClass('selected');login_required(url,function(response){if(response.success){anchor.data('href',re_url);}else{alert(response.message);}});return false;});$('.n_like').livequery('click',function(){var anchor=$(this);var url=$(this).data('href');var stat=url.search('unlike');var status_icon=$('i',anchor);var like_count_text=status_icon[0].nextSibling;var like_count=parseInt(like_count_text.textContent);if(stat==-1){var new_url=url.replace('like','unlike');var new_like_count=like_count+1;}else{var new_url=url.replace('unlike','like');var new_like_count=like_count-1;}
status_icon.toggleClass('selected');like_count_text.textContent=new_like_count;login_required(url,{success:function(response){if(response.success){anchor.data('href',new_url);}else{alert(response.message);}}});return false;});$('.s_like').livequery('click',function(){var anchor=$(this);var url=$(this).data('href');var stat=url.search('unlike');if(stat==-1)
var re_url=url.replace('like','unlike');else
var re_url=url.replace('unlike','like');$('.s_like i').toggleClass('selected');$('.s_like').data('href',re_url);var like_num_text=$('#like_num').text();var like_num=parseInt(like_num_text);if(stat==-1){if($('.s_like').length>1){$('.s_like').each(function(){$(this).contents(':eq(2)').replaceWith(gettext("You liked this work"));});$('.num_box a').text(function(index,text){$(this).text(parseInt(text)+1);});}else{$(anchor).contents(':eq(2)').replaceWith(gettext("You liked this work"));$(anchor).next('.num').children('a').text(function(index,text){if(!text)text=0;$(this).text(parseInt(text)+1)});}
$('#like_num').text(like_num+1);}else{if($('.s_like').length>1){$('.s_like').each(function(){$(this).contents(':eq(2)').replaceWith(gettext("Like"));});$('').text(function(index,text){$(this).text(parseInt(text)-1);});}else{$(anchor).contents(':eq(2)').replaceWith(gettext("Like"));$(anchor).next('.num').children('a').text(function(index,text){if(text==1)$(this).text('');else $(this).text(parseInt(text)-1)});}
$('#like_num').text(like_num-1);}
login_required(url,function(response){if(response.success){}else{alert(response.message);}});return false;});});$(function(){$('#repost_form').livequery('submit',function(e){var url=$(this).attr('action');var data=$(this).serialize();$.ajax({type:'POST',url:url,data:data,dataType:'json',success:function(resp){if(resp.success){$.jGrowl(gettext('Repost success'),{'life':800,'speed':'fast'});$('#ModalDiv .modal').modal('hide');}
else{alert(gettext('Repost error'));}},error:function(ob,textStatus){alert(textStatus);}});_gaq.push(['_trackEvent','Repost','Submit repost']);return false;});$('.delete_repost').livequery('click',function(e){e.preventDefault();var item_box=$(this).parents('.item_box');var link_url=this.href;confirm(gettext('delete?'),gettext('is really delete the repost'),gettext('delete'),gettext('cancel'),function(confirmed){if(!confirmed){return;}
login_required(link_url,function(response){if(!response.success){alert(response.message);}else{item_box.remove();$('#item_box_list').isotope('remove',item_box);}});});_gaq.push(['_trackEvent','Repost','Delete repost']);return false;});});$(function(){function dismissPopup(container){if($(container).attr('popup')==='yes'){$(container).remove();var delta=0-(window.popupTimes||0);if(delta<0){if(window.prv_url.indexOf('/')!=0){window.prv_url='/'+window.prv_url;}
window.do_not_refresh=true;History.pushState(null,window.prv_title,window.prv_url);}
if(delta==0){window.prv_title='StreetVoice';window.prv_url='/';History.pushState(null,'StreetVoice','/');}}else{var nextUrl=$(container).data('default-url')||'/';}
if($("#back-top").is(':visible')){$("#back-top").fadeOut();}
$('body').css('overflow','auto');}
$('#zoomScroll').livequery('click',function(e){if(e.target==this){dismissPopup(this);}});$(document).keyup(function(e){if((e.keyCode==27)&&($('#zoomScroll').length>0)){dismissPopup('#zoomScroll');}});$('#zoomScroll .close').livequery('click',function(e){dismissPopup('#zoomScroll');});$('#zoomScroll .dismiss').livequery('click',function(e){dismissPopup('#zoomScroll');});});(function(){var timeoutToTrySearch;function trySearch(event){if(timeoutToTrySearch){clearTimeout(timeoutToTrySearch);}
var keyword=$(this).val();if(keyword.length>=1){timeoutToTrySearch=setTimeout(function(){doSearch(keyword);},500);}}
var lastKeyword;function doSearch(keyword){timeoutToTrySearch=undefined;if(keyword==lastKeyword){return;}
lastKeyword=keyword;clearResults();$.ajax({url:'/search/ajax/?q='+keyword,dataType:'json',success:function(response){if(response.success){updateResults(keyword,response.results);}},error:function(xhr,status,errorThrown){clearResults();}});}
function updateResults(keyword,results){var suggestions_html='<div id="searchresults">';if(results.length>0){for(var i in results){var result=results[i];suggestions_html+='<a class="content_line dynamic" href="'+result.url+'">'
+'<span class="searchheading">'
+'<img src="'+result.image+'" />'
+'<i class="s_icon-'+result.type+'"></i>'
+'<div class="search_name">'+result.name+'</div>'
+'</span>'
+'</a>';}
suggestions_html+='<span class="moreresults"><a class="dynamic" href="/search/?q='+keyword+'">查看更多結果</a></span>';}else{suggestions_html+='<span class="moreresults"><a>無符合的搜尋結果</a></span>';}
suggestions_html+='</div>';current=-1;$('#suggestions').html(suggestions_html);$('#suggestions').show();}
function clearResults(){current=-1;$('#suggestions').html('');$('#suggestions').hide();}
var current=-1;function moveInResults(event){if(($('#searchKeyword').val()).length>0&&($("#suggestions a").length)>0){var results=$('#suggestions a.content_line');var count=results.length;switch(event.keyCode){case 40:current+=1;if(current>=count){current=0;}
results.removeClass('selected').eq(current).addClass('selected');return false;break;case 38:current-=1;if(current<0){current=count-1;}
results.removeClass('selected').eq(current).addClass('selected');return false;break;case 13:var target=results.filter('.selected')[0];if(target){target.click();}else{$('#searchform').submit();}
return false;break;default:break;};}};window.initStreetVoiceSearch=function(){$('#searchKeyword').on('keyup',trySearch);$('#searchform').on('keydown',moveInResults);$('#searchform').on('submit',function(event){var q=$('#searchKeyword').val();if(q.length>=2){var searchUrl=$(this).attr('action')+'?q='+q;$('.navbar-inner .dropdown').find('.dropdown-menu').hide();resetStreetVoiceSearch();History.pushState(null,null,searchUrl);}
return false;});};window.resetStreetVoiceSearch=function(){$('#searchKeyword').val('');lastKeyword=undefined;clearResults();};$('#form-search-submit').livequery('click',function(){$('#searchpageform').submit();});$('#searchpageform').livequery('submit',function(){if(($('#searchpageKeyword').val()).length>0){resetStreetVoiceSearch();var q=$('#searchpageKeyword').val();var searchUrl=$('#searchform').attr('action')+'?q='+q;History.pushState(null,null,searchUrl);}
return false;});})();function bind_search_result_infinitescroll(){$('#search_results').infinitescroll({loading:{finishedMsg:'',msgText:'',img:'/asset/images/ajax-loader.gif'},behavior:'local',binder:$('#wrapper'),navSelector:'#nextpage',nextSelector:'#nextpage .next',itemSelector:'.content_wrapper',localMode:true});}
$(function(){$('#frm_change_language').livequery('submit',function(){$('#btn_change_language_ok').prop('disabled',true);});});;(function(d){var k=d.scrollTo=function(a,i,e){d(window).scrollTo(a,i,e)};k.defaults={axis:'xy',duration:parseFloat(d.fn.jquery)>=1.3?0:1};k.window=function(a){return d(window)._scrollable()};d.fn._scrollable=function(){return this.map(function(){var a=this,i=!a.nodeName||d.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!i)return a;var e=(a.contentWindow||a).document||a.ownerDocument||a;return d.browser.safari||e.compatMode=='BackCompat'?e.body:e.documentElement})};d.fn.scrollTo=function(n,j,b){if(typeof j=='object'){b=j;j=0}if(typeof b=='function')b={onAfter:b};if(n=='max')n=9e9;b=d.extend({},k.defaults,b);j=j||b.speed||b.duration;b.queue=b.queue&&b.axis.length>1;if(b.queue)j/=2;b.offset=p(b.offset);b.over=p(b.over);return this._scrollable().each(function(){var q=this,r=d(q),f=n,s,g={},u=r.is('html,body');switch(typeof f){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(f)){f=p(f);break}f=d(f,this);case'object':if(f.is||f.style)s=(f=d(f)).offset()}d.each(b.axis.split(''),function(a,i){var e=i=='x'?'Left':'Top',h=e.toLowerCase(),c='scroll'+e,l=q[c],m=k.max(q,i);if(s){g[c]=s[h]+(u?0:l-r.offset()[h]);if(b.margin){g[c]-=parseInt(f.css('margin'+e))||0;g[c]-=parseInt(f.css('border'+e+'Width'))||0}g[c]+=b.offset[h]||0;if(b.over[h])g[c]+=f[i=='x'?'width':'height']()*b.over[h]}else{var o=f[h];g[c]=o.slice&&o.slice(-1)=='%'?parseFloat(o)/100*m:o}if(/^\d+$/.test(g[c]))g[c]=g[c]<=0?0:Math.min(g[c],m);if(!a&&b.queue){if(l!=g[c])t(b.onAfterFirst);delete g[c]}});t(b.onAfter);function t(a){r.animate(g,j,b.easing,a&&function(){a.call(this,n,b)})}}).end()};k.max=function(a,i){var e=i=='x'?'Width':'Height',h='scroll'+e;if(!d(a).is('html,body'))return a[h]-d(a)[e.toLowerCase()]();var c='client'+e,l=a.ownerDocument.documentElement,m=a.ownerDocument.body;return Math.max(l[h],m[h])-Math.min(l[c],m[c])};function p(a){return typeof a=='object'?a:{top:a,left:a}}})(jQuery);Calendar=function(){function bm(a){typeof a=="string"&&(a=document.getElementById(a));return a}function bk(a,b,c){for(c=0;c<a.length;++c)b(a[c])}function bj(){var a=document.documentElement,b=document.body;return{x:a.scrollLeft||b.scrollLeft,y:a.scrollTop||b.scrollTop,w:a.clientWidth||window.innerWidth||b.clientWidth,h:a.clientHeight||window.innerHeight||b.clientHeight}}function bi(a){var b=0,c=0,d=/^div$/i.test(a.tagName),e,f;d&&a.scrollLeft&&(b=a.scrollLeft),d&&a.scrollTop&&(c=a.scrollTop),e={x:a.offsetLeft-b,y:a.offsetTop-c},a.offsetParent&&(f=bi(a.offsetParent),e.x+=f.x,e.y+=f.y);return e}function bh(a,b){var c=e?a.clientX+document.body.scrollLeft:a.pageX,d=e?a.clientY+document.body.scrollTop:a.pageY;b&&(c-=b.x,d-=b.y);return{x:c,y:d}}function bg(a,b){var c=a.style;b!=null&&(c.display=b?"":"none");return c.display!="none"}function bf(a,b){b===""?e?a.style.filter="":a.style.opacity="":b!=null?e?a.style.filter="alpha(opacity="+b*100+")":a.style.opacity=b:e?/alpha\(opacity=([0-9.])+\)/.test(a.style.opacity)&&(b=parseFloat(RegExp.$1)/100):b=parseFloat(a.style.opacity);return b}function bd(a,b,c){function h(){var b=a.len;a.onUpdate(c/b,d),c==b&&g(),++c}function g(){b&&(clearInterval(b),b=null),a.onStop(c/a.len,d)}function f(){b&&g(),c=0,b=setInterval(h,1e3/a.fps)}function d(a,b,c,d){return d?c+a*(b-c):b+a*(c-b)}a=U(a,{fps:50,len:15,onUpdate:bl,onStop:bl}),e&&(a.len=Math.round(a.len/2)),f();return{start:f,stop:g,update:h,args:a,map:d}}function bc(a,b){if(!b(a))for(var c=a.firstChild;c;c=c.nextSibling)c.nodeType==1&&bc(c,b)}function bb(a,b){var c=ba(arguments,2);return b==undefined?function(){return a.apply(this,c.concat(ba(arguments)))}:function(){return a.apply(b,c.concat(ba(arguments)))}}function ba(a,b){b==null&&(b=0);var c,d,e;try{c=Array.prototype.slice.call(a,b)}catch(f){c=Array(a.length-b);for(d=b,e=0;d<a.length;++d,++e)c[e]=a[d]}return c}function _(a,b,c){var d=null;document.createElementNS?d=document.createElementNS("http://www.w3.org/1999/xhtml",a):d=document.createElement(a),b&&(d.className=b),c&&c.appendChild(d);return d}function $(a,b,c){if(b instanceof Array)for(var d=b.length;--d>=0;)$(a,b[d],c);else Y(b,c,a?c:null);return a}function Z(a,b){return Y(a,b,b)}function Y(a,b,c){if(a){var d=a.className.replace(/^\s+|\s+$/,"").split(/\x20/),e=[],f;for(f=d.length;f>0;)d[--f]!=b&&e.push(d[f]);c&&e.push(c),a.className=e.join(" ")}return c}function X(a){a=a||window.event,e?(a.cancelBubble=!0,a.returnValue=!1):(a.preventDefault(),a.stopPropagation());return!1}function W(a,b,c,d){if(a instanceof Array)for(var f=a.length;--f>=0;)W(a[f],b,c);else if(typeof b=="object")for(var f in b)b.hasOwnProperty(f)&&W(a,f,b[f],c);else a.removeEventListener?a.removeEventListener(b,c,e?!0:!!d):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}function V(a,b,c,d){if(a instanceof Array)for(var f=a.length;--f>=0;)V(a[f],b,c,d);else if(typeof b=="object")for(var f in b)b.hasOwnProperty(f)&&V(a,f,b[f],c);else a.addEventListener?a.addEventListener(b,c,e?!0:!!d):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function U(a,b,c,d){d={};for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d}function T(a){if(/\S/.test(a)){a=a.toLowerCase();function b(b){for(var c=b.length;--c>=0;)if(b[c].toLowerCase().indexOf(a)==0)return c+1}return b(L("smn"))||b(L("mn"))}}function S(a){if(a){if(typeof a=="number")return P(a);if(!(a instanceof Date)){var b=a.split(/-/);return new Date(parseInt(b[0],10),parseInt(b[1],10)-1,parseInt(b[2],10),12,0,0,0)}}return a}function R(a,b){var c=a.getMonth(),d=a.getDate(),e=a.getFullYear(),f=M(a),g=a.getDay(),h=a.getHours(),i=h>=12,j=i?h-12:h,k=N(a),l=a.getMinutes(),m=a.getSeconds(),n=/%./g,o;j===0&&(j=12),o={"%a":L("sdn")[g],"%A":L("dn")[g],"%b":L("smn")[c],"%B":L("mn")[c],"%C":1+Math.floor(e/100),"%d":d<10?"0"+d:d,"%e":d,"%H":h<10?"0"+h:h,"%I":j<10?"0"+j:j,"%j":k<10?"00"+k:k<100?"0"+k:k,"%k":h,"%l":j,"%m":c<9?"0"+(1+c):1+c,"%o":1+c,"%M":l<10?"0"+l:l,"%n":"\n","%p":i?"PM":"AM","%P":i?"pm":"am","%s":Math.floor(a.getTime()/1e3),"%S":m<10?"0"+m:m,"%t":"\t","%U":f<10?"0"+f:f,"%W":f<10?"0"+f:f,"%V":f<10?"0"+f:f,"%u":g+1,"%w":g,"%y":(""+e).substr(2,2),"%Y":e,"%%":"%"};return b.replace(n,function(a){return o.hasOwnProperty(a)?o[a]:a})}function Q(a,b,c){var d=a.getFullYear(),e=a.getMonth(),f=a.getDate(),g=b.getFullYear(),h=b.getMonth(),i=b.getDate();return d<g?-3:d>g?3:e<h?-2:e>h?2:c?0:f<i?-1:f>i?1:0}function P(a,b,c,d,e){if(!(a instanceof Date)){a=parseInt(a,10);var f=Math.floor(a/1e4);a=a%1e4;var g=Math.floor(a/100);a=a%100,a=new Date(f,g-1,a,b==null?12:b,c==null?0:c,d==null?0:d,e==null?0:e)}return a}function O(a){if(a instanceof Date)return 1e4*a.getFullYear()+100*(a.getMonth()+1)+a.getDate();if(typeof a=="string")return parseInt(a,10);return a}function N(a){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12,0,0);var b=new Date(a.getFullYear(),0,1,12,0,0),c=a-b;return Math.floor(c/864e5)}function M(a){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),12,0,0);var b=a.getDay();a.setDate(a.getDate()-(b+6)%7+3);var c=a.valueOf();a.setMonth(0),a.setDate(4);return Math.round((c-a.valueOf())/6048e5)+1}function L(a,b){var c=i.__.data[a];b&&typeof c=="string"&&(c=K(c,b));return c}function K(a,b){return a.replace(/\$\{([^:\}]+)(:[^\}]+)?\}/g,function(a,c,d){var e=b[c],f;d&&(f=d.substr(1).split(/\s*\|\s*/),e=(e>=f.length?f[f.length-1]:f[e]).replace(/##?/g,function(a){return a.length==2?"#":e}));return e})}function J(b){if(!this._menuAnim){b=b||window.event;var c=b.target||b.srcElement,d=c.getAttribute("dyc-btn"),e=b.keyCode,f=b.charCode||e,g=H[e];if("year"==d&&e==13){var h=new Date(this.date);h.setDate(1),h.setFullYear(this._getInputYear()),this.moveTo(h,!0),z(this,!1);return X(b)}if(this._menuVisible){if(e==27){z(this,!1);return X(b)}}else{b.ctrlKey||(g=null),g==null&&!b.ctrlKey&&(g=I[e]),e==36&&(g=0);if(g!=null){y(this,g);return X(b)}f=String.fromCharCode(f).toLowerCase();var i=this.els.yearInput,j=this.selection;if(f==" "){z(this,!0),this.focus(),i.focus(),i.select();return X(b)}if(f>="0"&&f<="9"){z(this,!0),this.focus(),i.value=f,i.focus();return X(b)}var k=L("mn"),l=b.shiftKey?-1:this.date.getMonth(),m=0,n;while(++m<12){n=k[(l+m)%12].toLowerCase();if(n.indexOf(f)==0){var h=new Date(this.date);h.setDate(1),h.setMonth((l+m)%12),this.moveTo(h,!0);return X(b)}}if(e>=37&&e<=40){var h=this._lastHoverDate;if(!h&&!j.isEmpty()){h=e<39?j.getFirstDate():j.getLastDate();if(h<this._firstDateVisible||h>this._lastDateVisible)h=null}if(!h)h=e<39?this._lastDateVisible:this._firstDateVisible;else{var o=h;h=P(h);var l=100;while(l-->0){switch(e){case 37:h.setDate(h.getDate()-1);break;case 38:h.setDate(h.getDate()-7);break;case 39:h.setDate(h.getDate()+1);break;case 40:h.setDate(h.getDate()+7)}if(!this.isDisabled(h))break}h=O(h),(h<this._firstDateVisible||h>this._lastDateVisible)&&this.moveTo(h)}Y(this._getDateDiv(o),Z(this._getDateDiv(h),"DynarchCalendar-hover-date")),this._lastHoverDate=h;return X(b)}if(e==13&&this._lastHoverDate){j.type==a.SEL_MULTIPLE&&(b.shiftKey||b.ctrlKey)?(b.shiftKey&&this._selRangeStart&&(j.clear(!0),j.selectRange(this._selRangeStart,this._lastHoverDate)),b.ctrlKey&&j.set(this._selRangeStart=this._lastHoverDate,!0)):j.reset(this._selRangeStart=this._lastHoverDate);return X(b)}e==27&&!this.args.cont&&this.hide()}}}function G(){this.refresh();var a=this.inputField,b=this.selection;if(a){var c=b.print(this.dateFormat);/input|textarea/i.test(a.tagName)?a.value=c:a.innerHTML=c}this.callHooks("onSelect",this,b)}function F(a){a=a||window.event;var b=C(a);if(b){var c=b.getAttribute("dyc-btn"),d=b.getAttribute("dyc-type"),e=a.wheelDelta?a.wheelDelta/120:-a.detail/3;e=e<0?-1:e>0?1:0,this.args.reverseWheel&&(e=-e);if(/^(time-(hour|min))/.test(d)){switch(RegExp.$1){case"time-hour":this.setHours(this.getHours()+e);break;case"time-min":this.setMinutes(this.getMinutes()+this.args.minuteStep*e)}X(a)}else/Y/i.test(c)&&(e*=2),y(this,-e),X(a)}}function E(a,b){b=b||window.event;var c=C(b);if(c){var d=c.getAttribute("dyc-type");if(d&&!c.getAttribute("disabled"))if(!a||!this._bodyAnim||d!="date"){var e=c.getAttribute("dyc-cls");e=e?D(e,0):"DynarchCalendar-hover-"+d,(d!="date"||this.selection.type)&&$(a,c,e),d=="date"&&($(a,c.parentNode.parentNode,"DynarchCalendar-hover-week"),this._showTooltip(c.getAttribute("dyc-date"))),/^time-hour/.test(d)&&$(a,this.els.timeHour,"DynarchCalendar-hover-time"),/^time-min/.test(d)&&$(a,this.els.timeMinute,"DynarchCalendar-hover-time"),Y(this._getDateDiv(this._lastHoverDate),"DynarchCalendar-hover-date"),this._lastHoverDate=null}}a||this._showTooltip()}function D(a,b){return"DynarchCalendar-"+a.split(/,/)[b]}function C(a){var b=a.target||a.srcElement,c=b;while(b&&b.getAttribute&&!b.getAttribute("dyc-type"))b=b.parentNode;return b.getAttribute&&b||c}function B(a){a=a||window.event;var b=this.els.topCont.style,c=bh(a,this._mouseDiff);b.left=c.x+"px",b.top=c.y+"px"}function A(b,c){c=c||window.event;var d=C(c);if(d&&!d.getAttribute("disabled")){var f=d.getAttribute("dyc-btn"),g=d.getAttribute("dyc-type"),h=d.getAttribute("dyc-date"),i=this.selection,j,k={mouseover:X,mousemove:X,mouseup:function(a){var b=d.getAttribute("dyc-cls");b&&Y(d,D(b,1)),clearTimeout(j),W(document,k,!0),k=null}};if(b){setTimeout(bb(this.focus,this),1);var l=d.getAttribute("dyc-cls");l&&Z(d,D(l,1));if("menu"==f)this.toggleMenu();else if(d&&/^[+-][MY]$/.test(f))if(y(this,f)){var m=bb(function(){y(this,f,!0)?j=setTimeout(m,40):(k.mouseup(),y(this,f))},this);j=setTimeout(m,350),V(document,k,!0)}else k.mouseup();else if("year"==f)this.els.yearInput.focus(),this.els.yearInput.select();else if(g=="time-am")V(document,k,!0);else if(/^time/.test(g)){var m=bb(function(a){w.call(this,a),j=setTimeout(m,100)},this,g);w.call(this,g),j=setTimeout(m,350),V(document,k,!0)}else h&&i.type&&(i.type==a.SEL_MULTIPLE?c.shiftKey&&this._selRangeStart?i.selectRange(this._selRangeStart,h):(!c.ctrlKey&&!i.isSelected(h)&&i.clear(!0),i.set(h,!0),this._selRangeStart=h):(i.set(h),this.moveTo(P(h),2)),d=this._getDateDiv(h),E.call(this,!0,{target:d})),V(document,k,!0);e&&k&&/dbl/i.test(c.type)&&k.mouseup(),!this.args.fixed&&/^(DynarchCalendar-(topBar|bottomBar|weekend|weekNumber|menu(-sep)?))?$/.test(d.className)&&!this.args.cont&&(k.mousemove=bb(B,this),this._mouseDiff=bh(c,bi(this.els.topCont)),V(document,k,!0))}else if("today"==f)!this._menuVisible&&i.type==a.SEL_SINGLE&&i.set(new Date),this.moveTo(new Date,!0),z(this,!1);else if(/^m([0-9]+)/.test(f)){var h=new Date(this.date);h.setDate(1),h.setMonth(RegExp.$1),h.setFullYear(this._getInputYear()),this.moveTo(h,!0),z(this,!1)}else g=="time-am"&&this.setHours(this.getHours()+12);e||X(c)}}function z(a,b){a._menuVisible=b,$(b,a.els.title,"DynarchCalendar-pressed-title");var c=a.els.menu;f&&(c.style.height=a.els.main.offsetHeight+"px");if(!a.args.animation)bg(c,b),a.focused&&a.focus();else{a._menuAnim&&a._menuAnim.stop();var d=a.els.main.offsetHeight;f&&(c.style.width=a.els.topBar.offsetWidth+"px"),b&&(c.firstChild.style.marginTop=-d+"px",a.args.opacity>0&&bf(c,0),bg(c,!0)),a._menuAnim=bd({onUpdate:function(e,f){c.firstChild.style.marginTop=f(be.accel_b(e),-d,0,!b)+"px",a.args.opacity>0&&bf(c,f(be.accel_b(e),0,.85,!b))},onStop:function(){a.args.opacity>0&&bf(c,.85),c.firstChild.style.marginTop="",a._menuAnim=null,b||(bg(c,!1),a.focused&&a.focus())}})}}function y(a,b,c){this._bodyAnim&&this._bodyAnim.stop();var d;if(b!=0){d=new Date(a.date),d.setDate(1);switch(b){case"-Y":case-2:d.setFullYear(d.getFullYear()-1);break;case"+Y":case 2:d.setFullYear(d.getFullYear()+1);break;case"-M":case-1:d.setMonth(d.getMonth()-1);break;case"+M":case 1:d.setMonth(d.getMonth()+1)}}else d=new Date;return a.moveTo(d,!c)}function w(a){switch(a){case"time-hour+":this.setHours(this.getHours()+1);break;case"time-hour-":this.setHours(this.getHours()-1);break;case"time-min+":this.setMinutes(this.getMinutes()+this.args.minuteStep);break;case"time-min-":this.setMinutes(this.getMinutes()-this.args.minuteStep);break;default:return}}function v(){this._bluringTimeout=setTimeout(bb(u,this),50)}function u(){this.focused=!1,Y(this.els.main,"DynarchCalendar-focused"),this._menuVisible&&z(this,!1),this.args.cont||this.hide(),this.callHooks("onBlur",this)}function t(){this._bluringTimeout&&clearTimeout(this._bluringTimeout),this.focused=!0,Z(this.els.main,"DynarchCalendar-focused"),this.callHooks("onFocus",this)}function s(a){var b=_("div"),c=a.els={},d={mousedown:bb(A,a,!0),mouseup:bb(A,a,!1),mouseover:bb(E,a,!0),mouseout:bb(E,a,!1),keypress:bb(J,a)};a.args.noScroll||(d[g?"DOMMouseScroll":"mousewheel"]=bb(F,a)),e&&(d.dblclick=d.mousedown,d.keydown=d.keypress),b.innerHTML=m(a),bc(b.firstChild,function(a){var b=r[a.className];b&&(c[b]=a),e&&a.setAttribute("unselectable","on")}),V(c.main,d),V([c.focusLink,c.yearInput],a._focusEvents={focus:bb(t,a),blur:bb(v,a)}),a.moveTo(a.date,!1),a.setTime(null,!0);return c.topCont}function q(a){function d(){c.showTime&&(b.push("<td>"),p(a,b),b.push("</td>"))}var b=[],c=a.args;b.push("<table",j," style='width:100%'><tr>"),c.timePos=="left"&&d(),c.bottomBar&&(b.push("<td>"),b.push("<table",j,"><tr><td>","<div dyc-btn='today' dyc-cls='hover-bottomBar-today,pressed-bottomBar-today' dyc-type='bottomBar-today' ","class='DynarchCalendar-bottomBar-today'>",L("today"),"</div>","</td></tr></table>"),b.push("</td>")),c.timePos=="right"&&d(),b.push("</tr></table>");return b.join("")}function p(a,b){b.push("<table class='DynarchCalendar-time'"+j+"><tr>","<td rowspan='2'><div dyc-type='time-hour' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-hour'></div></td>","<td dyc-type='time-hour+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td>","<td rowspan='2' class='DynarchCalendar-time-sep'></td>","<td rowspan='2'><div dyc-type='time-min' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-minute'></div></td>","<td dyc-type='time-min+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td>"),a.args.showTime==12&&b.push("<td rowspan='2' class='DynarchCalendar-time-sep'></td>","<td rowspan='2'><div class='DynarchCalendar-time-am' dyc-type='time-am' dyc-cls='hover-time,pressed-time'></div></td>"),b.push("</tr><tr>","<td dyc-type='time-hour-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td>","<td dyc-type='time-min-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td>","</tr></table>")}function o(a){var b=["<table height='100%'",j,"><tr><td>","<table style='margin-top: 1.5em'",j,">","<tr><td colspan='3'><input dyc-btn='year' class='DynarchCalendar-menu-year' size='6' value='",a.date.getFullYear(),"' /></td></tr>","<tr><td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='today'>",L("goToday"),"</div></td></tr>","</table>","<p class='DynarchCalendar-menu-sep'>&nbsp;</p>","<table class='DynarchCalendar-menu-mtable'",j,">"],c=L("smn"),d=0,e=b.length,f;while(d<12){b[e++]="<tr>";for(f=4;--f>0;)b[e++]="<td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='m"+d+"' class='DynarchCalendar-menu-month'>"+c[d++]+"</div></td>";b[e++]="</tr>"}b[e++]="</table></td></tr></table>";return b.join("")}function n(a){return"<div unselectable='on'>"+R(a.date,a.args.titleFormat)+"</div>"}function m(a){var b=["<table class='DynarchCalendar-topCont'",j,"><tr><td>","<div class='DynarchCalendar'>",e?"<a class='DynarchCalendar-focusLink' href='#'></a>":"<button class='DynarchCalendar-focusLink'></button>","<div class='DynarchCalendar-topBar'>","<div dyc-type='nav' dyc-btn='-Y' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-prevYear'><div></div></div>","<div dyc-type='nav' dyc-btn='+Y' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-nextYear'><div></div></div>","<div dyc-type='nav' dyc-btn='-M' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-prevMonth'><div></div></div>","<div dyc-type='nav' dyc-btn='+M' dyc-cls='hover-navBtn,pressed-navBtn' ","class='DynarchCalendar-navBtn DynarchCalendar-nextMonth'><div></div></div>","<table class='DynarchCalendar-titleCont'",j,"><tr><td>","<div dyc-type='title' dyc-btn='menu' dyc-cls='hover-title,pressed-title' class='DynarchCalendar-title'>",n(a),"</div></td></tr></table>","<div class='DynarchCalendar-dayNames'>",k(a),"</div>","</div>","<div class='DynarchCalendar-body'></div>"];(a.args.bottomBar||a.args.showTime)&&b.push("<div class='DynarchCalendar-bottomBar'>",q(a),"</div>"),b.push("<div class='DynarchCalendar-menu' style='display: none'>",o(a),"</div>","<div class='DynarchCalendar-tooltip'></div>","</div>","</td></tr></table>");return b.join("")}function l(a,b,c){b=b||a.date,c=c||a.fdow,b=new Date(b.getFullYear(),b.getMonth(),b.getDate(),12,0,0,0);var d=b.getMonth(),e=[],f=0,g=a.args.weekNumbers;b.setDate(1);var h=(b.getDay()-c)%7;h<0&&(h+=7),b.setDate(0-h),b.setDate(b.getDate()+1);var i=new Date,k=i.getDate(),l=i.getMonth(),m=i.getFullYear();e[f++]="<table class='DynarchCalendar-bodyTable'"+j+">";for(var n=0;n<6;++n){e[f++]="<tr class='DynarchCalendar-week",n==0&&(e[f++]=" DynarchCalendar-first-row"),n==5&&(e[f++]=" DynarchCalendar-last-row"),e[f++]="'>",g&&(e[f++]="<td class='DynarchCalendar-first-col'><div class='DynarchCalendar-weekNumber'>"+M(b)+"</div></td>");for(var o=0;o<7;++o){var p=b.getDate(),q=b.getMonth(),r=b.getFullYear(),s=1e4*r+100*(q+1)+p,t=a.selection.isSelected(s),u=a.isDisabled(b);e[f++]="<td class='",o==0&&!g&&(e[f++]=" DynarchCalendar-first-col"),o==0&&n==0&&(a._firstDateVisible=s),o==6&&(e[f++]=" DynarchCalendar-last-col",n==5&&(a._lastDateVisible=s)),t&&(e[f++]=" DynarchCalendar-td-selected"),e[f++]="'><div dyc-type='date' unselectable='on' dyc-date='"+s+"' ",u&&(e[f++]="disabled='1' "),e[f++]="class='DynarchCalendar-day",L("weekend").indexOf(b.getDay())>=0&&(e[f++]=" DynarchCalendar-weekend"),q!=d&&(e[f++]=" DynarchCalendar-day-othermonth"),p==k&&q==l&&r==m&&(e[f++]=" DynarchCalendar-day-today"),u&&(e[f++]=" DynarchCalendar-day-disabled"),t&&(e[f++]=" DynarchCalendar-day-selected"),u=a.args.dateInfo(b),u&&u.klass&&(e[f++]=" "+u.klass),e[f++]="'>"+p+"</div></td>",b=new Date(r,q,p+1,12,0,0,0)}e[f++]="</tr>"}e[f++]="</table>";return e.join("")}function k(a){var b=["<table",j,"><tr>"],c=0;a.args.weekNumbers&&b.push("<td><div class='DynarchCalendar-weekNumber'>",L("wk"),"</div></td>");while(c<7){var d=(c++ +a.fdow)%7;b.push("<td><div",L("weekend").indexOf(d)>=0?" class='DynarchCalendar-weekend'>":">",L("sdn")[d],"</div></td>")}b.push("</tr></table>");return b.join("")}function a(b){b=b||{},this.args=b=U(b,{animation:!f,cont:null,bottomBar:!0,date:!0,fdow:L("fdow"),min:null,max:null,reverseWheel:!1,selection:[],selectionType:a.SEL_SINGLE,weekNumbers:!1,align:"Bl/ / /T/r",inputField:null,trigger:null,dateFormat:"%Y-%m-%d",fixed:!1,opacity:e?1:3,titleFormat:"%b %Y",showTime:!1,timePos:"right",time:!0,minuteStep:5,noScroll:!1,disabled:bl,checkRange:!1,dateInfo:bl,onChange:bl,onSelect:bl,onTimeChange:bl,onFocus:bl,onBlur:bl}),this.handlers={};var c=this,d=new Date;b.min=S(b.min),b.max=S(b.max),b.date===!0&&(b.date=d),b.time===!0&&(b.time=d.getHours()*100+Math.floor(d.getMinutes()/b.minuteStep)*b.minuteStep),this.date=S(b.date),this.time=b.time,this.fdow=b.fdow,bk("onChange onSelect onTimeChange onFocus onBlur".split(/\s+/),function(a){var d=b[a];d instanceof Array||(d=[d]),c.handlers[a]=d}),this.selection=new a.Selection(b.selection,b.selectionType,G,this);var g=s(this);b.cont&&bm(b.cont).appendChild(g),b.trigger&&this.manageFields(b.trigger,b.inputField,b.dateFormat)}var b=navigator.userAgent,c=/opera/i.test(b),d=/Konqueror|Safari|KHTML/i.test(b),e=/msie/i.test(b)&&!c&&!/mac_powerpc/i.test(b),f=e&&/msie 6/i.test(b),g=/gecko/i.test(b)&&!d&&!c&&!e,h=a.prototype,i=a.I18N={};a.SEL_NONE=0,a.SEL_SINGLE=1,a.SEL_MULTIPLE=2,a.SEL_WEEK=3,a.dateToInt=O,a.intToDate=P,a.printDate=R,a.formatString=K,a.i18n=L,a.LANG=function(a,b,c){i.__=i[a]={name:b,data:c}},a.setup=function(b){return new a(b)},h.moveTo=function(a,b){var c=this;a=S(a);var d=Q(a,c.date,!0),e,f=c.args,g=f.min&&Q(a,f.min),h=f.max&&Q(a,f.max);f.animation||(b=!1),$(g!=null&&g<=1,[c.els.navPrevMonth,c.els.navPrevYear],"DynarchCalendar-navDisabled"),$(h!=null&&h>=-1,[c.els.navNextMonth,c.els.navNextYear],"DynarchCalendar-navDisabled"),g<-1&&(a=f.min,e=1,d=0),h>1&&(a=f.max,e=2,d=0),c.date=a,c.refresh(!!b),c.callHooks("onChange",c,a,b);if(b&&(d!=0||b!=2)){c._bodyAnim&&c._bodyAnim.stop();var i=c.els.body,j=_("div","DynarchCalendar-animBody-"+x[d],i),k=i.firstChild,m=bf(k)||.7,n=e?be.brakes:d==0?be.shake:be.accel_ab2,o=d*d>4,p=o?k.offsetTop:k.offsetLeft,q=j.style,r=o?i.offsetHeight:i.offsetWidth;d<0?r+=p:d>0?r=p-r:(r=Math.round(r/7),e==2&&(r=-r));if(!e&&d!=0){var s=j.cloneNode(!0),t=s.style,u=2*r;s.appendChild(k.cloneNode(!0)),t[o?"marginTop":"marginLeft"]=r+"px",i.appendChild(s)}k.style.visibility="hidden",j.innerHTML=l(c),c._bodyAnim=bd({onUpdate:function(a,b){var f=n(a);if(s)var g=b(f,r,u)+"px";if(e)q[o?"marginTop":"marginLeft"]=b(f,r,0)+"px";else{if(o||d==0)q.marginTop=b(d==0?n(a*a):f,0,r)+"px",d!=0&&(t.marginTop=g);if(!o||d==0)q.marginLeft=b(f,0,r)+"px",d!=0&&(t.marginLeft=g)}c.args.opacity>2&&s&&(bf(s,1-f),bf(j,f))},onStop:function(b){i.innerHTML=l(c,a),c._bodyAnim=null}})}c._lastHoverDate=null;return g>=-1&&h<=1},h.isDisabled=function(a){var b=this.args;return b.min&&Q(a,b.min)<0||b.max&&Q(a,b.max)>0||b.disabled(a)},h.toggleMenu=function(){z(this,!this._menuVisible)},h.refresh=function(a){var b=this.els;a||(b.body.innerHTML=l(this)),b.title.innerHTML=n(this),b.yearInput.value=this.date.getFullYear()},h.redraw=function(){var a=this,b=a.els;a.refresh(),b.dayNames.innerHTML=k(a),b.menu.innerHTML=o(a),b.bottomBar&&(b.bottomBar.innerHTML=q(a)),bc(b.topCont,function(c){var d=r[c.className];d&&(b[d]=c),c.className=="DynarchCalendar-menu-year"?(V(c,a._focusEvents),b.yearInput=c):e&&c.setAttribute("unselectable","on")}),a.setTime(null,!0)},h.setLanguage=function(b){var c=a.setLanguage(b);c&&(this.fdow=c.data.fdow,this.redraw())},a.setLanguage=function(a){var b=i[a];b&&(i.__=b);return b},h.focus=function(){try{this.els[this._menuVisible?"yearInput":"focusLink"].focus()}catch(a){}t.call(this)},h.blur=function(){this.els.focusLink.blur(),this.els.yearInput.blur(),u.call(this)},h.showAt=function(a,b,c){this._showAnim&&this._showAnim.stop(),c=c&&this.args.animation;var d=this.els.topCont,e=this,f=this.els.body.firstChild,g=f.offsetHeight,h=d.style;h.position="absolute",h.left=a+"px",h.top=b+"px",h.zIndex=1e4,h.display="",c&&(f.style.marginTop=-g+"px",this.args.opacity>1&&bf(d,0),this._showAnim=bd({onUpdate:function(a,b){f.style.marginTop=-b(be.accel_b(a),g,0)+"px",e.args.opacity>1&&bf(d,a)},onStop:function(){e.args.opacity>1&&bf(d,""),e._showAnim=null}}))},h.hide=function(){var a=this.els.topCont,b=this,c=this.els.body.firstChild,d=c.offsetHeight,e=bi(a).y;this.args.animation?(this._showAnim&&this._showAnim.stop(),this._showAnim=bd({onUpdate:function(f,g){b.args.opacity>1&&bf(a,1-f),c.style.marginTop=-g(be.accel_b(f),0,d)+"px",a.style.top=g(be.accel_ab(f),e,e-10)+"px"},onStop:function(){a.style.display="none",c.style.marginTop="",b.args.opacity>1&&bf(a,""),b._showAnim=null}})):a.style.display="none",this.inputField=null},h.popup=function(a,b){function h(b){var c={x:i.x,y:i.y};if(!b)return c;/B/.test(b)&&(c.y+=a.offsetHeight),/b/.test(b)&&(c.y+=a.offsetHeight-f.y),/T/.test(b)&&(c.y-=f.y),/l/.test(b)&&(c.x-=f.x-a.offsetWidth),/L/.test(b)&&(c.x-=f.x),/R/.test(b)&&(c.x+=a.offsetWidth),/c/i.test(b)&&(c.x+=(a.offsetWidth-f.x)/2),/m/i.test(b)&&(c.y+=(a.offsetHeight-f.y)/2);return c}a=bm(a),b||(b=this.args.align),b=b.split(/\x2f/);var c=bi(a),d=this.els.topCont,e=d.style,f,g=bj();e.visibility="hidden",e.display="",this.showAt(0,0),document.body.appendChild(d),f={x:d.offsetWidth,y:d.offsetHeight};var i=c;i=h(b[0]),i.y<g.y&&(i.y=c.y,i=h(b[1])),i.x+f.x>g.x+g.w&&(i.x=c.x,i=h(b[2])),i.y+f.y>g.y+g.h&&(i.y=c.y,i=h(b[3])),i.x<g.x&&(i.x=c.x,i=h(b[4])),this.showAt(i.x,i.y,!0),e.visibility="",this.focus()},h.manageFields=function(b,c,d){var e=this;c=bm(c),b=bm(b),/^button$/i.test(b.tagName)&&b.setAttribute("type","button"),V(b,"click",function(){e.inputField=c,e.dateFormat=d;if(e.selection.type==a.SEL_SINGLE){var f,g,h,i;f=/input|textarea/i.test(c.tagName)?c.value:c.innerText||c.textContent,f&&(g=/(^|[^%])%[bBmo]/.exec(d),h=/(^|[^%])%[de]/.exec(d),g&&h&&(i=g.index<h.index),f=Calendar.parseDate(f,i),f&&(e.selection.set(f,!1,!0),e.args.showTime&&(e.setHours(f.getHours()),e.setMinutes(f.getMinutes())),e.moveTo(f)))}e.popup(b)})},h.callHooks=function(a){var b=ba(arguments,1),c=this.handlers[a],d=0;for(;d<c.length;++d)c[d].apply(this,b)},h.addEventListener=function(a,b){this.handlers[a].push(b)},h.removeEventListener=function(a,b){var c=this.handlers[a],d=c.length;while(--d>=0)c[d]===b&&c.splice(d,1)},h.getTime=function(){return this.time},h.setTime=function(a,b){if(this.args.showTime){a=a!=null?a:this.time,this.time=a;var c=this.getHours(),d=this.getMinutes(),e=c<12;this.args.showTime==12&&(c==0&&(c=12),c>12&&(c-=12),this.els.timeAM.innerHTML=L(e?"AM":"PM")),c<10&&(c="0"+c),d<10&&(d="0"+d),this.els.timeHour.innerHTML=c,this.els.timeMinute.innerHTML=d,b||this.callHooks("onTimeChange",this,a)}},h.getHours=function(){return Math.floor(this.time/100)},h.getMinutes=function(){return this.time%100},h.setHours=function(a){a<0&&(a+=24),this.setTime(100*(a%24)+this.time%100)},h.setMinutes=function(a){a<0&&(a+=60),a=Math.floor(a/this.args.minuteStep)*this.args.minuteStep,this.setTime(100*this.getHours()+a%60)},h._getInputYear=function(){var a=parseInt(this.els.yearInput.value,10);isNaN(a)&&(a=this.date.getFullYear());return a},h._showTooltip=function(a){var b="",c,d=this.els.tooltip;a&&(a=P(a),c=this.args.dateInfo(a),c&&c.tooltip&&(b="<div class='DynarchCalendar-tooltipCont'>"+R(a,c.tooltip)+"</div>")),d.innerHTML=b};var j=" align='center' cellspacing='0' cellpadding='0'",r={"DynarchCalendar-topCont":"topCont","DynarchCalendar-focusLink":"focusLink",DynarchCalendar:"main","DynarchCalendar-topBar":"topBar","DynarchCalendar-title":"title","DynarchCalendar-dayNames":"dayNames","DynarchCalendar-body":"body","DynarchCalendar-menu":"menu","DynarchCalendar-menu-year":"yearInput","DynarchCalendar-bottomBar":"bottomBar","DynarchCalendar-tooltip":"tooltip","DynarchCalendar-time-hour":"timeHour","DynarchCalendar-time-minute":"timeMinute","DynarchCalendar-time-am":"timeAM","DynarchCalendar-navBtn DynarchCalendar-prevYear":"navPrevYear","DynarchCalendar-navBtn DynarchCalendar-nextYear":"navNextYear","DynarchCalendar-navBtn DynarchCalendar-prevMonth":"navPrevMonth","DynarchCalendar-navBtn DynarchCalendar-nextMonth":"navNextMonth"},x={"-3":"backYear","-2":"back",0:"now",2:"fwd",3:"fwdYear"},H={37:-1,38:-2,39:1,40:2},I={33:-1,34:1};h._getDateDiv=function(a){var b=null;if(a)try{bc(this.els.body,function(c){if(c.getAttribute("dyc-date")==a)throw b=c})}catch(c){}return b},(a.Selection=function(a,b,c,d){this.type=b,this.sel=a instanceof Array?a:[a],this.onChange=bb(c,d),this.cal=d}).prototype={get:function(){return this.type==a.SEL_SINGLE?this.sel[0]:this.sel},isEmpty:function(){return this.sel.length==0},set:function(b,c,d){var e=this.type==a.SEL_SINGLE;b instanceof Array?(this.sel=b,this.normalize(),d||this.onChange(this)):(b=O(b),e||!this.isSelected(b)?(e?this.sel=[b]:this.sel.splice(this.findInsertPos(b),0,b),this.normalize(),d||this.onChange(this)):c&&this.unselect(b,d))},reset:function(){this.sel=[],this.set.apply(this,arguments)},countDays:function(){var a=0,b=this.sel,c=b.length,d,e,f;while(--c>=0)d=b[c],d instanceof Array&&(e=P(d[0]),f=P(d[1]),a+=Math.round(Math.abs(f.getTime()-e.getTime())/864e5)),++a;return a},unselect:function(a,b){a=O(a);var c=!1;for(var d=this.sel,e=d.length,f;--e>=0;){f=d[e];if(f instanceof Array){if(a>=f[0]&&a<=f[1]){var g=P(a),h=g.getDate();if(a==f[0])g.setDate(h+1),f[0]=O(g),c=!0;else if(a==f[1])g.setDate(h-1),f[1]=O(g),c=!0;else{var i=new Date(g);i.setDate(h+1),g.setDate(h-1),d.splice(e+1,0,[O(i),f[1]]),f[1]=O(g),c=!0}}}else a==f&&(d.splice(e,1),c=!0)}c&&(this.normalize(),b||this.onChange(this))},normalize:function(){this.sel=this.sel.sort(function(a,b){a instanceof Array&&(a=a[0]),b instanceof Array&&(b=b[0]);return a-b});for(var a=this.sel,b=a.length,c,d;--b>=0;){c=a[b];if(c instanceof Array){if(c[0]>c[1]){a.splice(b,1);continue}c[0]==c[1]&&(c=a[b]=c[0])}if(d){var e=d,f=c instanceof Array?c[1]:c;f=P(f),f.setDate(f.getDate()+1),f=O(f);if(f>=e){var g=a[b+1];c instanceof Array&&g instanceof Array?(c[1]=g[1],a.splice(b+1,1)):c instanceof Array?(c[1]=d,a.splice(b+1,1)):g instanceof Array?(g[0]=c,a.splice(b,1)):(a[b]=[c,g],a.splice(b+1,1))}}d=c instanceof Array?c[0]:c}},findInsertPos:function(a){for(var b=this.sel,c=b.length,d;--c>=0;){d=b[c],d instanceof Array&&(d=d[0]);if(d<=a)break}return c+1},clear:function(a){this.sel=[],a||this.onChange(this)},selectRange:function(b,c){b=O(b),c=O(c);if(b>c){var d=b;b=c,c=d}var e=this.cal.args.checkRange;if(!e)return this._do_selectRange(b,c);try{bk((new a.Selection([[b,c]],a.SEL_MULTIPLE,bl)).getDates(),bb(function(a){if(this.isDisabled(a)){e instanceof Function&&e(a,this);throw"OUT"}},this.cal)),this._do_selectRange(b,c)}catch(f){}},_do_selectRange:function(a,b){this.sel.push([a,b]),this.normalize(),this.onChange(this)},isSelected:function(a){for(var b=this.sel.length,c;--b>=0;){c=this.sel[b];if(c instanceof Array&&a>=c[0]&&a<=c[1]||a==c)return!0}return!1},getFirstDate:function(){var a=this.sel[0];a&&a instanceof Array&&(a=a[0]);return a},getLastDate:function(){if(this.sel.length>0){var a=this.sel[this.sel.length-1];a&&a instanceof Array&&(a=a[1]);return a}},print:function(a,b){var c=[],d=0,e,f=this.cal.getHours(),g=this.cal.getMinutes();b||(b=" -> ");while(d<this.sel.length)e=this.sel[d++],e instanceof Array?c.push(R(P(e[0],f,g),a)+b+R(P(e[1],f,g),a)):c.push(R(P(e,f,g),a));return c},getDates:function(a){var b=[],c=0,d,e;while(c<this.sel.length){e=this.sel[c++];if(e instanceof Array){d=P(e[0]),e=e[1];while(O(d)<e)b.push(a?R(d,a):new Date(d)),d.setDate(d.getDate()+1)}else d=P(e);b.push(a?R(d,a):d)}return b}},a.isUnicodeLetter=function(a){return a.toUpperCase()!=a.toLowerCase()},a.parseDate=function(b,c,d){if(!/\S/.test(b))return"";b=b.replace(/^\s+/,"").replace(/\s+$/,""),d=d||new Date;var e=null,f=null,g=null,h=null,i=null,j=null,k=b.match(/([0-9]{1,2}):([0-9]{1,2})(:[0-9]{1,2})?\s*(am|pm)?/i);k&&(h=parseInt(k[1],10),i=parseInt(k[2],10),j=k[3]?parseInt(k[3].substr(1),10):0,b=b.substring(0,k.index)+b.substr(k.index+k[0].length),k[4]&&(k[4].toLowerCase()=="pm"&&h<12?h+=12:k[4].toLowerCase()=="am"&&h>=12&&(h-=12)));var l=function(){function k(a){d.push(a)}function j(){var a="";while(g()&&/[0-9]/.test(g()))a+=f();if(h(g()))return i(a);return parseInt(a,10)}function i(a){while(g()&&h(g()))a+=f();return a}function g(){return b.charAt(c)}function f(){return b.charAt(c++)}var c=0,d=[],e,h=a.isUnicodeLetter;while(c<b.length)e=g(),h(e)?k(i("")):/[0-9]/.test(e)?k(j()):f();return d}(),m=[];for(var n=0;n<l.length;++n){var o=l[n];/^[0-9]{4}$/.test(o)?(e=parseInt(o,10),f==null&&g==null&&c==null&&(c=!0)):/^[0-9]{1,2}$/.test(o)?(o=parseInt(o,10),o<60?o<0||o>12?o>=1&&o<=31&&(g=o):m.push(o):e=o):f==null&&(f=T(o))}m.length<2?m.length==1&&(g==null?g=m.shift():f==null&&(f=m.shift())):c?(f==null&&(f=m.shift()),g==null&&(g=m.shift())):(g==null&&(g=m.shift()),f==null&&(f=m.shift())),e==null&&(e=m.length>0?m.shift():d.getFullYear()),e<30?e+=2e3:e<99&&(e+=1900),f==null&&(f=d.getMonth()+1);return e!=null&&f!=null&&g!=null?new Date(e,f-1,g,h,i,j):null};var be={elastic_b:function(a){return 1-Math.cos(-a*5.5*Math.PI)/Math.pow(2,7*a)},magnetic:function(a){return 1-Math.cos(a*a*a*10.5*Math.PI)/Math.exp(4*a)},accel_b:function(a){a=1-a;return 1-a*a*a*a},accel_a:function(a){return a*a*a},accel_ab:function(a){a=1-a;return 1-Math.sin(a*a*Math.PI/2)},accel_ab2:function(a){return(a/=.5)<1?.5*a*a:-0.5*(--a*(a-2)-1)},brakes:function(a){a=1-a;return 1-Math.sin(a*a*Math.PI)},shake:function(a){return a<.5?-Math.cos(a*11*Math.PI)*a*a:(a=1-a,Math.cos(a*11*Math.PI)*a*a)}},bl=new Function;return a}()
Calendar.isUnicodeLetter=(function(){var rx=new RegExp("[\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0523\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0621-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971\\u0972\\u097B-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D28\\u0D2A-\\u0D39\\u0D3D\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC\\u0EDD\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8B\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10D0-\\u10FA\\u10FC\\u1100-\\u1159\\u115F-\\u11A2\\u11A8-\\u11F9\\u1200-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u1676\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19A9\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u2094\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2C6F\\u2C71-\\u2C7D\\u2C80-\\u2CE4\\u2D00-\\u2D25\\u2D30-\\u2D65\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31B7\\u31F0-\\u31FF\\u3400\\u4DB5\\u4E00\\u9FC3\\uA000-\\uA48C\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA65F\\uA662-\\uA66E\\uA67F-\\uA697\\uA717-\\uA71F\\uA722-\\uA788\\uA78B\\uA78C\\uA7FB-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA90A-\\uA925\\uA930-\\uA946\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAC00\\uD7A3\\uF900-\\uFA2D\\uFA30-\\uFA6A\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]","i");return function(ch){return rx.test(ch);};})();Calendar.LANG("cn","中文",{fdow:1,goToday:"今天",today:"今天",wk:"周",weekend:"0,6",AM:"AM",PM:"PM",mn:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],smn:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dn:["日","一","二","三","四","五","六","日"],sdn:["日","一","二","三","四","五","六","日"]});(function($){return $.fn.serializeObject=function(){var json,patterns,push_counters,_this=this;json={};push_counters={};patterns={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};this.build=function(base,key,value){base[key]=value;return base;};this.push_counter=function(key){if(push_counters[key]===void 0){push_counters[key]=0;}
return push_counters[key]++;};$.each($(this).serializeArray(),function(i,elem){var k,keys,merge,re,reverse_key;if(!patterns.validate.test(elem.name)){return;}
keys=elem.name.match(patterns.key);merge=elem.value;reverse_key=elem.name;while((k=keys.pop())!==void 0){if(patterns.push.test(k)){re=new RegExp("\\["+k+"\\]$");reverse_key=reverse_key.replace(re,'');merge=_this.build([],_this.push_counter(reverse_key),merge);}else if(patterns.fixed.test(k)){merge=_this.build([],k,merge);}else if(patterns.named.test(k)){merge=_this.build({},k,merge);}}
return json=$.extend(true,json,merge);});return json;};})(jQuery);(function($,undefined)
{function TextExt(){};function ItemManager(){};function TextExtPlugin(){};var stringify=(JSON||{}).stringify,slice=Array.prototype.slice,p,UNDEFINED='undefined',OPT_ITEM_MANAGER='item.manager',OPT_PLUGINS='plugins',OPT_EXT='ext',OPT_HTML_WRAP='html.wrap',OPT_HTML_HIDDEN='html.hidden',OPT_KEYS='keys',EVENT_PRE_INVALIDATE='preInvalidate',EVENT_POST_INVALIDATE='postInvalidate',EVENT_GET_FORM_DATA='getFormData',EVENT_SET_FORM_DATA='setFormData',EVENT_SET_INPUT_DATA='setInputData',EVENT_POST_INIT='postInit',EVENT_READY='ready',DEFAULT_OPTS={itemManager:ItemManager,plugins:[],ext:{},html:{wrap:'<div class="text-core"><div class="text-wrap"/></div>',hidden:'<input type="hidden" />'},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter'}};if(!stringify)
throw new Error('JSON.stringify() not found');function getProperty(source,name)
{if(typeof(name)==='string')
name=name.split('.');var fullCamelCaseName=name.join('.').replace(/\.(\w)/g,function(match,letter){return letter.toUpperCase()}),nestedName=name.shift(),result;if(typeof(result=source[fullCamelCaseName])!=UNDEFINED)
result=result;else if(typeof(result=source[nestedName])!=UNDEFINED&&name.length>0)
result=getProperty(result,name);return result;};function hookupEvents()
{var args=slice.apply(arguments),self=this,target=args.length===1?self:args.shift(),event;args=args[0]||{};function bind(event,handler)
{target.bind(event,function()
{return handler.apply(self,arguments);});}
for(event in args)
bind(event,args[event]);};function formDataObject(input,form)
{return{'input':input,'form':form};};p=ItemManager.prototype;p.init=function(core)
{};p.filter=function(list,query)
{var result=[],i,item;for(i=0;i<list.length;i++)
{item=list[i];if(this.itemContains(item,query))
result.push(item);}
return result;};p.itemContains=function(item,needle)
{return this.itemToString(item).toLowerCase().indexOf(needle.toLowerCase())==0;};p.stringToItem=function(str)
{return str;};p.itemToString=function(item)
{return item;};p.compareItems=function(item1,item2)
{return item1==item2;};p=TextExt.prototype;p.init=function(input,opts)
{var self=this,hiddenInput,itemManager,container;self._defaults=$.extend({},DEFAULT_OPTS);self._opts=opts||{};self._plugins={};self._itemManager=itemManager=new(self.opts(OPT_ITEM_MANAGER))();input=$(input);container=$(self.opts(OPT_HTML_WRAP));hiddenInput=$(self.opts(OPT_HTML_HIDDEN));input.wrap(container).keydown(function(e){return self.onKeyDown(e)}).keyup(function(e){return self.onKeyUp(e)}).data('textext',self);$(self).data({'hiddenInput':hiddenInput,'wrapElement':input.parents('.text-wrap').first(),'input':input});hiddenInput.attr('name',input.attr('name'));input.attr('name',null);hiddenInput.insertAfter(input);$.extend(true,itemManager,self.opts(OPT_EXT+'.item.manager'));$.extend(true,self,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.core'));self.originalWidth=input.outerWidth();self.invalidateBounds();itemManager.init(self);self.initPatches();self.initPlugins(self.opts(OPT_PLUGINS),$.fn.textext.plugins);self.on({setFormData:self.onSetFormData,getFormData:self.onGetFormData,setInputData:self.onSetInputData,anyKeyUp:self.onAnyKeyUp});self.trigger(EVENT_POST_INIT);self.trigger(EVENT_READY);self.getFormData(0);};p.initPatches=function()
{var list=[],source=$.fn.textext.patches,name;for(name in source)
list.push(name);this.initPlugins(list,source);};p.initPlugins=function(plugins,source)
{var self=this,ext,name,plugin,initList=[],i;if(typeof(plugins)=='string')
plugins=plugins.split(/\s*,\s*|\s+/g);for(i=0;i<plugins.length;i++)
{name=plugins[i];plugin=source[name];if(plugin)
{self._plugins[name]=plugin=new plugin();self[name]=(function(plugin){return function(){return plugin;}})(plugin);initList.push(plugin);$.extend(true,plugin,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.'+name));}}
initList.sort(function(p1,p2)
{p1=p1.initPriority();p2=p2.initPriority();return p1===p2?0:p1<p2?1:-1;});for(i=0;i<initList.length;i++)
initList[i].init(self);};p.hasPlugin=function(name)
{return!!this._plugins[name];};p.on=hookupEvents;p.bind=function(event,handler)
{this.input().bind(event,handler);};p.trigger=function()
{var args=arguments;this.input().trigger(args[0],slice.call(args,1));};p.itemManager=function()
{return this._itemManager;};p.input=function()
{return $(this).data('input');};p.opts=function(name)
{var result=getProperty(this._opts,name);return typeof(result)=='undefined'?getProperty(this._defaults,name):result;};p.wrapElement=function()
{return $(this).data('wrapElement');};p.invalidateBounds=function()
{var self=this,input=self.input(),wrap=self.wrapElement(),container=wrap.parent(),width=self.originalWidth+'px',height;self.trigger(EVENT_PRE_INVALIDATE);height=input.outerHeight()+'px';input.css({'width':width});wrap.css({'width':width,'height':height});container.css({'height':height});self.trigger(EVENT_POST_INVALIDATE);};p.focusInput=function()
{this.input()[0].focus();};p.serializeData=stringify;p.hiddenInput=function(value)
{return $(this).data('hiddenInput');};p.getWeightedEventResponse=function(event,args)
{var self=this,data={},maxWeight=0;self.trigger(event,data,args);for(var weight in data)
maxWeight=Math.max(maxWeight,weight);return data[maxWeight];};p.getFormData=function(keyCode)
{var self=this,data=self.getWeightedEventResponse(EVENT_GET_FORM_DATA,keyCode||0);self.trigger(EVENT_SET_FORM_DATA,data['form']);self.trigger(EVENT_SET_INPUT_DATA,data['input']);};p.onAnyKeyUp=function(e,keyCode)
{this.getFormData(keyCode);};p.onSetInputData=function(e,data)
{this.input().val(data);};p.onSetFormData=function(e,data)
{var self=this;self.hiddenInput().val(self.serializeData(data));};p.onGetFormData=function(e,data)
{var val=this.input().val();data[0]=formDataObject(val,val);};$(['Down','Up']).each(function()
{var type=this.toString();p['onKey'+type]=function(e)
{var self=this,keyName=self.opts(OPT_KEYS)[e.keyCode],defaultResult=true;if(keyName)
{defaultResult=keyName.substr(-1)!='!';keyName=keyName.replace('!','');self.trigger(keyName+'Key'+type);if(type=='Up'&&self._lastKeyDown==e.keyCode)
{self._lastKeyDown=null;self.trigger(keyName+'KeyPress');}
if(type=='Down')
self._lastKeyDown=e.keyCode;}
self.trigger('anyKey'+type,e.keyCode);return defaultResult;};});p=TextExtPlugin.prototype;p.on=hookupEvents;p.formDataObject=formDataObject;p.init=function(core){throw new Error('Not implemented')};p.baseInit=function(core,defaults)
{var self=this;core._defaults=$.extend(true,core._defaults,defaults);self._core=core;self._timers={};};p.startTimer=function(name,delay,callback)
{var self=this;self.stopTimer(name);self._timers[name]=setTimeout(function()
{delete self._timers[name];callback.apply(self);},delay*1000);};p.stopTimer=function(name)
{clearTimeout(this._timers[name]);};p.core=function()
{return this._core;};p.opts=function(name)
{return this.core().opts(name);};p.itemManager=function()
{return this.core().itemManager();};p.input=function()
{return this.core().input();};p.val=function(value)
{var input=this.input();if(typeof(value)===UNDEFINED)
return input.val();else
input.val(value);};p.trigger=function()
{var core=this.core();core.trigger.apply(core,arguments);};p.bind=function(event,handler)
{this.core().bind(event,handler);};p.initPriority=function()
{return 0;};var cssInjected=false;var textext=$.fn.textext=function(opts)
{var css;if(!cssInjected&&(css=$.fn.textext.css)!=null)
{$('head').append('<style>'+css+'</style>');cssInjected=true;}
return this.map(function()
{var self=$(this);if(opts==null)
return self.data('textext');var instance=new TextExt();instance.init(self,opts);self.data('textext',instance);return instance.input()[0];});};textext.addPlugin=function(name,constructor)
{textext.plugins[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.addPatch=function(name,constructor)
{textext.patches[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.TextExt=TextExt;textext.TextExtPlugin=TextExtPlugin;textext.ItemManager=ItemManager;textext.plugins={};textext.patches={};})(jQuery);(function($)
{function TextExtIE9Patches(){};$.fn.textext.TextExtIE9Patches=TextExtIE9Patches;$.fn.textext.addPatch('ie9',TextExtIE9Patches);var p=TextExtIE9Patches.prototype;p.init=function(core)
{if(navigator.userAgent.indexOf('MSIE 9')==-1)
return;var self=this;core.on({postInvalidate:self.onPostInvalidate});};p.onPostInvalidate=function()
{var self=this,input=self.input(),val=input.val();input.val(Math.random());input.val(val);};})(jQuery);(function($)
{function TextExtAjax(){};$.fn.textext.TextExtAjax=TextExtAjax;$.fn.textext.addPlugin('ajax',TextExtAjax);var p=TextExtAjax.prototype,OPT_DATA_CALLBACK='ajax.data.callback',OPT_CACHE_RESULTS='ajax.cache.results',OPT_LOADING_DELAY='ajax.loading.delay',OPT_LOADING_MESSAGE='ajax.loading.message',OPT_TYPE_DELAY='ajax.type.delay',EVENT_SET_SUGGESTION='setSuggestions',EVENT_SHOW_DROPDOWN='showDropdown',TIMER_LOADING='loading',DEFAULT_OPTS={ajax:{typeDelay:0.5,loadingMessage:'Loading...',loadingDelay:0.5,cacheResults:false,dataCallback:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions});self._suggestions=null;};p.load=function(query)
{var self=this,dataCallback=self.opts(OPT_DATA_CALLBACK)||function(query){return{q:query}},opts;opts=$.extend(true,{data:dataCallback(query),success:function(data){self.onComplete(data,query)},error:function(jqXHR,message){console.error(message,query)}},self.opts('ajax'));$.ajax(opts);};p.onComplete=function(data,query)
{var self=this,result=data;self.dontShowLoading();if(self.opts(OPT_CACHE_RESULTS)==true)
{self._suggestions=data;result=self.itemManager().filter(data,query);}
self.trigger(EVENT_SET_SUGGESTION,{result:result});};p.dontShowLoading=function()
{this.stopTimer(TIMER_LOADING);};p.showLoading=function()
{var self=this;self.dontShowLoading();self.startTimer(TIMER_LOADING,self.opts(OPT_LOADING_DELAY),function()
{self.trigger(EVENT_SHOW_DROPDOWN,function(autocomplete)
{autocomplete.clearItems();var node=autocomplete.addDropdownItem(self.opts(OPT_LOADING_MESSAGE));node.addClass('text-loading');});});};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions,query=(data||{}).query||'';if(suggestions&&self.opts(OPT_CACHE_RESULTS)===true)
return self.onComplete(suggestions,query);self.startTimer('ajax',self.opts(OPT_TYPE_DELAY),function()
{self.showLoading();self.load(query);});};})(jQuery);(function($)
{function TextExtArrow(){};$.fn.textext.TextExtArrow=TextExtArrow;$.fn.textext.addPlugin('arrow',TextExtArrow);var p=TextExtArrow.prototype,OPT_HTML_ARROW='html.arrow',DEFAULT_OPTS={html:{arrow:'<div class="text-arrow"/>'}};p.init=function(core)
{var self=this,arrow;self.baseInit(core,DEFAULT_OPTS);self._arrow=arrow=$(self.opts(OPT_HTML_ARROW));self.core().wrapElement().append(arrow);arrow.bind('click',function(e){self.onArrowClick(e);});};p.onArrowClick=function(e)
{this.trigger('toggleDropdown');this.core().focusInput();};})(jQuery);(function($)
{function TextExtAutocomplete(){};$.fn.textext.TextExtAutocomplete=TextExtAutocomplete;$.fn.textext.addPlugin('autocomplete',TextExtAutocomplete);var p=TextExtAutocomplete.prototype,CSS_DOT='.',CSS_SELECTED='text-selected',CSS_DOT_SELECTED=CSS_DOT+CSS_SELECTED,CSS_SUGGESTION='text-suggestion',CSS_DOT_SUGGESTION=CSS_DOT+CSS_SUGGESTION,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,OPT_ENABLED='autocomplete.enabled',OPT_POSITION='autocomplete.dropdown.position',OPT_MAX_HEIGHT='autocomplete.dropdown.maxHeight',OPT_RENDER='autocomplete.render',OPT_HTML_DROPDOWN='html.dropdown',OPT_HTML_SUGGESTION='html.suggestion',EVENT_HIDE_DROPDOWN='hideDropdown',EVENT_SHOW_DROPDOWN='showDropdown',EVENT_GET_SUGGESTIONS='getSuggestions',EVENT_GET_FORM_DATA='getFormData',EVENT_TOGGLE_DROPDOWN='toggleDropdown',POSITION_ABOVE='above',POSITION_BELOW='below',DATA_MOUSEDOWN_ON_AUTOCOMPLETE='mousedownOnAutocomplete',DEFAULT_OPTS={autocomplete:{enabled:true,dropdown:{position:POSITION_BELOW,maxHeight:'100px'}},html:{dropdown:'<div class="text-dropdown"><div class="text-list"/></div>',suggestion:'<div class="text-suggestion"><span class="text-label"/></div>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);var input=self.input(),container;if(self.opts(OPT_ENABLED)===true)
{self.on({blur:self.onBlur,anyKeyUp:self.onAnyKeyUp,deleteKeyUp:self.onAnyKeyUp,backspaceKeyPress:self.onBackspaceKeyPress,enterKeyPress:self.onEnterKeyPress,escapeKeyPress:self.onEscapeKeyPress,setSuggestions:self.onSetSuggestions,showDropdown:self.onShowDropdown,hideDropdown:self.onHideDropdown,toggleDropdown:self.onToggleDropdown,postInvalidate:self.positionDropdown,getFormData:self.onGetFormData,downKeyDown:self.onDownKeyDown,upKeyDown:self.onUpKeyDown});container=$(self.opts(OPT_HTML_DROPDOWN));container.insertAfter(input);self.on(container,{mouseover:self.onMouseOver,mousedown:self.onMouseDown,click:self.onClick});container.css('maxHeight',self.opts(OPT_MAX_HEIGHT)).addClass('text-position-'+self.opts(OPT_POSITION));$(self).data('container',container);$(document.body).click(function(e)
{if(self.isDropdownVisible()&&!self.withinWrapElement(e.target))
self.trigger(EVENT_HIDE_DROPDOWN);});self.positionDropdown();}};p.containerElement=function()
{return $(this).data('container');};p.onMouseOver=function(e)
{var self=this,target=$(e.target);if(target.is(CSS_DOT_SUGGESTION))
{self.clearSelected();target.addClass(CSS_SELECTED);}};p.onMouseDown=function(e)
{this.containerElement().data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE,true);};p.onClick=function(e)
{var self=this,target=$(e.target);if(target.is(CSS_DOT_SUGGESTION)||target.is(CSS_DOT_LABEL))
self.trigger('enterKeyPress');if(self.core().hasPlugin('tags'))
self.val('');};p.onBlur=function(e)
{var self=this,container=self.containerElement(),isBlurByMousedown=container.data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE)===true;if(self.isDropdownVisible())
isBlurByMousedown?self.core().focusInput():self.trigger(EVENT_HIDE_DROPDOWN);container.removeData(DATA_MOUSEDOWN_ON_AUTOCOMPLETE);};p.onBackspaceKeyPress=function(e)
{var self=this,isEmpty=self.val().length>0;if(isEmpty||self.isDropdownVisible())
self.getSuggestions();};p.onAnyKeyUp=function(e,keyCode)
{var self=this,isFunctionKey=self.opts('keys.'+keyCode)!=null;if(self.val().length>0&&!isFunctionKey)
self.getSuggestions();};p.onDownKeyDown=function(e)
{var self=this;self.isDropdownVisible()?self.toggleNextSuggestion():self.getSuggestions();};p.onUpKeyDown=function(e)
{this.togglePreviousSuggestion();};p.onEnterKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.selectFromDropdown();};p.onEscapeKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.trigger(EVENT_HIDE_DROPDOWN);};p.positionDropdown=function()
{var self=this,container=self.containerElement(),direction=self.opts(OPT_POSITION),height=self.core().wrapElement().outerHeight(),css={};css[direction===POSITION_ABOVE?'bottom':'top']=height+'px';container.css(css);};p.suggestionElements=function()
{return this.containerElement().find(CSS_DOT_SUGGESTION);};p.setSelectedSuggestion=function(suggestion)
{if(!suggestion)
return;var self=this,all=self.suggestionElements(),target=all.first(),item,i;self.clearSelected();for(i=0;i<all.length;i++)
{item=$(all[i]);if(self.itemManager().compareItems(item.data(CSS_SUGGESTION),suggestion))
{target=item.addClass(CSS_SELECTED);break;}}
target.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(target);};p.selectedSuggestionElement=function()
{return this.suggestionElements().filter(CSS_DOT_SELECTED).first();};p.isDropdownVisible=function()
{return this.containerElement().is(':visible')===true;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue=val;data[100]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 200;};p.onHideDropdown=function(e)
{this.hideDropdown();};p.onToggleDropdown=function(e)
{var self=this;self.trigger(self.containerElement().is(':visible')?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.onShowDropdown=function(e,renderCallback)
{var self=this,current=self.selectedSuggestionElement().data(CSS_SUGGESTION),suggestions=self._suggestions;if(!suggestions)
return self.trigger(EVENT_GET_SUGGESTIONS);if($.isFunction(renderCallback))
{renderCallback(self);}
else
{self.renderSuggestions(self._suggestions);self.toggleNextSuggestion();}
self.showDropdown(self.containerElement());self.setSelectedSuggestion(current);};p.onSetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions=data.result;if(data.showHideDropdown!==false)
self.trigger(suggestions===null||suggestions.length===0?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.getSuggestions=function()
{var self=this,val=self.val();if(self._previousInputValue==val)
return;if(val=='')
current=null;self._previousInputValue=val;self.trigger(EVENT_GET_SUGGESTIONS,{query:val});};p.clearItems=function()
{this.containerElement().find('.text-list').children().remove();};p.renderSuggestions=function(suggestions)
{var self=this;self.clearItems();$.each(suggestions||[],function(index,item)
{self.addSuggestion(item);});};p.showDropdown=function()
{this.containerElement().show();};p.hideDropdown=function()
{var self=this,dropdown=self.containerElement();self._previousInputValue=null;dropdown.hide();};p.addSuggestion=function(suggestion)
{var self=this,renderer=self.opts(OPT_RENDER),node=self.addDropdownItem(renderer?renderer.call(self,suggestion):self.itemManager().itemToString(suggestion));node.data(CSS_SUGGESTION,suggestion);};p.addDropdownItem=function(html)
{var self=this,container=self.containerElement().find('.text-list'),node=$(self.opts(OPT_HTML_SUGGESTION));node.find('.text-label').html(html);container.append(node);return node;};p.clearSelected=function()
{this.suggestionElements().removeClass(CSS_SELECTED);};p.toggleNextSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),next;if(selected.length>0)
{next=selected.next();if(next.length>0)
selected.removeClass(CSS_SELECTED);}
else
{next=self.suggestionElements().first();}
next.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(next);};p.togglePreviousSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),prev=selected.prev();if(prev.length==0)
return;self.clearSelected();prev.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(prev);};p.scrollSuggestionIntoView=function(item)
{var itemHeight=item.outerHeight(),dropdown=this.containerElement(),dropdownHeight=dropdown.innerHeight(),scrollPos=dropdown.scrollTop(),itemTop=(item.position()||{}).top,scrollTo=null,paddingTop=parseInt(dropdown.css('paddingTop'));if(itemTop==null)
return;if(itemTop+itemHeight>dropdownHeight)
scrollTo=itemTop+scrollPos+itemHeight-dropdownHeight+paddingTop;if(itemTop<0)
scrollTo=itemTop+scrollPos-paddingTop;if(scrollTo!=null)
dropdown.scrollTop(scrollTo);};p.selectFromDropdown=function()
{var self=this,suggestion=self.selectedSuggestionElement().data(CSS_SUGGESTION);if(suggestion)
{self.val(self.itemManager().itemToString(suggestion));self.core().getFormData();}
self.trigger(EVENT_HIDE_DROPDOWN);};p.withinWrapElement=function(element)
{return this.core().wrapElement().find(element).size()>0;}})(jQuery);(function($)
{function TextExtClear(){};$.fn.textext.TextExtClear=TextExtClear;$.fn.textext.addPlugin('clear',TextExtClear);var p=TextExtClear.prototype,OPT_HTML_CLEAR='html.clear',DEFAULT_OPTS={html:{clear:'<div class="text-clear"/>'}};p.init=function(core)
{var self=this,clear;self.baseInit(core,DEFAULT_OPTS);self._clear=clear=$(self.opts(OPT_HTML_CLEAR));self.core().wrapElement().append(clear);clear.bind('click',function(e){self.onClearClick(e);});};p.onClearClick=function(e)
{var self=this;if(typeof self.core()._plugins.tags!='undefined')
{var elems=self.core()._plugins.tags.tagElements();for(var i=0;i<elems.length;i++)
{self.core()._plugins.tags.removeTag($(elems[i]));}}
self.val('');self.core().getFormData();};})(jQuery);(function($)
{function TextExtFilter(){};$.fn.textext.TextExtFilter=TextExtFilter;$.fn.textext.addPlugin('filter',TextExtFilter);var p=TextExtFilter.prototype,OPT_ENABLED='filter.enabled',OPT_ITEMS='filter.items',DEFAULT_OPTS={filter:{enabled:true,items:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getFormData:self.onGetFormData,isTagAllowed:self.onIsTagAllowed,setSuggestions:self.onSetSuggestions});self._suggestions=null;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue='';if(!self.core().hasPlugin('tags'))
{if(self.isValueAllowed(inputValue))
formValue=val;data[300]=self.formDataObject(inputValue,formValue);}};p.isValueAllowed=function(value)
{var self=this,list=self.opts('filterItems')||self._suggestions||[],itemManager=self.itemManager(),result=!self.opts(OPT_ENABLED),i;for(i=0;i<list.length&&!result;i++)
if(itemManager.compareItems(value,list[i]))
result=true;return result;};p.onIsTagAllowed=function(e,data)
{data.result=this.isValueAllowed(data.tag);};p.onSetSuggestions=function(e,data)
{this._suggestions=data.result;};})(jQuery);(function($)
{function TextExtFocus(){};$.fn.textext.TextExtFocus=TextExtFocus;$.fn.textext.addPlugin('focus',TextExtFocus);var p=TextExtFocus.prototype,OPT_HTML_FOCUS='html.focus',DEFAULT_OPTS={html:{focus:'<div class="text-focus"/>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.core().wrapElement().append(self.opts(OPT_HTML_FOCUS));self.on({blur:self.onBlur,focus:self.onFocus});self._timeoutId=0;};p.onBlur=function(e)
{var self=this;clearTimeout(self._timeoutId);self._timeoutId=setTimeout(function()
{self.getFocus().hide();},100);};p.onFocus=function(e)
{var self=this;clearTimeout(self._timeoutId);self.getFocus().show();};p.getFocus=function()
{return this.core().wrapElement().find('.text-focus');};})(jQuery);(function($)
{function TextExtPrompt(){};$.fn.textext.TextExtPrompt=TextExtPrompt;$.fn.textext.addPlugin('prompt',TextExtPrompt);var p=TextExtPrompt.prototype,CSS_HIDE_PROMPT='text-hide-prompt',OPT_PROMPT='prompt',OPT_HTML_PROMPT='html.prompt',DEFAULT_OPTS={prompt:'Awaiting input...',html:{prompt:'<div class="text-prompt"/>'}};p.init=function(core)
{var self=this,placeholderKey='placeholder',container,prompt;self.baseInit(core,DEFAULT_OPTS);container=$(self.opts(OPT_HTML_PROMPT));$(self).data('container',container);self.core().wrapElement().append(container);self.setPrompt(self.opts(OPT_PROMPT));prompt=core.input().attr(placeholderKey);if(!prompt)
prompt=self.opts(OPT_PROMPT);core.input().attr(placeholderKey,'');if(prompt)
self.setPrompt(prompt);if($.trim(self.val()).length>0)
self.hidePrompt();self.on({blur:self.onBlur,focus:self.onFocus,postInvalidate:self.onPostInvalidate,postInit:self.onPostInit});};p.onPostInit=function(e)
{this.invalidateBounds();};p.onPostInvalidate=function(e)
{this.invalidateBounds();};p.invalidateBounds=function()
{var self=this,input=self.input();self.containerElement().css({paddingLeft:input.css('paddingLeft'),paddingTop:input.css('paddingTop')});};p.onBlur=function(e)
{var self=this;self.startTimer('prompt',0.1,function()
{self.showPrompt();});};p.showPrompt=function()
{var self=this,input=self.input();if($.trim(self.val()).length===0&&!input.is(':focus'))
self.containerElement().removeClass(CSS_HIDE_PROMPT);};p.hidePrompt=function()
{this.stopTimer('prompt');this.containerElement().addClass(CSS_HIDE_PROMPT);};p.onFocus=function(e)
{this.hidePrompt();};p.setPrompt=function(str)
{this.containerElement().text(str);};p.containerElement=function()
{return $(this).data('container');};})(jQuery);(function($)
{function TextExtSuggestions(){};$.fn.textext.TextExtSuggestions=TextExtSuggestions;$.fn.textext.addPlugin('suggestions',TextExtSuggestions);var p=TextExtSuggestions.prototype,OPT_SUGGESTIONS='suggestions',DEFAULT_OPTS={suggestions:null};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions,postInit:self.onPostInit});};p.setSuggestions=function(suggestions,showHideDropdown)
{this.trigger('setSuggestions',{result:suggestions,showHideDropdown:showHideDropdown!=false});};p.onPostInit=function(e)
{var self=this;self.setSuggestions(self.opts(OPT_SUGGESTIONS),false);};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self.opts(OPT_SUGGESTIONS);suggestions.sort();self.setSuggestions(self.itemManager().filter(suggestions,data.query));};})(jQuery);(function($)
{function TextExtTags(){};$.fn.textext.TextExtTags=TextExtTags;$.fn.textext.addPlugin('tags',TextExtTags);var p=TextExtTags.prototype,CSS_DOT='.',CSS_TAGS_ON_TOP='text-tags-on-top',CSS_DOT_TAGS_ON_TOP=CSS_DOT+CSS_TAGS_ON_TOP,CSS_TAG='text-tag',CSS_DOT_TAG=CSS_DOT+CSS_TAG,CSS_TAGS='text-tags',CSS_DOT_TAGS=CSS_DOT+CSS_TAGS,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,CSS_REMOVE='text-remove',CSS_DOT_REMOVE=CSS_DOT+CSS_REMOVE,OPT_ENABLED='tags.enabled',OPT_ITEMS='tags.items',OPT_HTML_TAG='html.tag',OPT_HTML_TAGS='html.tags',EVENT_IS_TAG_ALLOWED='isTagAllowed',EVENT_TAG_CLICK='tagClick',DEFAULT_OPTS={tags:{enabled:true,items:null},html:{tags:'<div class="text-tags"/>',tag:'<div class="text-tag"><div class="text-button"><span class="text-label"/><a class="text-remove"/></div></div>'}};p.init=function(core)
{this.baseInit(core,DEFAULT_OPTS);var self=this,input=self.input(),container;if(self.opts(OPT_ENABLED))
{container=$(self.opts(OPT_HTML_TAGS));input.after(container);$(self).data('container',container);self.on({enterKeyPress:self.onEnterKeyPress,backspaceKeyDown:self.onBackspaceKeyDown,preInvalidate:self.onPreInvalidate,postInit:self.onPostInit,getFormData:self.onGetFormData});self.on(container,{click:self.onClick,mousemove:self.onContainerMouseMove});self.on(input,{mousemove:self.onInputMouseMove});}
self._originalPadding={left:parseInt(input.css('paddingLeft')||0),top:parseInt(input.css('paddingTop')||0)};self._paddingBox={left:0,top:0};self.updateFormCache();};p.containerElement=function()
{return $(this).data('container');};p.onPostInit=function(e)
{var self=this;self.addTags(self.opts(OPT_ITEMS));};p.onGetFormData=function(e,data,keyCode)
{var self=this,inputValue=keyCode===13?'':self.val(),formValue=self._formData;data[200]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 100;};p.onInputMouseMove=function(e)
{this.toggleZIndex(e);};p.onContainerMouseMove=function(e)
{this.toggleZIndex(e);};p.onBackspaceKeyDown=function(e)
{var self=this,lastTag=self.tagElements().last();if(self.val().length==0)
self.removeTag(lastTag);};p.onPreInvalidate=function(e)
{var self=this,lastTag=self.tagElements().last(),pos=lastTag.position();if(lastTag.length>0)
pos.left+=lastTag.innerWidth();else
pos=self._originalPadding;self._paddingBox=pos;self.input().css({paddingLeft:pos.left,paddingTop:pos.top});};p.onClick=function(e)
{var self=this,core=self.core(),source=$(e.target),focus=0,tag;if(source.is(CSS_DOT_TAGS))
{focus=1;}
else if(source.is(CSS_DOT_REMOVE))
{self.removeTag(source.parents(CSS_DOT_TAG+':first'));focus=1;}
else if(source.is(CSS_DOT_LABEL))
{tag=source.parents(CSS_DOT_TAG+':first');self.trigger(EVENT_TAG_CLICK,tag,tag.data(CSS_TAG),tagClickCallback);}
function tagClickCallback(newValue,refocus)
{tag.data(CSS_TAG,newValue);tag.find(CSS_DOT_LABEL).text(self.itemManager().itemToString(newValue));self.updateFormCache();core.getFormData();core.invalidateBounds();if(refocus)
core.focusInput();}
if(focus)
core.focusInput();};p.onEnterKeyPress=function(e)
{var self=this,val=self.val(),tag=self.itemManager().stringToItem(val);if(self.isTagAllowed(tag))
{self.addTags([tag]);self.core().focusInput();}};p.updateFormCache=function()
{var self=this,result=[];self.tagElements().each(function()
{result.push($(this).data(CSS_TAG));});self._formData=result;};p.toggleZIndex=function(e)
{var self=this,offset=self.input().offset(),mouseX=e.clientX-offset.left,mouseY=e.clientY-offset.top,box=self._paddingBox,container=self.containerElement(),isOnTop=container.is(CSS_DOT_TAGS_ON_TOP),isMouseOverText=mouseX>box.left&&mouseY>box.top;if(!isOnTop&&!isMouseOverText||isOnTop&&isMouseOverText)
container[(!isOnTop?'add':'remove')+'Class'](CSS_TAGS_ON_TOP);};p.tagElements=function()
{return this.containerElement().find(CSS_DOT_TAG);};p.isTagAllowed=function(tag)
{var opts={tag:tag,result:true};this.trigger(EVENT_IS_TAG_ALLOWED,opts);return opts.result===true;};p.addTags=function(tags)
{if(!tags||tags.length==0)
return;var self=this,core=self.core(),container=self.containerElement(),i,tag;for(i=0;i<tags.length;i++)
{tag=tags[i];if(tag&&self.isTagAllowed(tag))
container.append(self.renderTag(tag));}
self.updateFormCache();core.getFormData();core.invalidateBounds();};p.getTagElement=function(tag)
{var self=this,list=self.tagElements(),i,item;for(i=0;i<list.length;i++){item=$(list[i]);if(self.itemManager().compareItems(item.data(CSS_TAG),tag))
return item;}
return null;};p.removeTag=function(tag)
{var self=this,core=self.core(),element;if(tag instanceof $)
{element=tag;tag=tag.data(CSS_TAG);}
else
{element=self.getTagElement(tag);if(element===null){return;}}
element.remove();self.updateFormCache();core.getFormData();core.invalidateBounds();};p.renderTag=function(tag)
{var self=this,node=$(self.opts(OPT_HTML_TAG));node.find('.text-label').text(self.itemManager().itemToString(tag));node.data(CSS_TAG,tag);return node;};})(jQuery);(function($){$.jGrowl=function(m,o){if($('#jGrowl').size()==0)
$('<div id="jGrowl"></div>').addClass((o&&o.position)?o.position:$.jGrowl.defaults.position).appendTo('body');$('#jGrowl').jGrowl(m,o);};$.fn.jGrowl=function(m,o){if($.isFunction(this.each)){var args=arguments;return this.each(function(){var self=this;if($(this).data('jGrowl.instance')==undefined){$(this).data('jGrowl.instance',$.extend(new $.fn.jGrowl(),{notifications:[],element:null,interval:null}));$(this).data('jGrowl.instance').startup(this);}
if($.isFunction($(this).data('jGrowl.instance')[m])){$(this).data('jGrowl.instance')[m].apply($(this).data('jGrowl.instance'),$.makeArray(args).slice(1));}else{$(this).data('jGrowl.instance').create(m,o);}});};};$.extend($.fn.jGrowl.prototype,{defaults:{pool:0,header:'',group:'',sticky:false,position:'top-right',glue:'after',theme:'default',themeState:'highlight',corners:'10px',check:250,life:3000,closeDuration:'normal',openDuration:'normal',easing:'swing',closer:true,closeTemplate:'&times;',closerTemplate:'<div>[ close all ]</div>',log:function(e,m,o){},beforeOpen:function(e,m,o){},afterOpen:function(e,m,o){},open:function(e,m,o){},beforeClose:function(e,m,o){},close:function(e,m,o){},animateOpen:{opacity:'show'},animateClose:{opacity:'hide'}},notifications:[],element:null,interval:null,create:function(message,o){var o=$.extend({},this.defaults,o);if(typeof o.speed!=='undefined'){o.openDuration=o.speed;o.closeDuration=o.speed;}
this.notifications.push({message:message,options:o});o.log.apply(this.element,[this.element,message,o]);},render:function(notification){var self=this;var message=notification.message;var o=notification.options;o.themeState=(o.themeState=='')?'':'ui-state-'+o.themeState;var notification=$('<div class="jGrowl-notification '+o.themeState+' ui-corner-all'+
((o.group!=undefined&&o.group!='')?' '+o.group:'')+'">'+'<div class="jGrowl-close">'+o.closeTemplate+'</div>'+'<div class="jGrowl-header">'+o.header+'</div>'+'<div class="jGrowl-message">'+message+'</div></div>').data("jGrowl",o).addClass(o.theme).children('div.jGrowl-close').bind("click.jGrowl",function(){$(this).parent().trigger('jGrowl.close');}).parent();$(notification).bind("mouseover.jGrowl",function(){$('div.jGrowl-notification',self.element).data("jGrowl.pause",true);}).bind("mouseout.jGrowl",function(){$('div.jGrowl-notification',self.element).data("jGrowl.pause",false);}).bind('jGrowl.beforeOpen',function(){if(o.beforeOpen.apply(notification,[notification,message,o,self.element])!=false){$(this).trigger('jGrowl.open');}}).bind('jGrowl.open',function(){if(o.open.apply(notification,[notification,message,o,self.element])!=false){if(o.glue=='after'){$('div.jGrowl-notification:last',self.element).after(notification);}else{$('div.jGrowl-notification:first',self.element).before(notification);}
$(this).animate(o.animateOpen,o.openDuration,o.easing,function(){if($.browser.msie&&(parseInt($(this).css('opacity'),10)===1||parseInt($(this).css('opacity'),10)===0))
this.style.removeAttribute('filter');if($(this).data("jGrowl")!=null)
$(this).data("jGrowl").created=new Date();$(this).trigger('jGrowl.afterOpen');});}}).bind('jGrowl.afterOpen',function(){o.afterOpen.apply(notification,[notification,message,o,self.element]);}).bind('jGrowl.beforeClose',function(){if(o.beforeClose.apply(notification,[notification,message,o,self.element])!=false)
$(this).trigger('jGrowl.close');}).bind('jGrowl.close',function(){$(this).data('jGrowl.pause',true);$(this).animate(o.animateClose,o.closeDuration,o.easing,function(){if($.isFunction(o.close)){if(o.close.apply(notification,[notification,message,o,self.element])!==false)
$(this).remove();}else{$(this).remove();}});}).trigger('jGrowl.beforeOpen');if(o.corners!=''&&$.fn.corner!=undefined)$(notification).corner(o.corners);if($('div.jGrowl-notification:parent',self.element).size()>1&&$('div.jGrowl-closer',self.element).size()==0&&this.defaults.closer!=false){$(this.defaults.closerTemplate).addClass('jGrowl-closer '+this.defaults.themeState+' ui-corner-all').addClass(this.defaults.theme).appendTo(self.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){$(this).siblings().trigger("jGrowl.beforeClose");if($.isFunction(self.defaults.closer)){self.defaults.closer.apply($(this).parent()[0],[$(this).parent()[0]]);}});};},update:function(){$(this.element).find('div.jGrowl-notification:parent').each(function(){if($(this).data("jGrowl")!=undefined&&$(this).data("jGrowl").created!=undefined&&($(this).data("jGrowl").created.getTime()+parseInt($(this).data("jGrowl").life))<(new Date()).getTime()&&$(this).data("jGrowl").sticky!=true&&($(this).data("jGrowl.pause")==undefined||$(this).data("jGrowl.pause")!=true)){$(this).trigger('jGrowl.beforeClose');}});if(this.notifications.length>0&&(this.defaults.pool==0||$(this.element).find('div.jGrowl-notification:parent').size()<this.defaults.pool))
this.render(this.notifications.shift());if($(this.element).find('div.jGrowl-notification:parent').size()<2){$(this.element).find('div.jGrowl-closer').animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){$(this).remove();});}},startup:function(e){this.element=$(e).addClass('jGrowl').append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){$(e).data('jGrowl.instance').update();},parseInt(this.defaults.check));if($.browser.msie&&parseInt($.browser.version)<7&&!window["XMLHttpRequest"]){$(this.element).addClass('ie6');}},shutdown:function(){$(this.element).removeClass('jGrowl').find('div.jGrowl-notification').remove();clearInterval(this.interval);},close:function(){$(this.element).find('div.jGrowl-notification').each(function(){$(this).trigger('jGrowl.beforeClose');});}});$.jGrowl.defaults=$.fn.jGrowl.prototype.defaults;})(jQuery);(function($){var uuid=0;$.fn.upload=function(url,data,callback,type){var self=this,inputs,checkbox,checked,iframeName='jquery_upload'+ ++uuid,iframe=$('<iframe name="'+iframeName+'" style="position:absolute;top:-9999px" />').appendTo('body'),form='<form target="'+iframeName+'" method="post" enctype="multipart/form-data" />';if($.isFunction(data)){type=callback;callback=data;data={};}
checkbox=$('input:checkbox',this);checked=$('input:checked',this);form=self.wrapAll(form).parent('form').attr('action',url);checkbox.removeAttr('checked');checked.attr('checked',true);inputs=createInputs(data);inputs=inputs?$(inputs).appendTo(form):null;form.submit(function(){iframe.load(function(){var data=handleData(this,type),checked=$('input:checked',self);form.after(self).remove();checkbox.removeAttr('checked');checked.attr('checked',true);if(inputs){inputs.remove();}
setTimeout(function(){iframe.remove();if(type==='script'){$.globalEval(data);}
if(callback){callback.call(self,data);}},0);});}).submit();return this;};function createInputs(data){return $.map(param(data),function(param){return'<input type="hidden" name="'+param.name+'" value="'+param.value+'"/>';}).join('');}
function param(data){if($.isArray(data)){return data;}
var params=[];function add(name,value){params.push({name:name,value:value});}
if(typeof data==='object'){$.each(data,function(name){if($.isArray(this)){$.each(this,function(){add(name,this);});}else{add(name,$.isFunction(this)?this():this);}});}else if(typeof data==='string'){$.each(data.split('&'),function(){var param=$.map(this.split('='),function(v){return decodeURIComponent(v.replace(/\+/g,' '));});add(param[0],param[1]);});}
return params;}
function handleData(iframe,type){var data,contents=$(iframe).contents().get(0);if($.isXMLDoc(contents)||contents.XMLDocument){return contents.XMLDocument||contents;}
data=$(contents).find('body').html();switch(type){case'xml':data=parseXml(data);break;case'json':data=window.eval('('+data+')');break;}
return data;}
function parseXml(text){if(window.DOMParser){return new DOMParser().parseFromString(text,'application/xml');}else{var xml=new ActiveXObject('Microsoft.XMLDOM');xml.async=false;xml.loadXML(text);return xml;}}})(jQuery);(function($,window,undefined){'use strict';var
dfpScript=this,dfpID='',count=0,uid=0,rendered=0,dfpSelector='.adunit',dfpOptions={},dfpIsLoaded=false,$adCollection,storeAs='googleAdUnit',init=function(id,selector,options){count=0;rendered=0;dfpID=id;$adCollection=$(selector);dfpLoader();setOptions(options);$(function(){createAds();displayAds();});},setOptions=function(options){dfpOptions={setTargeting:{},setCategoryExclusion:'',setLocation:'',enableSingleRequest:true,collapseEmptyDivs:'original',refreshExisting:true,disablePublisherConsole:false,disableInitialLoad:false,noFetch:false,namespace:undefined,sizeMapping:{}};if(typeof options.setUrlTargeting==='undefined'||options.setUrlTargeting)
{var urlTargeting=getUrlTargeting();$.extend(true,dfpOptions.setTargeting,{inURL:urlTargeting.inURL,URLIs:urlTargeting.URLIs,Query:urlTargeting.Query,Domain:window.location.host});}
$.extend(true,dfpOptions,options);if(dfpOptions.googletag){window.googletag.cmd.push(function(){$.extend(true,window.googletag,dfpOptions.googletag);});}},createAds=function(){$adCollection.each(function(){var $adUnit=$(this);count++;var adUnitName=getName($adUnit);var adUnitID=getID($adUnit,adUnitName);var dimensions=getDimensions($adUnit);$adUnit.data('existingContent',$adUnit.html());$adUnit.html('').addClass('display-none');window.googletag.cmd.push(function(){var googleAdUnit,$adUnitData=$adUnit.data(storeAs);if($adUnitData){googleAdUnit=$adUnitData;}else{if($adUnit.data('outofpage')){googleAdUnit=window.googletag.defineOutOfPageSlot('/'+dfpID+'/'+adUnitName,adUnitID).addService(window.googletag.pubads());}else{if($adUnit.data('companion')){googleAdUnit=window.googletag.defineSlot('/'+dfpID+'/'+adUnitName,dimensions,adUnitID).addService(window.googletag.companionAds()).addService(window.googletag.pubads());}else{googleAdUnit=window.googletag.defineSlot('/'+dfpID+'/'+adUnitName,dimensions,adUnitID).addService(window.googletag.pubads());}}}
var targeting=$adUnit.data('targeting');if(targeting){$.each(targeting,function(k,v){googleAdUnit.setTargeting(k,v);});}
var exclusions=$adUnit.data('exclusions');if(exclusions){var exclusionsGroup=exclusions.split(',');var valueTrimmed;$.each(exclusionsGroup,function(k,v){valueTrimmed=$.trim(v);if(valueTrimmed.length>0){googleAdUnit.setCategoryExclusion(valueTrimmed);}});}
var mapping=$adUnit.data('size-mapping');if(mapping&&dfpOptions.sizeMapping[mapping]){var map=window.googletag.sizeMapping();$.each(dfpOptions.sizeMapping[mapping],function(k,v){map.addSize(v.browser,v.ad_sizes);});googleAdUnit.defineSizeMapping(map.build());}
$adUnit.data(storeAs,googleAdUnit);if(typeof dfpOptions.beforeEachAdLoaded==='function'){dfpOptions.beforeEachAdLoaded.call(this,$adUnit);}});});window.googletag.cmd.push(function(){if(dfpOptions.enableSingleRequest){window.googletag.pubads().enableSingleRequest();}
$.each(dfpOptions.setTargeting,function(k,v){window.googletag.pubads().setTargeting(k,v);});if(typeof dfpOptions.setLocation==='object'){if(typeof dfpOptions.setLocation.latitude==='number'&&typeof dfpOptions.setLocation.longitude==='number'&&typeof dfpOptions.setLocation.precision==='number'){window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude,dfpOptions.setLocation.precision);}else if(typeof dfpOptions.setLocation.latitude==='number'&&typeof dfpOptions.setLocation.longitude==='number'){window.googletag.pubads().setLocation(dfpOptions.setLocation.latitude,dfpOptions.setLocation.longitude);}}
if(dfpOptions.setCategoryExclusion.length>0){var exclusionsGroup=dfpOptions.setCategoryExclusion.split(',');var valueTrimmed;$.each(exclusionsGroup,function(k,v){valueTrimmed=$.trim(v);if(valueTrimmed.length>0){window.googletag.pubads().setCategoryExclusion(valueTrimmed);}});}
if(dfpOptions.collapseEmptyDivs){window.googletag.pubads().collapseEmptyDivs();}
if(dfpOptions.disablePublisherConsole){window.googletag.pubads().disablePublisherConsole();}
if(dfpOptions.companionAds){window.googletag.companionAds().setRefreshUnfilledSlots(true);if(!dfpOptions.disableInitialLoad){window.googletag.pubads().enableVideoAds();}}
if(dfpOptions.disableInitialLoad){window.googletag.pubads().disableInitialLoad();}
if(dfpOptions.noFetch){window.googletag.pubads().noFetch();}
window.googletag.pubads().addEventListener('slotRenderEnded',function(event){rendered++;var $adUnit=$('#'+event.slot.getSlotId().getDomId());var display=event.isEmpty?'none':'block';var $existingContent=$adUnit.data('existingContent');if(display==='none'&&$.trim($existingContent).length>0&&dfpOptions.collapseEmptyDivs==='original'){$adUnit.show().html($existingContent);display='block display-original';}
$adUnit.removeClass('display-none').addClass('display-'+display);if(typeof dfpOptions.afterEachAdLoaded==='function'){dfpOptions.afterEachAdLoaded.call(this,$adUnit,event);}
if(typeof dfpOptions.afterAllAdsLoaded==='function'&&rendered===count){dfpOptions.afterAllAdsLoaded.call(this,$adCollection);}});window.googletag.enableServices();});},displayAds=function(){$adCollection.each(function(){var $adUnit=$(this),$adUnitData=$adUnit.data(storeAs);if(dfpOptions.refreshExisting&&$adUnitData&&$adUnit.hasClass('display-block')){window.googletag.cmd.push(function(){window.googletag.pubads().refresh([$adUnitData]);});}else{window.googletag.cmd.push(function(){window.googletag.display($adUnit.attr('id'));});}});},getUrlTargeting=function(){var paths=window.location.pathname.replace(/\/$/,''),patt=new RegExp('\/([^\/]*)','ig'),pathsMatches=paths.match(patt),targetPaths=['/'],longestpath='';if(pathsMatches&&paths!=='/'){var target='',size=pathsMatches.length;if(size>0){for(var i=0;i<size;i++){target=pathsMatches[i];targetPaths.push(target);for(var j=i+1;j<size;j++){target+=pathsMatches[j];targetPaths.push(target);}
if(i===0){targetPaths.splice(-1,1);longestpath=target;}}}
targetPaths.push(longestpath);}
targetPaths=targetPaths.reverse();var url=window.location.toString().replace(/\=/ig,':').match(/\?(.+)$/),params=RegExp.$1.split('&');return{inURL:targetPaths,URLIs:targetPaths[0],Query:params};},getID=function($adUnit,adUnitName){uid++;return $adUnit.attr('id')||$adUnit.attr('id',adUnitName.replace(/[^A-z0-9]/g,'_')+'-auto-gen-id-'+uid).attr('id');},getName=function($adUnit){var adUnitName=$adUnit.data('adunit')||dfpOptions.namespace||$adUnit.attr('id')||'';if(typeof dfpOptions.alterAdUnitName==='function'){adUnitName=dfpOptions.alterAdUnitName.call(this,adUnitName,$adUnit);}
return adUnitName;},getDimensions=function($adUnit){var dimensions=[],dimensionsData=$adUnit.data('dimensions');if(dimensionsData){var dimensionGroups=dimensionsData.split(',');$.each(dimensionGroups,function(k,v){var dimensionSet=v.split('x');dimensions.push([parseInt(dimensionSet[0],10),parseInt(dimensionSet[1],10)]);});}else{dimensions.push([$adUnit.width(),$adUnit.height()]);}
return dimensions;},dfpLoader=function(){dfpIsLoaded=dfpIsLoaded||$('script[src*="googletagservices.com/tag/js/gpt.js"]').length;if(dfpIsLoaded){return;}
window.googletag=window.googletag||{};window.googletag.cmd=window.googletag.cmd||[];var gads=document.createElement('script');gads.async=true;gads.type='text/javascript';gads.onerror=function(){dfpBlocked();};var useSSL='https:'===document.location.protocol;gads.src=(useSSL?'https:':'http:')+'//www.googletagservices.com/tag/js/gpt.js';var node=document.getElementsByTagName('script')[0];node.parentNode.insertBefore(gads,node);if(gads.style.display==='none'){dfpBlocked();}},dfpBlocked=function(){var commands=window.googletag.cmd;setTimeout(function(){var _defineSlot=function(name,dimensions,id,oop){window.googletag.ads.push(id);window.googletag.ads[id]={renderEnded:function(){},addService:function(){return this;}};return window.googletag.ads[id];};window.googletag={cmd:{push:function(callback){callback.call(dfpScript);}},ads:[],pubads:function(){return this;},noFetch:function(){return this;},disableInitialLoad:function(){return this;},disablePublisherConsole:function(){return this;},enableSingleRequest:function(){return this;},setTargeting:function(){return this;},collapseEmptyDivs:function(){return this;},enableServices:function(){return this;},defineSlot:function(name,dimensions,id){return _defineSlot(name,dimensions,id,false);},defineOutOfPageSlot:function(name,id){return _defineSlot(name,[],id,true);},display:function(id){window.googletag.ads[id].renderEnded.call(dfpScript);return this;}};$.each(commands,function(k,v){window.googletag.cmd.push(v);});},50);};$.dfp=$.fn.dfp=function(id,options){options=options||{};if(id===undefined){id=dfpID;}
if(typeof id==='object'){options=id;id=options.dfpID||dfpID;}
var selector=this;if(typeof this==='function'){selector=dfpSelector;}
init(id,selector,options);return this;};})(window.jQuery||window.Zepto||window.tire,window);(function(root,factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{if(root.jQuery){factory(root.jQuery);}else{factory(root.Zepto);}}}(this,function($,undefined){$.fn.jPlayer=function(options){var name="jPlayer";var isMethodCall=typeof options==="string",args=Array.prototype.slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.extend.apply(null,[true,options].concat(args)):options;if(isMethodCall&&options.charAt(0)==="_"){return returnValue;}
if(isMethodCall){this.each(function(){var instance=$(this).data(name),methodValue=instance&&$.isFunction(instance[options])?instance[options].apply(instance,args):instance;if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue;return false;}});}else{this.each(function(){var instance=$(this).data(name);if(instance){instance.option(options||{});}else{$(this).data(name,new $.jPlayer(options,this));}});}
return returnValue;};$.jPlayer=function(options,element){if(arguments.length){this.element=$(element);this.options=$.extend(true,{},this.options,options);var self=this;this.element.bind("remove.jPlayer",function(){self.destroy();});this._init();}};if(typeof $.fn.stop!=='function'){$.fn.stop=function(){};}
$.jPlayer.emulateMethods="load play pause";$.jPlayer.emulateStatus="src readyState networkState currentTime duration paused ended playbackRate";$.jPlayer.emulateOptions="muted volume";$.jPlayer.reservedEvent="ready flashreset resize repeat error warning";$.jPlayer.event={};$.each(['ready','flashreset','resize','repeat','click','error','warning','loadstart','progress','suspend','abort','emptied','stalled','play','pause','loadedmetadata','loadeddata','waiting','playing','canplay','canplaythrough','seeking','seeked','timeupdate','ended','ratechange','durationchange','volumechange'],function(){$.jPlayer.event[this]='jPlayer_'+this;});$.jPlayer.htmlEvent=["loadstart","abort","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough"];$.jPlayer.pause=function(){$.each($.jPlayer.prototype.instances,function(i,element){if(element.data("jPlayer").status.srcSet){element.jPlayer("pause");}});};$.jPlayer.timeFormat={showHour:false,showMin:true,showSec:true,padHour:false,padMin:true,padSec:true,sepHour:":",sepMin:":",sepSec:""};var ConvertTime=function(){this.init();};ConvertTime.prototype={init:function(){this.options={timeFormat:$.jPlayer.timeFormat};},time:function(s){s=(s&&typeof s==='number')?s:0;var myTime=new Date(s*1000),hour=myTime.getUTCHours(),min=this.options.timeFormat.showHour?myTime.getUTCMinutes():myTime.getUTCMinutes()+hour*60,sec=this.options.timeFormat.showMin?myTime.getUTCSeconds():myTime.getUTCSeconds()+min*60,strHour=(this.options.timeFormat.padHour&&hour<10)?"0"+hour:hour,strMin=(this.options.timeFormat.padMin&&min<10)?"0"+min:min,strSec=(this.options.timeFormat.padSec&&sec<10)?"0"+sec:sec,strTime="";strTime+=this.options.timeFormat.showHour?strHour+this.options.timeFormat.sepHour:"";strTime+=this.options.timeFormat.showMin?strMin+this.options.timeFormat.sepMin:"";strTime+=this.options.timeFormat.showSec?strSec+this.options.timeFormat.sepSec:"";return strTime;}};var myConvertTime=new ConvertTime();$.jPlayer.convertTime=function(s){return myConvertTime.time(s);};$.jPlayer.uaBrowser=function(userAgent){var ua=userAgent.toLowerCase();var rwebkit=/(webkit)[ \/]([\w.]+)/;var ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/;var rmsie=/(msie) ([\w.]+)/;var rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/;var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};};$.jPlayer.uaPlatform=function(userAgent){var ua=userAgent.toLowerCase();var rplatform=/(ipad|iphone|ipod|android|blackberry|playbook|windows ce|webos)/;var rtablet=/(ipad|playbook)/;var randroid=/(android)/;var rmobile=/(mobile)/;var platform=rplatform.exec(ua)||[];var tablet=rtablet.exec(ua)||!rmobile.exec(ua)&&randroid.exec(ua)||[];if(platform[1]){platform[1]=platform[1].replace(/\s/g,"_");}
return{platform:platform[1]||"",tablet:tablet[1]||""};};$.jPlayer.browser={};$.jPlayer.platform={};var browserMatch=$.jPlayer.uaBrowser(navigator.userAgent);if(browserMatch.browser){$.jPlayer.browser[browserMatch.browser]=true;$.jPlayer.browser.version=browserMatch.version;}
var platformMatch=$.jPlayer.uaPlatform(navigator.userAgent);if(platformMatch.platform){$.jPlayer.platform[platformMatch.platform]=true;$.jPlayer.platform.mobile=!platformMatch.tablet;$.jPlayer.platform.tablet=!!platformMatch.tablet;}
$.jPlayer.getDocMode=function(){var docMode;if($.jPlayer.browser.msie){if(document.documentMode){docMode=document.documentMode;}else{docMode=5;if(document.compatMode){if(document.compatMode==="CSS1Compat"){docMode=7;}}}}
return docMode;};$.jPlayer.browser.documentMode=$.jPlayer.getDocMode();$.jPlayer.nativeFeatures={init:function(){var d=document,v=d.createElement('video'),spec={w3c:['fullscreenEnabled','fullscreenElement','requestFullscreen','exitFullscreen','fullscreenchange','fullscreenerror'],moz:['mozFullScreenEnabled','mozFullScreenElement','mozRequestFullScreen','mozCancelFullScreen','mozfullscreenchange','mozfullscreenerror'],webkit:['','webkitCurrentFullScreenElement','webkitRequestFullScreen','webkitCancelFullScreen','webkitfullscreenchange',''],webkitVideo:['webkitSupportsFullscreen','webkitDisplayingFullscreen','webkitEnterFullscreen','webkitExitFullscreen','','']},specOrder=['w3c','moz','webkit','webkitVideo'],fs,i,il;this.fullscreen=fs={support:{w3c:!!d[spec.w3c[0]],moz:!!d[spec.moz[0]],webkit:typeof d[spec.webkit[3]]==='function',webkitVideo:typeof v[spec.webkitVideo[2]]==='function'},used:{}};for(i=0,il=specOrder.length;i<il;i++){var n=specOrder[i];if(fs.support[n]){fs.spec=n;fs.used[n]=true;break;}}
if(fs.spec){var s=spec[fs.spec];fs.api={fullscreenEnabled:true,fullscreenElement:function(elem){elem=elem?elem:d;return elem[s[1]];},requestFullscreen:function(elem){return elem[s[2]]();},exitFullscreen:function(elem){elem=elem?elem:d;return elem[s[3]]();}};fs.event={fullscreenchange:s[4],fullscreenerror:s[5]};}else{fs.api={fullscreenEnabled:false,fullscreenElement:function(){return null;},requestFullscreen:function(){},exitFullscreen:function(){}};fs.event={};}}};$.jPlayer.nativeFeatures.init();$.jPlayer.focus=null;$.jPlayer.keyIgnoreElementNames="INPUT TEXTAREA";var keyBindings=function(event){var f=$.jPlayer.focus,ignoreKey;if(f){$.each($.jPlayer.keyIgnoreElementNames.split(/\s+/g),function(i,name){if(event.target.nodeName.toUpperCase()===name.toUpperCase()){ignoreKey=true;return false;}});if(!ignoreKey){$.each(f.options.keyBindings,function(action,binding){if(binding&&event.which===binding.key&&$.isFunction(binding.fn)){event.preventDefault();binding.fn(f);return false;}});}}};$.jPlayer.keys=function(en){var event="keydown.jPlayer";$(document.documentElement).unbind(event);if(en){$(document.documentElement).bind(event,keyBindings);}};$.jPlayer.keys(true);$.jPlayer.prototype={count:0,version:{script:"2.5.1",needFlash:"2.5.0",flash:"unknown"},options:{swfPath:"js",solution:"html, flash",supplied:"mp3",preload:'metadata',volume:0.8,muted:false,playbackRate:1,defaultPlaybackRate:1,minPlaybackRate:0.5,maxPlaybackRate:4,wmode:"opaque",backgroundColor:"#000000",cssSelectorAncestor:"#jp_container_1",cssSelector:{videoPlay:".jp-video-play",play:".jp-play",pause:".jp-pause",stop:".jp-stop",seekBar:".jp-seek-bar",playBar:".jp-play-bar",mute:".jp-mute",unmute:".jp-unmute",volumeBar:".jp-volume-bar",volumeBarValue:".jp-volume-bar-value",volumeMax:".jp-volume-max",playbackRateBar:".jp-playback-rate-bar",playbackRateBarValue:".jp-playback-rate-bar-value",currentTime:".jp-current-time",duration:".jp-duration",fullScreen:".jp-full-screen",restoreScreen:".jp-restore-screen",repeat:".jp-repeat",repeatOff:".jp-repeat-off",gui:".jp-gui",noSolution:".jp-no-solution"},smoothPlayBar:false,fullScreen:false,fullWindow:false,autohide:{restored:false,full:true,fadeIn:200,fadeOut:600,hold:1000},loop:false,repeat:function(event){if(event.jPlayer.options.loop){$(this).unbind(".jPlayerRepeat").bind($.jPlayer.event.ended+".jPlayer.jPlayerRepeat",function(){$(this).jPlayer("play");});}else{$(this).unbind(".jPlayerRepeat");}},nativeVideoControls:{},noFullWindow:{msie:/msie [0-6]\./,ipad:/ipad.*?os [0-4]\./,iphone:/iphone/,ipod:/ipod/,android_pad:/android [0-3]\.(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/},noVolume:{ipad:/ipad/,iphone:/iphone/,ipod:/ipod/,android_pad:/android(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/,playbook:/playbook/},timeFormat:{},keyEnabled:false,audioFullScreen:false,keyBindings:{play:{key:32,fn:function(f){if(f.status.paused){f.play();}else{f.pause();}}},fullScreen:{key:13,fn:function(f){if(f.status.video||f.options.audioFullScreen){f._setOption("fullScreen",!f.options.fullScreen);}}},muted:{key:8,fn:function(f){f._muted(!f.options.muted);}},volumeUp:{key:38,fn:function(f){f.volume(f.options.volume+0.1);}},volumeDown:{key:40,fn:function(f){f.volume(f.options.volume-0.1);}}},verticalVolume:false,verticalPlaybackRate:false,globalVolume:false,idPrefix:"jp",noConflict:"jQuery",emulateHtml:false,consoleAlerts:true,errorAlerts:false,warningAlerts:false},optionsAudio:{size:{width:"0px",height:"0px",cssClass:""},sizeFull:{width:"0px",height:"0px",cssClass:""}},optionsVideo:{size:{width:"480px",height:"270px",cssClass:"jp-video-270p"},sizeFull:{width:"100%",height:"100%",cssClass:"jp-video-full"}},instances:{},status:{src:"",media:{},paused:true,format:{},formatType:"",waitForPlay:true,waitForLoad:true,srcSet:false,video:false,seekPercent:0,currentPercentRelative:0,currentPercentAbsolute:0,currentTime:0,duration:0,videoWidth:0,videoHeight:0,readyState:0,networkState:0,playbackRate:1,ended:0},internal:{ready:false},solution:{html:true,flash:true},format:{mp3:{codec:'audio/mpeg; codecs="mp3"',flashCanPlay:true,media:'audio'},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:true,media:'audio'},m3u8a:{codec:'application/vnd.apple.mpegurl; codecs="mp4a.40.2"',flashCanPlay:false,media:'audio'},m3ua:{codec:'audio/mpegurl',flashCanPlay:false,media:'audio'},oga:{codec:'audio/ogg; codecs="vorbis, opus"',flashCanPlay:false,media:'audio'},flac:{codec:'audio/x-flac',flashCanPlay:false,media:'audio'},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:false,media:'audio'},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:false,media:'audio'},fla:{codec:'audio/x-flv',flashCanPlay:true,media:'audio'},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:true,media:'audio'},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:true,media:'video'},m3u8v:{codec:'application/vnd.apple.mpegurl; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:false,media:'video'},m3uv:{codec:'audio/mpegurl',flashCanPlay:false,media:'video'},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:false,media:'video'},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:false,media:'video'},flv:{codec:'video/x-flv',flashCanPlay:true,media:'video'},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:true,media:'video'}},_init:function(){var self=this;this.element.empty();this.status=$.extend({},this.status);this.internal=$.extend({},this.internal);this.options.timeFormat=$.extend({},$.jPlayer.timeFormat,this.options.timeFormat);this.internal.cmdsIgnored=$.jPlayer.platform.ipad||$.jPlayer.platform.iphone||$.jPlayer.platform.ipod;this.internal.domNode=this.element.get(0);if(this.options.keyEnabled&&!$.jPlayer.focus){$.jPlayer.focus=this;}
this.formats=[];this.solutions=[];this.require={};this.htmlElement={};this.html={};this.html.audio={};this.html.video={};this.flash={};this.css={};this.css.cs={};this.css.jq={};this.ancestorJq=[];this.options.volume=this._limitValue(this.options.volume,0,1);$.each(this.options.supplied.toLowerCase().split(","),function(index1,value1){var format=value1.replace(/^\s+|\s+$/g,"");if(self.format[format]){var dupFound=false;$.each(self.formats,function(index2,value2){if(format===value2){dupFound=true;return false;}});if(!dupFound){self.formats.push(format);}}});$.each(this.options.solution.toLowerCase().split(","),function(index1,value1){var solution=value1.replace(/^\s+|\s+$/g,"");if(self.solution[solution]){var dupFound=false;$.each(self.solutions,function(index2,value2){if(solution===value2){dupFound=true;return false;}});if(!dupFound){self.solutions.push(solution);}}});this.internal.instance="jp_"+this.count;this.instances[this.internal.instance]=this.element;if(!this.element.attr("id")){this.element.attr("id",this.options.idPrefix+"_jplayer_"+this.count);}
this.internal.self=$.extend({},{id:this.element.attr("id"),jq:this.element});this.internal.audio=$.extend({},{id:this.options.idPrefix+"_audio_"+this.count,jq:undefined});this.internal.video=$.extend({},{id:this.options.idPrefix+"_video_"+this.count,jq:undefined});this.internal.flash=$.extend({},{id:this.options.idPrefix+"_flash_"+this.count,jq:undefined,swf:this.options.swfPath+(this.options.swfPath.toLowerCase().slice(-4)!==".swf"?(this.options.swfPath&&this.options.swfPath.slice(-1)!=="/"?"/":"")+"Jplayer.swf":"")});this.internal.poster=$.extend({},{id:this.options.idPrefix+"_poster_"+this.count,jq:undefined});$.each($.jPlayer.event,function(eventName,eventType){if(self.options[eventName]!==undefined){self.element.bind(eventType+".jPlayer",self.options[eventName]);self.options[eventName]=undefined;}});this.require.audio=false;this.require.video=false;$.each(this.formats,function(priority,format){self.require[self.format[format].media]=true;});if(this.require.video){this.options=$.extend(true,{},this.optionsVideo,this.options);}else{this.options=$.extend(true,{},this.optionsAudio,this.options);}
this._setSize();this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls);this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow);this.status.noVolume=this._uaBlocklist(this.options.noVolume);if($.jPlayer.nativeFeatures.fullscreen.api.fullscreenEnabled){this._fullscreenAddEventListeners();}
this._restrictNativeVideoControls();this.htmlElement.poster=document.createElement('img');this.htmlElement.poster.id=this.internal.poster.id;this.htmlElement.poster.onload=function(){if(!self.status.video||self.status.waitForPlay){self.internal.poster.jq.show();}};this.element.append(this.htmlElement.poster);this.internal.poster.jq=$("#"+this.internal.poster.id);this.internal.poster.jq.css({'width':this.status.width,'height':this.status.height});this.internal.poster.jq.hide();this.internal.poster.jq.bind("click.jPlayer",function(){self._trigger($.jPlayer.event.click);});this.html.audio.available=false;if(this.require.audio){this.htmlElement.audio=document.createElement('audio');this.htmlElement.audio.id=this.internal.audio.id;this.html.audio.available=!!this.htmlElement.audio.canPlayType&&this._testCanPlayType(this.htmlElement.audio);}
this.html.video.available=false;if(this.require.video){this.htmlElement.video=document.createElement('video');this.htmlElement.video.id=this.internal.video.id;this.html.video.available=!!this.htmlElement.video.canPlayType&&this._testCanPlayType(this.htmlElement.video);}
this.flash.available=this._checkForFlash(10.1);this.html.canPlay={};this.flash.canPlay={};$.each(this.formats,function(priority,format){self.html.canPlay[format]=self.html[self.format[format].media].available&&""!==self.htmlElement[self.format[format].media].canPlayType(self.format[format].codec);self.flash.canPlay[format]=self.format[format].flashCanPlay&&self.flash.available;});this.html.desired=false;this.flash.desired=false;$.each(this.solutions,function(solutionPriority,solution){if(solutionPriority===0){self[solution].desired=true;}else{var audioCanPlay=false;var videoCanPlay=false;$.each(self.formats,function(formatPriority,format){if(self[self.solutions[0]].canPlay[format]){if(self.format[format].media==='video'){videoCanPlay=true;}else{audioCanPlay=true;}}});self[solution].desired=(self.require.audio&&!audioCanPlay)||(self.require.video&&!videoCanPlay);}});this.html.support={};this.flash.support={};$.each(this.formats,function(priority,format){self.html.support[format]=self.html.canPlay[format]&&self.html.desired;self.flash.support[format]=self.flash.canPlay[format]&&self.flash.desired;});this.html.used=false;this.flash.used=false;$.each(this.solutions,function(solutionPriority,solution){$.each(self.formats,function(formatPriority,format){if(self[solution].support[format]){self[solution].used=true;return false;}});});this._resetActive();this._resetGate();this._cssSelectorAncestor(this.options.cssSelectorAncestor);if(!(this.html.used||this.flash.used)){this._error({type:$.jPlayer.error.NO_SOLUTION,context:"{solution:'"+this.options.solution+"', supplied:'"+this.options.supplied+"'}",message:$.jPlayer.errorMsg.NO_SOLUTION,hint:$.jPlayer.errorHint.NO_SOLUTION});if(this.css.jq.noSolution.length){this.css.jq.noSolution.show();}}else{if(this.css.jq.noSolution.length){this.css.jq.noSolution.hide();}}
if(this.flash.used){var htmlObj,flashVars='jQuery='+encodeURI(this.options.noConflict)+'&id='+encodeURI(this.internal.self.id)+'&vol='+this.options.volume+'&muted='+this.options.muted;if($.jPlayer.browser.msie&&(Number($.jPlayer.browser.version)<9||$.jPlayer.browser.documentMode<9)){var objStr='<object id="'+this.internal.flash.id+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="0" height="0" tabindex="-1"></object>';var paramStr=['<param name="movie" value="'+this.internal.flash.swf+'" />','<param name="FlashVars" value="'+flashVars+'" />','<param name="allowScriptAccess" value="always" />','<param name="bgcolor" value="'+this.options.backgroundColor+'" />','<param name="wmode" value="'+this.options.wmode+'" />'];htmlObj=document.createElement(objStr);for(var i=0;i<paramStr.length;i++){htmlObj.appendChild(document.createElement(paramStr[i]));}}else{var createParam=function(el,n,v){var p=document.createElement("param");p.setAttribute("name",n);p.setAttribute("value",v);el.appendChild(p);};htmlObj=document.createElement("object");htmlObj.setAttribute("id",this.internal.flash.id);htmlObj.setAttribute("name",this.internal.flash.id);htmlObj.setAttribute("data",this.internal.flash.swf);htmlObj.setAttribute("type","application/x-shockwave-flash");htmlObj.setAttribute("width","1");htmlObj.setAttribute("height","1");htmlObj.setAttribute("tabindex","-1");createParam(htmlObj,"flashvars",flashVars);createParam(htmlObj,"allowscriptaccess","always");createParam(htmlObj,"bgcolor",this.options.backgroundColor);createParam(htmlObj,"wmode",this.options.wmode);}
this.element.append(htmlObj);this.internal.flash.jq=$(htmlObj);}
if(this.html.used&&!this.flash.used){this.status.playbackRateEnabled=this._testPlaybackRate('audio');}else{this.status.playbackRateEnabled=false;}
this._updatePlaybackRate();if(this.html.used){if(this.html.audio.available){this._addHtmlEventListeners(this.htmlElement.audio,this.html.audio);this.element.append(this.htmlElement.audio);this.internal.audio.jq=$("#"+this.internal.audio.id);}
if(this.html.video.available){this._addHtmlEventListeners(this.htmlElement.video,this.html.video);this.element.append(this.htmlElement.video);this.internal.video.jq=$("#"+this.internal.video.id);if(this.status.nativeVideoControls){this.internal.video.jq.css({'width':this.status.width,'height':this.status.height});}else{this.internal.video.jq.css({'width':'0px','height':'0px'});}
this.internal.video.jq.bind("click.jPlayer",function(){self._trigger($.jPlayer.event.click);});}}
if(this.options.emulateHtml){this._emulateHtmlBridge();}
if(this.html.used&&!this.flash.used){setTimeout(function(){self.internal.ready=true;self.version.flash="n/a";self._trigger($.jPlayer.event.repeat);self._trigger($.jPlayer.event.ready);},100);}
this._updateNativeVideoControls();if(this.css.jq.videoPlay.length){this.css.jq.videoPlay.hide();}
$.jPlayer.prototype.count++;},destroy:function(){this.clearMedia();this._removeUiClass();if(this.css.jq.currentTime.length){this.css.jq.currentTime.text("");}
if(this.css.jq.duration.length){this.css.jq.duration.text("");}
$.each(this.css.jq,function(fn,jq){if(jq.length){jq.unbind(".jPlayer");}});this.internal.poster.jq.unbind(".jPlayer");if(this.internal.video.jq){this.internal.video.jq.unbind(".jPlayer");}
this._fullscreenRemoveEventListeners();if(this===$.jPlayer.focus){$.jPlayer.focus=null;}
if(this.options.emulateHtml){this._destroyHtmlBridge();}
this.element.removeData("jPlayer");this.element.unbind(".jPlayer");this.element.empty();delete this.instances[this.internal.instance];},enable:function(){},disable:function(){},_testCanPlayType:function(elem){try{elem.canPlayType(this.format.mp3.codec);return true;}catch(err){return false;}},_testPlaybackRate:function(type){var el,rate=0.5;type=typeof type==='string'?type:'audio';el=document.createElement(type);try{if('playbackRate'in el){el.playbackRate=rate;return el.playbackRate===rate;}else{return false;}}catch(err){return false;}},_uaBlocklist:function(list){var ua=navigator.userAgent.toLowerCase(),block=false;$.each(list,function(p,re){if(re&&re.test(ua)){block=true;return false;}});return block;},_restrictNativeVideoControls:function(){if(this.require.audio){if(this.status.nativeVideoControls){this.status.nativeVideoControls=false;this.status.noFullWindow=true;}}},_updateNativeVideoControls:function(){if(this.html.video.available&&this.html.used){this.htmlElement.video.controls=this.status.nativeVideoControls;this._updateAutohide();if(this.status.nativeVideoControls&&this.require.video){this.internal.poster.jq.hide();this.internal.video.jq.css({'width':this.status.width,'height':this.status.height});}else if(this.status.waitForPlay&&this.status.video){this.internal.poster.jq.show();this.internal.video.jq.css({'width':'0px','height':'0px'});}}},_addHtmlEventListeners:function(mediaElement,entity){var self=this;mediaElement.preload=this.options.preload;mediaElement.muted=this.options.muted;mediaElement.volume=this.options.volume;if(this.status.playbackRateEnabled){mediaElement.defaultPlaybackRate=this.options.defaultPlaybackRate;mediaElement.playbackRate=this.options.playbackRate;}
mediaElement.addEventListener("progress",function(){if(entity.gate){if(self.internal.cmdsIgnored&&this.readyState>0){self.internal.cmdsIgnored=false;}
self._getHtmlStatus(mediaElement);self._updateInterface();self._trigger($.jPlayer.event.progress);}},false);mediaElement.addEventListener("timeupdate",function(){if(entity.gate){self._getHtmlStatus(mediaElement);self._updateInterface();self._trigger($.jPlayer.event.timeupdate);}},false);mediaElement.addEventListener("durationchange",function(){if(entity.gate){self._getHtmlStatus(mediaElement);self._updateInterface();self._trigger($.jPlayer.event.durationchange);}},false);mediaElement.addEventListener("play",function(){if(entity.gate){self._updateButtons(true);self._html_checkWaitForPlay();self._trigger($.jPlayer.event.play);}},false);mediaElement.addEventListener("playing",function(){if(entity.gate){self._updateButtons(true);self._seeked();self._trigger($.jPlayer.event.playing);}},false);mediaElement.addEventListener("pause",function(){if(entity.gate){self._updateButtons(false);self._trigger($.jPlayer.event.pause);}},false);mediaElement.addEventListener("waiting",function(){if(entity.gate){self._seeking();self._trigger($.jPlayer.event.waiting);}},false);mediaElement.addEventListener("seeking",function(){if(entity.gate){self._seeking();self._trigger($.jPlayer.event.seeking);}},false);mediaElement.addEventListener("seeked",function(){if(entity.gate){self._seeked();self._trigger($.jPlayer.event.seeked);}},false);mediaElement.addEventListener("volumechange",function(){if(entity.gate){self.options.volume=mediaElement.volume;self.options.muted=mediaElement.muted;self._updateMute();self._updateVolume();self._trigger($.jPlayer.event.volumechange);}},false);mediaElement.addEventListener("ratechange",function(){if(entity.gate){self.options.defaultPlaybackRate=mediaElement.defaultPlaybackRate;self.options.playbackRate=mediaElement.playbackRate;self._updatePlaybackRate();self._trigger($.jPlayer.event.ratechange);}},false);mediaElement.addEventListener("suspend",function(){if(entity.gate){self._seeked();self._trigger($.jPlayer.event.suspend);}},false);mediaElement.addEventListener("ended",function(){if(entity.gate){if(!$.jPlayer.browser.webkit){self.htmlElement.media.currentTime=0;}
self.htmlElement.media.pause();self._updateButtons(false);self._getHtmlStatus(mediaElement,true);self._updateInterface();self._trigger($.jPlayer.event.ended);}},false);mediaElement.addEventListener("error",function(){if(entity.gate){self._updateButtons(false);self._seeked();if(self.status.srcSet){clearTimeout(self.internal.htmlDlyCmdId);self.status.waitForLoad=true;self.status.waitForPlay=true;if(self.status.video&&!self.status.nativeVideoControls){self.internal.video.jq.css({'width':'0px','height':'0px'});}
if(self._validString(self.status.media.poster)&&!self.status.nativeVideoControls){self.internal.poster.jq.show();}
if(self.css.jq.videoPlay.length){self.css.jq.videoPlay.show();}
self._error({type:$.jPlayer.error.URL,context:self.status.src,message:$.jPlayer.errorMsg.URL,hint:$.jPlayer.errorHint.URL});}}},false);$.each($.jPlayer.htmlEvent,function(i,eventType){mediaElement.addEventListener(this,function(){if(entity.gate){self._trigger($.jPlayer.event[eventType]);}},false);});},_getHtmlStatus:function(media,override){var ct=0,cpa=0,sp=0,cpr=0;if(isFinite(media.duration)){this.status.duration=media.duration;}
ct=media.currentTime;cpa=(this.status.duration>0)?100*ct/this.status.duration:0;if((typeof media.seekable==="object")&&(media.seekable.length>0)){sp=(this.status.duration>0)?100*media.seekable.end(media.seekable.length-1)/this.status.duration:100;cpr=(this.status.duration>0)?100*media.currentTime/media.seekable.end(media.seekable.length-1):0;}else{sp=100;cpr=cpa;}
if(override){ct=0;cpr=0;cpa=0;}
this.status.seekPercent=sp;this.status.currentPercentRelative=cpr;this.status.currentPercentAbsolute=cpa;this.status.currentTime=ct;this.status.videoWidth=media.videoWidth;this.status.videoHeight=media.videoHeight;this.status.readyState=media.readyState;this.status.networkState=media.networkState;this.status.playbackRate=media.playbackRate;this.status.ended=media.ended;},_resetStatus:function(){this.status=$.extend({},this.status,$.jPlayer.prototype.status);},_trigger:function(eventType,error,warning){var event=$.Event(eventType);event.jPlayer={};event.jPlayer.version=$.extend({},this.version);event.jPlayer.options=$.extend(true,{},this.options);event.jPlayer.status=$.extend(true,{},this.status);event.jPlayer.html=$.extend(true,{},this.html);event.jPlayer.flash=$.extend(true,{},this.flash);if(error){event.jPlayer.error=$.extend({},error);}
if(warning){event.jPlayer.warning=$.extend({},warning);}
this.element.trigger(event);},jPlayerFlashEvent:function(eventType,status){if(eventType===$.jPlayer.event.ready){if(!this.internal.ready){this.internal.ready=true;this.internal.flash.jq.css({'width':'0px','height':'0px'});this.version.flash=status.version;if(this.version.needFlash!==this.version.flash){this._error({type:$.jPlayer.error.VERSION,context:this.version.flash,message:$.jPlayer.errorMsg.VERSION+this.version.flash,hint:$.jPlayer.errorHint.VERSION});}
this._trigger($.jPlayer.event.repeat);this._trigger(eventType);}else{if(this.flash.gate){if(this.status.srcSet){var currentTime=this.status.currentTime,paused=this.status.paused;this.setMedia(this.status.media);this.volumeWorker(this.options.volume);if(currentTime>0){if(paused){this.pause(currentTime);}else{this.play(currentTime);}}}
this._trigger($.jPlayer.event.flashreset);}}}
if(this.flash.gate){switch(eventType){case $.jPlayer.event.progress:this._getFlashStatus(status);this._updateInterface();this._trigger(eventType);break;case $.jPlayer.event.timeupdate:this._getFlashStatus(status);this._updateInterface();this._trigger(eventType);break;case $.jPlayer.event.play:this._seeked();this._updateButtons(true);this._trigger(eventType);break;case $.jPlayer.event.pause:this._updateButtons(false);this._trigger(eventType);break;case $.jPlayer.event.ended:this._updateButtons(false);this._trigger(eventType);break;case $.jPlayer.event.click:this._trigger(eventType);break;case $.jPlayer.event.error:this.status.waitForLoad=true;this.status.waitForPlay=true;if(this.status.video){this.internal.flash.jq.css({'width':'0px','height':'0px'});}
if(this._validString(this.status.media.poster)){this.internal.poster.jq.show();}
if(this.css.jq.videoPlay.length&&this.status.video){this.css.jq.videoPlay.show();}
if(this.status.video){this._flash_setVideo(this.status.media);}else{this._flash_setAudio(this.status.media);}
this._updateButtons(false);this._error({type:$.jPlayer.error.URL,context:status.src,message:$.jPlayer.errorMsg.URL,hint:$.jPlayer.errorHint.URL});break;case $.jPlayer.event.seeking:this._seeking();this._trigger(eventType);break;case $.jPlayer.event.seeked:this._seeked();this._trigger(eventType);break;case $.jPlayer.event.ready:break;default:this._trigger(eventType);}}
return false;},_getFlashStatus:function(status){this.status.seekPercent=status.seekPercent;this.status.currentPercentRelative=status.currentPercentRelative;this.status.currentPercentAbsolute=status.currentPercentAbsolute;this.status.currentTime=status.currentTime;this.status.duration=status.duration;this.status.videoWidth=status.videoWidth;this.status.videoHeight=status.videoHeight;this.status.readyState=4;this.status.networkState=0;this.status.playbackRate=1;this.status.ended=false;},_updateButtons:function(playing){if(playing===undefined){playing=!this.status.paused;}else{this.status.paused=!playing;}
if(this.css.jq.play.length&&this.css.jq.pause.length){if(playing){this.css.jq.play.hide();this.css.jq.pause.show();}else{this.css.jq.play.show();this.css.jq.pause.hide();}}
if(this.css.jq.restoreScreen.length&&this.css.jq.fullScreen.length){if(this.status.noFullWindow){this.css.jq.fullScreen.hide();this.css.jq.restoreScreen.hide();}else if(this.options.fullWindow){this.css.jq.fullScreen.hide();this.css.jq.restoreScreen.show();}else{this.css.jq.fullScreen.show();this.css.jq.restoreScreen.hide();}}
if(this.css.jq.repeat.length&&this.css.jq.repeatOff.length){if(this.options.loop){this.css.jq.repeat.hide();this.css.jq.repeatOff.show();}else{this.css.jq.repeat.show();this.css.jq.repeatOff.hide();}}},_updateInterface:function(){if(this.css.jq.seekBar.length){this.css.jq.seekBar.width(this.status.seekPercent+"%");}
if(this.css.jq.playBar.length){if(this.options.smoothPlayBar){this.css.jq.playBar.stop().animate({width:this.status.currentPercentAbsolute+"%"},250,"linear");}else{this.css.jq.playBar.width(this.status.currentPercentRelative+"%");}}
if(this.css.jq.currentTime.length){this.css.jq.currentTime.text(this._convertTime(this.status.currentTime));}
if(this.css.jq.duration.length){this.css.jq.duration.text(this._convertTime(this.status.duration));}},_convertTime:ConvertTime.prototype.time,_seeking:function(){if(this.css.jq.seekBar.length){this.css.jq.seekBar.addClass("jp-seeking-bg");}},_seeked:function(){if(this.css.jq.seekBar.length){this.css.jq.seekBar.removeClass("jp-seeking-bg");}},_resetGate:function(){this.html.audio.gate=false;this.html.video.gate=false;this.flash.gate=false;},_resetActive:function(){this.html.active=false;this.flash.active=false;},_escapeHtml:function(s){return s.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('"').join('&quot;');},_qualifyURL:function(url){var el=document.createElement('div');el.innerHTML='<a href="'+this._escapeHtml(url)+'">x</a>';return el.firstChild.href;},_absoluteMediaUrls:function(media){var self=this;$.each(media,function(type,url){if(self.format[type]){media[type]=self._qualifyURL(url);}});return media;},setMedia:function(media){var self=this,supported=false,posterChanged=this.status.media.poster!==media.poster;this._resetMedia();this._resetGate();this._resetActive();media=this._absoluteMediaUrls(media);$.each(this.formats,function(formatPriority,format){var isVideo=self.format[format].media==='video';$.each(self.solutions,function(solutionPriority,solution){if(self[solution].support[format]&&self._validString(media[format])){var isHtml=solution==='html';if(isVideo){if(isHtml){self.html.video.gate=true;self._html_setVideo(media);self.html.active=true;}else{self.flash.gate=true;self._flash_setVideo(media);self.flash.active=true;}
if(self.css.jq.videoPlay.length){self.css.jq.videoPlay.show();}
self.status.video=true;}else{if(isHtml){self.html.audio.gate=true;self._html_setAudio(media);self.html.active=true;}else{self.flash.gate=true;self._flash_setAudio(media);self.flash.active=true;}
if(self.css.jq.videoPlay.length){self.css.jq.videoPlay.hide();}
self.status.video=false;}
supported=true;return false;}});if(supported){return false;}});if(supported){if(!(this.status.nativeVideoControls&&this.html.video.gate)){if(this._validString(media.poster)){if(posterChanged){this.htmlElement.poster.src=media.poster;}else{this.internal.poster.jq.show();}}}
this.status.srcSet=true;this.status.media=$.extend({},media);this._updateButtons(false);this._updateInterface();}else{this._error({type:$.jPlayer.error.NO_SUPPORT,context:"{supplied:'"+this.options.supplied+"'}",message:$.jPlayer.errorMsg.NO_SUPPORT,hint:$.jPlayer.errorHint.NO_SUPPORT});}},_resetMedia:function(){this._resetStatus();this._updateButtons(false);this._updateInterface();this._seeked();this.internal.poster.jq.hide();clearTimeout(this.internal.htmlDlyCmdId);if(this.html.active){this._html_resetMedia();}else if(this.flash.active){this._flash_resetMedia();}},clearMedia:function(){this._resetMedia();if(this.html.active){this._html_clearMedia();}else if(this.flash.active){this._flash_clearMedia();}
this._resetGate();this._resetActive();},load:function(){if(this.status.srcSet){if(this.html.active){this._html_load();}else if(this.flash.active){this._flash_load();}}else{this._urlNotSetError("load");}},focus:function(){if(this.options.keyEnabled){$.jPlayer.focus=this;}},play:function(time){time=(typeof time==="number")?time:NaN;if(this.status.srcSet){this.focus();if(this.html.active){this._html_play(time);}else if(this.flash.active){this._flash_play(time);}}else{this._urlNotSetError("play");}},videoPlay:function(){this.play();},pause:function(time){time=(typeof time==="number")?time:NaN;if(this.status.srcSet){if(this.html.active){this._html_pause(time);}else if(this.flash.active){this._flash_pause(time);}}else{this._urlNotSetError("pause");}},tellOthers:function(command,conditions){var self=this,hasConditions=typeof conditions==='function',args=Array.prototype.slice.call(arguments);if(typeof command!=='string'){return;}
if(hasConditions){args.splice(1,1);}
$.each(this.instances,function(){if(self.element!==this){if(!hasConditions||conditions.call(this.data("jPlayer"),self)){this.jPlayer.apply(this,args);}}});},pauseOthers:function(time){this.tellOthers("pause",function(){return this.status.srcSet;},time);},stop:function(){if(this.status.srcSet){if(this.html.active){this._html_pause(0);}else if(this.flash.active){this._flash_pause(0);}}else{this._urlNotSetError("stop");}},playHead:function(p){p=this._limitValue(p,0,100);if(this.status.srcSet){if(this.html.active){this._html_playHead(p);}else if(this.flash.active){this._flash_playHead(p);}}else{this._urlNotSetError("playHead");}},_muted:function(muted){this.mutedWorker(muted);if(this.options.globalVolume){this.tellOthers("mutedWorker",function(){return this.options.globalVolume;},muted);}},mutedWorker:function(muted){this.options.muted=muted;if(this.html.used){this._html_setProperty('muted',muted);}
if(this.flash.used){this._flash_mute(muted);}
if(!this.html.video.gate&&!this.html.audio.gate){this._updateMute(muted);this._updateVolume(this.options.volume);this._trigger($.jPlayer.event.volumechange);}},mute:function(mute){mute=mute===undefined?true:!!mute;this._muted(mute);},unmute:function(unmute){unmute=unmute===undefined?true:!!unmute;this._muted(!unmute);},_updateMute:function(mute){if(mute===undefined){mute=this.options.muted;}
if(this.css.jq.mute.length&&this.css.jq.unmute.length){if(this.status.noVolume){this.css.jq.mute.hide();this.css.jq.unmute.hide();}else if(mute){this.css.jq.mute.hide();this.css.jq.unmute.show();}else{this.css.jq.mute.show();this.css.jq.unmute.hide();}}},volume:function(v){this.volumeWorker(v);if(this.options.globalVolume){this.tellOthers("volumeWorker",function(){return this.options.globalVolume;},v);}},volumeWorker:function(v){v=this._limitValue(v,0,1);this.options.volume=v;if(this.html.used){this._html_setProperty('volume',v);}
if(this.flash.used){this._flash_volume(v);}
if(!this.html.video.gate&&!this.html.audio.gate){this._updateVolume(v);this._trigger($.jPlayer.event.volumechange);}},volumeBar:function(e){if(this.css.jq.volumeBar.length){var $bar=$(e.currentTarget),offset=$bar.offset(),x=e.pageX-offset.left,w=$bar.width(),y=$bar.height()-e.pageY+offset.top,h=$bar.height();if(this.options.verticalVolume){this.volume(y/h);}else{this.volume(x/w);}}
if(this.options.muted){this._muted(false);}},_updateVolume:function(v){if(v===undefined){v=this.options.volume;}
v=this.options.muted?0:v;if(this.status.noVolume){if(this.css.jq.volumeBar.length){this.css.jq.volumeBar.hide();}
if(this.css.jq.volumeBarValue.length){this.css.jq.volumeBarValue.hide();}
if(this.css.jq.volumeMax.length){this.css.jq.volumeMax.hide();}}else{if(this.css.jq.volumeBar.length){this.css.jq.volumeBar.show();}
if(this.css.jq.volumeBarValue.length){this.css.jq.volumeBarValue.show();this.css.jq.volumeBarValue[this.options.verticalVolume?"height":"width"]((v*100)+"%");}
if(this.css.jq.volumeMax.length){this.css.jq.volumeMax.show();}}},volumeMax:function(){this.volume(1);if(this.options.muted){this._muted(false);}},_cssSelectorAncestor:function(ancestor){var self=this;this.options.cssSelectorAncestor=ancestor;this._removeUiClass();this.ancestorJq=ancestor?$(ancestor):[];if(ancestor&&this.ancestorJq.length!==1){this._warning({type:$.jPlayer.warning.CSS_SELECTOR_COUNT,context:ancestor,message:$.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.ancestorJq.length+" found for cssSelectorAncestor.",hint:$.jPlayer.warningHint.CSS_SELECTOR_COUNT});}
this._addUiClass();$.each(this.options.cssSelector,function(fn,cssSel){self._cssSelector(fn,cssSel);});this._updateInterface();this._updateButtons();this._updateAutohide();this._updateVolume();this._updateMute();},_cssSelector:function(fn,cssSel){var self=this;if(typeof cssSel==='string'){if($.jPlayer.prototype.options.cssSelector[fn]){if(this.css.jq[fn]&&this.css.jq[fn].length){this.css.jq[fn].unbind(".jPlayer");}
this.options.cssSelector[fn]=cssSel;this.css.cs[fn]=this.options.cssSelectorAncestor+" "+cssSel;if(cssSel){this.css.jq[fn]=$(this.css.cs[fn]);}else{this.css.jq[fn]=[];}
if(this.css.jq[fn].length&&this[fn]){var handler=function(e){e.preventDefault();self[fn](e);$(this).blur();};this.css.jq[fn].bind("click.jPlayer",handler);}
if(cssSel&&this.css.jq[fn].length!==1){this._warning({type:$.jPlayer.warning.CSS_SELECTOR_COUNT,context:this.css.cs[fn],message:$.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.css.jq[fn].length+" found for "+fn+" method.",hint:$.jPlayer.warningHint.CSS_SELECTOR_COUNT});}}else{this._warning({type:$.jPlayer.warning.CSS_SELECTOR_METHOD,context:fn,message:$.jPlayer.warningMsg.CSS_SELECTOR_METHOD,hint:$.jPlayer.warningHint.CSS_SELECTOR_METHOD});}}else{this._warning({type:$.jPlayer.warning.CSS_SELECTOR_STRING,context:cssSel,message:$.jPlayer.warningMsg.CSS_SELECTOR_STRING,hint:$.jPlayer.warningHint.CSS_SELECTOR_STRING});}},seekBar:function(e){if(this.css.jq.seekBar.length){var $bar=$(e.currentTarget),offset=$bar.offset(),x=e.pageX-offset.left,w=$bar.width(),p=100*x/w;this.playHead(p);}},playbackRate:function(pbr){this._setOption("playbackRate",pbr);},playbackRateBar:function(e){if(this.css.jq.playbackRateBar.length){var $bar=$(e.currentTarget),offset=$bar.offset(),x=e.pageX-offset.left,w=$bar.width(),y=$bar.height()-e.pageY+offset.top,h=$bar.height(),ratio,pbr;if(this.options.verticalPlaybackRate){ratio=y/h;}else{ratio=x/w;}
pbr=ratio*(this.options.maxPlaybackRate-this.options.minPlaybackRate)+this.options.minPlaybackRate;this.playbackRate(pbr);}},_updatePlaybackRate:function(){var pbr=this.options.playbackRate,ratio=(pbr-this.options.minPlaybackRate)/(this.options.maxPlaybackRate-this.options.minPlaybackRate);if(this.status.playbackRateEnabled){if(this.css.jq.playbackRateBar.length){this.css.jq.playbackRateBar.show();}
if(this.css.jq.playbackRateBarValue.length){this.css.jq.playbackRateBarValue.show();this.css.jq.playbackRateBarValue[this.options.verticalPlaybackRate?"height":"width"]((ratio*100)+"%");}}else{if(this.css.jq.playbackRateBar.length){this.css.jq.playbackRateBar.hide();}
if(this.css.jq.playbackRateBarValue.length){this.css.jq.playbackRateBarValue.hide();}}},repeat:function(){this._loop(true);},repeatOff:function(){this._loop(false);},_loop:function(loop){if(this.options.loop!==loop){this.options.loop=loop;this._updateButtons();this._trigger($.jPlayer.event.repeat);}},option:function(key,value){var options=key;if(arguments.length===0){return $.extend(true,{},this.options);}
if(typeof key==="string"){var keys=key.split(".");if(value===undefined){var opt=$.extend(true,{},this.options);for(var i=0;i<keys.length;i++){if(opt[keys[i]]!==undefined){opt=opt[keys[i]];}else{this._warning({type:$.jPlayer.warning.OPTION_KEY,context:key,message:$.jPlayer.warningMsg.OPTION_KEY,hint:$.jPlayer.warningHint.OPTION_KEY});return undefined;}}
return opt;}
options={};var opts=options;for(var j=0;j<keys.length;j++){if(j<keys.length-1){opts[keys[j]]={};opts=opts[keys[j]];}else{opts[keys[j]]=value;}}}
this._setOptions(options);return this;},_setOptions:function(options){var self=this;$.each(options,function(key,value){self._setOption(key,value);});return this;},_setOption:function(key,value){var self=this;switch(key){case"volume":this.volume(value);break;case"muted":this._muted(value);break;case"globalVolume":this.options[key]=value;break;case"cssSelectorAncestor":this._cssSelectorAncestor(value);break;case"cssSelector":$.each(value,function(fn,cssSel){self._cssSelector(fn,cssSel);});break;case"playbackRate":this.options[key]=value=this._limitValue(value,this.options.minPlaybackRate,this.options.maxPlaybackRate);if(this.html.used){this._html_setProperty('playbackRate',value);}
this._updatePlaybackRate();break;case"defaultPlaybackRate":this.options[key]=value=this._limitValue(value,this.options.minPlaybackRate,this.options.maxPlaybackRate);if(this.html.used){this._html_setProperty('defaultPlaybackRate',value);}
this._updatePlaybackRate();break;case"minPlaybackRate":this.options[key]=value=this._limitValue(value,0.1,this.options.maxPlaybackRate-0.1);this._updatePlaybackRate();break;case"maxPlaybackRate":this.options[key]=value=this._limitValue(value,this.options.minPlaybackRate+0.1,16);this._updatePlaybackRate();break;case"fullScreen":if(this.options[key]!==value){var wkv=$.jPlayer.nativeFeatures.fullscreen.used.webkitVideo;if(!wkv||wkv&&!this.status.waitForPlay){if(!wkv){this.options[key]=value;}
if(value){this._requestFullscreen();}else{this._exitFullscreen();}
if(!wkv){this._setOption("fullWindow",value);}}}
break;case"fullWindow":if(this.options[key]!==value){this._removeUiClass();this.options[key]=value;this._refreshSize();}
break;case"size":if(!this.options.fullWindow&&this.options[key].cssClass!==value.cssClass){this._removeUiClass();}
this.options[key]=$.extend({},this.options[key],value);this._refreshSize();break;case"sizeFull":if(this.options.fullWindow&&this.options[key].cssClass!==value.cssClass){this._removeUiClass();}
this.options[key]=$.extend({},this.options[key],value);this._refreshSize();break;case"autohide":this.options[key]=$.extend({},this.options[key],value);this._updateAutohide();break;case"loop":this._loop(value);break;case"nativeVideoControls":this.options[key]=$.extend({},this.options[key],value);this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls);this._restrictNativeVideoControls();this._updateNativeVideoControls();break;case"noFullWindow":this.options[key]=$.extend({},this.options[key],value);this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls);this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow);this._restrictNativeVideoControls();this._updateButtons();break;case"noVolume":this.options[key]=$.extend({},this.options[key],value);this.status.noVolume=this._uaBlocklist(this.options.noVolume);this._updateVolume();this._updateMute();break;case"emulateHtml":if(this.options[key]!==value){this.options[key]=value;if(value){this._emulateHtmlBridge();}else{this._destroyHtmlBridge();}}
break;case"timeFormat":this.options[key]=$.extend({},this.options[key],value);break;case"keyEnabled":this.options[key]=value;if(!value&&this===$.jPlayer.focus){$.jPlayer.focus=null;}
break;case"keyBindings":this.options[key]=$.extend(true,{},this.options[key],value);break;case"audioFullScreen":this.options[key]=value;break;}
return this;},_refreshSize:function(){this._setSize();this._addUiClass();this._updateSize();this._updateButtons();this._updateAutohide();this._trigger($.jPlayer.event.resize);},_setSize:function(){if(this.options.fullWindow){this.status.width=this.options.sizeFull.width;this.status.height=this.options.sizeFull.height;this.status.cssClass=this.options.sizeFull.cssClass;}else{this.status.width=this.options.size.width;this.status.height=this.options.size.height;this.status.cssClass=this.options.size.cssClass;}
this.element.css({'width':this.status.width,'height':this.status.height});},_addUiClass:function(){if(this.ancestorJq.length){this.ancestorJq.addClass(this.status.cssClass);}},_removeUiClass:function(){if(this.ancestorJq.length){this.ancestorJq.removeClass(this.status.cssClass);}},_updateSize:function(){this.internal.poster.jq.css({'width':this.status.width,'height':this.status.height});if(!this.status.waitForPlay&&this.html.active&&this.status.video||this.html.video.available&&this.html.used&&this.status.nativeVideoControls){this.internal.video.jq.css({'width':this.status.width,'height':this.status.height});}
else if(!this.status.waitForPlay&&this.flash.active&&this.status.video){this.internal.flash.jq.css({'width':this.status.width,'height':this.status.height});}},_updateAutohide:function(){var self=this,event="mousemove.jPlayer",namespace=".jPlayerAutohide",eventType=event+namespace,handler=function(){self.css.jq.gui.fadeIn(self.options.autohide.fadeIn,function(){clearTimeout(self.internal.autohideId);self.internal.autohideId=setTimeout(function(){self.css.jq.gui.fadeOut(self.options.autohide.fadeOut);},self.options.autohide.hold);});};if(this.css.jq.gui.length){this.css.jq.gui.stop(true,true);clearTimeout(this.internal.autohideId);this.element.unbind(namespace);this.css.jq.gui.unbind(namespace);if(!this.status.nativeVideoControls){if(this.options.fullWindow&&this.options.autohide.full||!this.options.fullWindow&&this.options.autohide.restored){this.element.bind(eventType,handler);this.css.jq.gui.bind(eventType,handler);this.css.jq.gui.hide();}else{this.css.jq.gui.show();}}else{this.css.jq.gui.hide();}}},fullScreen:function(){this._setOption("fullScreen",true);},restoreScreen:function(){this._setOption("fullScreen",false);},_fullscreenAddEventListeners:function(){var self=this,fs=$.jPlayer.nativeFeatures.fullscreen;if(fs.api.fullscreenEnabled){if(fs.event.fullscreenchange){if(typeof this.internal.fullscreenchangeHandler!=='function'){this.internal.fullscreenchangeHandler=function(){self._fullscreenchange();};}
document.addEventListener(fs.event.fullscreenchange,this.internal.fullscreenchangeHandler,false);}}},_fullscreenRemoveEventListeners:function(){var fs=$.jPlayer.nativeFeatures.fullscreen;if(this.internal.fullscreenchangeHandler){document.addEventListener(fs.event.fullscreenchange,this.internal.fullscreenchangeHandler,false);}},_fullscreenchange:function(){if(this.options.fullScreen&&!$.jPlayer.nativeFeatures.fullscreen.api.fullscreenElement()){this._setOption("fullScreen",false);}},_requestFullscreen:function(){var e=this.ancestorJq.length?this.ancestorJq[0]:this.element[0],fs=$.jPlayer.nativeFeatures.fullscreen;if(fs.used.webkitVideo){e=this.htmlElement.video;}
if(fs.api.fullscreenEnabled){fs.api.requestFullscreen(e);}},_exitFullscreen:function(){var fs=$.jPlayer.nativeFeatures.fullscreen,e;if(fs.used.webkitVideo){e=this.htmlElement.video;}
if(fs.api.fullscreenEnabled){fs.api.exitFullscreen(e);}},_html_initMedia:function(media){var $media=$(this.htmlElement.media).empty();$.each(media.track||[],function(i,v){var track=document.createElement('track');track.setAttribute("kind",v.kind?v.kind:"");track.setAttribute("src",v.src?v.src:"");track.setAttribute("srclang",v.srclang?v.srclang:"");track.setAttribute("label",v.label?v.label:"");if(v.def){track.setAttribute("default",v.def);}
$media.append(track);});this.htmlElement.media.src=this.status.src;if(this.options.preload!=='none'){this._html_load();}
this._trigger($.jPlayer.event.timeupdate);},_html_setFormat:function(media){var self=this;$.each(this.formats,function(priority,format){if(self.html.support[format]&&media[format]){self.status.src=media[format];self.status.format[format]=true;self.status.formatType=format;return false;}});},_html_setAudio:function(media){this._html_setFormat(media);this.htmlElement.media=this.htmlElement.audio;this._html_initMedia(media);},_html_setVideo:function(media){this._html_setFormat(media);if(this.status.nativeVideoControls){this.htmlElement.video.poster=this._validString(media.poster)?media.poster:"";}
this.htmlElement.media=this.htmlElement.video;this._html_initMedia(media);},_html_resetMedia:function(){if(this.htmlElement.media){if(this.htmlElement.media.id===this.internal.video.id&&!this.status.nativeVideoControls){this.internal.video.jq.css({'width':'0px','height':'0px'});}
this.htmlElement.media.pause();}},_html_clearMedia:function(){if(this.htmlElement.media){this.htmlElement.media.src="about:blank";this.htmlElement.media.load();}},_html_load:function(){if(this.status.waitForLoad){this.status.waitForLoad=false;this.htmlElement.media.load();}
clearTimeout(this.internal.htmlDlyCmdId);},_html_play:function(time){var self=this,media=this.htmlElement.media;this._html_load();if(!isNaN(time)){if(this.internal.cmdsIgnored){media.play();}
try{if(!media.seekable||typeof media.seekable==="object"&&media.seekable.length>0){media.currentTime=time;media.play();}else{throw 1;}}catch(err){this.internal.htmlDlyCmdId=setTimeout(function(){self.play(time);},250);return;}}else{media.play();}
this._html_checkWaitForPlay();},_html_pause:function(time){var self=this,media=this.htmlElement.media;if(time>0){this._html_load();}else{clearTimeout(this.internal.htmlDlyCmdId);}
media.pause();if(!isNaN(time)){try{if(!media.seekable||typeof media.seekable==="object"&&media.seekable.length>0){media.currentTime=time;}else{throw 1;}}catch(err){this.internal.htmlDlyCmdId=setTimeout(function(){self.pause(time);},250);return;}}
if(time>0){this._html_checkWaitForPlay();}},_html_playHead:function(percent){var self=this,media=this.htmlElement.media;this._html_load();try{if(typeof media.seekable==="object"&&media.seekable.length>0){media.currentTime=percent*media.seekable.end(media.seekable.length-1)/100;}else if(media.duration>0&&!isNaN(media.duration)){media.currentTime=percent*media.duration/100;}else{throw"e";}}catch(err){this.internal.htmlDlyCmdId=setTimeout(function(){self.playHead(percent);},250);return;}
if(!this.status.waitForLoad){this._html_checkWaitForPlay();}},_html_checkWaitForPlay:function(){if(this.status.waitForPlay){this.status.waitForPlay=false;if(this.css.jq.videoPlay.length){this.css.jq.videoPlay.hide();}
if(this.status.video){this.internal.poster.jq.hide();this.internal.video.jq.css({'width':this.status.width,'height':this.status.height});}}},_html_setProperty:function(property,value){if(this.html.audio.available){this.htmlElement.audio[property]=value;}
if(this.html.video.available){this.htmlElement.video[property]=value;}},_flash_setAudio:function(media){var self=this;try{$.each(this.formats,function(priority,format){if(self.flash.support[format]&&media[format]){switch(format){case"m4a":case"fla":self._getMovie().fl_setAudio_m4a(media[format]);break;case"mp3":self._getMovie().fl_setAudio_mp3(media[format]);break;case"rtmpa":self._getMovie().fl_setAudio_rtmp(media[format]);break;}
self.status.src=media[format];self.status.format[format]=true;self.status.formatType=format;return false;}});if(this.options.preload==='auto'){this._flash_load();this.status.waitForLoad=false;}}catch(err){this._flashError(err);}},_flash_setVideo:function(media){var self=this;try{$.each(this.formats,function(priority,format){if(self.flash.support[format]&&media[format]){switch(format){case"m4v":case"flv":self._getMovie().fl_setVideo_m4v(media[format]);break;case"rtmpv":self._getMovie().fl_setVideo_rtmp(media[format]);break;}
self.status.src=media[format];self.status.format[format]=true;self.status.formatType=format;return false;}});if(this.options.preload==='auto'){this._flash_load();this.status.waitForLoad=false;}}catch(err){this._flashError(err);}},_flash_resetMedia:function(){this.internal.flash.jq.css({'width':'0px','height':'0px'});this._flash_pause(NaN);},_flash_clearMedia:function(){try{this._getMovie().fl_clearMedia();}catch(err){this._flashError(err);}},_flash_load:function(){try{this._getMovie().fl_load();}catch(err){this._flashError(err);}
this.status.waitForLoad=false;},_flash_play:function(time){try{this._getMovie().fl_play(time);}catch(err){this._flashError(err);}
this.status.waitForLoad=false;this._flash_checkWaitForPlay();},_flash_pause:function(time){try{this._getMovie().fl_pause(time);}catch(err){this._flashError(err);}
if(time>0){this.status.waitForLoad=false;this._flash_checkWaitForPlay();}},_flash_playHead:function(p){try{this._getMovie().fl_play_head(p);}catch(err){this._flashError(err);}
if(!this.status.waitForLoad){this._flash_checkWaitForPlay();}},_flash_checkWaitForPlay:function(){if(this.status.waitForPlay){this.status.waitForPlay=false;if(this.css.jq.videoPlay.length){this.css.jq.videoPlay.hide();}
if(this.status.video){this.internal.poster.jq.hide();this.internal.flash.jq.css({'width':this.status.width,'height':this.status.height});}}},_flash_volume:function(v){try{this._getMovie().fl_volume(v);}catch(err){this._flashError(err);}},_flash_mute:function(m){try{this._getMovie().fl_mute(m);}catch(err){this._flashError(err);}},_getMovie:function(){return document[this.internal.flash.id];},_getFlashPluginVersion:function(){var version=0,flash;if(window.ActiveXObject){try{flash=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(flash){var v=flash.GetVariable("$version");if(v){v=v.split(" ")[1].split(",");version=parseInt(v[0],10)+"."+parseInt(v[1],10);}}}catch(e){}}
else if(navigator.plugins&&navigator.mimeTypes.length>0){flash=navigator.plugins["Shockwave Flash"];if(flash){version=navigator.plugins["Shockwave Flash"].description.replace(/.*\s(\d+\.\d+).*/,"$1");}}
return version*1;},_checkForFlash:function(version){var flashOk=false;if(this._getFlashPluginVersion()>=version){flashOk=true;}
return flashOk;},_validString:function(url){return(url&&typeof url==="string");},_limitValue:function(value,min,max){return(value<min)?min:((value>max)?max:value);},_urlNotSetError:function(context){this._error({type:$.jPlayer.error.URL_NOT_SET,context:context,message:$.jPlayer.errorMsg.URL_NOT_SET,hint:$.jPlayer.errorHint.URL_NOT_SET});},_flashError:function(error){var errorType;if(!this.internal.ready){errorType="FLASH";}else{errorType="FLASH_DISABLED";}
this._error({type:$.jPlayer.error[errorType],context:this.internal.flash.swf,message:$.jPlayer.errorMsg[errorType]+error.message,hint:$.jPlayer.errorHint[errorType]});this.internal.flash.jq.css({'width':'1px','height':'1px'});},_error:function(error){this._trigger($.jPlayer.event.error,error);if(this.options.errorAlerts){this._alert("Error!"+(error.message?"\n"+error.message:"")+(error.hint?"\n"+error.hint:"")+"\nContext: "+error.context);}},_warning:function(warning){this._trigger($.jPlayer.event.warning,undefined,warning);if(this.options.warningAlerts){this._alert("Warning!"+(warning.message?"\n"+warning.message:"")+(warning.hint?"\n"+warning.hint:"")+"\nContext: "+warning.context);}},_alert:function(message){var msg="jPlayer "+this.version.script+" : id='"+this.internal.self.id+"' : "+message;if(!this.options.consoleAlerts){alert(msg);}else if(console&&console.log){console.log(msg);}},_emulateHtmlBridge:function(){var self=this;$.each($.jPlayer.emulateMethods.split(/\s+/g),function(i,name){self.internal.domNode[name]=function(arg){self[name](arg);};});$.each($.jPlayer.event,function(eventName,eventType){var nativeEvent=true;$.each($.jPlayer.reservedEvent.split(/\s+/g),function(i,name){if(name===eventName){nativeEvent=false;return false;}});if(nativeEvent){self.element.bind(eventType+".jPlayer.jPlayerHtml",function(){self._emulateHtmlUpdate();var domEvent=document.createEvent("Event");domEvent.initEvent(eventName,false,true);self.internal.domNode.dispatchEvent(domEvent);});}});},_emulateHtmlUpdate:function(){var self=this;$.each($.jPlayer.emulateStatus.split(/\s+/g),function(i,name){self.internal.domNode[name]=self.status[name];});$.each($.jPlayer.emulateOptions.split(/\s+/g),function(i,name){self.internal.domNode[name]=self.options[name];});},_destroyHtmlBridge:function(){var self=this;this.element.unbind(".jPlayerHtml");var emulated=$.jPlayer.emulateMethods+" "+$.jPlayer.emulateStatus+" "+$.jPlayer.emulateOptions;$.each(emulated.split(/\s+/g),function(i,name){delete self.internal.domNode[name];});}};$.jPlayer.error={FLASH:"e_flash",FLASH_DISABLED:"e_flash_disabled",NO_SOLUTION:"e_no_solution",NO_SUPPORT:"e_no_support",URL:"e_url",URL_NOT_SET:"e_url_not_set",VERSION:"e_version"};$.jPlayer.errorMsg={FLASH:"jPlayer's Flash fallback is not configured correctly, or a command was issued before the jPlayer Ready event. Details: ",FLASH_DISABLED:"jPlayer's Flash fallback has been disabled by the browser due to the CSS rules you have used. Details: ",NO_SOLUTION:"No solution can be found by jPlayer in this browser. Neither HTML nor Flash can be used.",NO_SUPPORT:"It is not possible to play any media format provided in setMedia() on this browser using your current options.",URL:"Media URL could not be loaded.",URL_NOT_SET:"Attempt to issue media playback commands, while no media url is set.",VERSION:"jPlayer "+$.jPlayer.prototype.version.script+" needs Jplayer.swf version "+$.jPlayer.prototype.version.needFlash+" but found "};$.jPlayer.errorHint={FLASH:"Check your swfPath option and that Jplayer.swf is there.",FLASH_DISABLED:"Check that you have not display:none; the jPlayer entity or any ancestor.",NO_SOLUTION:"Review the jPlayer options: support and supplied.",NO_SUPPORT:"Video or audio formats defined in the supplied option are missing.",URL:"Check media URL is valid.",URL_NOT_SET:"Use setMedia() to set the media URL.",VERSION:"Update jPlayer files."};$.jPlayer.warning={CSS_SELECTOR_COUNT:"e_css_selector_count",CSS_SELECTOR_METHOD:"e_css_selector_method",CSS_SELECTOR_STRING:"e_css_selector_string",OPTION_KEY:"e_option_key"};$.jPlayer.warningMsg={CSS_SELECTOR_COUNT:"The number of css selectors found did not equal one: ",CSS_SELECTOR_METHOD:"The methodName given in jPlayer('cssSelector') is not a valid jPlayer method.",CSS_SELECTOR_STRING:"The methodCssSelector given in jPlayer('cssSelector') is not a String or is empty.",OPTION_KEY:"The option requested in jPlayer('option') is undefined."};$.jPlayer.warningHint={CSS_SELECTOR_COUNT:"Check your css selector and the ancestor.",CSS_SELECTOR_METHOD:"Check your method name.",CSS_SELECTOR_STRING:"Check your css selector is a string.",OPTION_KEY:"Check your option name."};}));(function(window,$,undefined){"use strict";$.infinitescroll=function infscr(options,callback,element){this.element=$(element);if(!this._create(options,callback)){this.failed=true;}};$.infinitescroll.defaults={loading:{finished:undefined,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"data:image/gif;base64,R0lGODlh3AATAPQeAPDy+MnQ6LW/4N3h8MzT6rjC4sTM5r/I5NHX7N7j8c7U6tvg8OLl8uXo9Ojr9b3G5MfP6Ovu9tPZ7PT1+vX2+tbb7vf4+8/W69jd7rC73vn5/O/x+K243ai02////wAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQECgD/ACwAAAAA3AATAAAF/6AnjmRpnmiqrmzrvnAsz3Rt33iu73zv/8CgcEj0BAScpHLJbDqf0Kh0Sq1ar9isdioItAKGw+MAKYMFhbF63CW438f0mg1R2O8EuXj/aOPtaHx7fn96goR4hmuId4qDdX95c4+RBIGCB4yAjpmQhZN0YGYGXitdZBIVGAsLoq4BBKQDswm1CQRkcG6ytrYKubq8vbfAcMK9v7q7EMO1ycrHvsW6zcTKsczNz8HZw9vG3cjTsMIYqQkCLBwHCgsMDQ4RDAYIqfYSFxDxEfz88/X38Onr16+Bp4ADCco7eC8hQYMAEe57yNCew4IVBU7EGNDiRn8Z831cGLHhSIgdFf9chIeBg7oA7gjaWUWTVQAGE3LqBDCTlc9WOHfm7PkTqNCh54rePDqB6M+lR536hCpUqs2gVZM+xbrTqtGoWqdy1emValeXKzggYBBB5y1acFNZmEvXAoN2cGfJrTv3bl69Ffj2xZt3L1+/fw3XRVw4sGDGcR0fJhxZsF3KtBTThZxZ8mLMgC3fRatCbYMNFCzwLEqLgE4NsDWs/tvqdezZf13Hvk2A9Szdu2X3pg18N+68xXn7rh1c+PLksI/Dhe6cuO3ow3NfV92bdArTqC2Ebd3A8vjf5QWfH6Bg7Nz17c2fj69+fnq+8N2Lty+fuP78/eV2X13neIcCeBRwxorbZrA1ANoCDGrgoG8RTshahQ9iSKEEzUmYIYfNWViUhheCGJyIP5E4oom7WWjgCeBFAJNv1DVV01MAdJhhjdkplWNzO/5oXI846njjVEIqR2OS2B1pE5PVscajkxhMycqLJghQSwT40PgfAl4GqNSXYdZXJn5gSkmmmmJu1aZYb14V51do+pTOCmA40AqVCIhG5IJ9PvYnhIFOxmdqhpaI6GeHCtpooisuutmg+Eg62KOMKuqoTaXgicQWoIYq6qiklmoqFV0UoeqqrLbq6quwxirrrLTWauutJ4QAACH5BAUKABwALAcABADOAAsAAAX/IPd0D2dyRCoUp/k8gpHOKtseR9yiSmGbuBykler9XLAhkbDavXTL5k2oqFqNOxzUZPU5YYZd1XsD72rZpBjbeh52mSNnMSC8lwblKZGwi+0QfIJ8CncnCoCDgoVnBHmKfByGJimPkIwtiAeBkH6ZHJaKmCeVnKKTHIihg5KNq4uoqmEtcRUtEREMBggtEr4QDrjCuRC8h7/BwxENeicSF8DKy82pyNLMOxzWygzFmdvD2L3P0dze4+Xh1Arkyepi7dfFvvTtLQkZBC0T/FX3CRgCMOBHsJ+EHYQY7OinAGECgQsB+Lu3AOK+CewcWjwxQeJBihtNGHSoQOE+iQ3//4XkwBBhRZMcUS6YSXOAwIL8PGqEaSJCiYt9SNoCmnJPAgUVLChdaoFBURN8MAzl2PQphwQLfDFd6lTowglHve6rKpbjhK7/pG5VinZP1qkiz1rl4+tr2LRwWU64cFEihwEtZgbgR1UiHaMVvxpOSwBA37kzGz9e8G+B5MIEKLutOGEsAH2ATQwYfTmuX8aETWdGPZmiZcccNSzeTCA1Sw0bdiitC7LBWgu8jQr8HRzqgpK6gX88QbrB14z/kF+ELpwB8eVQj/JkqdylAudji/+ts3039vEEfK8Vz2dlvxZKG0CmbkKDBvllRd6fCzDvBLKBDSCeffhRJEFebFk1k/Mv9jVIoIJZSeBggwUaNeB+Qk34IE0cXlihcfRxkOAJFFhwGmKlmWDiakZhUJtnLBpnWWcnKaAZcxI0piFGGLBm1mc90kajSCveeBVWKeYEoU2wqeaQi0PetoE+rr14EpVC7oAbAUHqhYExbn2XHHsVqbcVew9tx8+XJKk5AZsqqdlddGpqAKdbAYBn1pcczmSTdWvdmZ17c1b3FZ99vnTdCRFM8OEcAhLwm1NdXnWcBBSMRWmfkWZqVlsmLIiAp/o1gGV2vpS4lalGYsUOqXrddcKCmK61aZ8SjEpUpVFVoCpTj4r661Km7kBHjrDyc1RAIQAAIfkEBQoAGwAsBwAEAM4ACwAABf/gtmUCd4goQQgFKj6PYKi0yrrbc8i4ohQt12EHcal+MNSQiCP8gigdz7iCioaCIvUmZLp8QBzW0EN2vSlCuDtFKaq4RyHzQLEKZNdiQDhRDVooCwkbfm59EAmKi4SGIm+AjIsKjhsqB4mSjT2IOIOUnICeCaB/mZKFNTSRmqVpmJqklSqskq6PfYYCDwYHDC4REQwGCBLGxxIQDsHMwhAIX8bKzcENgSLGF9PU1j3Sy9zX2NrgzQziChLk1BHWxcjf7N046tvN82715czn9Pryz6Ilc4ACj4EBOCZM8KEnAYYADBRKnACAYUMFv1wotIhCEcaJCisqwJFgAUSQGyX/kCSVUUTIdKMwJlyo0oXHlhskwrTJciZHEXsgaqS4s6PJiCAr1uzYU8kBBSgnWFqpoMJMUjGtDmUwkmfVmVypakWhEKvXsS4nhLW5wNjVroJIoc05wSzTr0PtiigpYe4EC2vj4iWrFu5euWIMRBhacaVJhYQBEFjA9jHjyQ0xEABwGceGAZYjY0YBOrRLCxUp29QM+bRkx5s7ZyYgVbTqwwti2ybJ+vLtDYpycyZbYOlptxdx0kV+V7lC5iJAyyRrwYKxAdiz82ng0/jnAdMJFz0cPi104Ec1Vj9/M6F173vKL/feXv156dw11tlqeMMnv4V5Ap53GmjQQH97nFfg+IFiucfgRX5Z8KAgbUlQ4IULIlghhhdOSB6AgX0IVn8eReghen3NRIBsRgnH4l4LuEidZBjwRpt6NM5WGwoW0KSjCwX6yJSMab2GwwAPDXfaBCtWpluRTQqC5JM5oUZAjUNS+VeOLWpJEQ7VYQANW0INJSZVDFSnZphjSikfmzE5N4EEbQI1QJmnWXCmHulRp2edwDXF43txukenJwvI9xyg9Q26Z3MzGUcBYFEChZh6DVTq34AU8Iflh51Sd+CnKFYQ6mmZkhqfBKfSxZWqA9DZanWjxmhrWwi0qtCrt/43K6WqVjjpmhIqgEGvculaGKklKstAACEAACH5BAUKABwALAcABADOAAsAAAX/ICdyQmaMYyAUqPgIBiHPxNpy79kqRXH8wAPsRmDdXpAWgWdEIYm2llCHqjVHU+jjJkwqBTecwItShMXkEfNWSh8e1NGAcLgpDGlRgk7EJ/6Ae3VKfoF/fDuFhohVeDeCfXkcCQqDVQcQhn+VNDOYmpSWaoqBlUSfmowjEA+iEAEGDRGztAwGCDcXEA60tXEiCrq8vREMEBLIyRLCxMWSHMzExnbRvQ2Sy7vN0zvVtNfU2tLY3rPgLdnDvca4VQS/Cpk3ABwSLQkYAQwT/P309vcI7OvXr94jBQMJ/nskkGA/BQBRLNDncAIAiDcG6LsxAWOLiQzmeURBKWSLCQbv/1F0eDGinJUKR47YY1IEgQASKk7Yc7ACRwZm7mHweRJoz59BJUogisKCUaFMR0x4SlJBVBFTk8pZivTR0K73rN5wqlXEAq5Fy3IYgHbEzQ0nLy4QSoCjXLoom96VOJEeCosK5n4kkFfqXjl94wa+l1gvAcGICbewAOAxY8l/Ky/QhAGz4cUkGxu2HNozhwMGBnCUqUdBg9UuW9eUynqSwLHIBujePef1ZGQZXcM+OFuEBeBhi3OYgLyqcuaxbT9vLkf4SeqyWxSQpKGB2gQpm1KdWbu72rPRzR9Ne2Nu9Kzr/1Jqj0yD/fvqP4aXOt5sW/5qsXXVcv1Nsp8IBUAmgswGF3llGgeU1YVXXKTN1FlhWFXW3gIE+DVChApysACHHo7Q4A35lLichh+ROBmLKAzgYmYEYDAhCgxKGOOMn4WR4kkDaoBBOxJtdNKQxFmg5JIWIBnQc07GaORfUY4AEkdV6jHlCEISSZ5yTXpp1pbGZbkWmcuZmQCaE6iJ0FhjMaDjTMsgZaNEHFRAQVp3bqXnZED1qYcECOz5V6BhSWCoVJQIKuKQi2KFKEkEFAqoAo7uYSmO3jk61wUUMKmknJ4SGimBmAa0qVQBhAAAIfkEBQoAGwAsBwAEAM4ACwAABf/gJm5FmRlEqhJC+bywgK5pO4rHI0D3pii22+Mg6/0Ej96weCMAk7cDkXf7lZTTnrMl7eaYoy10JN0ZFdco0XAuvKI6qkgVFJXYNwjkIBcNBgR8TQoGfRsJCRuCYYQQiI+ICosiCoGOkIiKfSl8mJkHZ4U9kZMbKaI3pKGXmJKrngmug4WwkhA0lrCBWgYFCCMQFwoQDRHGxwwGCBLMzRLEx8iGzMMO0cYNeCMKzBDW19lnF9DXDIY/48Xg093f0Q3s1dcR8OLe8+Y91OTv5wrj7o7B+7VNQqABIoRVCMBggsOHE36kSoCBIcSH3EbFangxogJYFi8CkJhqQciLJEf/LDDJEeJIBT0GsOwYUYJGBS0fjpQAMidGmyVP6sx4Y6VQhzs9VUwkwqaCCh0tmKoFtSMDmBOf9phg4SrVrROuasRQAaxXpVUhdsU6IsECZlvX3kwLUWzRt0BHOLTbNlbZG3vZinArge5Dvn7wbqtQkSYAAgtKmnSsYKVKo2AfW048uaPmG386i4Q8EQMBAIAnfB7xBxBqvapJ9zX9WgRS2YMpnvYMGdPK3aMjt/3dUcNI4blpj7iwkMFWDXDvSmgAlijrt9RTR78+PS6z1uAJZIe93Q8g5zcsWCi/4Y+C8bah5zUv3vv89uft30QP23punGCx5954oBBwnwYaNCDY/wYrsYeggnM9B2Fpf8GG2CEUVWhbWAtGouEGDy7Y4IEJVrbSiXghqGKIo7z1IVcXIkKWWR361QOLWWnIhwERpLaaCCee5iMBGJQmJGyPFTnbkfHVZGRtIGrg5HALEJAZbu39BuUEUmq1JJQIPtZilY5hGeSWsSk52G9XqsmgljdIcABytq13HyIM6RcUA+r1qZ4EBF3WHWB29tBgAzRhEGhig8KmqKFv8SeCeo+mgsF7YFXa1qWSbkDpom/mqR1PmHCqJ3fwNRVXjC7S6CZhFVCQ2lWvZiirhQq42SACt25IK2hv8TprriUV1usGgeka7LFcNmCldMLi6qZMgFLgpw16Cipb7bC1knXsBiEAACH5BAUKABsALAcABADOAAsAAAX/4FZsJPkUmUGsLCEUTywXglFuSg7fW1xAvNWLF6sFFcPb42C8EZCj24EJdCp2yoegWsolS0Uu6fmamg8n8YYcLU2bXSiRaXMGvqV6/KAeJAh8VgZqCX+BexCFioWAYgqNi4qAR4ORhRuHY408jAeUhAmYYiuVlpiflqGZa5CWkzc5fKmbbhIpsAoQDRG8vQwQCBLCwxK6vb5qwhfGxxENahvCEA7NzskSy7vNzzzK09W/PNHF1NvX2dXcN8K55cfh69Luveol3vO8zwi4Yhj+AQwmCBw4IYclDAAJDlQggVOChAoLKkgFkSCAHDwWLKhIEOONARsDKryogFPIiAUb/95gJNIiw4wnI778GFPhzBKFOAq8qLJEhQpiNArjMcHCmlTCUDIouTKBhApELSxFWiGiVKY4E2CAekPgUphDu0742nRrVLJZnyrFSqKQ2ohoSYAMW6IoDpNJ4bLdILTnAj8KUF7UeENjAKuDyxIgOuGiOI0EBBMgLNew5AUrDTMGsFixwBIaNCQuAXJB57qNJ2OWm2Aj4skwCQCIyNkhhtMkdsIuodE0AN4LJDRgfLPtn5YDLdBlraAByuUbBgxQwICxMOnYpVOPej074OFdlfc0TqC62OIbcppHjV4o+LrieWhfT8JC/I/T6W8oCl29vQ0XjLdBaA3s1RcPBO7lFvpX8BVoG4O5jTXRQRDuJ6FDTzEWF1/BCZhgbyAKE9qICYLloQYOFtahVRsWYlZ4KQJHlwHS/IYaZ6sZd9tmu5HQm2xi1UaTbzxYwJk/wBF5g5EEYOBZeEfGZmNdFyFZmZIR4jikbLThlh5kUUVJGmRT7sekkziRWUIACABk3T4qCsedgO4xhgGcY7q5pHJ4klBBTQRJ0CeHcoYHHUh6wgfdn9uJdSdMiebGJ0zUPTcoS286FCkrZxnYoYYKWLkBowhQoBeaOlZAgVhLidrXqg2GiqpQpZ4apwSwRtjqrB3muoF9BboaXKmshlqWqsWiGt2wphJkQbAU5hoCACH5BAUKABsALAcABADOAAsAAAX/oGFw2WZuT5oZROsSQnGaKjRvilI893MItlNOJ5v5gDcFrHhKIWcEYu/xFEqNv6B1N62aclysF7fsZYe5aOx2yL5aAUGSaT1oTYMBwQ5VGCAJgYIJCnx1gIOBhXdwiIl7d0p2iYGQUAQBjoOFSQR/lIQHnZ+Ue6OagqYzSqSJi5eTpTxGcjcSChANEbu8DBAIEsHBChe5vL13G7fFuscRDcnKuM3H0La3EA7Oz8kKEsXazr7Cw9/Gztar5uHHvte47MjktznZ2w0G1+D3BgirAqJmJMAQgMGEgwgn5Ei0gKDBhBMALGRYEOJBb5QcWlQo4cbAihZz3GgIMqFEBSM1/4ZEOWPAgpIIJXYU+PIhRG8ja1qU6VHlzZknJNQ6UanCjQkWCIGSUGEjAwVLjc44+DTqUQtPPS5gejUrTa5TJ3g9sWCr1BNUWZI161StiQUDmLYdGfesibQ3XMq1OPYthrwuA2yU2LBs2cBHIypYQPPlYAKFD5cVvNPtW8eVGbdcQADATsiNO4cFAPkvHpedPzc8kUcPgNGgZ5RNDZG05reoE9s2vSEP79MEGiQGy1qP8LA4ZcdtsJE48ONoLTBtTV0B9LsTnPceoIDBDQvS7W7vfjVY3q3eZ4A339J4eaAmKqU/sV58HvJh2RcnIBsDUw0ABqhBA5aV5V9XUFGiHfVeAiWwoFgJJrIXRH1tEMiDFV4oHoAEGlaWhgIGSGBO2nFomYY3mKjVglidaNYJGJDkWW2xxTfbjCbVaOGNqoX2GloR8ZeTaECS9pthRGJH2g0b3Agbk6hNANtteHD2GJUucfajCQBy5OOTQ25ZgUPvaVVQmbKh9510/qQpwXx3SQdfk8tZJOd5b6JJFplT3ZnmmX3qd5l1eg5q00HrtUkUn0AKaiGjClSAgKLYZcgWXwocGRcCFGCKwSB6ceqphwmYRUFYT/1WKlOdUpipmxW0mlCqHjYkAaeoZlqrqZ4qd+upQKaapn/AmgAegZ8KUtYtFAQQAgAh+QQFCgAbACwHAAQAzgALAAAF/+C2PUcmiCiZGUTrEkKBis8jQEquKwU5HyXIbEPgyX7BYa5wTNmEMwWsSXsqFbEh8DYs9mrgGjdK6GkPY5GOeU6ryz7UFopSQEzygOGhJBjoIgMDBAcBM0V/CYqLCQqFOwobiYyKjn2TlI6GKC2YjJZknouaZAcQlJUHl6eooJwKooobqoewrJSEmyKdt59NhRKFMxLEEA4RyMkMEAjDEhfGycqAG8TQx9IRDRDE3d3R2ctD1RLg0ttKEnbY5wZD3+zJ6M7X2RHi9Oby7u/r9g38UFjTh2xZJBEBMDAboogAgwkQI07IMUORwocSJwCgWDFBAIwZOaJIsOBjRogKJP8wTODw5ESVHVtm3AhzpEeQElOuNDlTZ0ycEUWKWFASqEahGwYUPbnxoAgEdlYSqDBkgoUNClAlIHbSAoOsqCRQnQHxq1axVb06FWFxLIqyaze0Tft1JVqyE+pWXMD1pF6bYl3+HTqAWNW8cRUFzmih0ZAAB2oGKukSAAGGRHWJgLiR6AylBLpuHKKUMlMCngMpDSAa9QIUggZVVvDaJobLeC3XZpvgNgCmtPcuwP3WgmXSq4do0DC6o2/guzcseECtUoO0hmcsGKDgOt7ssBd07wqesAIGZC1YIBa7PQHvb1+SFo+++HrJSQfB33xfav3i5eX3Hnb4CTJgegEq8tH/YQEOcIJzbm2G2EoYRLgBXFpVmFYDcREV4HIcnmUhiGBRouEMJGJGzHIspqgdXxK0yCKHRNXoIX4uorCdTyjkyNtdPWrA4Up82EbAbzMRxxZRR54WXVLDIRmRcag5d2R6ugl3ZXzNhTecchpMhIGVAKAYpgJjjsSklBEd99maZoo535ZvdamjBEpusJyctg3h4X8XqodBMx0tiNeg/oGJaKGABpogS40KSqiaEgBqlQWLUtqoVQnytekEjzo0hHqhRorppOZt2p923M2AAV+oBtpAnnPNoB6HaU6mAAIU+IXmi3j2mtFXuUoHKwXpzVrsjcgGOauKEjQrwq157hitGq2NoWmjh7z6Wmxb0m5w66+2VRAuXN/yFUAIACH5BAUKABsALAcABADOAAsAAAX/4CZuRiaM45MZqBgIRbs9AqTcuFLE7VHLOh7KB5ERdjJaEaU4ClO/lgKWjKKcMiJQ8KgumcieVdQMD8cbBeuAkkC6LYLhOxoQ2PF5Ys9PKPBMen17f0CCg4VSh32JV4t8jSNqEIOEgJKPlkYBlJWRInKdiJdkmQlvKAsLBxdABA4RsbIMBggtEhcQsLKxDBC2TAS6vLENdJLDxMZAubu8vjIbzcQRtMzJz79S08oQEt/guNiyy7fcvMbh4OezdAvGrakLAQwyABsELQkY9BP+//ckyPDD4J9BfAMh1GsBoImMeQUN+lMgUJ9CiRMa5msxoB9Gh/o8GmxYMZXIgxtR/yQ46S/gQAURR0pDwYDfywoyLPip5AdnCwsMFPBU4BPFhKBDi444quCmDKZOfwZ9KEGpCKgcN1jdALSpPqIYsabS+nSqvqplvYqQYAeDPgwKwjaMtiDl0oaqUAyo+3TuWwUAMPpVCfee0cEjVBGQq2ABx7oTWmQk4FglZMGN9fGVDMCuiH2AOVOu/PmyxM630gwM0CCn6q8LjVJ8GXvpa5Uwn95OTC/nNxkda1/dLSK475IjCD6dHbK1ZOa4hXP9DXs5chJ00UpVm5xo2qRpoxptwF2E4/IbJpB/SDz9+q9b1aNfQH08+p4a8uvX8B53fLP+ycAfemjsRUBgp1H20K+BghHgVgt1GXZXZpZ5lt4ECjxYR4ScUWiShEtZqBiIInRGWnERNnjiBglw+JyGnxUmGowsyiiZg189lNtPGACjV2+S9UjbU0JWF6SPvEk3QZEqsZYTk3UAaRSUnznJI5LmESCdBVSyaOWUWLK4I5gDUYVeV1T9l+FZClCAUVA09uSmRHBCKAECFEhW51ht6rnmWBXkaR+NjuHpJ40D3DmnQXt2F+ihZxlqVKOfQRACACH5BAUKABwALAcABADOAAsAAAX/ICdyUCkUo/g8mUG8MCGkKgspeC6j6XEIEBpBUeCNfECaglBcOVfJFK7YQwZHQ6JRZBUqTrSuVEuD3nI45pYjFuWKvjjSkCoRaBUMWxkwBGgJCXspQ36Bh4EEB0oKhoiBgyNLjo8Ki4QElIiWfJqHnISNEI+Ql5J9o6SgkqKkgqYihamPkW6oNBgSfiMMDQkGCBLCwxIQDhHIyQwQCGMKxsnKVyPCF9DREQ3MxMPX0cu4wt7J2uHWx9jlKd3o39MiuefYEcvNkuLt5O8c1ePI2tyELXGQwoGDAQf+iEC2xByDCRAjTlAgIUWCBRgCPJQ4AQBFXAs0coT40WLIjRxL/47AcHLkxIomRXL0CHPERZkpa4q4iVKiyp0tR/7kwHMkTUBBJR5dOCEBAVcKKtCAyOHpowXCpk7goABqBZdcvWploACpBKkpIJI1q5OD2rIWE0R1uTZu1LFwbWL9OlKuWb4c6+o9i3dEgw0RCGDUG9KlRw56gDY2qmCByZBaASi+TACA0TucAaTteCcy0ZuOK3N2vJlx58+LRQyY3Xm0ZsgjZg+oPQLi7dUcNXi0LOJw1pgNtB7XG6CBy+U75SYfPTSQAgZTNUDnQHt67wnbZyvwLgKiMN3oCZB3C76tdewpLFgIP2C88rbi4Y+QT3+8S5USMICZXWj1pkEDeUU3lOYGB3alSoEiMIjgX4WlgNF2EibIwQIXauWXSRg2SAOHIU5IIIMoZkhhWiJaiFVbKo6AQEgQXrTAazO1JhkBrBG3Y2Y6EsUhaGn95hprSN0oWpFE7rhkeaQBchGOEWnwEmc0uKWZj0LeuNV3W4Y2lZHFlQCSRjTIl8uZ+kG5HU/3sRlnTG2ytyadytnD3HrmuRcSn+0h1dycexIK1KCjYaCnjCCVqOFFJTZ5GkUUjESWaUIKU2lgCmAKKQIUjHapXRKE+t2og1VgankNYnohqKJ2CmKplso6GKz7WYCgqxeuyoF8u9IQAgA7",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:'fast',start:undefined},state:{isDuringAjax:false,isInvalidPage:false,isDestroyed:false,isDone:false,isPaused:false,isBeyondMaxPage:false,currPage:1},debug:false,behavior:undefined,binder:$(window),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:false,pathParse:undefined,dataType:'html',appendCallback:true,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:undefined,path:undefined,prefill:false,maxPage:undefined};$.infinitescroll.prototype={_binding:function infscr_binding(binding){var instance=this,opts=instance.options;opts.v='2.0b2.120520';if(!!opts.behavior&&this['_binding_'+opts.behavior]!==undefined){this['_binding_'+opts.behavior].call(this);return;}
if(binding!=='bind'&&binding!=='unbind'){this._debug('Binding value  '+binding+' not valid');return false;}
if(binding==='unbind'){(this.options.binder).unbind('smartscroll.infscr.'+instance.options.infid);}else{(this.options.binder)[binding]('smartscroll.infscr.'+instance.options.infid,function(){instance.scroll();});}
this._debug('Binding',binding);},_create:function infscr_create(options,callback){var opts=$.extend(true,{},$.infinitescroll.defaults,options);this.options=opts;var $window=$(window);var instance=this;if(!instance._validate(options)){return false;}
var path=$(opts.nextSelector).attr('href');if(!path){this._debug('Navigation selector not found');return false;}
opts.path=opts.path||this._determinepath(path);opts.contentSelector=opts.contentSelector||this.element;opts.loading.selector=opts.loading.selector||opts.contentSelector;opts.loading.msg=opts.loading.msg||$('<div id="infscr-loading"><img alt="Loading..." src="'+opts.loading.img+'" /><div>'+opts.loading.msgText+'</div></div>');(new Image()).src=opts.loading.img;if(opts.pixelsFromNavToBottom===undefined){opts.pixelsFromNavToBottom=$(document).height()-$(opts.navSelector).offset().top;this._debug("pixelsFromNavToBottom: "+opts.pixelsFromNavToBottom);}
var self=this;opts.loading.start=opts.loading.start||function(){$(opts.navSelector).hide();opts.loading.msg.appendTo(opts.loading.selector).show(opts.loading.speed,$.proxy(function(){this.beginAjax(opts);},self));};opts.loading.finished=opts.loading.finished||function(){if(!opts.state.isBeyondMaxPage)
opts.loading.msg.fadeOut(opts.loading.speed);};opts.callback=function(instance,data,url){if(!!opts.behavior&&instance['_callback_'+opts.behavior]!==undefined){instance['_callback_'+opts.behavior].call($(opts.contentSelector)[0],data,url);}
if(callback){callback.call($(opts.contentSelector)[0],data,opts,url);}
if(opts.prefill){$window.bind("resize.infinite-scroll",instance._prefill);}};if(options.debug){if(Function.prototype.bind&&(typeof console==='object'||typeof console==='function')&&typeof console.log==="object"){["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(method){console[method]=this.call(console[method],console);},Function.prototype.bind);}}
this._setup();if(opts.prefill){this._prefill();}
return true;},_prefill:function infscr_prefill(){var instance=this;var $window=$(window);function needsPrefill(){return(instance.options.contentSelector.height()<=$window.height());}
this._prefill=function(){if(needsPrefill()){instance.scroll();}
$window.bind("resize.infinite-scroll",function(){if(needsPrefill()){$window.unbind("resize.infinite-scroll");instance.scroll();}});};this._prefill();},_debug:function infscr_debug(){if(true!==this.options.debug){return;}
if(typeof console!=='undefined'&&typeof console.log==='function'){if((Array.prototype.slice.call(arguments)).length===1&&typeof Array.prototype.slice.call(arguments)[0]==='string'){console.log((Array.prototype.slice.call(arguments)).toString());}else{console.log(Array.prototype.slice.call(arguments));}}else if(!Function.prototype.bind&&typeof console!=='undefined'&&typeof console.log==='object'){Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments));}},_determinepath:function infscr_determinepath(path){var opts=this.options;if(!!opts.behavior&&this['_determinepath_'+opts.behavior]!==undefined){return this['_determinepath_'+opts.behavior].call(this,path);}
if(!!opts.pathParse){this._debug('pathParse manual');return opts.pathParse(path,this.options.state.currPage+1);}else if(path.match(/^(.*?)\b2\b(.*?$)/)){path=path.match(/^(.*?)\b2\b(.*?$)/).slice(1);}else if(path.match(/^(.*?)2(.*?$)/)){if(path.match(/^(.*?page=)2(\/.*|$)/)){path=path.match(/^(.*?page=)2(\/.*|$)/).slice(1);return path;}
path=path.match(/^(.*?)2(.*?$)/).slice(1);}else{if(path.match(/^(.*?page=)1(\/.*|$)/)){path=path.match(/^(.*?page=)1(\/.*|$)/).slice(1);return path;}else{this._debug('Sorry, we couldn\'t parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.');opts.state.isInvalidPage=true;}}
this._debug('determinePath',path);return path;},_error:function infscr_error(xhr){var opts=this.options;if(!!opts.behavior&&this['_error_'+opts.behavior]!==undefined){this['_error_'+opts.behavior].call(this,xhr);return;}
if(xhr!=='destroy'&&xhr!=='end'){xhr='unknown';}
this._debug('Error',xhr);if(xhr==='end'||opts.state.isBeyondMaxPage){this._showdonemsg();}
opts.state.isDone=true;opts.state.currPage=1;opts.state.isPaused=false;opts.state.isBeyondMaxPage=false;this._binding('unbind');},_loadcallback:function infscr_loadcallback(box,data,url){var opts=this.options,callback=this.options.callback,result=(opts.state.isDone)?'done':(!opts.appendCallback)?'no-append':'append',frag;if(!!opts.behavior&&this['_loadcallback_'+opts.behavior]!==undefined){this['_loadcallback_'+opts.behavior].call(this,box,data);return;}
switch(result){case'done':this._showdonemsg();return false;case'no-append':if(opts.dataType==='html'){data='<div>'+data+'</div>';data=$(data).find(opts.itemSelector);}
break;case'append':var children=box.children();if(children.length===0){return this._error('end');}
frag=document.createDocumentFragment();while(box[0].firstChild){frag.appendChild(box[0].firstChild);}
this._debug('contentSelector',$(opts.contentSelector)[0]);$(opts.contentSelector)[0].appendChild(frag);data=children.get();break;}
opts.loading.finished.call($(opts.contentSelector)[0],opts);if(opts.animate){var scrollTo=$(window).scrollTop()+$(opts.loading.msg).height()+opts.extraScrollPx+'px';$('html,body').animate({scrollTop:scrollTo},800,function(){opts.state.isDuringAjax=false;});}
if(!opts.animate){opts.state.isDuringAjax=false;}
callback(this,data,url);if(opts.prefill){this._prefill();}},_nearbottom:function infscr_nearbottom(){var opts=this.options,pixelsFromWindowBottomToBottom=0+$(document).height()-(opts.binder.scrollTop())-$(window).height();if(!!opts.behavior&&this['_nearbottom_'+opts.behavior]!==undefined){return this['_nearbottom_'+opts.behavior].call(this);}
this._debug('math:',pixelsFromWindowBottomToBottom,opts.pixelsFromNavToBottom);return(pixelsFromWindowBottomToBottom-opts.bufferPx<opts.pixelsFromNavToBottom);},_pausing:function infscr_pausing(pause){var opts=this.options;if(!!opts.behavior&&this['_pausing_'+opts.behavior]!==undefined){this['_pausing_'+opts.behavior].call(this,pause);return;}
if(pause!=='pause'&&pause!=='resume'&&pause!==null){this._debug('Invalid argument. Toggling pause value instead');}
pause=(pause&&(pause==='pause'||pause==='resume'))?pause:'toggle';switch(pause){case'pause':opts.state.isPaused=true;break;case'resume':opts.state.isPaused=false;break;case'toggle':opts.state.isPaused=!opts.state.isPaused;break;}
this._debug('Paused',opts.state.isPaused);return false;},_setup:function infscr_setup(){var opts=this.options;if(!!opts.behavior&&this['_setup_'+opts.behavior]!==undefined){this['_setup_'+opts.behavior].call(this);return;}
this._binding('bind');return false;},_showdonemsg:function infscr_showdonemsg(){var opts=this.options;if(!!opts.behavior&&this['_showdonemsg_'+opts.behavior]!==undefined){this['_showdonemsg_'+opts.behavior].call(this);return;}
opts.loading.msg.find('img').hide().parent().find('div').html(opts.loading.finishedMsg).animate({opacity:1},2000,function(){$(this).parent().fadeOut(opts.loading.speed);});opts.errorCallback.call($(opts.contentSelector)[0],'done');},_validate:function infscr_validate(opts){for(var key in opts){if(key.indexOf&&key.indexOf('Selector')>-1&&$(opts[key]).length===0){this._debug('Your '+key+' found no elements.');return false;}}
return true;},bind:function infscr_bind(){this._binding('bind');},destroy:function infscr_destroy(){this.options.state.isDestroyed=true;this.options.loading.finished();return this._error('destroy');},pause:function infscr_pause(){this._pausing('pause');},resume:function infscr_resume(){this._pausing('resume');},beginAjax:function infscr_ajax(opts){var instance=this,path=opts.path,box,desturl,method,condition;opts.state.currPage++;if(opts.maxPage!=undefined&&opts.state.currPage>opts.maxPage){opts.state.isBeyondMaxPage=true;this.destroy();return;}
box=$(opts.contentSelector).is('table, tbody')?$('<tbody/>'):$('<div/>');desturl=(typeof path==='function')?path(opts.state.currPage):path.join(opts.state.currPage);instance._debug('heading into ajax',desturl);method=(opts.dataType==='html'||opts.dataType==='json')?opts.dataType:'html+callback';if(opts.appendCallback&&opts.dataType==='html'){method+='+callback';}
switch(method){case'html+callback':instance._debug('Using HTML via .load() method');box.load(desturl+' '+opts.itemSelector,undefined,function infscr_ajax_callback(responseText){instance._loadcallback(box,responseText,desturl);});break;case'html':instance._debug('Using '+(method.toUpperCase())+' via $.ajax() method');$.ajax({url:desturl,dataType:opts.dataType,complete:function infscr_ajax_callback(jqXHR,textStatus){condition=(typeof(jqXHR.isResolved)!=='undefined')?(jqXHR.isResolved()):(textStatus==="success"||textStatus==="notmodified");if(condition){instance._loadcallback(box,jqXHR.responseText,desturl);}else{instance._error('end');}}});break;case'json':instance._debug('Using '+(method.toUpperCase())+' via $.ajax() method');$.ajax({dataType:'json',type:'GET',url:desturl,success:function(data,textStatus,jqXHR){condition=(typeof(jqXHR.isResolved)!=='undefined')?(jqXHR.isResolved()):(textStatus==="success"||textStatus==="notmodified");if(opts.appendCallback){if(opts.template!==undefined){var theData=opts.template(data);box.append(theData);if(condition){instance._loadcallback(box,theData);}else{instance._error('end');}}else{instance._debug("template must be defined.");instance._error('end');}}else{if(condition){instance._loadcallback(box,data,desturl);}else{instance._error('end');}}},error:function(){instance._debug("JSON ajax request failed.");instance._error('end');}});break;}},retrieve:function infscr_retrieve(pageNum){pageNum=pageNum||null;var instance=this,opts=instance.options;if(!!opts.behavior&&this['retrieve_'+opts.behavior]!==undefined){this['retrieve_'+opts.behavior].call(this,pageNum);return;}
if(opts.state.isDestroyed){this._debug('Instance is destroyed');return false;}
opts.state.isDuringAjax=true;opts.loading.start.call($(opts.contentSelector)[0],opts);},scroll:function infscr_scroll(){var opts=this.options,state=opts.state;if(!!opts.behavior&&this['scroll_'+opts.behavior]!==undefined){this['scroll_'+opts.behavior].call(this);return;}
if(state.isDuringAjax||state.isInvalidPage||state.isDone||state.isDestroyed||state.isPaused){return;}
if(!this._nearbottom()){return;}
this.retrieve();},toggle:function infscr_toggle(){this._pausing();},unbind:function infscr_unbind(){this._binding('unbind');},update:function infscr_options(key){if($.isPlainObject(key)){this.options=$.extend(true,this.options,key);}}};$.fn.infinitescroll=function infscr_init(options,callback){var thisCall=typeof options;switch(thisCall){case'string':var args=Array.prototype.slice.call(arguments,1);this.each(function(){var instance=$.data(this,'infinitescroll');if(!instance){return false;}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return false;}
instance[options].apply(instance,args);});break;case'object':this.each(function(){var instance=$.data(this,'infinitescroll');if(instance){instance.update(options);}else{instance=new $.infinitescroll(options,callback,this);if(!instance.failed){$.data(this,'infinitescroll',instance);}}});break;}
return this;};var event=$.event,scrollTimeout;event.special.smartscroll={setup:function(){$(this).bind("scroll",event.special.smartscroll.handler);},teardown:function(){$(this).unbind("scroll",event.special.smartscroll.handler);},handler:function(event,execAsap){var context=this,args=arguments;event.type="smartscroll";if(scrollTimeout){clearTimeout(scrollTimeout);}
scrollTimeout=setTimeout(function(){$(context).trigger('smartscroll',args);},execAsap==="execAsap"?0:100);}};$.fn.smartscroll=function(fn){return fn?this.bind("smartscroll",fn):this.trigger("smartscroll",["execAsap"]);};})(window,jQuery);if(typeof img_resize==='function'){img_resize("#wrapper");}else{$(function(){img_resize("#wrapper");});}
(function(window,undefined){var _IE=(function(){var v=3,div=document.createElement('div'),all=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->',all[0]);return v>4?v:false;}());var History=window.History;var State=History.getState();window.timer=true;window.do_not_refresh=false;window.menu_flag=false;window.prv_title=$('title').html();window.prv_url=State.hash;if(_IE<10){if(location.href.indexOf('#')>=0){window.prv_url=State.hash.replace('#','');if((State.hash.indexOf('#./')<0)||(State.hash.indexOf('./')<0)){if(location.href.indexOf('&_suid')>=0){History.pushState(null,window.prv_title,State.hash.replace('#','')+parseInt(Math.random()*(1000-100+1)+100));}}else{window.do_not_refresh=true;}}}
window.loading_indicator=new loadingIndicator('#loading_box');window.dna_upload_flag=true;window.photo_upload_flag=true;window.song_upload_flag=true;window.album_upload_flag=true;window.video_upload_flag=true;window.album_image_upload_flag=true;window.dna_upload_loaded=false;window.photo_upload_loaded=false;window.song_upload_loaded=false;window.album_upload_loaded=false;window.video_upload_loaded=false;window.album_image_upload_loaded=false;$(function(){dynamic();comment();init();initStreetVoiceSearch();bind_search_result_infinitescroll();});History.Adapter.bind(window,'statechange',function(){if($('#SocialShare').length>0){$('#SocialShare').remove();}
if(typeof countdown=="number"){window.clearInterval(countdown);}
var State=History.getState();href=State.hash;menu_active(href);var re=/^[\/]?dna\/manage\/upload\//g;if(re.test(href)){window.dna_upload_flag=true;window.photo_upload_flag=false;window.song_upload_flag=false;window.album_upload_flag=false;window.video_upload_flag=false;window.album_image_upload_flag=false;}
var re=/^[\/]?photo\/manage\/upload\//g;if(re.test(href)){window.dna_upload_flag=false;window.photo_upload_flag=true;window.song_upload_flag=false;window.album_upload_flag=false;window.video_upload_flag=false;window.album_image_upload_flag=false;}
var re=/^[\/]?music\/manage\/song\/upload\//g;if(re.test(href)){window.dna_upload_flag=false;window.photo_upload_flag=false;window.song_upload_flag=true;window.album_upload_flag=false;window.video_upload_flag=false;window.album_image_upload_flag=false;}
var re=/^music\/manage\/album\/\d+\/info\//g;if(re.test(href)){window.dna_upload_flag=false;window.photo_upload_flag=false;window.song_upload_flag=false;window.album_upload_flag=true;window.video_upload_flag=false;window.album_image_upload_flag=true;}
var re=/^[\/]?video\/manage\/upload\//g;if(re.test(href)){window.dna_upload_flag=false;window.photo_upload_flag=false;window.song_upload_flag=false;window.album_upload_flag=false;window.video_upload_flag=true;window.album_image_upload_flag=false;}
var re=/^[\/]?music\/manage\/album\/create\//g;if(re.test(href)){window.dna_upload_flag=false;window.photo_upload_flag=false;window.song_upload_flag=false;window.album_upload_flag=true;window.video_upload_flag=false;window.album_image_upload_flag=true;}
if(window.do_not_refresh){window.do_not_refresh=false;if(_IE<10){if(window.prv_title==''){document.title='StreetVoice';}else{document.title=window.prv_title;}}else{window.prv_title=$('title').html();}
window.prv_url=State.hash;return false;}
$('.dropdown.open').removeClass('open');var state=History.getState();var backTopBottom=$('#back-top').css('bottom');var key=true;var is_popupcontent=false;_gaq.push(['_trackPageview',state.hash]);if($.isEmptyObject(state.data)){$.get(state.hash,function(data){if(data.redirect){History.pushState(null,null,data.redirect);}
var scrollcontent=$(data).siblings('#SocialShare');var popupcontent=$(data).siblings('#zoomScroll');if(popupcontent.length>0){if($('#zoomScroll').length>0){var popupFlag=$('#zoomScroll').attr('popup');$('#zoomScroll').replaceWith(popupcontent);$('body').prepend(scrollcontent);$('#zoomScroll').attr('popup',popupFlag);window.popupTimes+=1;}else{$('body').prepend(popupcontent);$('body').prepend(scrollcontent);$('#zoomScroll').attr('popup','yes');window.popupTimes=1;}
is_popupcontent=true;if(window.country_code!='CN'){if((typeof gapi)!="undefined"&&gapi.plusone){gapi.plusone.render(document.getElementById('gplusone'),{'href':location.href,'size':'small'});}}}else{window.popupTimes=0;if($('#zoomScroll').length>0){$('#zoomScroll').remove();}
var wrapper=$(data).siblings('#wrapper');if($(data).find('#item_box_list').length>0){key=false;}
$('#wrapper').removeClass().addClass(wrapper.attr('class'));$('#wrapper').html(wrapper.html());$('#wrapper').trigger('checktrendingtop');img_resize('#wrapper');bind_search_result_infinitescroll();}
if($(data).siblings('title').length>0){$('title').html($(data).siblings('title').html());}else{re=/<title>([\s\S]*?)<\/title>/g;if(re.test(data)){re=/<title>([\s\S]*?)<\/title>/g;title=re.exec(data)[1];document.title=title;}}
$('.content_wrapper.content_line.full_box p').find('a').each(function(){if(typeof($(this).attr('target'))=='undefined'){$(this).attr('target','_blank');}});}).success(function(){if(is_popupcontent){$('#zoomScroll').scrollTop(0);$('.banner_box .adunit').dfp({dfpID:'6531201',enableSingleRequest:false,afterAllAdsLoaded:function(){}});}
else{$('.lazy').lazyload({container:$('#wrapper')});if($('.works_list').length>0){$('.lazy').lazyload({container:$('.works_list')});}
$('#wrapper').scrollTop(0);$('#back-top').css('bottom',backTopBottom);$('.adunit').dfp({dfpID:'6531201',enableSingleRequest:false,afterAllAdsLoaded:function(){start_iosslider();$('.carousel').carousel({interval:5000});}});}
try{FB.XFBML.parse();}catch(ex){}});}else{$.post(state.hash,state.data,function(data){var wrapper=$(data).siblings('#wrapper');$('#wrapper').removeClass().addClass(wrapper.attr('class'));$('#wrapper').html(wrapper.html());$('#wrapper').trigger('checktrendingtop');}).success(function(){$('.lazy').lazyload({container:$('#wrapper')});if($('.works_list').length>0){$('.lazy').lazyload({container:$('.works_list')});}
$('#wrapper').scrollTop(1);});}
return false;});})(window);